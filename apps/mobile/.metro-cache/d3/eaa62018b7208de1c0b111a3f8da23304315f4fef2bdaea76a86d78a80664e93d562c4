{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":68,"index":68}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":69},"end":{"line":2,"column":42,"index":111}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"@/context/AuthProvider","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":112},"end":{"line":3,"column":49,"index":161}}],"key":"hnDMt1RwOyVwgo481TGNr6ITBm4=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":162},"end":{"line":4,"column":43,"index":205}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1], \"@tanstack/react-query\");\n  var _libSupabase = require(_dependencyMap[2], \"@/lib/supabase\");\n  var _contextAuthProvider = require(_dependencyMap[3], \"@/context/AuthProvider\");\n  var _queryKeys = require(_dependencyMap[4], \"../../queryKeys\");\n  /** Mutation hook that inserts a message with optimistic cache update */\n  var useSendMessage = () => {\n    _s();\n    var _useAuth = (0, _contextAuthProvider.useAuth)(),\n      user = _useAuth.user,\n      profile = _useAuth.profile;\n    var queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    return (0, _tanstackReactQuery.useMutation)({\n      mutationFn: function () {\n        var _ref = (0, _asyncToGenerator.default)(function* (input) {\n          if (!user) throw new Error('Must be signed in to send messages');\n          var _yield$supabase$from$ = yield _libSupabase.supabase.from('messages').insert({\n              conversation_id: input.conversationId,\n              sender_id: user.id,\n              type: input.type,\n              body: input.body ?? null,\n              payload: input.payload ?? null\n            }).select(`\n          *,\n          sender:users!messages_sender_id_fkey (\n            id,\n            display_name,\n            avatar_url\n          )\n        `).single(),\n            data = _yield$supabase$from$.data,\n            error = _yield$supabase$from$.error;\n          if (error) throw error;\n          return data;\n        });\n        return function mutationFn(_x) {\n          return _ref.apply(this, arguments);\n        };\n      }(),\n      onMutate: function () {\n        var _ref2 = (0, _asyncToGenerator.default)(function* (input) {\n          if (!user) return;\n          var messagesKey = _queryKeys.chatKeys.messages(input.conversationId);\n\n          // Cancel any outgoing refetches for this conversation\n          yield queryClient.cancelQueries({\n            queryKey: messagesKey\n          });\n\n          // Snapshot the previous value\n          var previousMessages = queryClient.getQueryData(messagesKey);\n\n          // Optimistically add the message to the first page\n          var optimisticMessage = {\n            id: `optimistic-${Date.now()}`,\n            conversation_id: input.conversationId,\n            sender_id: user.id,\n            type: input.type,\n            body: input.body ?? null,\n            payload: input.payload ?? null,\n            created_at: new Date().toISOString(),\n            sender: {\n              id: user.id,\n              display_name: profile?.display_name ?? 'You',\n              avatar_url: profile?.avatar_url ?? null\n            }\n          };\n          queryClient.setQueryData(messagesKey, old => {\n            if (!old) {\n              return {\n                pages: [[optimisticMessage]],\n                pageParams: [null]\n              };\n            }\n            return {\n              ...old,\n              pages: [[optimisticMessage, ...(old.pages[0] ?? [])], ...old.pages.slice(1)]\n            };\n          });\n          return {\n            previousMessages\n          };\n        });\n        return function onMutate(_x2) {\n          return _ref2.apply(this, arguments);\n        };\n      }(),\n      onError: (_err, input, context) => {\n        // Rollback on error\n        if (context?.previousMessages) {\n          queryClient.setQueryData(_queryKeys.chatKeys.messages(input.conversationId), context.previousMessages);\n        }\n      },\n      onSettled: (_data, _error, input) => {\n        // Refetch messages and conversations list\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.chatKeys.messages(input.conversationId)\n        });\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.chatKeys.conversations()\n        });\n      }\n    });\n  };\n  _s(useSendMessage, \"mIpLf/mRhxoV5NZVf4b+OHrmEj8=\", false, function () {\n    return [_contextAuthProvider.useAuth, _tanstackReactQuery.useQueryClient, _tanstackReactQuery.useMutation];\n  });\n  var _default = useSendMessage;\n});","lineCount":128,"map":[[13,2,121,0,"Object"],[13,8,121,0],[13,9,121,0,"defineProperty"],[13,23,121,0],[13,24,121,0,"exports"],[13,31,121,0],[14,4,121,0,"enumerable"],[14,14,121,0],[15,4,121,0,"get"],[15,7,121,0],[15,18,121,0,"get"],[15,19,121,0],[16,6,121,0],[16,13,121,0,"_default"],[16,21,121,0],[17,4,121,0],[18,2,121,0],[19,2,121,30],[19,6,121,30,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,121,30],[19,45,121,30,"require"],[19,52,121,30],[19,53,121,30,"_dependencyMap"],[19,67,121,30],[20,2,121,30],[20,6,121,30,"_asyncToGenerator"],[20,23,121,30],[20,26,121,30,"_interopDefault"],[20,41,121,30],[20,42,121,30,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,121,30],[21,2,1,0],[21,6,1,0,"_tanstackReactQuery"],[21,25,1,0],[21,28,1,0,"require"],[21,35,1,0],[21,36,1,0,"_dependencyMap"],[21,50,1,0],[22,2,2,0],[22,6,2,0,"_libSupabase"],[22,18,2,0],[22,21,2,0,"require"],[22,28,2,0],[22,29,2,0,"_dependencyMap"],[22,43,2,0],[23,2,3,0],[23,6,3,0,"_contextAuthProvider"],[23,26,3,0],[23,29,3,0,"require"],[23,36,3,0],[23,37,3,0,"_dependencyMap"],[23,51,3,0],[24,2,4,0],[24,6,4,0,"_queryKeys"],[24,16,4,0],[24,19,4,0,"require"],[24,26,4,0],[24,27,4,0,"_dependencyMap"],[24,41,4,0],[25,2,16,0],[26,2,17,0],[26,6,17,6,"useSendMessage"],[26,20,17,20],[26,23,17,23,"useSendMessage"],[26,24,17,23],[26,29,17,29],[27,4,17,29,"_s"],[27,6,17,29],[28,4,18,2],[28,8,18,2,"_useAuth"],[28,16,18,2],[28,19,18,28],[28,23,18,28,"useAuth"],[28,43,18,35],[28,44,18,35,"useAuth"],[28,51,18,35],[28,53,18,36],[28,54,18,37],[29,6,18,10,"user"],[29,10,18,14],[29,13,18,14,"_useAuth"],[29,21,18,14],[29,22,18,10,"user"],[29,26,18,14],[30,6,18,16,"profile"],[30,13,18,23],[30,16,18,23,"_useAuth"],[30,24,18,23],[30,25,18,16,"profile"],[30,32,18,23],[31,4,19,2],[31,8,19,8,"queryClient"],[31,19,19,19],[31,22,19,22],[31,26,19,22,"useQueryClient"],[31,45,19,36],[31,46,19,36,"useQueryClient"],[31,60,19,36],[31,62,19,37],[31,63,19,38],[32,4,21,2],[32,11,21,9],[32,15,21,9,"useMutation"],[32,34,21,20],[32,35,21,20,"useMutation"],[32,46,21,20],[32,48,21,21],[33,6,22,4,"mutationFn"],[33,16,22,14],[34,8,22,14],[34,12,22,14,"_ref"],[34,16,22,14],[34,23,22,14,"_asyncToGenerator"],[34,40,22,14],[34,41,22,14,"default"],[34,48,22,14],[34,50,22,16],[34,61,22,23,"input"],[34,66,22,46],[34,68,22,51],[35,10,23,6],[35,14,23,10],[35,15,23,11,"user"],[35,19,23,15],[35,21,23,17],[35,27,23,23],[35,31,23,27,"Error"],[35,36,23,32],[35,37,23,33],[35,73,23,69],[35,74,23,70],[36,10,25,6],[36,14,25,6,"_yield$supabase$from$"],[36,35,25,6],[36,44,25,36,"supabase"],[36,56,25,44],[36,57,25,44,"supabase"],[36,65,25,44],[36,66,26,9,"from"],[36,70,26,13],[36,71,26,14],[36,81,26,24],[36,82,26,25],[36,83,27,9,"insert"],[36,89,27,15],[36,90,27,16],[37,14,28,10,"conversation_id"],[37,29,28,25],[37,31,28,27,"input"],[37,36,28,32],[37,37,28,33,"conversationId"],[37,51,28,47],[38,14,29,10,"sender_id"],[38,23,29,19],[38,25,29,21,"user"],[38,29,29,25],[38,30,29,26,"id"],[38,32,29,28],[39,14,30,10,"type"],[39,18,30,14],[39,20,30,16,"input"],[39,25,30,21],[39,26,30,22,"type"],[39,30,30,26],[40,14,31,10,"body"],[40,18,31,14],[40,20,31,16,"input"],[40,25,31,21],[40,26,31,22,"body"],[40,30,31,26],[40,34,31,30],[40,38,31,34],[41,14,32,10,"payload"],[41,21,32,17],[41,23,32,19,"input"],[41,28,32,24],[41,29,32,25,"payload"],[41,36,32,32],[41,40,32,36],[42,12,33,8],[42,13,33,9],[42,14,33,10],[42,15,34,9,"select"],[42,21,34,15],[42,22,35,10],[43,0,36,0],[44,0,37,0],[45,0,38,0],[46,0,39,0],[47,0,40,0],[48,0,41,0],[49,0,42,0],[49,9,43,8],[49,10,43,9],[49,11,44,9,"single"],[49,17,44,15],[49,18,44,16],[49,19,44,17],[50,12,25,14,"data"],[50,16,25,18],[50,19,25,18,"_yield$supabase$from$"],[50,40,25,18],[50,41,25,14,"data"],[50,45,25,18],[51,12,25,20,"error"],[51,17,25,25],[51,20,25,25,"_yield$supabase$from$"],[51,41,25,25],[51,42,25,20,"error"],[51,47,25,25],[52,10,46,6],[52,14,46,10,"error"],[52,19,46,15],[52,21,46,17],[52,27,46,23,"error"],[52,32,46,28],[53,10,47,6],[53,17,47,13,"data"],[53,21,47,17],[54,8,48,4],[54,9,48,5],[55,8,48,5],[55,24,22,4,"mutationFn"],[55,34,22,14,"mutationFn"],[55,35,22,14,"_x"],[55,37,22,14],[56,10,22,14],[56,17,22,14,"_ref"],[56,21,22,14],[56,22,22,14,"apply"],[56,27,22,14],[56,34,22,14,"arguments"],[56,43,22,14],[57,8,22,14],[58,6,22,14],[58,9,48,5],[59,6,49,4,"onMutate"],[59,14,49,12],[60,8,49,12],[60,12,49,12,"_ref2"],[60,17,49,12],[60,24,49,12,"_asyncToGenerator"],[60,41,49,12],[60,42,49,12,"default"],[60,49,49,12],[60,51,49,14],[60,62,49,21,"input"],[60,67,49,26],[60,69,49,31],[61,10,50,6],[61,14,50,10],[61,15,50,11,"user"],[61,19,50,15],[61,21,50,17],[62,10,52,6],[62,14,52,12,"messagesKey"],[62,25,52,23],[62,28,52,26,"chatKeys"],[62,38,52,34],[62,39,52,34,"chatKeys"],[62,47,52,34],[62,48,52,35,"messages"],[62,56,52,43],[62,57,52,44,"input"],[62,62,52,49],[62,63,52,50,"conversationId"],[62,77,52,64],[62,78,52,65],[64,10,54,6],[65,10,55,6],[65,16,55,12,"queryClient"],[65,27,55,23],[65,28,55,24,"cancelQueries"],[65,41,55,37],[65,42,55,38],[66,12,55,40,"queryKey"],[66,20,55,48],[66,22,55,50,"messagesKey"],[67,10,55,62],[67,11,55,63],[67,12,55,64],[69,10,57,6],[70,10,58,6],[70,14,58,12,"previousMessages"],[70,30,58,28],[70,33,59,8,"queryClient"],[70,44,59,19],[70,45,59,20,"getQueryData"],[70,57,59,32],[70,58,60,10,"messagesKey"],[70,69,61,8],[70,70,61,9],[72,10,63,6],[73,10,64,6],[73,14,64,12,"optimisticMessage"],[73,31,64,48],[73,34,64,51],[74,12,65,8,"id"],[74,14,65,10],[74,16,65,12],[74,30,65,26,"Date"],[74,34,65,30],[74,35,65,31,"now"],[74,38,65,34],[74,39,65,35],[74,40,65,36],[74,42,65,38],[75,12,66,8,"conversation_id"],[75,27,66,23],[75,29,66,25,"input"],[75,34,66,30],[75,35,66,31,"conversationId"],[75,49,66,45],[76,12,67,8,"sender_id"],[76,21,67,17],[76,23,67,19,"user"],[76,27,67,23],[76,28,67,24,"id"],[76,30,67,26],[77,12,68,8,"type"],[77,16,68,12],[77,18,68,14,"input"],[77,23,68,19],[77,24,68,20,"type"],[77,28,68,24],[78,12,69,8,"body"],[78,16,69,12],[78,18,69,14,"input"],[78,23,69,19],[78,24,69,20,"body"],[78,28,69,24],[78,32,69,28],[78,36,69,32],[79,12,70,8,"payload"],[79,19,70,15],[79,21,70,17,"input"],[79,26,70,22],[79,27,70,23,"payload"],[79,34,70,30],[79,38,70,34],[79,42,70,38],[80,12,71,8,"created_at"],[80,22,71,18],[80,24,71,20],[80,28,71,24,"Date"],[80,32,71,28],[80,33,71,29],[80,34,71,30],[80,35,71,31,"toISOString"],[80,46,71,42],[80,47,71,43],[80,48,71,44],[81,12,72,8,"sender"],[81,18,72,14],[81,20,72,16],[82,14,73,10,"id"],[82,16,73,12],[82,18,73,14,"user"],[82,22,73,18],[82,23,73,19,"id"],[82,25,73,21],[83,14,74,10,"display_name"],[83,26,74,22],[83,28,74,24,"profile"],[83,35,74,31],[83,37,74,33,"display_name"],[83,49,74,45],[83,53,74,49],[83,58,74,54],[84,14,75,10,"avatar_url"],[84,24,75,20],[84,26,75,22,"profile"],[84,33,75,29],[84,35,75,31,"avatar_url"],[84,45,75,41],[84,49,75,45],[85,12,76,8],[86,10,77,6],[86,11,77,7],[87,10,79,6,"queryClient"],[87,21,79,17],[87,22,79,18,"setQueryData"],[87,34,79,30],[87,35,80,8,"messagesKey"],[87,46,80,19],[87,48,81,9,"old"],[87,51,81,12],[87,55,81,17],[88,12,82,10],[88,16,82,14],[88,17,82,15,"old"],[88,20,82,18],[88,22,82,20],[89,14,83,12],[89,21,83,19],[90,16,84,14,"pages"],[90,21,84,19],[90,23,84,21],[90,24,84,22],[90,25,84,23,"optimisticMessage"],[90,42,84,40],[90,43,84,41],[90,44,84,42],[91,16,85,14,"pageParams"],[91,26,85,24],[91,28,85,26],[91,29,85,27],[91,33,85,31],[92,14,86,12],[92,15,86,13],[93,12,87,10],[94,12,88,10],[94,19,88,17],[95,14,89,12],[95,17,89,15,"old"],[95,20,89,18],[96,14,90,12,"pages"],[96,19,90,17],[96,21,90,19],[96,22,91,14],[96,23,91,15,"optimisticMessage"],[96,40,91,32],[96,42,91,34],[96,46,91,38,"old"],[96,49,91,41],[96,50,91,42,"pages"],[96,55,91,47],[96,56,91,48],[96,57,91,49],[96,58,91,50],[96,62,91,54],[96,64,91,56],[96,65,91,57],[96,66,91,58],[96,68,92,14],[96,71,92,17,"old"],[96,74,92,20],[96,75,92,21,"pages"],[96,80,92,26],[96,81,92,27,"slice"],[96,86,92,32],[96,87,92,33],[96,88,92,34],[96,89,92,35],[97,12,94,10],[97,13,94,11],[98,10,95,8],[98,11,96,6],[98,12,96,7],[99,10,98,6],[99,17,98,13],[100,12,98,15,"previousMessages"],[101,10,98,32],[101,11,98,33],[102,8,99,4],[102,9,99,5],[103,8,99,5],[103,24,49,4,"onMutate"],[103,32,49,12,"onMutate"],[103,33,49,12,"_x2"],[103,36,49,12],[104,10,49,12],[104,17,49,12,"_ref2"],[104,22,49,12],[104,23,49,12,"apply"],[104,28,49,12],[104,35,49,12,"arguments"],[104,44,49,12],[105,8,49,12],[106,6,49,12],[106,9,99,5],[107,6,100,4,"onError"],[107,13,100,11],[107,15,100,13,"onError"],[107,16,100,14,"_err"],[107,20,100,18],[107,22,100,20,"input"],[107,27,100,25],[107,29,100,27,"context"],[107,36,100,34],[107,41,100,39],[108,8,101,6],[109,8,102,6],[109,12,102,10,"context"],[109,19,102,17],[109,21,102,19,"previousMessages"],[109,37,102,35],[109,39,102,37],[110,10,103,8,"queryClient"],[110,21,103,19],[110,22,103,20,"setQueryData"],[110,34,103,32],[110,35,104,10,"chatKeys"],[110,45,104,18],[110,46,104,18,"chatKeys"],[110,54,104,18],[110,55,104,19,"messages"],[110,63,104,27],[110,64,104,28,"input"],[110,69,104,33],[110,70,104,34,"conversationId"],[110,84,104,48],[110,85,104,49],[110,87,105,10,"context"],[110,94,105,17],[110,95,105,18,"previousMessages"],[110,111,106,8],[110,112,106,9],[111,8,107,6],[112,6,108,4],[112,7,108,5],[113,6,109,4,"onSettled"],[113,15,109,13],[113,17,109,15,"onSettled"],[113,18,109,16,"_data"],[113,23,109,21],[113,25,109,23,"_error"],[113,31,109,29],[113,33,109,31,"input"],[113,38,109,36],[113,43,109,41],[114,8,110,6],[115,8,111,6,"queryClient"],[115,19,111,17],[115,20,111,18,"invalidateQueries"],[115,37,111,35],[115,38,111,36],[116,10,112,8,"queryKey"],[116,18,112,16],[116,20,112,18,"chatKeys"],[116,30,112,26],[116,31,112,26,"chatKeys"],[116,39,112,26],[116,40,112,27,"messages"],[116,48,112,35],[116,49,112,36,"input"],[116,54,112,41],[116,55,112,42,"conversationId"],[116,69,112,56],[117,8,113,6],[117,9,113,7],[117,10,113,8],[118,8,114,6,"queryClient"],[118,19,114,17],[118,20,114,18,"invalidateQueries"],[118,37,114,35],[118,38,114,36],[119,10,115,8,"queryKey"],[119,18,115,16],[119,20,115,18,"chatKeys"],[119,30,115,26],[119,31,115,26,"chatKeys"],[119,39,115,26],[119,40,115,27,"conversations"],[119,53,115,40],[119,54,115,41],[120,8,116,6],[120,9,116,7],[120,10,116,8],[121,6,117,4],[122,4,118,2],[122,5,118,3],[122,6,118,4],[123,2,119,0],[123,3,119,1],[124,2,119,2,"_s"],[124,4,119,2],[124,5,17,6,"useSendMessage"],[124,19,17,20],[125,4,17,20],[125,12,18,28,"useAuth"],[125,32,18,35],[125,33,18,35,"useAuth"],[125,40,18,35],[125,42,19,22,"useQueryClient"],[125,61,19,36],[125,62,19,36,"useQueryClient"],[125,76,19,36],[125,78,21,9,"useMutation"],[125,97,21,20],[125,98,21,20,"useMutation"],[125,109,21,20],[126,2,21,20],[127,2,121,0],[127,6,121,0,"_default"],[127,14,121,0],[127,17,121,15,"useSendMessage"],[127,31,121,29],[128,0,121,30],[128,3]],"functionMap":{"names":["<global>","useSendMessage","useMutation$argument_0.mutationFn","useMutation$argument_0.onMutate","queryClient.setQueryData$argument_1","useMutation$argument_0.onError","useMutation$argument_0.onSettled"],"mappings":"AAA;uBCgB;gBCK;KD0B;cEC;QCgC;SDc;KFI;aIC;KJQ;eKC;KLQ;CDE"},"hasCjsExports":false},"type":"js/module"}]}
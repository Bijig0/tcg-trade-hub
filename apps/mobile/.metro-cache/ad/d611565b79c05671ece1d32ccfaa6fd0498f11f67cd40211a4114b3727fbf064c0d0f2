{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var CONDITION_RANK = {\n    nm: 5,\n    lp: 4,\n    mp: 3,\n    hp: 2,\n    dmg: 1\n  };\n  var SEVEN_DAYS_MS = 7 * 24 * 60 * 60 * 1000;\n\n  /**\n   * Checks if an item satisfies a single trade want.\n   * Returns true if the item matches the want criteria.\n   */\n  var itemMatchesWant = function itemMatchesWant(item, want) {\n    switch (want.type) {\n      case 'specific_card':\n        return item.card_external_id === want.card_external_id;\n      case 'sealed':\n        // Sealed items would have a product_type indicator — checking card_rarity as proxy\n        // In practice, listing_items don't have is_sealed; this matches on naming convention\n        return false;\n      // Sealed matching requires listing-level metadata not in listing_items\n\n      case 'slab':\n        // Graded items would have grading info — not stored in listing_items\n        return false;\n      // Slab matching requires collection-level metadata\n\n      case 'raw_cards':\n        {\n          var _CONDITION_RANK$item$, _CONDITION_RANK$want$;\n          if (want.min_condition == null) return true;\n          var itemRank = (_CONDITION_RANK$item$ = CONDITION_RANK[item.condition]) != null ? _CONDITION_RANK$item$ : 0;\n          var minRank = (_CONDITION_RANK$want$ = CONDITION_RANK[want.min_condition]) != null ? _CONDITION_RANK$want$ : 0;\n          return itemRank >= minRank;\n        }\n      case 'cash':\n        return false;\n      // Cash is informational, not item-matchable\n\n      case 'open_to_offers':\n        return true;\n      // Matches everything\n\n      case 'custom':\n        return false;\n      // Custom tags are not system-matchable\n    }\n  };\n\n  /**\n   * Finds trade opportunities for a user's listing by comparing against other active listings.\n   *\n   * Matching logic:\n   * - Forward match: other listing's items satisfy my trade_wants → \"has what you want\"\n   * - Reverse match: my listing's items satisfy their trade_wants → \"wants what you have\"\n   * - Mutual: both directions match\n   *\n   * Scoring:\n   * - Forward card match: +5 per matched item\n   * - Reverse match: +5 per matched item\n   * - Mutual bonus: +3\n   * - Same TCG: +2\n   * - Recency (7-day decay): +1 max\n   */\n  var findTradeOpportunities = function findTradeOpportunities(myListing, otherListings) {\n    var opportunities = [];\n    for (var other of otherListings) {\n      // Skip same user\n      if (other.user_id === myListing.user_id) continue;\n      var forwardScore = 0;\n      var reverseScore = 0;\n      var matchedCardIds = [];\n\n      // Forward: do their items match my wants?\n      for (var want of myListing.trade_wants) {\n        for (var item of other.items) {\n          if (itemMatchesWant(item, want)) {\n            forwardScore += 5;\n            if (!matchedCardIds.includes(item.card_external_id)) {\n              matchedCardIds.push(item.card_external_id);\n            }\n          }\n        }\n      }\n\n      // Reverse: do my items match their wants?\n      for (var _want of other.trade_wants) {\n        for (var _item of myListing.items) {\n          if (itemMatchesWant(_item, _want)) {\n            reverseScore += 5;\n            if (!matchedCardIds.includes(_item.card_external_id)) {\n              matchedCardIds.push(_item.card_external_id);\n            }\n          }\n        }\n      }\n\n      // If no matches at all, skip\n      if (forwardScore === 0 && reverseScore === 0) continue;\n\n      // Determine match type\n      var matchType = void 0;\n      if (forwardScore > 0 && reverseScore > 0) {\n        matchType = 'mutual';\n      } else if (forwardScore > 0) {\n        matchType = 'has_what_you_want';\n      } else {\n        matchType = 'wants_what_you_have';\n      }\n\n      // Calculate total score\n      var score = forwardScore + reverseScore;\n\n      // Mutual bonus\n      if (matchType === 'mutual') {\n        score += 3;\n      }\n\n      // Same TCG bonus\n      if (other.tcg === myListing.tcg) {\n        score += 2;\n      }\n\n      // Recency bonus (7-day decay)\n      var ageMs = Date.now() - new Date(other.created_at).getTime();\n      if (ageMs < SEVEN_DAYS_MS) {\n        score += 1 - ageMs / SEVEN_DAYS_MS;\n      }\n      opportunities.push({\n        listing: other,\n        owner: other.owner,\n        matchType: matchType,\n        matchedCardIds: matchedCardIds,\n        score: score\n      });\n    }\n\n    // Sort by score descending\n    opportunities.sort(function (a, b) {\n      return b.score - a.score;\n    });\n    return opportunities;\n  };\n  var _default = findTradeOpportunities;\n});","lineCount":158,"map":[[7,2,164,0,"Object"],[7,8,164,0],[7,9,164,0,"defineProperty"],[7,23,164,0],[7,24,164,0,"exports"],[7,31,164,0],[8,4,164,0,"enumerable"],[8,14,164,0],[9,4,164,0,"get"],[9,7,164,0],[9,18,164,0,"get"],[9,19,164,0],[10,6,164,0],[10,13,164,0,"_default"],[10,21,164,0],[11,4,164,0],[12,2,164,0],[13,2,18,0],[13,6,18,6,"CONDITION_RANK"],[13,20,18,44],[13,23,18,47],[14,4,19,2,"nm"],[14,6,19,4],[14,8,19,6],[14,9,19,7],[15,4,20,2,"lp"],[15,6,20,4],[15,8,20,6],[15,9,20,7],[16,4,21,2,"mp"],[16,6,21,4],[16,8,21,6],[16,9,21,7],[17,4,22,2,"hp"],[17,6,22,4],[17,8,22,6],[17,9,22,7],[18,4,23,2,"dmg"],[18,7,23,5],[18,9,23,7],[19,2,24,0],[19,3,24,1],[20,2,26,0],[20,6,26,6,"SEVEN_DAYS_MS"],[20,19,26,19],[20,22,26,22],[20,23,26,23],[20,26,26,26],[20,28,26,28],[20,31,26,31],[20,33,26,33],[20,36,26,36],[20,38,26,38],[20,41,26,41],[20,45,26,45],[22,2,28,0],[23,0,29,0],[24,0,30,0],[25,0,31,0],[26,2,32,0],[26,6,32,6,"itemMatchesWant"],[26,21,32,21],[26,24,32,24],[26,33,32,6,"itemMatchesWant"],[26,48,32,21,"itemMatchesWant"],[26,49,32,25,"item"],[26,53,32,45],[26,55,32,47,"want"],[26,59,32,62],[26,61,32,76],[27,4,33,2],[27,12,33,10,"want"],[27,16,33,14],[27,17,33,15,"type"],[27,21,33,19],[28,6,34,4],[28,11,34,9],[28,26,34,24],[29,8,35,6],[29,15,35,13,"item"],[29,19,35,17],[29,20,35,18,"card_external_id"],[29,36,35,34],[29,41,35,39,"want"],[29,45,35,43],[29,46,35,44,"card_external_id"],[29,62,35,60],[30,6,37,4],[30,11,37,9],[30,19,37,17],[31,8,38,6],[32,8,39,6],[33,8,40,6],[33,15,40,13],[33,20,40,18],[34,6,40,20],[36,6,42,4],[36,11,42,9],[36,17,42,15],[37,8,43,6],[38,8,44,6],[38,15,44,13],[38,20,44,18],[39,6,44,20],[41,6,46,4],[41,11,46,9],[41,22,46,20],[42,8,46,22],[43,10,46,22],[43,14,46,22,"_CONDITION_RANK$item$"],[43,35,46,22],[43,37,46,22,"_CONDITION_RANK$want$"],[43,58,46,22],[44,10,47,6],[44,14,47,10,"want"],[44,18,47,14],[44,19,47,15,"min_condition"],[44,32,47,28],[44,36,47,32],[44,40,47,36],[44,42,47,38],[44,49,47,45],[44,53,47,49],[45,10,48,6],[45,14,48,12,"itemRank"],[45,22,48,20],[45,26,48,20,"_CONDITION_RANK$item$"],[45,47,48,20],[45,50,48,23,"CONDITION_RANK"],[45,64,48,37],[45,65,48,38,"item"],[45,69,48,42],[45,70,48,43,"condition"],[45,79,48,52],[45,80,48,53],[45,92,48,53,"_CONDITION_RANK$item$"],[45,113,48,53],[45,116,48,57],[45,117,48,58],[46,10,49,6],[46,14,49,12,"minRank"],[46,21,49,19],[46,25,49,19,"_CONDITION_RANK$want$"],[46,46,49,19],[46,49,49,22,"CONDITION_RANK"],[46,63,49,36],[46,64,49,37,"want"],[46,68,49,41],[46,69,49,42,"min_condition"],[46,82,49,55],[46,83,49,56],[46,95,49,56,"_CONDITION_RANK$want$"],[46,116,49,56],[46,119,49,60],[46,120,49,61],[47,10,50,6],[47,17,50,13,"itemRank"],[47,25,50,21],[47,29,50,25,"minRank"],[47,36,50,32],[48,8,51,4],[49,6,53,4],[49,11,53,9],[49,17,53,15],[50,8,54,6],[50,15,54,13],[50,20,54,18],[51,6,54,20],[53,6,56,4],[53,11,56,9],[53,27,56,25],[54,8,57,6],[54,15,57,13],[54,19,57,17],[55,6,57,19],[57,6,59,4],[57,11,59,9],[57,19,59,17],[58,8,60,6],[58,15,60,13],[58,20,60,18],[59,6,60,20],[60,4,61,2],[61,2,62,0],[61,3,62,1],[63,2,64,0],[64,0,65,0],[65,0,66,0],[66,0,67,0],[67,0,68,0],[68,0,69,0],[69,0,70,0],[70,0,71,0],[71,0,72,0],[72,0,73,0],[73,0,74,0],[74,0,75,0],[75,0,76,0],[76,0,77,0],[77,0,78,0],[78,2,79,0],[78,6,79,6,"findTradeOpportunities"],[78,28,79,28],[78,31,79,31],[78,40,79,6,"findTradeOpportunities"],[78,62,79,28,"findTradeOpportunities"],[78,63,80,2,"myListing"],[78,72,80,27],[78,74,81,2,"otherListings"],[78,87,81,36],[78,89,82,25],[79,4,83,2],[79,8,83,8,"opportunities"],[79,21,83,41],[79,24,83,44],[79,26,83,46],[80,4,85,2],[80,9,85,7],[80,13,85,13,"other"],[80,18,85,18],[80,22,85,22,"otherListings"],[80,35,85,35],[80,37,85,37],[81,6,86,4],[82,6,87,4],[82,10,87,8,"other"],[82,15,87,13],[82,16,87,14,"user_id"],[82,23,87,21],[82,28,87,26,"myListing"],[82,37,87,35],[82,38,87,36,"user_id"],[82,45,87,43],[82,47,87,45],[83,6,89,4],[83,10,89,8,"forwardScore"],[83,22,89,20],[83,25,89,23],[83,26,89,24],[84,6,90,4],[84,10,90,8,"reverseScore"],[84,22,90,20],[84,25,90,23],[84,26,90,24],[85,6,91,4],[85,10,91,10,"matchedCardIds"],[85,24,91,34],[85,27,91,37],[85,29,91,39],[87,6,93,4],[88,6,94,4],[88,11,94,9],[88,15,94,15,"want"],[88,19,94,19],[88,23,94,23,"myListing"],[88,32,94,32],[88,33,94,33,"trade_wants"],[88,44,94,44],[88,46,94,46],[89,8,95,6],[89,13,95,11],[89,17,95,17,"item"],[89,21,95,21],[89,25,95,25,"other"],[89,30,95,30],[89,31,95,31,"items"],[89,36,95,36],[89,38,95,38],[90,10,96,8],[90,14,96,12,"itemMatchesWant"],[90,29,96,27],[90,30,96,28,"item"],[90,34,96,32],[90,36,96,34,"want"],[90,40,96,38],[90,41,96,39],[90,43,96,41],[91,12,97,10,"forwardScore"],[91,24,97,22],[91,28,97,26],[91,29,97,27],[92,12,98,10],[92,16,98,14],[92,17,98,15,"matchedCardIds"],[92,31,98,29],[92,32,98,30,"includes"],[92,40,98,38],[92,41,98,39,"item"],[92,45,98,43],[92,46,98,44,"card_external_id"],[92,62,98,60],[92,63,98,61],[92,65,98,63],[93,14,99,12,"matchedCardIds"],[93,28,99,26],[93,29,99,27,"push"],[93,33,99,31],[93,34,99,32,"item"],[93,38,99,36],[93,39,99,37,"card_external_id"],[93,55,99,53],[93,56,99,54],[94,12,100,10],[95,10,101,8],[96,8,102,6],[97,6,103,4],[99,6,105,4],[100,6,106,4],[100,11,106,9],[100,15,106,15,"want"],[100,20,106,19],[100,24,106,23,"other"],[100,29,106,28],[100,30,106,29,"trade_wants"],[100,41,106,40],[100,43,106,42],[101,8,107,6],[101,13,107,11],[101,17,107,17,"item"],[101,22,107,21],[101,26,107,25,"myListing"],[101,35,107,34],[101,36,107,35,"items"],[101,41,107,40],[101,43,107,42],[102,10,108,8],[102,14,108,12,"itemMatchesWant"],[102,29,108,27],[102,30,108,28,"item"],[102,35,108,32],[102,37,108,34,"want"],[102,42,108,38],[102,43,108,39],[102,45,108,41],[103,12,109,10,"reverseScore"],[103,24,109,22],[103,28,109,26],[103,29,109,27],[104,12,110,10],[104,16,110,14],[104,17,110,15,"matchedCardIds"],[104,31,110,29],[104,32,110,30,"includes"],[104,40,110,38],[104,41,110,39,"item"],[104,46,110,43],[104,47,110,44,"card_external_id"],[104,63,110,60],[104,64,110,61],[104,66,110,63],[105,14,111,12,"matchedCardIds"],[105,28,111,26],[105,29,111,27,"push"],[105,33,111,31],[105,34,111,32,"item"],[105,39,111,36],[105,40,111,37,"card_external_id"],[105,56,111,53],[105,57,111,54],[106,12,112,10],[107,10,113,8],[108,8,114,6],[109,6,115,4],[111,6,117,4],[112,6,118,4],[112,10,118,8,"forwardScore"],[112,22,118,20],[112,27,118,25],[112,28,118,26],[112,32,118,30,"reverseScore"],[112,44,118,42],[112,49,118,47],[112,50,118,48],[112,52,118,50],[114,6,120,4],[115,6,121,4],[115,10,121,8,"matchType"],[115,19,121,44],[116,6,122,4],[116,10,122,8,"forwardScore"],[116,22,122,20],[116,25,122,23],[116,26,122,24],[116,30,122,28,"reverseScore"],[116,42,122,40],[116,45,122,43],[116,46,122,44],[116,48,122,46],[117,8,123,6,"matchType"],[117,17,123,15],[117,20,123,18],[117,28,123,26],[118,6,124,4],[118,7,124,5],[118,13,124,11],[118,17,124,15,"forwardScore"],[118,29,124,27],[118,32,124,30],[118,33,124,31],[118,35,124,33],[119,8,125,6,"matchType"],[119,17,125,15],[119,20,125,18],[119,39,125,37],[120,6,126,4],[120,7,126,5],[120,13,126,11],[121,8,127,6,"matchType"],[121,17,127,15],[121,20,127,18],[121,41,127,39],[122,6,128,4],[124,6,130,4],[125,6,131,4],[125,10,131,8,"score"],[125,15,131,13],[125,18,131,16,"forwardScore"],[125,30,131,28],[125,33,131,31,"reverseScore"],[125,45,131,43],[127,6,133,4],[128,6,134,4],[128,10,134,8,"matchType"],[128,19,134,17],[128,24,134,22],[128,32,134,30],[128,34,134,32],[129,8,135,6,"score"],[129,13,135,11],[129,17,135,15],[129,18,135,16],[130,6,136,4],[132,6,138,4],[133,6,139,4],[133,10,139,8,"other"],[133,15,139,13],[133,16,139,14,"tcg"],[133,19,139,17],[133,24,139,22,"myListing"],[133,33,139,31],[133,34,139,32,"tcg"],[133,37,139,35],[133,39,139,37],[134,8,140,6,"score"],[134,13,140,11],[134,17,140,15],[134,18,140,16],[135,6,141,4],[137,6,143,4],[138,6,144,4],[138,10,144,10,"ageMs"],[138,15,144,15],[138,18,144,18,"Date"],[138,22,144,22],[138,23,144,23,"now"],[138,26,144,26],[138,27,144,27],[138,28,144,28],[138,31,144,31],[138,35,144,35,"Date"],[138,39,144,39],[138,40,144,40,"other"],[138,45,144,45],[138,46,144,46,"created_at"],[138,56,144,56],[138,57,144,57],[138,58,144,58,"getTime"],[138,65,144,65],[138,66,144,66],[138,67,144,67],[139,6,145,4],[139,10,145,8,"ageMs"],[139,15,145,13],[139,18,145,16,"SEVEN_DAYS_MS"],[139,31,145,29],[139,33,145,31],[140,8,146,6,"score"],[140,13,146,11],[140,17,146,15],[140,18,146,16],[140,21,146,19,"ageMs"],[140,26,146,24],[140,29,146,27,"SEVEN_DAYS_MS"],[140,42,146,40],[141,6,147,4],[142,6,149,4,"opportunities"],[142,19,149,17],[142,20,149,18,"push"],[142,24,149,22],[142,25,149,23],[143,8,150,6,"listing"],[143,15,150,13],[143,17,150,15,"other"],[143,22,150,20],[144,8,151,6,"owner"],[144,13,151,11],[144,15,151,13,"other"],[144,20,151,18],[144,21,151,19,"owner"],[144,26,151,24],[145,8,152,6,"matchType"],[145,17,152,15],[145,19,152,6,"matchType"],[145,28,152,15],[146,8,153,6,"matchedCardIds"],[146,22,153,20],[146,24,153,6,"matchedCardIds"],[146,38,153,20],[147,8,154,6,"score"],[147,13,154,11],[147,15,154,6,"score"],[148,6,155,4],[148,7,155,5],[148,8,155,6],[149,4,156,2],[151,4,158,2],[152,4,159,2,"opportunities"],[152,17,159,15],[152,18,159,16,"sort"],[152,22,159,20],[152,23,159,21],[152,33,159,22,"a"],[152,34,159,23],[152,36,159,25,"b"],[152,37,159,26],[153,6,159,26],[153,13,159,31,"b"],[153,14,159,32],[153,15,159,33,"score"],[153,20,159,38],[153,23,159,41,"a"],[153,24,159,42],[153,25,159,43,"score"],[153,30,159,48],[154,4,159,48],[154,6,159,49],[155,4,161,2],[155,11,161,9,"opportunities"],[155,24,161,22],[156,2,162,0],[156,3,162,1],[157,2,164,0],[157,6,164,0,"_default"],[157,14,164,0],[157,17,164,15,"findTradeOpportunities"],[157,39,164,37],[158,0,164,38],[158,3]],"functionMap":{"names":["<global>","itemMatchesWant","findTradeOpportunities","opportunities.sort$argument_0"],"mappings":"AAA;wBC+B;CD8B;+BEiB;qBCgF,2BD;CFG"},"hasCjsExports":false},"type":"js/module"}]}
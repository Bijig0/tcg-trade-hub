{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":49,"index":49}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":50},"end":{"line":2,"column":42,"index":92}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":93},"end":{"line":3,"column":43,"index":136}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0]);\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1]);\n  var _libSupabase = require(_dependencyMap[2]);\n  var _queryKeys = require(_dependencyMap[3]);\n  /**\n   * Fetches the previous (second-most-recent) card_offer message for a conversation.\n   * Returns null when there's only one offer (i.e. the current active offer is the first).\n   */\n  var usePreviousOffer = conversationId => {\n    return (0, _tanstackReactQuery.useQuery)({\n      queryKey: _queryKeys.chatKeys.previousOffer(conversationId),\n      queryFn: function () {\n        var _ref = (0, _asyncToGenerator.default)(function* () {\n          var _yield$supabase$from$ = yield _libSupabase.supabase.from('messages').select(`\n          id,\n          payload,\n          created_at,\n          sender:users!messages_sender_id_fkey (\n            id,\n            display_name\n          )\n        `).eq('conversation_id', conversationId).eq('type', 'card_offer').order('created_at', {\n              ascending: false\n            }).limit(2),\n            data = _yield$supabase$from$.data,\n            error = _yield$supabase$from$.error;\n          if (error) throw error;\n          if (!data || data.length < 2) return null;\n\n          // Index 0 = most recent (current active offer), index 1 = previous offer\n          var prev = data[1];\n          var payload = prev.payload;\n          var sender = prev.sender;\n          return {\n            offering: payload.offering ?? [],\n            requesting: payload.requesting ?? [],\n            cashAmount: payload.cash_amount ?? 0,\n            cashDirection: payload.cash_direction ?? null,\n            note: payload.note ?? null,\n            senderDisplayName: sender.display_name,\n            sentAt: prev.created_at\n          };\n        });\n        return function queryFn() {\n          return _ref.apply(this, arguments);\n        };\n      }(),\n      enabled: !!conversationId,\n      staleTime: 300000\n    });\n  };\n  var _default = usePreviousOffer;\n});","lineCount":71,"map":[[12,2,65,0,"Object"],[12,8,65,0],[12,9,65,0,"defineProperty"],[12,23,65,0],[12,24,65,0,"exports"],[12,31,65,0],[13,4,65,0,"enumerable"],[13,14,65,0],[14,4,65,0,"get"],[14,7,65,0],[14,18,65,0,"get"],[14,19,65,0],[15,6,65,0],[15,13,65,0,"_default"],[15,21,65,0],[16,4,65,0],[17,2,65,0],[18,2,65,32],[18,6,65,32,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,65,32],[18,45,65,32,"require"],[18,52,65,32],[18,53,65,32,"_dependencyMap"],[18,67,65,32],[19,2,65,32],[19,6,65,32,"_asyncToGenerator"],[19,23,65,32],[19,26,65,32,"_interopDefault"],[19,41,65,32],[19,42,65,32,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,65,32],[20,2,1,0],[20,6,1,0,"_tanstackReactQuery"],[20,25,1,0],[20,28,1,0,"require"],[20,35,1,0],[20,36,1,0,"_dependencyMap"],[20,50,1,0],[21,2,2,0],[21,6,2,0,"_libSupabase"],[21,18,2,0],[21,21,2,0,"require"],[21,28,2,0],[21,29,2,0,"_dependencyMap"],[21,43,2,0],[22,2,3,0],[22,6,3,0,"_queryKeys"],[22,16,3,0],[22,19,3,0,"require"],[22,26,3,0],[22,27,3,0,"_dependencyMap"],[22,41,3,0],[23,2,16,0],[24,0,17,0],[25,0,18,0],[26,0,19,0],[27,2,20,0],[27,6,20,6,"usePreviousOffer"],[27,22,20,22],[27,25,20,26,"conversationId"],[27,39,20,48],[27,43,20,53],[28,4,21,2],[28,11,21,9],[28,15,21,9,"useQuery"],[28,34,21,17],[28,35,21,17,"useQuery"],[28,43,21,17],[28,45,21,18],[29,6,22,4,"queryKey"],[29,14,22,12],[29,16,22,14,"chatKeys"],[29,26,22,22],[29,27,22,22,"chatKeys"],[29,35,22,22],[29,36,22,23,"previousOffer"],[29,49,22,36],[29,50,22,37,"conversationId"],[29,64,22,51],[29,65,22,52],[30,6,23,4,"queryFn"],[30,13,23,11],[31,8,23,11],[31,12,23,11,"_ref"],[31,16,23,11],[31,23,23,11,"_asyncToGenerator"],[31,40,23,11],[31,41,23,11,"default"],[31,48,23,11],[31,50,23,13],[31,63,23,56],[32,10,24,6],[32,14,24,6,"_yield$supabase$from$"],[32,35,24,6],[32,44,24,36,"supabase"],[32,56,24,44],[32,57,24,44,"supabase"],[32,65,24,44],[32,66,25,9,"from"],[32,70,25,13],[32,71,25,14],[32,81,25,24],[32,82,25,25],[32,83,26,9,"select"],[32,89,26,15],[32,90,27,10],[33,0,28,0],[34,0,29,0],[35,0,30,0],[36,0,31,0],[37,0,32,0],[38,0,33,0],[39,0,34,0],[40,0,35,0],[40,9,36,8],[40,10,36,9],[40,11,37,9,"eq"],[40,13,37,11],[40,14,37,12],[40,31,37,29],[40,33,37,31,"conversationId"],[40,47,37,45],[40,48,37,46],[40,49,38,9,"eq"],[40,51,38,11],[40,52,38,12],[40,58,38,18],[40,60,38,20],[40,72,38,32],[40,73,38,33],[40,74,39,9,"order"],[40,79,39,14],[40,80,39,15],[40,92,39,27],[40,94,39,29],[41,14,39,31,"ascending"],[41,23,39,40],[41,25,39,42],[42,12,39,48],[42,13,39,49],[42,14,39,50],[42,15,40,9,"limit"],[42,20,40,14],[42,21,40,15],[42,22,40,16],[42,23,40,17],[43,12,24,14,"data"],[43,16,24,18],[43,19,24,18,"_yield$supabase$from$"],[43,40,24,18],[43,41,24,14,"data"],[43,45,24,18],[44,12,24,20,"error"],[44,17,24,25],[44,20,24,25,"_yield$supabase$from$"],[44,41,24,25],[44,42,24,20,"error"],[44,47,24,25],[45,10,42,6],[45,14,42,10,"error"],[45,19,42,15],[45,21,42,17],[45,27,42,23,"error"],[45,32,42,28],[46,10,43,6],[46,14,43,10],[46,15,43,11,"data"],[46,19,43,15],[46,23,43,19,"data"],[46,27,43,23],[46,28,43,24,"length"],[46,34,43,30],[46,37,43,33],[46,38,43,34],[46,40,43,36],[46,47,43,43],[46,51,43,47],[48,10,45,6],[49,10,46,6],[49,14,46,12,"prev"],[49,18,46,16],[49,21,46,19,"data"],[49,25,46,23],[49,26,46,24],[49,27,46,25],[49,28,46,27],[50,10,47,6],[50,14,47,12,"payload"],[50,21,47,19],[50,24,47,22,"prev"],[50,28,47,26],[50,29,47,27,"payload"],[50,36,47,54],[51,10,48,6],[51,14,48,12,"sender"],[51,20,48,18],[51,23,48,21,"prev"],[51,27,48,25],[51,28,48,26,"sender"],[51,34,48,83],[52,10,50,6],[52,17,50,13],[53,12,51,8,"offering"],[53,20,51,16],[53,22,51,18,"payload"],[53,29,51,25],[53,30,51,26,"offering"],[53,38,51,34],[53,42,51,38],[53,44,51,40],[54,12,52,8,"requesting"],[54,22,52,18],[54,24,52,20,"payload"],[54,31,52,27],[54,32,52,28,"requesting"],[54,42,52,38],[54,46,52,42],[54,48,52,44],[55,12,53,8,"cashAmount"],[55,22,53,18],[55,24,53,20,"payload"],[55,31,53,27],[55,32,53,28,"cash_amount"],[55,43,53,39],[55,47,53,43],[55,48,53,44],[56,12,54,8,"cashDirection"],[56,25,54,21],[56,27,54,23,"payload"],[56,34,54,30],[56,35,54,31,"cash_direction"],[56,49,54,45],[56,53,54,49],[56,57,54,53],[57,12,55,8,"note"],[57,16,55,12],[57,18,55,14,"payload"],[57,25,55,21],[57,26,55,22,"note"],[57,30,55,26],[57,34,55,30],[57,38,55,34],[58,12,56,8,"senderDisplayName"],[58,29,56,25],[58,31,56,27,"sender"],[58,37,56,33],[58,38,56,34,"display_name"],[58,50,56,46],[59,12,57,8,"sentAt"],[59,18,57,14],[59,20,57,16,"prev"],[59,24,57,20],[59,25,57,21,"created_at"],[60,10,58,6],[60,11,58,7],[61,8,59,4],[61,9,59,5],[62,8,59,5],[62,24,23,4,"queryFn"],[62,31,23,11,"queryFn"],[62,32,23,11],[63,10,23,11],[63,17,23,11,"_ref"],[63,21,23,11],[63,22,23,11,"apply"],[63,27,23,11],[63,34,23,11,"arguments"],[63,43,23,11],[64,8,23,11],[65,6,23,11],[65,9,59,5],[66,6,60,4,"enabled"],[66,13,60,11],[66,15,60,13],[66,16,60,14],[66,17,60,15,"conversationId"],[66,31,60,29],[67,6,61,4,"staleTime"],[67,15,61,13],[68,4,62,2],[68,5,62,3],[68,6,62,4],[69,2,63,0],[69,3,63,1],[70,2,65,0],[70,6,65,0,"_default"],[70,14,65,0],[70,17,65,15,"usePreviousOffer"],[70,33,65,31],[71,0,65,32],[71,3]],"functionMap":{"names":["<global>","usePreviousOffer","useQuery$argument_0.queryFn"],"mappings":"AAA;yBCmB;aCG;KDoC;CDI"},"hasCjsExports":false},"type":"js/module"}]}
{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":68,"index":68}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":69},"end":{"line":2,"column":42,"index":111}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":112},"end":{"line":3,"column":46,"index":158}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}},{"name":"@/services/devLiveEmitter/devLiveEmitter","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":210},"end":{"line":5,"column":85,"index":295}}],"key":"+12q/uGkja92D/Tp4S2X61mlsvU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1], \"@tanstack/react-query\");\n  var _libSupabase = require(_dependencyMap[2], \"@/lib/supabase\");\n  var _queryKeys = require(_dependencyMap[3], \"../../queryKeys\");\n  var _servicesDevLiveEmitterDevLiveEmitter = require(_dependencyMap[4], \"@/services/devLiveEmitter/devLiveEmitter\");\n  /**\n   * Mutation hook that creates an offer on a listing via atomic Postgres RPC.\n   *\n   * Atomically inserts an offer row and all offer_items in a single transaction.\n   *\n   * @see packages/api/src/pipelines/createOffer/createOffer.ts\n   */\n  var useCreateOffer = () => {\n    _s();\n    var queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    return (0, _tanstackReactQuery.useMutation)({\n      mutationFn: function () {\n        var _ref2 = (0, _asyncToGenerator.default)(function* (_ref) {\n          var listingId = _ref.listingId,\n            selectedCards = _ref.selectedCards,\n            cashAmount = _ref.cashAmount,\n            message = _ref.message;\n          var scoped = __DEV__ ? _servicesDevLiveEmitterDevLiveEmitter.devEmitter.forPath('pipeline:createOffer', (0, _servicesDevLiveEmitterDevLiveEmitter.createTraceId)(), 'mobile:createOffer') : undefined;\n          scoped?.(0, 'started');\n          var _yield$supabase$auth$ = yield _libSupabase.supabase.auth.getSession(),\n            session = _yield$supabase$auth$.data.session;\n          var user = session?.user ?? null;\n          if (!user) throw new Error('User not authenticated');\n          var items = selectedCards.map(sc => ({\n            card_name: sc.card.name,\n            card_image_url: sc.card.imageUrl,\n            card_external_id: sc.card.externalId,\n            tcg: sc.card.tcg,\n            card_set: sc.card.setName,\n            card_number: sc.card.number,\n            condition: sc.condition,\n            market_price: sc.card.marketPrice ?? null,\n            quantity: 1\n          }));\n          try {\n            var _yield$supabase$rpc = yield _libSupabase.supabase.rpc('create_offer_v1', {\n                p_listing_id: listingId,\n                p_offerer_id: user.id,\n                p_cash_amount: cashAmount,\n                p_message: message ?? '',\n                p_items: JSON.stringify(items)\n              }),\n              data = _yield$supabase$rpc.data,\n              error = _yield$supabase$rpc.error;\n            if (error) throw error;\n            scoped?.(0, 'success');\n            return data;\n          } catch (err) {\n            scoped?.(0, 'error', {\n              message: err.message\n            });\n            throw err;\n          }\n        });\n        return function mutationFn(_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }(),\n      onSuccess: (_, variables) => {\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.offers(variables.listingId)\n        });\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.detail(variables.listingId)\n        });\n      }\n    });\n  };\n  _s(useCreateOffer, \"YK0wzM21ECnncaq5SECwU+/SVdQ=\", false, function () {\n    return [_tanstackReactQuery.useQueryClient, _tanstackReactQuery.useMutation];\n  });\n  var _default = useCreateOffer;\n});","lineCount":97,"map":[[13,2,80,0,"Object"],[13,8,80,0],[13,9,80,0,"defineProperty"],[13,23,80,0],[13,24,80,0,"exports"],[13,31,80,0],[14,4,80,0,"enumerable"],[14,14,80,0],[15,4,80,0,"get"],[15,7,80,0],[15,18,80,0,"get"],[15,19,80,0],[16,6,80,0],[16,13,80,0,"_default"],[16,21,80,0],[17,4,80,0],[18,2,80,0],[19,2,80,30],[19,6,80,30,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,80,30],[19,45,80,30,"require"],[19,52,80,30],[19,53,80,30,"_dependencyMap"],[19,67,80,30],[20,2,80,30],[20,6,80,30,"_asyncToGenerator"],[20,23,80,30],[20,26,80,30,"_interopDefault"],[20,41,80,30],[20,42,80,30,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,80,30],[21,2,1,0],[21,6,1,0,"_tanstackReactQuery"],[21,25,1,0],[21,28,1,0,"require"],[21,35,1,0],[21,36,1,0,"_dependencyMap"],[21,50,1,0],[22,2,2,0],[22,6,2,0,"_libSupabase"],[22,18,2,0],[22,21,2,0,"require"],[22,28,2,0],[22,29,2,0,"_dependencyMap"],[22,43,2,0],[23,2,3,0],[23,6,3,0,"_queryKeys"],[23,16,3,0],[23,19,3,0,"require"],[23,26,3,0],[23,27,3,0,"_dependencyMap"],[23,41,3,0],[24,2,5,0],[24,6,5,0,"_servicesDevLiveEmitterDevLiveEmitter"],[24,43,5,0],[24,46,5,0,"require"],[24,53,5,0],[24,54,5,0,"_dependencyMap"],[24,68,5,0],[25,2,18,0],[26,0,19,0],[27,0,20,0],[28,0,21,0],[29,0,22,0],[30,0,23,0],[31,0,24,0],[32,2,25,0],[32,6,25,6,"useCreateOffer"],[32,20,25,20],[32,23,25,23,"useCreateOffer"],[32,24,25,23],[32,29,25,29],[33,4,25,29,"_s"],[33,6,25,29],[34,4,26,2],[34,8,26,8,"queryClient"],[34,19,26,19],[34,22,26,22],[34,26,26,22,"useQueryClient"],[34,45,26,36],[34,46,26,36,"useQueryClient"],[34,60,26,36],[34,62,26,37],[34,63,26,38],[35,4,28,2],[35,11,28,9],[35,15,28,9,"useMutation"],[35,34,28,20],[35,35,28,20,"useMutation"],[35,46,28,20],[35,48,28,65],[36,6,29,4,"mutationFn"],[36,16,29,14],[37,8,29,14],[37,12,29,14,"_ref2"],[37,17,29,14],[37,24,29,14,"_asyncToGenerator"],[37,41,29,14],[37,42,29,14,"default"],[37,49,29,14],[37,51,29,16],[37,62,29,16,"_ref"],[37,66,29,16],[37,68,29,77],[38,10,29,77],[38,14,29,25,"listingId"],[38,23,29,34],[38,26,29,34,"_ref"],[38,30,29,34],[38,31,29,25,"listingId"],[38,40,29,34],[39,12,29,36,"selectedCards"],[39,25,29,49],[39,28,29,49,"_ref"],[39,32,29,49],[39,33,29,36,"selectedCards"],[39,46,29,49],[40,12,29,51,"cashAmount"],[40,22,29,61],[40,25,29,61,"_ref"],[40,29,29,61],[40,30,29,51,"cashAmount"],[40,40,29,61],[41,12,29,63,"message"],[41,19,29,70],[41,22,29,70,"_ref"],[41,26,29,70],[41,27,29,63,"message"],[41,34,29,70],[42,10,30,6],[42,14,30,12,"scoped"],[42,20,30,18],[42,23,30,21,"__DEV__"],[42,30,30,28],[42,33,31,10,"devEmitter"],[42,70,31,20],[42,71,31,20,"devEmitter"],[42,81,31,20],[42,82,31,21,"forPath"],[42,89,31,28],[42,90,31,29],[42,112,31,51],[42,114,31,53],[42,118,31,53,"createTraceId"],[42,155,31,66],[42,156,31,66,"createTraceId"],[42,169,31,66],[42,171,31,67],[42,172,31,68],[42,174,31,70],[42,194,31,90],[42,195,31,91],[42,198,32,10,"undefined"],[42,207,32,19],[43,10,34,6,"scoped"],[43,16,34,12],[43,19,34,15],[43,20,34,16],[43,22,34,18],[43,31,34,27],[43,32,34,28],[44,10,36,6],[44,14,36,6,"_yield$supabase$auth$"],[44,35,36,6],[44,44,38,16,"supabase"],[44,56,38,24],[44,57,38,24,"supabase"],[44,65,38,24],[44,66,38,25,"auth"],[44,70,38,29],[44,71,38,30,"getSession"],[44,81,38,40],[44,82,38,41],[44,83,38,42],[45,12,37,16,"session"],[45,19,37,23],[45,22,37,23,"_yield$supabase$auth$"],[45,43,37,23],[45,44,37,8,"data"],[45,48,37,12],[45,49,37,16,"session"],[45,56,37,23],[46,10,39,6],[46,14,39,12,"user"],[46,18,39,16],[46,21,39,19,"session"],[46,28,39,26],[46,30,39,28,"user"],[46,34,39,32],[46,38,39,36],[46,42,39,40],[47,10,41,6],[47,14,41,10],[47,15,41,11,"user"],[47,19,41,15],[47,21,41,17],[47,27,41,23],[47,31,41,27,"Error"],[47,36,41,32],[47,37,41,33],[47,61,41,57],[47,62,41,58],[48,10,43,6],[48,14,43,12,"items"],[48,19,43,17],[48,22,43,20,"selectedCards"],[48,35,43,33],[48,36,43,34,"map"],[48,39,43,37],[48,40,43,39,"sc"],[48,42,43,41],[48,47,43,47],[49,12,44,8,"card_name"],[49,21,44,17],[49,23,44,19,"sc"],[49,25,44,21],[49,26,44,22,"card"],[49,30,44,26],[49,31,44,27,"name"],[49,35,44,31],[50,12,45,8,"card_image_url"],[50,26,45,22],[50,28,45,24,"sc"],[50,30,45,26],[50,31,45,27,"card"],[50,35,45,31],[50,36,45,32,"imageUrl"],[50,44,45,40],[51,12,46,8,"card_external_id"],[51,28,46,24],[51,30,46,26,"sc"],[51,32,46,28],[51,33,46,29,"card"],[51,37,46,33],[51,38,46,34,"externalId"],[51,48,46,44],[52,12,47,8,"tcg"],[52,15,47,11],[52,17,47,13,"sc"],[52,19,47,15],[52,20,47,16,"card"],[52,24,47,20],[52,25,47,21,"tcg"],[52,28,47,24],[53,12,48,8,"card_set"],[53,20,48,16],[53,22,48,18,"sc"],[53,24,48,20],[53,25,48,21,"card"],[53,29,48,25],[53,30,48,26,"setName"],[53,37,48,33],[54,12,49,8,"card_number"],[54,23,49,19],[54,25,49,21,"sc"],[54,27,49,23],[54,28,49,24,"card"],[54,32,49,28],[54,33,49,29,"number"],[54,39,49,35],[55,12,50,8,"condition"],[55,21,50,17],[55,23,50,19,"sc"],[55,25,50,21],[55,26,50,22,"condition"],[55,35,50,31],[56,12,51,8,"market_price"],[56,24,51,20],[56,26,51,22,"sc"],[56,28,51,24],[56,29,51,25,"card"],[56,33,51,29],[56,34,51,30,"marketPrice"],[56,45,51,41],[56,49,51,45],[56,53,51,49],[57,12,52,8,"quantity"],[57,20,52,16],[57,22,52,18],[58,10,53,6],[58,11,53,7],[58,12,53,8],[58,13,53,9],[59,10,55,6],[59,14,55,10],[60,12,56,8],[60,16,56,8,"_yield$supabase$rpc"],[60,35,56,8],[60,44,56,38,"supabase"],[60,56,56,46],[60,57,56,46,"supabase"],[60,65,56,46],[60,66,56,47,"rpc"],[60,69,56,50],[60,70,56,51],[60,87,56,68],[60,89,56,70],[61,16,57,10,"p_listing_id"],[61,28,57,22],[61,30,57,24,"listingId"],[61,39,57,33],[62,16,58,10,"p_offerer_id"],[62,28,58,22],[62,30,58,24,"user"],[62,34,58,28],[62,35,58,29,"id"],[62,37,58,31],[63,16,59,10,"p_cash_amount"],[63,29,59,23],[63,31,59,25,"cashAmount"],[63,41,59,35],[64,16,60,10,"p_message"],[64,25,60,19],[64,27,60,21,"message"],[64,34,60,28],[64,38,60,32],[64,40,60,34],[65,16,61,10,"p_items"],[65,23,61,17],[65,25,61,19,"JSON"],[65,29,61,23],[65,30,61,24,"stringify"],[65,39,61,33],[65,40,61,34,"items"],[65,45,61,39],[66,14,62,8],[66,15,62,9],[66,16,62,10],[67,14,56,16,"data"],[67,18,56,20],[67,21,56,20,"_yield$supabase$rpc"],[67,40,56,20],[67,41,56,16,"data"],[67,45,56,20],[68,14,56,22,"error"],[68,19,56,27],[68,22,56,27,"_yield$supabase$rpc"],[68,41,56,27],[68,42,56,22,"error"],[68,47,56,27],[69,12,64,8],[69,16,64,12,"error"],[69,21,64,17],[69,23,64,19],[69,29,64,25,"error"],[69,34,64,30],[70,12,66,8,"scoped"],[70,18,66,14],[70,21,66,17],[70,22,66,18],[70,24,66,20],[70,33,66,29],[70,34,66,30],[71,12,67,8],[71,19,67,15,"data"],[71,23,67,19],[72,10,68,6],[72,11,68,7],[72,12,68,8],[72,19,68,15,"err"],[72,22,68,18],[72,24,68,20],[73,12,69,8,"scoped"],[73,18,69,14],[73,21,69,17],[73,22,69,18],[73,24,69,20],[73,31,69,27],[73,33,69,29],[74,14,69,31,"message"],[74,21,69,38],[74,23,69,41,"err"],[74,26,69,44],[74,27,69,55,"message"],[75,12,69,63],[75,13,69,64],[75,14,69,65],[76,12,70,8],[76,18,70,14,"err"],[76,21,70,17],[77,10,71,6],[78,8,72,4],[78,9,72,5],[79,8,72,5],[79,24,29,4,"mutationFn"],[79,34,29,14,"mutationFn"],[79,35,29,14,"_x"],[79,37,29,14],[80,10,29,14],[80,17,29,14,"_ref2"],[80,22,29,14],[80,23,29,14,"apply"],[80,28,29,14],[80,35,29,14,"arguments"],[80,44,29,14],[81,8,29,14],[82,6,29,14],[82,9,72,5],[83,6,73,4,"onSuccess"],[83,15,73,13],[83,17,73,15,"onSuccess"],[83,18,73,16,"_"],[83,19,73,17],[83,21,73,19,"variables"],[83,30,73,28],[83,35,73,33],[84,8,74,6,"queryClient"],[84,19,74,17],[84,20,74,18,"invalidateQueries"],[84,37,74,35],[84,38,74,36],[85,10,74,38,"queryKey"],[85,18,74,46],[85,20,74,48,"listingKeys"],[85,30,74,59],[85,31,74,59,"listingKeys"],[85,42,74,59],[85,43,74,60,"offers"],[85,49,74,66],[85,50,74,67,"variables"],[85,59,74,76],[85,60,74,77,"listingId"],[85,69,74,86],[86,8,74,88],[86,9,74,89],[86,10,74,90],[87,8,75,6,"queryClient"],[87,19,75,17],[87,20,75,18,"invalidateQueries"],[87,37,75,35],[87,38,75,36],[88,10,75,38,"queryKey"],[88,18,75,46],[88,20,75,48,"listingKeys"],[88,30,75,59],[88,31,75,59,"listingKeys"],[88,42,75,59],[88,43,75,60,"detail"],[88,49,75,66],[88,50,75,67,"variables"],[88,59,75,76],[88,60,75,77,"listingId"],[88,69,75,86],[89,8,75,88],[89,9,75,89],[89,10,75,90],[90,6,76,4],[91,4,77,2],[91,5,77,3],[91,6,77,4],[92,2,78,0],[92,3,78,1],[93,2,78,2,"_s"],[93,4,78,2],[93,5,25,6,"useCreateOffer"],[93,19,25,20],[94,4,25,20],[94,12,26,22,"useQueryClient"],[94,31,26,36],[94,32,26,36,"useQueryClient"],[94,46,26,36],[94,48,28,9,"useMutation"],[94,67,28,20],[94,68,28,20,"useMutation"],[94,79,28,20],[95,2,28,20],[96,2,80,0],[96,6,80,0,"_default"],[96,14,80,0],[96,17,80,15,"useCreateOffer"],[96,31,80,29],[97,0,80,30],[97,3]],"functionMap":{"names":["<global>","useCreateOffer","useMutation$argument_0.mutationFn","selectedCards.map$argument_0","useMutation$argument_0.onSuccess"],"mappings":"AAA;uBCwB;gBCI;sCCc;QDU;KDmB;eGC;KHG;CDE"},"hasCjsExports":false},"type":"js/module"}]}
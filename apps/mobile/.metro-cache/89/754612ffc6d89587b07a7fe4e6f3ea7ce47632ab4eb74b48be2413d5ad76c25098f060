{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":68,"index":68}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":69},"end":{"line":2,"column":42,"index":111}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":112},"end":{"line":3,"column":46,"index":158}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1], \"@tanstack/react-query\");\n  var _libSupabase = require(_dependencyMap[2], \"@/lib/supabase\");\n  var _queryKeys = require(_dependencyMap[3], \"../../queryKeys\");\n  /**\n   * Mutation hook that creates an offer on a listing via atomic Postgres RPC.\n   *\n   * Atomically inserts an offer row and all offer_items in a single transaction.\n   *\n   * @see packages/api/src/pipelines/createOffer/createOffer.ts\n   */\n  var useCreateOffer = () => {\n    _s();\n    var queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    return (0, _tanstackReactQuery.useMutation)({\n      mutationFn: function () {\n        var _ref2 = (0, _asyncToGenerator.default)(function* (_ref) {\n          var listingId = _ref.listingId,\n            selectedCards = _ref.selectedCards,\n            cashAmount = _ref.cashAmount,\n            message = _ref.message;\n          var _yield$supabase$auth$ = yield _libSupabase.supabase.auth.getSession(),\n            session = _yield$supabase$auth$.data.session;\n          var user = session?.user ?? null;\n          if (!user) throw new Error('User not authenticated');\n          var items = selectedCards.map(sc => ({\n            card_name: sc.card.name,\n            card_image_url: sc.card.imageUrl,\n            card_external_id: sc.card.externalId,\n            tcg: sc.card.tcg,\n            card_set: sc.card.setName,\n            card_number: sc.card.number,\n            condition: sc.condition,\n            market_price: sc.card.marketPrice ?? null,\n            quantity: 1\n          }));\n          var _yield$supabase$rpc = yield _libSupabase.supabase.rpc('create_offer_v1', {\n              p_listing_id: listingId,\n              p_offerer_id: user.id,\n              p_cash_amount: cashAmount,\n              p_message: message,\n              p_items: JSON.stringify(items)\n            }),\n            data = _yield$supabase$rpc.data,\n            error = _yield$supabase$rpc.error;\n          if (error) throw error;\n          return data;\n        });\n        return function mutationFn(_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }(),\n      onSuccess: (_, variables) => {\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.offers(variables.listingId)\n        });\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.detail(variables.listingId)\n        });\n      }\n    });\n  };\n  _s(useCreateOffer, \"YK0wzM21ECnncaq5SECwU+/SVdQ=\", false, function () {\n    return [_tanstackReactQuery.useQueryClient, _tanstackReactQuery.useMutation];\n  });\n  var _default = useCreateOffer;\n});","lineCount":86,"map":[[13,2,67,0,"Object"],[13,8,67,0],[13,9,67,0,"defineProperty"],[13,23,67,0],[13,24,67,0,"exports"],[13,31,67,0],[14,4,67,0,"enumerable"],[14,14,67,0],[15,4,67,0,"get"],[15,7,67,0],[15,18,67,0,"get"],[15,19,67,0],[16,6,67,0],[16,13,67,0,"_default"],[16,21,67,0],[17,4,67,0],[18,2,67,0],[19,2,67,30],[19,6,67,30,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,67,30],[19,45,67,30,"require"],[19,52,67,30],[19,53,67,30,"_dependencyMap"],[19,67,67,30],[20,2,67,30],[20,6,67,30,"_asyncToGenerator"],[20,23,67,30],[20,26,67,30,"_interopDefault"],[20,41,67,30],[20,42,67,30,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,67,30],[21,2,1,0],[21,6,1,0,"_tanstackReactQuery"],[21,25,1,0],[21,28,1,0,"require"],[21,35,1,0],[21,36,1,0,"_dependencyMap"],[21,50,1,0],[22,2,2,0],[22,6,2,0,"_libSupabase"],[22,18,2,0],[22,21,2,0,"require"],[22,28,2,0],[22,29,2,0,"_dependencyMap"],[22,43,2,0],[23,2,3,0],[23,6,3,0,"_queryKeys"],[23,16,3,0],[23,19,3,0,"require"],[23,26,3,0],[23,27,3,0,"_dependencyMap"],[23,41,3,0],[24,2,17,0],[25,0,18,0],[26,0,19,0],[27,0,20,0],[28,0,21,0],[29,0,22,0],[30,0,23,0],[31,2,24,0],[31,6,24,6,"useCreateOffer"],[31,20,24,20],[31,23,24,23,"useCreateOffer"],[31,24,24,23],[31,29,24,29],[32,4,24,29,"_s"],[32,6,24,29],[33,4,25,2],[33,8,25,8,"queryClient"],[33,19,25,19],[33,22,25,22],[33,26,25,22,"useQueryClient"],[33,45,25,36],[33,46,25,36,"useQueryClient"],[33,60,25,36],[33,62,25,37],[33,63,25,38],[34,4,27,2],[34,11,27,9],[34,15,27,9,"useMutation"],[34,34,27,20],[34,35,27,20,"useMutation"],[34,46,27,20],[34,48,27,65],[35,6,28,4,"mutationFn"],[35,16,28,14],[36,8,28,14],[36,12,28,14,"_ref2"],[36,17,28,14],[36,24,28,14,"_asyncToGenerator"],[36,41,28,14],[36,42,28,14,"default"],[36,49,28,14],[36,51,28,16],[36,62,28,16,"_ref"],[36,66,28,16],[36,68,28,77],[37,10,28,77],[37,14,28,25,"listingId"],[37,23,28,34],[37,26,28,34,"_ref"],[37,30,28,34],[37,31,28,25,"listingId"],[37,40,28,34],[38,12,28,36,"selectedCards"],[38,25,28,49],[38,28,28,49,"_ref"],[38,32,28,49],[38,33,28,36,"selectedCards"],[38,46,28,49],[39,12,28,51,"cashAmount"],[39,22,28,61],[39,25,28,61,"_ref"],[39,29,28,61],[39,30,28,51,"cashAmount"],[39,40,28,61],[40,12,28,63,"message"],[40,19,28,70],[40,22,28,70,"_ref"],[40,26,28,70],[40,27,28,63,"message"],[40,34,28,70],[41,10,29,6],[41,14,29,6,"_yield$supabase$auth$"],[41,35,29,6],[41,44,31,16,"supabase"],[41,56,31,24],[41,57,31,24,"supabase"],[41,65,31,24],[41,66,31,25,"auth"],[41,70,31,29],[41,71,31,30,"getSession"],[41,81,31,40],[41,82,31,41],[41,83,31,42],[42,12,30,16,"session"],[42,19,30,23],[42,22,30,23,"_yield$supabase$auth$"],[42,43,30,23],[42,44,30,8,"data"],[42,48,30,12],[42,49,30,16,"session"],[42,56,30,23],[43,10,32,6],[43,14,32,12,"user"],[43,18,32,16],[43,21,32,19,"session"],[43,28,32,26],[43,30,32,28,"user"],[43,34,32,32],[43,38,32,36],[43,42,32,40],[44,10,34,6],[44,14,34,10],[44,15,34,11,"user"],[44,19,34,15],[44,21,34,17],[44,27,34,23],[44,31,34,27,"Error"],[44,36,34,32],[44,37,34,33],[44,61,34,57],[44,62,34,58],[45,10,36,6],[45,14,36,12,"items"],[45,19,36,17],[45,22,36,20,"selectedCards"],[45,35,36,33],[45,36,36,34,"map"],[45,39,36,37],[45,40,36,39,"sc"],[45,42,36,41],[45,47,36,47],[46,12,37,8,"card_name"],[46,21,37,17],[46,23,37,19,"sc"],[46,25,37,21],[46,26,37,22,"card"],[46,30,37,26],[46,31,37,27,"name"],[46,35,37,31],[47,12,38,8,"card_image_url"],[47,26,38,22],[47,28,38,24,"sc"],[47,30,38,26],[47,31,38,27,"card"],[47,35,38,31],[47,36,38,32,"imageUrl"],[47,44,38,40],[48,12,39,8,"card_external_id"],[48,28,39,24],[48,30,39,26,"sc"],[48,32,39,28],[48,33,39,29,"card"],[48,37,39,33],[48,38,39,34,"externalId"],[48,48,39,44],[49,12,40,8,"tcg"],[49,15,40,11],[49,17,40,13,"sc"],[49,19,40,15],[49,20,40,16,"card"],[49,24,40,20],[49,25,40,21,"tcg"],[49,28,40,24],[50,12,41,8,"card_set"],[50,20,41,16],[50,22,41,18,"sc"],[50,24,41,20],[50,25,41,21,"card"],[50,29,41,25],[50,30,41,26,"setName"],[50,37,41,33],[51,12,42,8,"card_number"],[51,23,42,19],[51,25,42,21,"sc"],[51,27,42,23],[51,28,42,24,"card"],[51,32,42,28],[51,33,42,29,"number"],[51,39,42,35],[52,12,43,8,"condition"],[52,21,43,17],[52,23,43,19,"sc"],[52,25,43,21],[52,26,43,22,"condition"],[52,35,43,31],[53,12,44,8,"market_price"],[53,24,44,20],[53,26,44,22,"sc"],[53,28,44,24],[53,29,44,25,"card"],[53,33,44,29],[53,34,44,30,"marketPrice"],[53,45,44,41],[53,49,44,45],[53,53,44,49],[54,12,45,8,"quantity"],[54,20,45,16],[54,22,45,18],[55,10,46,6],[55,11,46,7],[55,12,46,8],[55,13,46,9],[56,10,48,6],[56,14,48,6,"_yield$supabase$rpc"],[56,33,48,6],[56,42,48,36,"supabase"],[56,54,48,44],[56,55,48,44,"supabase"],[56,63,48,44],[56,64,48,45,"rpc"],[56,67,48,48],[56,68,48,49],[56,85,48,66],[56,87,48,77],[57,14,49,8,"p_listing_id"],[57,26,49,20],[57,28,49,22,"listingId"],[57,37,49,31],[58,14,50,8,"p_offerer_id"],[58,26,50,20],[58,28,50,22,"user"],[58,32,50,26],[58,33,50,27,"id"],[58,35,50,29],[59,14,51,8,"p_cash_amount"],[59,27,51,21],[59,29,51,23,"cashAmount"],[59,39,51,33],[60,14,52,8,"p_message"],[60,23,52,17],[60,25,52,19,"message"],[60,32,52,26],[61,14,53,8,"p_items"],[61,21,53,15],[61,23,53,17,"JSON"],[61,27,53,21],[61,28,53,22,"stringify"],[61,37,53,31],[61,38,53,32,"items"],[61,43,53,37],[62,12,54,6],[62,13,54,16],[62,14,54,17],[63,12,48,14,"data"],[63,16,48,18],[63,19,48,18,"_yield$supabase$rpc"],[63,38,48,18],[63,39,48,14,"data"],[63,43,48,18],[64,12,48,20,"error"],[64,17,48,25],[64,20,48,25,"_yield$supabase$rpc"],[64,39,48,25],[64,40,48,20,"error"],[64,45,48,25],[65,10,56,6],[65,14,56,10,"error"],[65,19,56,15],[65,21,56,17],[65,27,56,23,"error"],[65,32,56,28],[66,10,58,6],[66,17,58,13,"data"],[66,21,58,17],[67,8,59,4],[67,9,59,5],[68,8,59,5],[68,24,28,4,"mutationFn"],[68,34,28,14,"mutationFn"],[68,35,28,14,"_x"],[68,37,28,14],[69,10,28,14],[69,17,28,14,"_ref2"],[69,22,28,14],[69,23,28,14,"apply"],[69,28,28,14],[69,35,28,14,"arguments"],[69,44,28,14],[70,8,28,14],[71,6,28,14],[71,9,59,5],[72,6,60,4,"onSuccess"],[72,15,60,13],[72,17,60,15,"onSuccess"],[72,18,60,16,"_"],[72,19,60,17],[72,21,60,19,"variables"],[72,30,60,28],[72,35,60,33],[73,8,61,6,"queryClient"],[73,19,61,17],[73,20,61,18,"invalidateQueries"],[73,37,61,35],[73,38,61,36],[74,10,61,38,"queryKey"],[74,18,61,46],[74,20,61,48,"listingKeys"],[74,30,61,59],[74,31,61,59,"listingKeys"],[74,42,61,59],[74,43,61,60,"offers"],[74,49,61,66],[74,50,61,67,"variables"],[74,59,61,76],[74,60,61,77,"listingId"],[74,69,61,86],[75,8,61,88],[75,9,61,89],[75,10,61,90],[76,8,62,6,"queryClient"],[76,19,62,17],[76,20,62,18,"invalidateQueries"],[76,37,62,35],[76,38,62,36],[77,10,62,38,"queryKey"],[77,18,62,46],[77,20,62,48,"listingKeys"],[77,30,62,59],[77,31,62,59,"listingKeys"],[77,42,62,59],[77,43,62,60,"detail"],[77,49,62,66],[77,50,62,67,"variables"],[77,59,62,76],[77,60,62,77,"listingId"],[77,69,62,86],[78,8,62,88],[78,9,62,89],[78,10,62,90],[79,6,63,4],[80,4,64,2],[80,5,64,3],[80,6,64,4],[81,2,65,0],[81,3,65,1],[82,2,65,2,"_s"],[82,4,65,2],[82,5,24,6,"useCreateOffer"],[82,19,24,20],[83,4,24,20],[83,12,25,22,"useQueryClient"],[83,31,25,36],[83,32,25,36,"useQueryClient"],[83,46,25,36],[83,48,27,9,"useMutation"],[83,67,27,20],[83,68,27,20,"useMutation"],[83,79,27,20],[84,2,27,20],[85,2,67,0],[85,6,67,0,"_default"],[85,14,67,0],[85,17,67,15,"useCreateOffer"],[85,31,67,29],[86,0,67,30],[86,3]],"functionMap":{"names":["<global>","useCreateOffer","useMutation$argument_0.mutationFn","selectedCards.map$argument_0","useMutation$argument_0.onSuccess"],"mappings":"AAA;uBCuB;gBCI;sCCQ;QDU;KDa;eGC;KHG;CDE"},"hasCjsExports":false},"type":"js/module"}]}
{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":68,"index":68}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"expo-router","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":69},"end":{"line":2,"column":40,"index":109}}],"key":"/+ErnBisjrT6aDU+GRp5Qz/lYoY=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":110},"end":{"line":3,"column":42,"index":152}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":153},"end":{"line":4,"column":46,"index":199}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}},{"name":"@/services/devLiveEmitter/devLiveEmitter","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":200},"end":{"line":5,"column":85,"index":285}}],"key":"+12q/uGkja92D/Tp4S2X61mlsvU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1], \"@tanstack/react-query\");\n  var _expoRouter = require(_dependencyMap[2], \"expo-router\");\n  var _libSupabase = require(_dependencyMap[3], \"@/lib/supabase\");\n  var _queryKeys = require(_dependencyMap[4], \"../../queryKeys\");\n  var _servicesDevLiveEmitterDevLiveEmitter = require(_dependencyMap[5], \"@/services/devLiveEmitter/devLiveEmitter\");\n  /**\n   * Mutation that accepts or declines an offer via atomic Postgres RPC.\n   *\n   * On accept: atomically accepts the offer, declines all sibling offers,\n   * creates a match + conversation, and transitions the listing to matched.\n   * Then navigates to the new chat.\n   *\n   * On decline: atomically declines the single offer.\n   *\n   * @see packages/api/src/pipelines/acceptOffer/acceptOffer.ts\n   * @see packages/api/src/pipelines/declineOffer/declineOffer.ts\n   */\n  var useRespondToOffer = () => {\n    _s();\n    var queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    var router = (0, _expoRouter.useRouter)();\n    return (0, _tanstackReactQuery.useMutation)({\n      mutationFn: function () {\n        var _ref2 = (0, _asyncToGenerator.default)(function* (_ref) {\n          var offerId = _ref.offerId,\n            listingId = _ref.listingId,\n            action = _ref.action;\n          var pipelineId = action === 'accepted' ? 'pipeline:acceptOffer' : 'pipeline:declineOffer';\n          var scoped = __DEV__ ? _servicesDevLiveEmitterDevLiveEmitter.devEmitter.forPath(pipelineId, (0, _servicesDevLiveEmitterDevLiveEmitter.createTraceId)(), `mobile:${action}Offer`) : undefined;\n          scoped?.(0, 'started');\n          var _yield$supabase$auth$ = yield _libSupabase.supabase.auth.getSession(),\n            session = _yield$supabase$auth$.data.session;\n          var userId = session?.user?.id;\n          if (!userId) throw new Error('Not authenticated');\n          try {\n            if (action === 'accepted') {\n              var _yield$supabase$rpc = yield _libSupabase.supabase.rpc('accept_offer_v1', {\n                  p_offer_id: offerId,\n                  p_listing_id: listingId,\n                  p_user_id: userId\n                }),\n                data = _yield$supabase$rpc.data,\n                _error = _yield$supabase$rpc.error;\n              if (_error) throw _error;\n              var result = data;\n              scoped?.(0, 'success');\n              return {\n                match_id: result.match_id,\n                conversation_id: result.conversation_id\n              };\n            }\n\n            // Decline\n            var _yield$supabase$rpc2 = yield _libSupabase.supabase.rpc('decline_offer_v1', {\n                p_offer_id: offerId,\n                p_user_id: userId\n              }),\n              error = _yield$supabase$rpc2.error;\n            if (error) throw error;\n            scoped?.(0, 'success');\n            return {\n              match_id: null,\n              conversation_id: null\n            };\n          } catch (err) {\n            scoped?.(0, 'error', {\n              message: err.message\n            });\n            throw err;\n          }\n        });\n        return function mutationFn(_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }(),\n      onSuccess: (data, variables) => {\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.offers(variables.listingId)\n        });\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.myListings()\n        });\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.detail(variables.listingId)\n        });\n        if (data.conversation_id) {\n          router.push(`/(tabs)/(messages)/chat/${data.conversation_id}`);\n        }\n      }\n    });\n  };\n  _s(useRespondToOffer, \"OMPBWmuGqcicNpy0gW6DnCxqRr0=\", false, function () {\n    return [_tanstackReactQuery.useQueryClient, _expoRouter.useRouter, _tanstackReactQuery.useMutation];\n  });\n  var _default = useRespondToOffer;\n});","lineCount":116,"map":[[13,2,95,0,"Object"],[13,8,95,0],[13,9,95,0,"defineProperty"],[13,23,95,0],[13,24,95,0,"exports"],[13,31,95,0],[14,4,95,0,"enumerable"],[14,14,95,0],[15,4,95,0,"get"],[15,7,95,0],[15,18,95,0,"get"],[15,19,95,0],[16,6,95,0],[16,13,95,0,"_default"],[16,21,95,0],[17,4,95,0],[18,2,95,0],[19,2,95,33],[19,6,95,33,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,95,33],[19,45,95,33,"require"],[19,52,95,33],[19,53,95,33,"_dependencyMap"],[19,67,95,33],[20,2,95,33],[20,6,95,33,"_asyncToGenerator"],[20,23,95,33],[20,26,95,33,"_interopDefault"],[20,41,95,33],[20,42,95,33,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,95,33],[21,2,1,0],[21,6,1,0,"_tanstackReactQuery"],[21,25,1,0],[21,28,1,0,"require"],[21,35,1,0],[21,36,1,0,"_dependencyMap"],[21,50,1,0],[22,2,2,0],[22,6,2,0,"_expoRouter"],[22,17,2,0],[22,20,2,0,"require"],[22,27,2,0],[22,28,2,0,"_dependencyMap"],[22,42,2,0],[23,2,3,0],[23,6,3,0,"_libSupabase"],[23,18,3,0],[23,21,3,0,"require"],[23,28,3,0],[23,29,3,0,"_dependencyMap"],[23,43,3,0],[24,2,4,0],[24,6,4,0,"_queryKeys"],[24,16,4,0],[24,19,4,0,"require"],[24,26,4,0],[24,27,4,0,"_dependencyMap"],[24,41,4,0],[25,2,5,0],[25,6,5,0,"_servicesDevLiveEmitterDevLiveEmitter"],[25,43,5,0],[25,46,5,0,"require"],[25,53,5,0],[25,54,5,0,"_dependencyMap"],[25,68,5,0],[26,2,18,0],[27,0,19,0],[28,0,20,0],[29,0,21,0],[30,0,22,0],[31,0,23,0],[32,0,24,0],[33,0,25,0],[34,0,26,0],[35,0,27,0],[36,0,28,0],[37,0,29,0],[38,2,30,0],[38,6,30,6,"useRespondToOffer"],[38,23,30,23],[38,26,30,26,"useRespondToOffer"],[38,27,30,26],[38,32,30,32],[39,4,30,32,"_s"],[39,6,30,32],[40,4,31,2],[40,8,31,8,"queryClient"],[40,19,31,19],[40,22,31,22],[40,26,31,22,"useQueryClient"],[40,45,31,36],[40,46,31,36,"useQueryClient"],[40,60,31,36],[40,62,31,37],[40,63,31,38],[41,4,32,2],[41,8,32,8,"router"],[41,14,32,14],[41,17,32,17],[41,21,32,17,"useRouter"],[41,32,32,26],[41,33,32,26,"useRouter"],[41,42,32,26],[41,44,32,27],[41,45,32,28],[42,4,34,2],[42,11,34,9],[42,15,34,9,"useMutation"],[42,34,34,20],[42,35,34,20,"useMutation"],[42,46,34,20],[42,48,34,57],[43,6,35,4,"mutationFn"],[43,16,35,14],[44,8,35,14],[44,12,35,14,"_ref2"],[44,17,35,14],[44,24,35,14,"_asyncToGenerator"],[44,41,35,14],[44,42,35,14,"default"],[44,49,35,14],[44,51,35,16],[44,62,35,16,"_ref"],[44,66,35,16],[44,68,35,58],[45,10,35,58],[45,14,35,25,"offerId"],[45,21,35,32],[45,24,35,32,"_ref"],[45,28,35,32],[45,29,35,25,"offerId"],[45,36,35,32],[46,12,35,34,"listingId"],[46,21,35,43],[46,24,35,43,"_ref"],[46,28,35,43],[46,29,35,34,"listingId"],[46,38,35,43],[47,12,35,45,"action"],[47,18,35,51],[47,21,35,51,"_ref"],[47,25,35,51],[47,26,35,45,"action"],[47,32,35,51],[48,10,36,6],[48,14,36,12,"pipelineId"],[48,24,36,22],[48,27,36,25,"action"],[48,33,36,31],[48,38,36,36],[48,48,36,46],[48,51,36,49],[48,73,36,71],[48,76,36,74],[48,99,36,97],[49,10,37,6],[49,14,37,12,"scoped"],[49,20,37,18],[49,23,37,21,"__DEV__"],[49,30,37,28],[49,33,38,10,"devEmitter"],[49,70,38,20],[49,71,38,20,"devEmitter"],[49,81,38,20],[49,82,38,21,"forPath"],[49,89,38,28],[49,90,38,29,"pipelineId"],[49,100,38,39],[49,102,38,41],[49,106,38,41,"createTraceId"],[49,143,38,54],[49,144,38,54,"createTraceId"],[49,157,38,54],[49,159,38,55],[49,160,38,56],[49,162,38,58],[49,172,38,68,"action"],[49,178,38,74],[49,185,38,81],[49,186,38,82],[49,189,39,10,"undefined"],[49,198,39,19],[50,10,41,6,"scoped"],[50,16,41,12],[50,19,41,15],[50,20,41,16],[50,22,41,18],[50,31,41,27],[50,32,41,28],[51,10,43,6],[51,14,43,6,"_yield$supabase$auth$"],[51,35,43,6],[51,44,45,16,"supabase"],[51,56,45,24],[51,57,45,24,"supabase"],[51,65,45,24],[51,66,45,25,"auth"],[51,70,45,29],[51,71,45,30,"getSession"],[51,81,45,40],[51,82,45,41],[51,83,45,42],[52,12,44,16,"session"],[52,19,44,23],[52,22,44,23,"_yield$supabase$auth$"],[52,43,44,23],[52,44,44,8,"data"],[52,48,44,12],[52,49,44,16,"session"],[52,56,44,23],[53,10,46,6],[53,14,46,12,"userId"],[53,20,46,18],[53,23,46,21,"session"],[53,30,46,28],[53,32,46,30,"user"],[53,36,46,34],[53,38,46,36,"id"],[53,40,46,38],[54,10,48,6],[54,14,48,10],[54,15,48,11,"userId"],[54,21,48,17],[54,23,48,19],[54,29,48,25],[54,33,48,29,"Error"],[54,38,48,34],[54,39,48,35],[54,58,48,54],[54,59,48,55],[55,10,50,6],[55,14,50,10],[56,12,51,8],[56,16,51,12,"action"],[56,22,51,18],[56,27,51,23],[56,37,51,33],[56,39,51,35],[57,14,52,10],[57,18,52,10,"_yield$supabase$rpc"],[57,37,52,10],[57,46,52,40,"supabase"],[57,58,52,48],[57,59,52,48,"supabase"],[57,67,52,48],[57,68,52,49,"rpc"],[57,71,52,52],[57,72,52,53],[57,89,52,70],[57,91,52,72],[58,18,53,12,"p_offer_id"],[58,28,53,22],[58,30,53,24,"offerId"],[58,37,53,31],[59,18,54,12,"p_listing_id"],[59,30,54,24],[59,32,54,26,"listingId"],[59,41,54,35],[60,18,55,12,"p_user_id"],[60,27,55,21],[60,29,55,23,"userId"],[61,16,56,10],[61,17,56,11],[61,18,56,12],[62,16,52,18,"data"],[62,20,52,22],[62,23,52,22,"_yield$supabase$rpc"],[62,42,52,22],[62,43,52,18,"data"],[62,47,52,22],[63,16,52,24,"error"],[63,22,52,29],[63,25,52,29,"_yield$supabase$rpc"],[63,44,52,29],[63,45,52,24,"error"],[63,50,52,29],[64,14,58,10],[64,18,58,14,"error"],[64,24,58,19],[64,26,58,21],[64,32,58,27,"error"],[64,38,58,32],[65,14,60,10],[65,18,60,16,"result"],[65,24,60,22],[65,27,60,25,"data"],[65,31,60,78],[66,14,61,10,"scoped"],[66,20,61,16],[66,23,61,19],[66,24,61,20],[66,26,61,22],[66,35,61,31],[66,36,61,32],[67,14,62,10],[67,21,62,17],[68,16,63,12,"match_id"],[68,24,63,20],[68,26,63,22,"result"],[68,32,63,28],[68,33,63,29,"match_id"],[68,41,63,37],[69,16,64,12,"conversation_id"],[69,31,64,27],[69,33,64,29,"result"],[69,39,64,35],[69,40,64,36,"conversation_id"],[70,14,65,10],[70,15,65,11],[71,12,66,8],[73,12,68,8],[74,12,69,8],[74,16,69,8,"_yield$supabase$rpc2"],[74,36,69,8],[74,45,69,32,"supabase"],[74,57,69,40],[74,58,69,40,"supabase"],[74,66,69,40],[74,67,69,41,"rpc"],[74,70,69,44],[74,71,69,45],[74,89,69,63],[74,91,69,65],[75,16,70,10,"p_offer_id"],[75,26,70,20],[75,28,70,22,"offerId"],[75,35,70,29],[76,16,71,10,"p_user_id"],[76,25,71,19],[76,27,71,21,"userId"],[77,14,72,8],[77,15,72,9],[77,16,72,10],[78,14,69,16,"error"],[78,19,69,21],[78,22,69,21,"_yield$supabase$rpc2"],[78,42,69,21],[78,43,69,16,"error"],[78,48,69,21],[79,12,74,8],[79,16,74,12,"error"],[79,21,74,17],[79,23,74,19],[79,29,74,25,"error"],[79,34,74,30],[80,12,76,8,"scoped"],[80,18,76,14],[80,21,76,17],[80,22,76,18],[80,24,76,20],[80,33,76,29],[80,34,76,30],[81,12,77,8],[81,19,77,15],[82,14,77,17,"match_id"],[82,22,77,25],[82,24,77,27],[82,28,77,31],[83,14,77,33,"conversation_id"],[83,29,77,48],[83,31,77,50],[84,12,77,55],[84,13,77,56],[85,10,78,6],[85,11,78,7],[85,12,78,8],[85,19,78,15,"err"],[85,22,78,18],[85,24,78,20],[86,12,79,8,"scoped"],[86,18,79,14],[86,21,79,17],[86,22,79,18],[86,24,79,20],[86,31,79,27],[86,33,79,29],[87,14,79,31,"message"],[87,21,79,38],[87,23,79,41,"err"],[87,26,79,44],[87,27,79,55,"message"],[88,12,79,63],[88,13,79,64],[88,14,79,65],[89,12,80,8],[89,18,80,14,"err"],[89,21,80,17],[90,10,81,6],[91,8,82,4],[91,9,82,5],[92,8,82,5],[92,24,35,4,"mutationFn"],[92,34,35,14,"mutationFn"],[92,35,35,14,"_x"],[92,37,35,14],[93,10,35,14],[93,17,35,14,"_ref2"],[93,22,35,14],[93,23,35,14,"apply"],[93,28,35,14],[93,35,35,14,"arguments"],[93,44,35,14],[94,8,35,14],[95,6,35,14],[95,9,82,5],[96,6,83,4,"onSuccess"],[96,15,83,13],[96,17,83,15,"onSuccess"],[96,18,83,16,"data"],[96,22,83,20],[96,24,83,22,"variables"],[96,33,83,31],[96,38,83,36],[97,8,84,6,"queryClient"],[97,19,84,17],[97,20,84,18,"invalidateQueries"],[97,37,84,35],[97,38,84,36],[98,10,84,38,"queryKey"],[98,18,84,46],[98,20,84,48,"listingKeys"],[98,30,84,59],[98,31,84,59,"listingKeys"],[98,42,84,59],[98,43,84,60,"offers"],[98,49,84,66],[98,50,84,67,"variables"],[98,59,84,76],[98,60,84,77,"listingId"],[98,69,84,86],[99,8,84,88],[99,9,84,89],[99,10,84,90],[100,8,85,6,"queryClient"],[100,19,85,17],[100,20,85,18,"invalidateQueries"],[100,37,85,35],[100,38,85,36],[101,10,85,38,"queryKey"],[101,18,85,46],[101,20,85,48,"listingKeys"],[101,30,85,59],[101,31,85,59,"listingKeys"],[101,42,85,59],[101,43,85,60,"myListings"],[101,53,85,70],[101,54,85,71],[102,8,85,73],[102,9,85,74],[102,10,85,75],[103,8,86,6,"queryClient"],[103,19,86,17],[103,20,86,18,"invalidateQueries"],[103,37,86,35],[103,38,86,36],[104,10,86,38,"queryKey"],[104,18,86,46],[104,20,86,48,"listingKeys"],[104,30,86,59],[104,31,86,59,"listingKeys"],[104,42,86,59],[104,43,86,60,"detail"],[104,49,86,66],[104,50,86,67,"variables"],[104,59,86,76],[104,60,86,77,"listingId"],[104,69,86,86],[105,8,86,88],[105,9,86,89],[105,10,86,90],[106,8,88,6],[106,12,88,10,"data"],[106,16,88,14],[106,17,88,15,"conversation_id"],[106,32,88,30],[106,34,88,32],[107,10,89,8,"router"],[107,16,89,14],[107,17,89,15,"push"],[107,21,89,19],[107,22,89,20],[107,49,89,47,"data"],[107,53,89,51],[107,54,89,52,"conversation_id"],[107,69,89,67],[107,71,89,69],[107,72,89,70],[108,8,90,6],[109,6,91,4],[110,4,92,2],[110,5,92,3],[110,6,92,4],[111,2,93,0],[111,3,93,1],[112,2,93,2,"_s"],[112,4,93,2],[112,5,30,6,"useRespondToOffer"],[112,22,30,23],[113,4,30,23],[113,12,31,22,"useQueryClient"],[113,31,31,36],[113,32,31,36,"useQueryClient"],[113,46,31,36],[113,48,32,17,"useRouter"],[113,59,32,26],[113,60,32,26,"useRouter"],[113,69,32,26],[113,71,34,9,"useMutation"],[113,90,34,20],[113,91,34,20,"useMutation"],[113,102,34,20],[114,2,34,20],[115,2,95,0],[115,6,95,0,"_default"],[115,14,95,0],[115,17,95,15,"useRespondToOffer"],[115,34,95,32],[116,0,95,33],[116,3]],"functionMap":{"names":["<global>","useRespondToOffer","useMutation$argument_0.mutationFn","useMutation$argument_0.onSuccess"],"mappings":"AAA;0BC6B;gBCK;KD+C;eEC;KFQ;CDE"},"hasCjsExports":false},"type":"js/module"}]}
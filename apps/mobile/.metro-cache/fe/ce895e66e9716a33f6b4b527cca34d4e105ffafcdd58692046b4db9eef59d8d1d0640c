{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":68,"index":68}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"expo-router","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":69},"end":{"line":2,"column":40,"index":109}}],"key":"/+ErnBisjrT6aDU+GRp5Qz/lYoY=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":110},"end":{"line":3,"column":42,"index":152}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":153},"end":{"line":4,"column":46,"index":199}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1], \"@tanstack/react-query\");\n  var _expoRouter = require(_dependencyMap[2], \"expo-router\");\n  var _libSupabase = require(_dependencyMap[3], \"@/lib/supabase\");\n  var _queryKeys = require(_dependencyMap[4], \"../../queryKeys\");\n  /**\n   * Mutation that accepts or declines an offer via atomic Postgres RPC.\n   *\n   * On accept: atomically accepts the offer, declines all sibling offers,\n   * creates a match + conversation, and transitions the listing to matched.\n   * Then navigates to the new chat.\n   *\n   * On decline: atomically declines the single offer.\n   *\n   * @see packages/api/src/pipelines/acceptOffer/acceptOffer.ts\n   * @see packages/api/src/pipelines/declineOffer/declineOffer.ts\n   */\n  var useRespondToOffer = () => {\n    _s();\n    var queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    var router = (0, _expoRouter.useRouter)();\n    return (0, _tanstackReactQuery.useMutation)({\n      mutationFn: function () {\n        var _ref2 = (0, _asyncToGenerator.default)(function* (_ref) {\n          var offerId = _ref.offerId,\n            listingId = _ref.listingId,\n            action = _ref.action;\n          var _yield$supabase$auth$ = yield _libSupabase.supabase.auth.getSession(),\n            session = _yield$supabase$auth$.data.session;\n          var userId = session?.user?.id;\n          if (!userId) throw new Error('Not authenticated');\n          if (action === 'accepted') {\n            var _yield$supabase$rpc = yield _libSupabase.supabase.rpc('accept_offer_v1', {\n                p_offer_id: offerId,\n                p_listing_id: listingId,\n                p_user_id: userId\n              }),\n              data = _yield$supabase$rpc.data,\n              _error = _yield$supabase$rpc.error;\n            if (_error) throw _error;\n            var result = data;\n            return {\n              match_id: result.match_id,\n              conversation_id: result.conversation_id\n            };\n          }\n\n          // Decline\n          var _yield$supabase$rpc2 = yield _libSupabase.supabase.rpc('decline_offer_v1', {\n              p_offer_id: offerId,\n              p_user_id: userId\n            }),\n            error = _yield$supabase$rpc2.error;\n          if (error) throw error;\n          return {\n            match_id: null,\n            conversation_id: null\n          };\n        });\n        return function mutationFn(_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }(),\n      onSuccess: (data, variables) => {\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.offers(variables.listingId)\n        });\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.myListings()\n        });\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.detail(variables.listingId)\n        });\n        if (data.conversation_id) {\n          router.push(`/(tabs)/(messages)/chat/${data.conversation_id}`);\n        }\n      }\n    });\n  };\n  _s(useRespondToOffer, \"OMPBWmuGqcicNpy0gW6DnCxqRr0=\", false, function () {\n    return [_tanstackReactQuery.useQueryClient, _expoRouter.useRouter, _tanstackReactQuery.useMutation];\n  });\n  var _default = useRespondToOffer;\n});","lineCount":103,"map":[[13,2,80,0,"Object"],[13,8,80,0],[13,9,80,0,"defineProperty"],[13,23,80,0],[13,24,80,0,"exports"],[13,31,80,0],[14,4,80,0,"enumerable"],[14,14,80,0],[15,4,80,0,"get"],[15,7,80,0],[15,18,80,0,"get"],[15,19,80,0],[16,6,80,0],[16,13,80,0,"_default"],[16,21,80,0],[17,4,80,0],[18,2,80,0],[19,2,80,33],[19,6,80,33,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,80,33],[19,45,80,33,"require"],[19,52,80,33],[19,53,80,33,"_dependencyMap"],[19,67,80,33],[20,2,80,33],[20,6,80,33,"_asyncToGenerator"],[20,23,80,33],[20,26,80,33,"_interopDefault"],[20,41,80,33],[20,42,80,33,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,80,33],[21,2,1,0],[21,6,1,0,"_tanstackReactQuery"],[21,25,1,0],[21,28,1,0,"require"],[21,35,1,0],[21,36,1,0,"_dependencyMap"],[21,50,1,0],[22,2,2,0],[22,6,2,0,"_expoRouter"],[22,17,2,0],[22,20,2,0,"require"],[22,27,2,0],[22,28,2,0,"_dependencyMap"],[22,42,2,0],[23,2,3,0],[23,6,3,0,"_libSupabase"],[23,18,3,0],[23,21,3,0,"require"],[23,28,3,0],[23,29,3,0,"_dependencyMap"],[23,43,3,0],[24,2,4,0],[24,6,4,0,"_queryKeys"],[24,16,4,0],[24,19,4,0,"require"],[24,26,4,0],[24,27,4,0,"_dependencyMap"],[24,41,4,0],[25,2,17,0],[26,0,18,0],[27,0,19,0],[28,0,20,0],[29,0,21,0],[30,0,22,0],[31,0,23,0],[32,0,24,0],[33,0,25,0],[34,0,26,0],[35,0,27,0],[36,0,28,0],[37,2,29,0],[37,6,29,6,"useRespondToOffer"],[37,23,29,23],[37,26,29,26,"useRespondToOffer"],[37,27,29,26],[37,32,29,32],[38,4,29,32,"_s"],[38,6,29,32],[39,4,30,2],[39,8,30,8,"queryClient"],[39,19,30,19],[39,22,30,22],[39,26,30,22,"useQueryClient"],[39,45,30,36],[39,46,30,36,"useQueryClient"],[39,60,30,36],[39,62,30,37],[39,63,30,38],[40,4,31,2],[40,8,31,8,"router"],[40,14,31,14],[40,17,31,17],[40,21,31,17,"useRouter"],[40,32,31,26],[40,33,31,26,"useRouter"],[40,42,31,26],[40,44,31,27],[40,45,31,28],[41,4,33,2],[41,11,33,9],[41,15,33,9,"useMutation"],[41,34,33,20],[41,35,33,20,"useMutation"],[41,46,33,20],[41,48,33,57],[42,6,34,4,"mutationFn"],[42,16,34,14],[43,8,34,14],[43,12,34,14,"_ref2"],[43,17,34,14],[43,24,34,14,"_asyncToGenerator"],[43,41,34,14],[43,42,34,14,"default"],[43,49,34,14],[43,51,34,16],[43,62,34,16,"_ref"],[43,66,34,16],[43,68,34,58],[44,10,34,58],[44,14,34,25,"offerId"],[44,21,34,32],[44,24,34,32,"_ref"],[44,28,34,32],[44,29,34,25,"offerId"],[44,36,34,32],[45,12,34,34,"listingId"],[45,21,34,43],[45,24,34,43,"_ref"],[45,28,34,43],[45,29,34,34,"listingId"],[45,38,34,43],[46,12,34,45,"action"],[46,18,34,51],[46,21,34,51,"_ref"],[46,25,34,51],[46,26,34,45,"action"],[46,32,34,51],[47,10,35,6],[47,14,35,6,"_yield$supabase$auth$"],[47,35,35,6],[47,44,37,16,"supabase"],[47,56,37,24],[47,57,37,24,"supabase"],[47,65,37,24],[47,66,37,25,"auth"],[47,70,37,29],[47,71,37,30,"getSession"],[47,81,37,40],[47,82,37,41],[47,83,37,42],[48,12,36,16,"session"],[48,19,36,23],[48,22,36,23,"_yield$supabase$auth$"],[48,43,36,23],[48,44,36,8,"data"],[48,48,36,12],[48,49,36,16,"session"],[48,56,36,23],[49,10,38,6],[49,14,38,12,"userId"],[49,20,38,18],[49,23,38,21,"session"],[49,30,38,28],[49,32,38,30,"user"],[49,36,38,34],[49,38,38,36,"id"],[49,40,38,38],[50,10,40,6],[50,14,40,10],[50,15,40,11,"userId"],[50,21,40,17],[50,23,40,19],[50,29,40,25],[50,33,40,29,"Error"],[50,38,40,34],[50,39,40,35],[50,58,40,54],[50,59,40,55],[51,10,42,6],[51,14,42,10,"action"],[51,20,42,16],[51,25,42,21],[51,35,42,31],[51,37,42,33],[52,12,43,8],[52,16,43,8,"_yield$supabase$rpc"],[52,35,43,8],[52,44,43,38,"supabase"],[52,56,43,46],[52,57,43,46,"supabase"],[52,65,43,46],[52,66,43,47,"rpc"],[52,69,43,50],[52,70,43,51],[52,87,43,68],[52,89,43,70],[53,16,44,10,"p_offer_id"],[53,26,44,20],[53,28,44,22,"offerId"],[53,35,44,29],[54,16,45,10,"p_listing_id"],[54,28,45,22],[54,30,45,24,"listingId"],[54,39,45,33],[55,16,46,10,"p_user_id"],[55,25,46,19],[55,27,46,21,"userId"],[56,14,47,8],[56,15,47,9],[56,16,47,10],[57,14,43,16,"data"],[57,18,43,20],[57,21,43,20,"_yield$supabase$rpc"],[57,40,43,20],[57,41,43,16,"data"],[57,45,43,20],[58,14,43,22,"error"],[58,20,43,27],[58,23,43,27,"_yield$supabase$rpc"],[58,42,43,27],[58,43,43,22,"error"],[58,48,43,27],[59,12,49,8],[59,16,49,12,"error"],[59,22,49,17],[59,24,49,19],[59,30,49,25,"error"],[59,36,49,30],[60,12,51,8],[60,16,51,14,"result"],[60,22,51,20],[60,25,51,23,"data"],[60,29,51,76],[61,12,52,8],[61,19,52,15],[62,14,53,10,"match_id"],[62,22,53,18],[62,24,53,20,"result"],[62,30,53,26],[62,31,53,27,"match_id"],[62,39,53,35],[63,14,54,10,"conversation_id"],[63,29,54,25],[63,31,54,27,"result"],[63,37,54,33],[63,38,54,34,"conversation_id"],[64,12,55,8],[64,13,55,9],[65,10,56,6],[67,10,58,6],[68,10,59,6],[68,14,59,6,"_yield$supabase$rpc2"],[68,34,59,6],[68,43,59,30,"supabase"],[68,55,59,38],[68,56,59,38,"supabase"],[68,64,59,38],[68,65,59,39,"rpc"],[68,68,59,42],[68,69,59,43],[68,87,59,61],[68,89,59,63],[69,14,60,8,"p_offer_id"],[69,24,60,18],[69,26,60,20,"offerId"],[69,33,60,27],[70,14,61,8,"p_user_id"],[70,23,61,17],[70,25,61,19,"userId"],[71,12,62,6],[71,13,62,7],[71,14,62,8],[72,12,59,14,"error"],[72,17,59,19],[72,20,59,19,"_yield$supabase$rpc2"],[72,40,59,19],[72,41,59,14,"error"],[72,46,59,19],[73,10,64,6],[73,14,64,10,"error"],[73,19,64,15],[73,21,64,17],[73,27,64,23,"error"],[73,32,64,28],[74,10,66,6],[74,17,66,13],[75,12,66,15,"match_id"],[75,20,66,23],[75,22,66,25],[75,26,66,29],[76,12,66,31,"conversation_id"],[76,27,66,46],[76,29,66,48],[77,10,66,53],[77,11,66,54],[78,8,67,4],[78,9,67,5],[79,8,67,5],[79,24,34,4,"mutationFn"],[79,34,34,14,"mutationFn"],[79,35,34,14,"_x"],[79,37,34,14],[80,10,34,14],[80,17,34,14,"_ref2"],[80,22,34,14],[80,23,34,14,"apply"],[80,28,34,14],[80,35,34,14,"arguments"],[80,44,34,14],[81,8,34,14],[82,6,34,14],[82,9,67,5],[83,6,68,4,"onSuccess"],[83,15,68,13],[83,17,68,15,"onSuccess"],[83,18,68,16,"data"],[83,22,68,20],[83,24,68,22,"variables"],[83,33,68,31],[83,38,68,36],[84,8,69,6,"queryClient"],[84,19,69,17],[84,20,69,18,"invalidateQueries"],[84,37,69,35],[84,38,69,36],[85,10,69,38,"queryKey"],[85,18,69,46],[85,20,69,48,"listingKeys"],[85,30,69,59],[85,31,69,59,"listingKeys"],[85,42,69,59],[85,43,69,60,"offers"],[85,49,69,66],[85,50,69,67,"variables"],[85,59,69,76],[85,60,69,77,"listingId"],[85,69,69,86],[86,8,69,88],[86,9,69,89],[86,10,69,90],[87,8,70,6,"queryClient"],[87,19,70,17],[87,20,70,18,"invalidateQueries"],[87,37,70,35],[87,38,70,36],[88,10,70,38,"queryKey"],[88,18,70,46],[88,20,70,48,"listingKeys"],[88,30,70,59],[88,31,70,59,"listingKeys"],[88,42,70,59],[88,43,70,60,"myListings"],[88,53,70,70],[88,54,70,71],[89,8,70,73],[89,9,70,74],[89,10,70,75],[90,8,71,6,"queryClient"],[90,19,71,17],[90,20,71,18,"invalidateQueries"],[90,37,71,35],[90,38,71,36],[91,10,71,38,"queryKey"],[91,18,71,46],[91,20,71,48,"listingKeys"],[91,30,71,59],[91,31,71,59,"listingKeys"],[91,42,71,59],[91,43,71,60,"detail"],[91,49,71,66],[91,50,71,67,"variables"],[91,59,71,76],[91,60,71,77,"listingId"],[91,69,71,86],[92,8,71,88],[92,9,71,89],[92,10,71,90],[93,8,73,6],[93,12,73,10,"data"],[93,16,73,14],[93,17,73,15,"conversation_id"],[93,32,73,30],[93,34,73,32],[94,10,74,8,"router"],[94,16,74,14],[94,17,74,15,"push"],[94,21,74,19],[94,22,74,20],[94,49,74,47,"data"],[94,53,74,51],[94,54,74,52,"conversation_id"],[94,69,74,67],[94,71,74,69],[94,72,74,70],[95,8,75,6],[96,6,76,4],[97,4,77,2],[97,5,77,3],[97,6,77,4],[98,2,78,0],[98,3,78,1],[99,2,78,2,"_s"],[99,4,78,2],[99,5,29,6,"useRespondToOffer"],[99,22,29,23],[100,4,29,23],[100,12,30,22,"useQueryClient"],[100,31,30,36],[100,32,30,36,"useQueryClient"],[100,46,30,36],[100,48,31,17,"useRouter"],[100,59,31,26],[100,60,31,26,"useRouter"],[100,69,31,26],[100,71,33,9,"useMutation"],[100,90,33,20],[100,91,33,20,"useMutation"],[100,102,33,20],[101,2,33,20],[102,2,80,0],[102,6,80,0,"_default"],[102,14,80,0],[102,17,80,15,"useRespondToOffer"],[102,34,80,32],[103,0,80,33],[103,3]],"functionMap":{"names":["<global>","useRespondToOffer","useMutation$argument_0.mutationFn","useMutation$argument_0.onSuccess"],"mappings":"AAA;0BC4B;gBCK;KDiC;eEC;KFQ;CDE"},"hasCjsExports":false},"type":"js/module"}]}
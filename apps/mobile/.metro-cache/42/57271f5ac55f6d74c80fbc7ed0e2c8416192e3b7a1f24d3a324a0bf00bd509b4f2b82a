{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":57,"index":57}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":58},"end":{"line":2,"column":42,"index":100}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":101},"end":{"line":3,"column":43,"index":144}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0]);\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1]);\n  var _libSupabase = require(_dependencyMap[2]);\n  var _queryKeys = require(_dependencyMap[3]);\n  var PAGE_SIZE = 30;\n  /** Fetches paginated messages for a conversation in reverse chronological order */\n  var useMessages = conversationId => {\n    return (0, _tanstackReactQuery.useInfiniteQuery)({\n      queryKey: _queryKeys.chatKeys.messages(conversationId),\n      queryFn: function () {\n        var _ref2 = (0, _asyncToGenerator.default)(function* (_ref) {\n          var pageParam = _ref.pageParam;\n          var query = _libSupabase.supabase.from('messages').select(`\n          *,\n          sender:users!messages_sender_id_fkey (\n            id,\n            display_name,\n            avatar_url\n          )\n        `).eq('conversation_id', conversationId).order('created_at', {\n            ascending: false\n          }).limit(PAGE_SIZE);\n          if (pageParam) {\n            query = query.lt('created_at', pageParam);\n          }\n          var _yield$query = yield query,\n            data = _yield$query.data,\n            error = _yield$query.error;\n          if (error) throw error;\n          return (data ?? []).map(msg => ({\n            ...msg,\n            sender: msg.sender\n          }));\n        });\n        return function queryFn(_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }(),\n      initialPageParam: null,\n      getNextPageParam: lastPage => {\n        if (lastPage.length < PAGE_SIZE) return undefined;\n        return lastPage[lastPage.length - 1]?.created_at ?? undefined;\n      },\n      enabled: !!conversationId\n    });\n  };\n  var _default = useMessages;\n});","lineCount":66,"map":[[12,2,58,0,"Object"],[12,8,58,0],[12,9,58,0,"defineProperty"],[12,23,58,0],[12,24,58,0,"exports"],[12,31,58,0],[13,4,58,0,"enumerable"],[13,14,58,0],[14,4,58,0,"get"],[14,7,58,0],[14,18,58,0,"get"],[14,19,58,0],[15,6,58,0],[15,13,58,0,"_default"],[15,21,58,0],[16,4,58,0],[17,2,58,0],[18,2,58,27],[18,6,58,27,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,58,27],[18,45,58,27,"require"],[18,52,58,27],[18,53,58,27,"_dependencyMap"],[18,67,58,27],[19,2,58,27],[19,6,58,27,"_asyncToGenerator"],[19,23,58,27],[19,26,58,27,"_interopDefault"],[19,41,58,27],[19,42,58,27,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,58,27],[20,2,1,0],[20,6,1,0,"_tanstackReactQuery"],[20,25,1,0],[20,28,1,0,"require"],[20,35,1,0],[20,36,1,0,"_dependencyMap"],[20,50,1,0],[21,2,2,0],[21,6,2,0,"_libSupabase"],[21,18,2,0],[21,21,2,0,"require"],[21,28,2,0],[21,29,2,0,"_dependencyMap"],[21,43,2,0],[22,2,3,0],[22,6,3,0,"_queryKeys"],[22,16,3,0],[22,19,3,0,"require"],[22,26,3,0],[22,27,3,0,"_dependencyMap"],[22,41,3,0],[23,2,6,0],[23,6,6,6,"PAGE_SIZE"],[23,15,6,15],[23,18,6,18],[23,20,6,20],[24,2,12,0],[25,2,13,0],[25,6,13,6,"useMessages"],[25,17,13,17],[25,20,13,21,"conversationId"],[25,34,13,43],[25,38,13,48],[26,4,14,2],[26,11,14,9],[26,15,14,9,"useInfiniteQuery"],[26,34,14,25],[26,35,14,25,"useInfiniteQuery"],[26,51,14,25],[26,53,14,26],[27,6,15,4,"queryKey"],[27,14,15,12],[27,16,15,14,"chatKeys"],[27,26,15,22],[27,27,15,22,"chatKeys"],[27,35,15,22],[27,36,15,23,"messages"],[27,44,15,31],[27,45,15,32,"conversationId"],[27,59,15,46],[27,60,15,47],[28,6,16,4,"queryFn"],[28,13,16,11],[29,8,16,11],[29,12,16,11,"_ref2"],[29,17,16,11],[29,24,16,11,"_asyncToGenerator"],[29,41,16,11],[29,42,16,11,"default"],[29,49,16,11],[29,51,16,13],[29,62,16,13,"_ref"],[29,66,16,13],[29,68,16,68],[30,10,16,68],[30,14,16,22,"pageParam"],[30,23,16,31],[30,26,16,31,"_ref"],[30,30,16,31],[30,31,16,22,"pageParam"],[30,40,16,31],[31,10,17,6],[31,14,17,10,"query"],[31,19,17,15],[31,22,17,18,"supabase"],[31,34,17,26],[31,35,17,26,"supabase"],[31,43,17,26],[31,44,18,9,"from"],[31,48,18,13],[31,49,18,14],[31,59,18,24],[31,60,18,25],[31,61,19,9,"select"],[31,67,19,15],[31,68,20,10],[32,0,21,0],[33,0,22,0],[34,0,23,0],[35,0,24,0],[36,0,25,0],[37,0,26,0],[38,0,27,0],[38,9,28,8],[38,10,28,9],[38,11,29,9,"eq"],[38,13,29,11],[38,14,29,12],[38,31,29,29],[38,33,29,31,"conversationId"],[38,47,29,45],[38,48,29,46],[38,49,30,9,"order"],[38,54,30,14],[38,55,30,15],[38,67,30,27],[38,69,30,29],[39,12,30,31,"ascending"],[39,21,30,40],[39,23,30,42],[40,10,30,48],[40,11,30,49],[40,12,30,50],[40,13,31,9,"limit"],[40,18,31,14],[40,19,31,15,"PAGE_SIZE"],[40,28,31,24],[40,29,31,25],[41,10,33,6],[41,14,33,10,"pageParam"],[41,23,33,19],[41,25,33,21],[42,12,34,8,"query"],[42,17,34,13],[42,20,34,16,"query"],[42,25,34,21],[42,26,34,22,"lt"],[42,28,34,24],[42,29,34,25],[42,41,34,37],[42,43,34,39,"pageParam"],[42,52,34,48],[42,53,34,49],[43,10,35,6],[44,10,37,6],[44,14,37,6,"_yield$query"],[44,26,37,6],[44,35,37,36,"query"],[44,40,37,41],[45,12,37,14,"data"],[45,16,37,18],[45,19,37,18,"_yield$query"],[45,31,37,18],[45,32,37,14,"data"],[45,36,37,18],[46,12,37,20,"error"],[46,17,37,25],[46,20,37,25,"_yield$query"],[46,32,37,25],[46,33,37,20,"error"],[46,38,37,25],[47,10,39,6],[47,14,39,10,"error"],[47,19,39,15],[47,21,39,17],[47,27,39,23,"error"],[47,32,39,28],[48,10,41,6],[48,17,41,13],[48,18,41,14,"data"],[48,22,41,18],[48,26,41,22],[48,28,41,24],[48,30,41,26,"map"],[48,33,41,29],[48,34,41,31,"msg"],[48,37,41,34],[48,42,41,40],[49,12,42,8],[49,15,42,11,"msg"],[49,18,42,14],[50,12,43,8,"sender"],[50,18,43,14],[50,20,43,16,"msg"],[50,23,43,19],[50,24,43,20,"sender"],[51,10,47,6],[51,11,47,7],[51,12,47,8],[51,13,47,9],[52,8,48,4],[52,9,48,5],[53,8,48,5],[53,24,16,4,"queryFn"],[53,31,16,11,"queryFn"],[53,32,16,11,"_x"],[53,34,16,11],[54,10,16,11],[54,17,16,11,"_ref2"],[54,22,16,11],[54,23,16,11,"apply"],[54,28,16,11],[54,35,16,11,"arguments"],[54,44,16,11],[55,8,16,11],[56,6,16,11],[56,9,48,5],[57,6,49,4,"initialPageParam"],[57,22,49,20],[57,24,49,22],[57,28,49,43],[58,6,50,4,"getNextPageParam"],[58,22,50,20],[58,24,50,23,"lastPage"],[58,32,50,31],[58,36,50,36],[59,8,51,6],[59,12,51,10,"lastPage"],[59,20,51,18],[59,21,51,19,"length"],[59,27,51,25],[59,30,51,28,"PAGE_SIZE"],[59,39,51,37],[59,41,51,39],[59,48,51,46,"undefined"],[59,57,51,55],[60,8,52,6],[60,15,52,13,"lastPage"],[60,23,52,21],[60,24,52,22,"lastPage"],[60,32,52,30],[60,33,52,31,"length"],[60,39,52,37],[60,42,52,40],[60,43,52,41],[60,44,52,42],[60,46,52,44,"created_at"],[60,56,52,54],[60,60,52,58,"undefined"],[60,69,52,67],[61,6,53,4],[61,7,53,5],[62,6,54,4,"enabled"],[62,13,54,11],[62,15,54,13],[62,16,54,14],[62,17,54,15,"conversationId"],[63,4,55,2],[63,5,55,3],[63,6,55,4],[64,2,56,0],[64,3,56,1],[65,2,58,0],[65,6,58,0,"_default"],[65,14,58,0],[65,17,58,15,"useMessages"],[65,28,58,26],[66,0,58,27],[66,3]],"functionMap":{"names":["<global>","useMessages","useInfiniteQuery$argument_0.queryFn","map$argument_0","useInfiniteQuery$argument_0.getNextPageParam"],"mappings":"AAA;oBCY;aCG;8BCyB;QDM;KDC;sBGE;KHG;CDG"},"hasCjsExports":false},"type":"js/module"}]}
{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":68,"index":68}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"react-native","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":69},"end":{"line":2,"column":37,"index":106}}],"key":"KyzuX10g6ixS9UfynhmjlvCIG3g=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":107},"end":{"line":3,"column":42,"index":149}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":150},"end":{"line":4,"column":45,"index":195}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}},{"name":"@/services/devLiveEmitter/devLiveEmitter","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":196},"end":{"line":5,"column":85,"index":281}}],"key":"+12q/uGkja92D/Tp4S2X61mlsvU=","exportNames":["*"],"imports":1}},{"name":"@tcg-trade-hub/database","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":282},"end":{"line":6,"column":57,"index":339}}],"key":"5m5x3CfVnTLecgF7rw3ym/c0mII=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0]);\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1]);\n  var _reactNative = require(_dependencyMap[2]);\n  var _libSupabase = require(_dependencyMap[3]);\n  var _queryKeys = require(_dependencyMap[4]);\n  var _servicesDevLiveEmitterDevLiveEmitter = require(_dependencyMap[5]);\n  var _tcgTradeHubDatabase = require(_dependencyMap[6]);\n  /**\n   * Hook that completes a meetup via atomic Postgres RPC.\n   *\n   * Marks the current user's side as completed. When both users have\n   * completed, the RPC atomically finalizes the meetup, match, and\n   * increments both users' total_trades. The response indicates\n   * `both_completed: true` which triggers the rating prompt via\n   * the onBothCompleted callback.\n   *\n   * @see packages/api/src/pipelines/completeMeetup/completeMeetup.ts\n   */\n  var useCompleteMeetup = onBothCompleted => {\n    var queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    return (0, _tanstackReactQuery.useMutation)({\n      mutationFn: function () {\n        var _ref2 = (0, _asyncToGenerator.default)(function* (_ref) {\n          var meetupId = _ref.meetupId;\n          var stepIdx = (0, _tcgTradeHubDatabase.stateStepIndex)('meetup', 'confirmed', 'completed');\n          var scoped = undefined;\n          scoped?.(stepIdx, 'started');\n          var _yield$supabase$auth$ = yield _libSupabase.supabase.auth.getSession(),\n            session = _yield$supabase$auth$.data.session;\n          var userId = session?.user?.id;\n          if (!userId) throw new Error('Not authenticated');\n          try {\n            var _yield$supabase$rpc = yield _libSupabase.supabase.rpc('complete_meetup_v1', {\n                p_meetup_id: meetupId,\n                p_user_id: userId\n              }),\n              data = _yield$supabase$rpc.data,\n              error = _yield$supabase$rpc.error;\n            if (error) throw error;\n            if (!data) throw new Error('No response from complete_meetup_v1');\n            scoped?.(stepIdx, 'success');\n            return data;\n          } catch (err) {\n            scoped?.(stepIdx, 'error', {\n              message: err.message\n            });\n            throw err;\n          }\n        });\n        return function mutationFn(_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }(),\n      onSuccess: data => {\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.meetupKeys.all\n        });\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.meetupKeys.detail(data.meetup_id)\n        });\n        if (data.both_completed && onBothCompleted) {\n          onBothCompleted(data.meetup_id);\n        }\n      },\n      onError: error => {\n        _reactNative.Alert.alert('Error', error.message ?? 'Failed to complete meetup');\n      }\n    });\n  };\n  var _default = useCompleteMeetup;\n});","lineCount":89,"map":[[12,2,77,0,"Object"],[12,8,77,0],[12,9,77,0,"defineProperty"],[12,23,77,0],[12,24,77,0,"exports"],[12,31,77,0],[13,4,77,0,"enumerable"],[13,14,77,0],[14,4,77,0,"get"],[14,7,77,0],[14,18,77,0,"get"],[14,19,77,0],[15,6,77,0],[15,13,77,0,"_default"],[15,21,77,0],[16,4,77,0],[17,2,77,0],[18,2,77,33],[18,6,77,33,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,77,33],[18,45,77,33,"require"],[18,52,77,33],[18,53,77,33,"_dependencyMap"],[18,67,77,33],[19,2,77,33],[19,6,77,33,"_asyncToGenerator"],[19,23,77,33],[19,26,77,33,"_interopDefault"],[19,41,77,33],[19,42,77,33,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,77,33],[20,2,1,0],[20,6,1,0,"_tanstackReactQuery"],[20,25,1,0],[20,28,1,0,"require"],[20,35,1,0],[20,36,1,0,"_dependencyMap"],[20,50,1,0],[21,2,2,0],[21,6,2,0,"_reactNative"],[21,18,2,0],[21,21,2,0,"require"],[21,28,2,0],[21,29,2,0,"_dependencyMap"],[21,43,2,0],[22,2,3,0],[22,6,3,0,"_libSupabase"],[22,18,3,0],[22,21,3,0,"require"],[22,28,3,0],[22,29,3,0,"_dependencyMap"],[22,43,3,0],[23,2,4,0],[23,6,4,0,"_queryKeys"],[23,16,4,0],[23,19,4,0,"require"],[23,26,4,0],[23,27,4,0,"_dependencyMap"],[23,41,4,0],[24,2,5,0],[24,6,5,0,"_servicesDevLiveEmitterDevLiveEmitter"],[24,43,5,0],[24,46,5,0,"require"],[24,53,5,0],[24,54,5,0,"_dependencyMap"],[24,68,5,0],[25,2,6,0],[25,6,6,0,"_tcgTradeHubDatabase"],[25,26,6,0],[25,29,6,0,"require"],[25,36,6,0],[25,37,6,0,"_dependencyMap"],[25,51,6,0],[26,2,17,0],[27,0,18,0],[28,0,19,0],[29,0,20,0],[30,0,21,0],[31,0,22,0],[32,0,23,0],[33,0,24,0],[34,0,25,0],[35,0,26,0],[36,0,27,0],[37,2,28,0],[37,6,28,6,"useCompleteMeetup"],[37,23,28,23],[37,26,28,27,"onBothCompleted"],[37,41,28,71],[37,45,28,76],[38,4,29,2],[38,8,29,8,"queryClient"],[38,19,29,19],[38,22,29,22],[38,26,29,22,"useQueryClient"],[38,45,29,36],[38,46,29,36,"useQueryClient"],[38,60,29,36],[38,62,29,37],[38,63,29,38],[39,4,31,2],[39,11,31,9],[39,15,31,9,"useMutation"],[39,34,31,20],[39,35,31,20,"useMutation"],[39,46,31,20],[39,48,31,21],[40,6,32,4,"mutationFn"],[40,16,32,14],[41,8,32,14],[41,12,32,14,"_ref2"],[41,17,32,14],[41,24,32,14,"_asyncToGenerator"],[41,41,32,14],[41,42,32,14,"default"],[41,49,32,14],[41,51,32,16],[41,62,32,16,"_ref"],[41,66,32,16],[41,68,32,62],[42,10,32,62],[42,14,32,25,"meetupId"],[42,22,32,33],[42,25,32,33,"_ref"],[42,29,32,33],[42,30,32,25,"meetupId"],[42,38,32,33],[43,10,33,6],[43,14,33,12,"stepIdx"],[43,21,33,19],[43,24,33,22],[43,28,33,22,"stateStepIndex"],[43,48,33,36],[43,49,33,36,"stateStepIndex"],[43,63,33,36],[43,65,33,37],[43,73,33,45],[43,75,33,47],[43,86,33,58],[43,88,33,60],[43,99,33,71],[43,100,33,72],[44,10,34,6],[44,14,34,12,"scoped"],[44,20,34,18],[44,23,36,10,"undefined"],[44,32,36,19],[45,10,38,6,"scoped"],[45,16,38,12],[45,19,38,15,"stepIdx"],[45,26,38,22],[45,28,38,24],[45,37,38,33],[45,38,38,34],[46,10,40,6],[46,14,40,6,"_yield$supabase$auth$"],[46,35,40,6],[46,44,42,16,"supabase"],[46,56,42,24],[46,57,42,24,"supabase"],[46,65,42,24],[46,66,42,25,"auth"],[46,70,42,29],[46,71,42,30,"getSession"],[46,81,42,40],[46,82,42,41],[46,83,42,42],[47,12,41,16,"session"],[47,19,41,23],[47,22,41,23,"_yield$supabase$auth$"],[47,43,41,23],[47,44,41,8,"data"],[47,48,41,12],[47,49,41,16,"session"],[47,56,41,23],[48,10,43,6],[48,14,43,12,"userId"],[48,20,43,18],[48,23,43,21,"session"],[48,30,43,28],[48,32,43,30,"user"],[48,36,43,34],[48,38,43,36,"id"],[48,40,43,38],[49,10,45,6],[49,14,45,10],[49,15,45,11,"userId"],[49,21,45,17],[49,23,45,19],[49,29,45,25],[49,33,45,29,"Error"],[49,38,45,34],[49,39,45,35],[49,58,45,54],[49,59,45,55],[50,10,47,6],[50,14,47,10],[51,12,48,8],[51,16,48,8,"_yield$supabase$rpc"],[51,35,48,8],[51,44,48,38,"supabase"],[51,56,48,46],[51,57,48,46,"supabase"],[51,65,48,46],[51,66,48,47,"rpc"],[51,69,48,50],[51,70,48,51],[51,90,48,71],[51,92,48,73],[52,16,49,10,"p_meetup_id"],[52,27,49,21],[52,29,49,23,"meetupId"],[52,37,49,31],[53,16,50,10,"p_user_id"],[53,25,50,19],[53,27,50,21,"userId"],[54,14,51,8],[54,15,51,9],[54,16,51,10],[55,14,48,16,"data"],[55,18,48,20],[55,21,48,20,"_yield$supabase$rpc"],[55,40,48,20],[55,41,48,16,"data"],[55,45,48,20],[56,14,48,22,"error"],[56,19,48,27],[56,22,48,27,"_yield$supabase$rpc"],[56,41,48,27],[56,42,48,22,"error"],[56,47,48,27],[57,12,53,8],[57,16,53,12,"error"],[57,21,53,17],[57,23,53,19],[57,29,53,25,"error"],[57,34,53,30],[58,12,54,8],[58,16,54,12],[58,17,54,13,"data"],[58,21,54,17],[58,23,54,19],[58,29,54,25],[58,33,54,29,"Error"],[58,38,54,34],[58,39,54,35],[58,76,54,72],[58,77,54,73],[59,12,56,8,"scoped"],[59,18,56,14],[59,21,56,17,"stepIdx"],[59,28,56,24],[59,30,56,26],[59,39,56,35],[59,40,56,36],[60,12,57,8],[60,19,57,15,"data"],[60,23,57,19],[61,10,58,6],[61,11,58,7],[61,12,58,8],[61,19,58,15,"err"],[61,22,58,18],[61,24,58,20],[62,12,59,8,"scoped"],[62,18,59,14],[62,21,59,17,"stepIdx"],[62,28,59,24],[62,30,59,26],[62,37,59,33],[62,39,59,35],[63,14,59,37,"message"],[63,21,59,44],[63,23,59,47,"err"],[63,26,59,50],[63,27,59,61,"message"],[64,12,59,69],[64,13,59,70],[64,14,59,71],[65,12,60,8],[65,18,60,14,"err"],[65,21,60,17],[66,10,61,6],[67,8,62,4],[67,9,62,5],[68,8,62,5],[68,24,32,4,"mutationFn"],[68,34,32,14,"mutationFn"],[68,35,32,14,"_x"],[68,37,32,14],[69,10,32,14],[69,17,32,14,"_ref2"],[69,22,32,14],[69,23,32,14,"apply"],[69,28,32,14],[69,35,32,14,"arguments"],[69,44,32,14],[70,8,32,14],[71,6,32,14],[71,9,62,5],[72,6,63,4,"onSuccess"],[72,15,63,13],[72,17,63,16,"data"],[72,21,63,20],[72,25,63,25],[73,8,64,6,"queryClient"],[73,19,64,17],[73,20,64,18,"invalidateQueries"],[73,37,64,35],[73,38,64,36],[74,10,64,38,"queryKey"],[74,18,64,46],[74,20,64,48,"meetupKeys"],[74,30,64,58],[74,31,64,58,"meetupKeys"],[74,41,64,58],[74,42,64,59,"all"],[75,8,64,63],[75,9,64,64],[75,10,64,65],[76,8,65,6,"queryClient"],[76,19,65,17],[76,20,65,18,"invalidateQueries"],[76,37,65,35],[76,38,65,36],[77,10,65,38,"queryKey"],[77,18,65,46],[77,20,65,48,"meetupKeys"],[77,30,65,58],[77,31,65,58,"meetupKeys"],[77,41,65,58],[77,42,65,59,"detail"],[77,48,65,65],[77,49,65,66,"data"],[77,53,65,70],[77,54,65,71,"meetup_id"],[77,63,65,80],[78,8,65,82],[78,9,65,83],[78,10,65,84],[79,8,67,6],[79,12,67,10,"data"],[79,16,67,14],[79,17,67,15,"both_completed"],[79,31,67,29],[79,35,67,33,"onBothCompleted"],[79,50,67,48],[79,52,67,50],[80,10,68,8,"onBothCompleted"],[80,25,68,23],[80,26,68,24,"data"],[80,30,68,28],[80,31,68,29,"meetup_id"],[80,40,68,38],[80,41,68,39],[81,8,69,6],[82,6,70,4],[82,7,70,5],[83,6,71,4,"onError"],[83,13,71,11],[83,15,71,14,"error"],[83,20,71,26],[83,24,71,31],[84,8,72,6,"Alert"],[84,20,72,11],[84,21,72,11,"Alert"],[84,26,72,11],[84,27,72,12,"alert"],[84,32,72,17],[84,33,72,18],[84,40,72,25],[84,42,72,27,"error"],[84,47,72,32],[84,48,72,33,"message"],[84,55,72,40],[84,59,72,44],[84,86,72,71],[84,87,72,72],[85,6,73,4],[86,4,74,2],[86,5,74,3],[86,6,74,4],[87,2,75,0],[87,3,75,1],[88,2,77,0],[88,6,77,0,"_default"],[88,14,77,0],[88,17,77,15,"useCompleteMeetup"],[88,34,77,32],[89,0,77,33],[89,3]],"functionMap":{"names":["<global>","useCompleteMeetup","useMutation$argument_0.mutationFn","useMutation$argument_0.onSuccess","useMutation$argument_0.onError"],"mappings":"AAA;0BC2B;gBCI;KD8B;eEC;KFO;aGC;KHE;CDE"},"hasCjsExports":false},"type":"js/module"}]}
{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":68,"index":68}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"react-native","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":69},"end":{"line":2,"column":37,"index":106}}],"key":"KyzuX10g6ixS9UfynhmjlvCIG3g=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":107},"end":{"line":3,"column":42,"index":149}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":150},"end":{"line":4,"column":45,"index":195}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}},{"name":"@/services/devLiveEmitter/devLiveEmitter","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":196},"end":{"line":5,"column":85,"index":281}}],"key":"+12q/uGkja92D/Tp4S2X61mlsvU=","exportNames":["*"],"imports":1}},{"name":"@tcg-trade-hub/database","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":282},"end":{"line":6,"column":57,"index":339}}],"key":"5m5x3CfVnTLecgF7rw3ym/c0mII=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1], \"@tanstack/react-query\");\n  var _reactNative = require(_dependencyMap[2], \"react-native\");\n  var _libSupabase = require(_dependencyMap[3], \"@/lib/supabase\");\n  var _queryKeys = require(_dependencyMap[4], \"../../queryKeys\");\n  var _servicesDevLiveEmitterDevLiveEmitter = require(_dependencyMap[5], \"@/services/devLiveEmitter/devLiveEmitter\");\n  var _tcgTradeHubDatabase = require(_dependencyMap[6], \"@tcg-trade-hub/database\");\n  /**\n   * Hook that completes a meetup via atomic Postgres RPC.\n   *\n   * Marks the current user's side as completed. When both users have\n   * completed, the RPC atomically finalizes the meetup, match, and\n   * increments both users' total_trades. The response indicates\n   * `both_completed: true` which triggers the rating prompt via\n   * the onBothCompleted callback.\n   *\n   * @see packages/api/src/pipelines/completeMeetup/completeMeetup.ts\n   */\n  var useCompleteMeetup = onBothCompleted => {\n    _s();\n    var queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    return (0, _tanstackReactQuery.useMutation)({\n      mutationFn: function () {\n        var _ref2 = (0, _asyncToGenerator.default)(function* (_ref) {\n          var meetupId = _ref.meetupId;\n          var stepIdx = (0, _tcgTradeHubDatabase.stateStepIndex)('meetup', 'confirmed', 'completed');\n          var scoped = __DEV__ ? _servicesDevLiveEmitterDevLiveEmitter.devEmitter.forPath('pipeline:completeMeetup', (0, _servicesDevLiveEmitterDevLiveEmitter.createTraceId)(), 'mobile:completeMeetup') : undefined;\n          scoped?.(stepIdx, 'started');\n          var _yield$supabase$auth$ = yield _libSupabase.supabase.auth.getSession(),\n            session = _yield$supabase$auth$.data.session;\n          var userId = session?.user?.id;\n          if (!userId) throw new Error('Not authenticated');\n          try {\n            var _yield$supabase$rpc = yield _libSupabase.supabase.rpc('complete_meetup_v1', {\n                p_meetup_id: meetupId,\n                p_user_id: userId\n              }),\n              data = _yield$supabase$rpc.data,\n              error = _yield$supabase$rpc.error;\n            if (error) throw error;\n            if (!data) throw new Error('No response from complete_meetup_v1');\n            scoped?.(stepIdx, 'success');\n            return data;\n          } catch (err) {\n            scoped?.(stepIdx, 'error', {\n              message: err.message\n            });\n            throw err;\n          }\n        });\n        return function mutationFn(_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }(),\n      onSuccess: data => {\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.meetupKeys.all\n        });\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.meetupKeys.detail(data.meetup_id)\n        });\n        if (data.both_completed && onBothCompleted) {\n          onBothCompleted(data.meetup_id);\n        }\n      },\n      onError: error => {\n        _reactNative.Alert.alert('Error', error.message ?? 'Failed to complete meetup');\n      }\n    });\n  };\n  _s(useCompleteMeetup, \"YK0wzM21ECnncaq5SECwU+/SVdQ=\", false, function () {\n    return [_tanstackReactQuery.useQueryClient, _tanstackReactQuery.useMutation];\n  });\n  var _default = useCompleteMeetup;\n});","lineCount":94,"map":[[13,2,77,0,"Object"],[13,8,77,0],[13,9,77,0,"defineProperty"],[13,23,77,0],[13,24,77,0,"exports"],[13,31,77,0],[14,4,77,0,"enumerable"],[14,14,77,0],[15,4,77,0,"get"],[15,7,77,0],[15,18,77,0,"get"],[15,19,77,0],[16,6,77,0],[16,13,77,0,"_default"],[16,21,77,0],[17,4,77,0],[18,2,77,0],[19,2,77,33],[19,6,77,33,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,77,33],[19,45,77,33,"require"],[19,52,77,33],[19,53,77,33,"_dependencyMap"],[19,67,77,33],[20,2,77,33],[20,6,77,33,"_asyncToGenerator"],[20,23,77,33],[20,26,77,33,"_interopDefault"],[20,41,77,33],[20,42,77,33,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,77,33],[21,2,1,0],[21,6,1,0,"_tanstackReactQuery"],[21,25,1,0],[21,28,1,0,"require"],[21,35,1,0],[21,36,1,0,"_dependencyMap"],[21,50,1,0],[22,2,2,0],[22,6,2,0,"_reactNative"],[22,18,2,0],[22,21,2,0,"require"],[22,28,2,0],[22,29,2,0,"_dependencyMap"],[22,43,2,0],[23,2,3,0],[23,6,3,0,"_libSupabase"],[23,18,3,0],[23,21,3,0,"require"],[23,28,3,0],[23,29,3,0,"_dependencyMap"],[23,43,3,0],[24,2,4,0],[24,6,4,0,"_queryKeys"],[24,16,4,0],[24,19,4,0,"require"],[24,26,4,0],[24,27,4,0,"_dependencyMap"],[24,41,4,0],[25,2,5,0],[25,6,5,0,"_servicesDevLiveEmitterDevLiveEmitter"],[25,43,5,0],[25,46,5,0,"require"],[25,53,5,0],[25,54,5,0,"_dependencyMap"],[25,68,5,0],[26,2,6,0],[26,6,6,0,"_tcgTradeHubDatabase"],[26,26,6,0],[26,29,6,0,"require"],[26,36,6,0],[26,37,6,0,"_dependencyMap"],[26,51,6,0],[27,2,17,0],[28,0,18,0],[29,0,19,0],[30,0,20,0],[31,0,21,0],[32,0,22,0],[33,0,23,0],[34,0,24,0],[35,0,25,0],[36,0,26,0],[37,0,27,0],[38,2,28,0],[38,6,28,6,"useCompleteMeetup"],[38,23,28,23],[38,26,28,27,"onBothCompleted"],[38,41,28,71],[38,45,28,76],[39,4,28,76,"_s"],[39,6,28,76],[40,4,29,2],[40,8,29,8,"queryClient"],[40,19,29,19],[40,22,29,22],[40,26,29,22,"useQueryClient"],[40,45,29,36],[40,46,29,36,"useQueryClient"],[40,60,29,36],[40,62,29,37],[40,63,29,38],[41,4,31,2],[41,11,31,9],[41,15,31,9,"useMutation"],[41,34,31,20],[41,35,31,20,"useMutation"],[41,46,31,20],[41,48,31,21],[42,6,32,4,"mutationFn"],[42,16,32,14],[43,8,32,14],[43,12,32,14,"_ref2"],[43,17,32,14],[43,24,32,14,"_asyncToGenerator"],[43,41,32,14],[43,42,32,14,"default"],[43,49,32,14],[43,51,32,16],[43,62,32,16,"_ref"],[43,66,32,16],[43,68,32,62],[44,10,32,62],[44,14,32,25,"meetupId"],[44,22,32,33],[44,25,32,33,"_ref"],[44,29,32,33],[44,30,32,25,"meetupId"],[44,38,32,33],[45,10,33,6],[45,14,33,12,"stepIdx"],[45,21,33,19],[45,24,33,22],[45,28,33,22,"stateStepIndex"],[45,48,33,36],[45,49,33,36,"stateStepIndex"],[45,63,33,36],[45,65,33,37],[45,73,33,45],[45,75,33,47],[45,86,33,58],[45,88,33,60],[45,99,33,71],[45,100,33,72],[46,10,34,6],[46,14,34,12,"scoped"],[46,20,34,18],[46,23,34,21,"__DEV__"],[46,30,34,28],[46,33,35,10,"devEmitter"],[46,70,35,20],[46,71,35,20,"devEmitter"],[46,81,35,20],[46,82,35,21,"forPath"],[46,89,35,28],[46,90,35,29],[46,115,35,54],[46,117,35,56],[46,121,35,56,"createTraceId"],[46,158,35,69],[46,159,35,69,"createTraceId"],[46,172,35,69],[46,174,35,70],[46,175,35,71],[46,177,35,73],[46,200,35,96],[46,201,35,97],[46,204,36,10,"undefined"],[46,213,36,19],[47,10,38,6,"scoped"],[47,16,38,12],[47,19,38,15,"stepIdx"],[47,26,38,22],[47,28,38,24],[47,37,38,33],[47,38,38,34],[48,10,40,6],[48,14,40,6,"_yield$supabase$auth$"],[48,35,40,6],[48,44,42,16,"supabase"],[48,56,42,24],[48,57,42,24,"supabase"],[48,65,42,24],[48,66,42,25,"auth"],[48,70,42,29],[48,71,42,30,"getSession"],[48,81,42,40],[48,82,42,41],[48,83,42,42],[49,12,41,16,"session"],[49,19,41,23],[49,22,41,23,"_yield$supabase$auth$"],[49,43,41,23],[49,44,41,8,"data"],[49,48,41,12],[49,49,41,16,"session"],[49,56,41,23],[50,10,43,6],[50,14,43,12,"userId"],[50,20,43,18],[50,23,43,21,"session"],[50,30,43,28],[50,32,43,30,"user"],[50,36,43,34],[50,38,43,36,"id"],[50,40,43,38],[51,10,45,6],[51,14,45,10],[51,15,45,11,"userId"],[51,21,45,17],[51,23,45,19],[51,29,45,25],[51,33,45,29,"Error"],[51,38,45,34],[51,39,45,35],[51,58,45,54],[51,59,45,55],[52,10,47,6],[52,14,47,10],[53,12,48,8],[53,16,48,8,"_yield$supabase$rpc"],[53,35,48,8],[53,44,48,38,"supabase"],[53,56,48,46],[53,57,48,46,"supabase"],[53,65,48,46],[53,66,48,47,"rpc"],[53,69,48,50],[53,70,48,51],[53,90,48,71],[53,92,48,73],[54,16,49,10,"p_meetup_id"],[54,27,49,21],[54,29,49,23,"meetupId"],[54,37,49,31],[55,16,50,10,"p_user_id"],[55,25,50,19],[55,27,50,21,"userId"],[56,14,51,8],[56,15,51,9],[56,16,51,10],[57,14,48,16,"data"],[57,18,48,20],[57,21,48,20,"_yield$supabase$rpc"],[57,40,48,20],[57,41,48,16,"data"],[57,45,48,20],[58,14,48,22,"error"],[58,19,48,27],[58,22,48,27,"_yield$supabase$rpc"],[58,41,48,27],[58,42,48,22,"error"],[58,47,48,27],[59,12,53,8],[59,16,53,12,"error"],[59,21,53,17],[59,23,53,19],[59,29,53,25,"error"],[59,34,53,30],[60,12,54,8],[60,16,54,12],[60,17,54,13,"data"],[60,21,54,17],[60,23,54,19],[60,29,54,25],[60,33,54,29,"Error"],[60,38,54,34],[60,39,54,35],[60,76,54,72],[60,77,54,73],[61,12,56,8,"scoped"],[61,18,56,14],[61,21,56,17,"stepIdx"],[61,28,56,24],[61,30,56,26],[61,39,56,35],[61,40,56,36],[62,12,57,8],[62,19,57,15,"data"],[62,23,57,19],[63,10,58,6],[63,11,58,7],[63,12,58,8],[63,19,58,15,"err"],[63,22,58,18],[63,24,58,20],[64,12,59,8,"scoped"],[64,18,59,14],[64,21,59,17,"stepIdx"],[64,28,59,24],[64,30,59,26],[64,37,59,33],[64,39,59,35],[65,14,59,37,"message"],[65,21,59,44],[65,23,59,47,"err"],[65,26,59,50],[65,27,59,61,"message"],[66,12,59,69],[66,13,59,70],[66,14,59,71],[67,12,60,8],[67,18,60,14,"err"],[67,21,60,17],[68,10,61,6],[69,8,62,4],[69,9,62,5],[70,8,62,5],[70,24,32,4,"mutationFn"],[70,34,32,14,"mutationFn"],[70,35,32,14,"_x"],[70,37,32,14],[71,10,32,14],[71,17,32,14,"_ref2"],[71,22,32,14],[71,23,32,14,"apply"],[71,28,32,14],[71,35,32,14,"arguments"],[71,44,32,14],[72,8,32,14],[73,6,32,14],[73,9,62,5],[74,6,63,4,"onSuccess"],[74,15,63,13],[74,17,63,16,"data"],[74,21,63,20],[74,25,63,25],[75,8,64,6,"queryClient"],[75,19,64,17],[75,20,64,18,"invalidateQueries"],[75,37,64,35],[75,38,64,36],[76,10,64,38,"queryKey"],[76,18,64,46],[76,20,64,48,"meetupKeys"],[76,30,64,58],[76,31,64,58,"meetupKeys"],[76,41,64,58],[76,42,64,59,"all"],[77,8,64,63],[77,9,64,64],[77,10,64,65],[78,8,65,6,"queryClient"],[78,19,65,17],[78,20,65,18,"invalidateQueries"],[78,37,65,35],[78,38,65,36],[79,10,65,38,"queryKey"],[79,18,65,46],[79,20,65,48,"meetupKeys"],[79,30,65,58],[79,31,65,58,"meetupKeys"],[79,41,65,58],[79,42,65,59,"detail"],[79,48,65,65],[79,49,65,66,"data"],[79,53,65,70],[79,54,65,71,"meetup_id"],[79,63,65,80],[80,8,65,82],[80,9,65,83],[80,10,65,84],[81,8,67,6],[81,12,67,10,"data"],[81,16,67,14],[81,17,67,15,"both_completed"],[81,31,67,29],[81,35,67,33,"onBothCompleted"],[81,50,67,48],[81,52,67,50],[82,10,68,8,"onBothCompleted"],[82,25,68,23],[82,26,68,24,"data"],[82,30,68,28],[82,31,68,29,"meetup_id"],[82,40,68,38],[82,41,68,39],[83,8,69,6],[84,6,70,4],[84,7,70,5],[85,6,71,4,"onError"],[85,13,71,11],[85,15,71,14,"error"],[85,20,71,26],[85,24,71,31],[86,8,72,6,"Alert"],[86,20,72,11],[86,21,72,11,"Alert"],[86,26,72,11],[86,27,72,12,"alert"],[86,32,72,17],[86,33,72,18],[86,40,72,25],[86,42,72,27,"error"],[86,47,72,32],[86,48,72,33,"message"],[86,55,72,40],[86,59,72,44],[86,86,72,71],[86,87,72,72],[87,6,73,4],[88,4,74,2],[88,5,74,3],[88,6,74,4],[89,2,75,0],[89,3,75,1],[90,2,75,2,"_s"],[90,4,75,2],[90,5,28,6,"useCompleteMeetup"],[90,22,28,23],[91,4,28,23],[91,12,29,22,"useQueryClient"],[91,31,29,36],[91,32,29,36,"useQueryClient"],[91,46,29,36],[91,48,31,9,"useMutation"],[91,67,31,20],[91,68,31,20,"useMutation"],[91,79,31,20],[92,2,31,20],[93,2,77,0],[93,6,77,0,"_default"],[93,14,77,0],[93,17,77,15,"useCompleteMeetup"],[93,34,77,32],[94,0,77,33],[94,3]],"functionMap":{"names":["<global>","useCompleteMeetup","useMutation$argument_0.mutationFn","useMutation$argument_0.onSuccess","useMutation$argument_0.onError"],"mappings":"AAA;0BC2B;gBCI;KD8B;eEC;KFO;aGC;KHE;CDE"},"hasCjsExports":false},"type":"js/module"}]}
{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":49,"index":49}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":50},"end":{"line":2,"column":42,"index":92}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":93},"end":{"line":3,"column":43,"index":136}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}},{"name":"../../utils/normalizeOfferNotes/normalizeOfferNotes","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":137},"end":{"line":4,"column":86,"index":223}}],"key":"i1eXRxjKohYoHxkMvLegV8XaHRc=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1], \"@tanstack/react-query\");\n  var _libSupabase = require(_dependencyMap[2], \"@/lib/supabase\");\n  var _queryKeys = require(_dependencyMap[3], \"../../queryKeys\");\n  var _utilsNormalizeOfferNotesNormalizeOfferNotes = require(_dependencyMap[4], \"../../utils/normalizeOfferNotes/normalizeOfferNotes\");\n  var normalizeOfferNotes = _interopDefault(_utilsNormalizeOfferNotesNormalizeOfferNotes);\n  /**\n   * Fetches the previous (second-most-recent) card_offer message for a conversation.\n   * Returns null when there's only one offer (i.e. the current active offer is the first).\n   */\n  var usePreviousOffer = conversationId => {\n    _s();\n    return (0, _tanstackReactQuery.useQuery)({\n      queryKey: _queryKeys.chatKeys.previousOffer(conversationId),\n      queryFn: function () {\n        var _ref = (0, _asyncToGenerator.default)(function* () {\n          var _yield$supabase$from$ = yield _libSupabase.supabase.from('messages').select(`\n          id,\n          payload,\n          created_at,\n          sender:users!messages_sender_id_fkey (\n            id,\n            display_name,\n            avatar_url\n          )\n        `).eq('conversation_id', conversationId).eq('type', 'card_offer').order('created_at', {\n              ascending: false\n            }).limit(2),\n            data = _yield$supabase$from$.data,\n            error = _yield$supabase$from$.error;\n          if (error) throw error;\n          if (!data || data.length < 2) return null;\n\n          // Index 0 = most recent (current active offer), index 1 = previous offer\n          var prev = data[1];\n          var payload = prev.payload;\n          var sender = prev.sender;\n          var normalized = (0, normalizeOfferNotes.default)(payload, {\n            id: sender.id,\n            name: sender.display_name,\n            avatarUrl: sender.avatar_url\n          });\n          return {\n            offering: payload.offering ?? [],\n            requesting: payload.requesting ?? [],\n            cashAmount: payload.cash_amount ?? 0,\n            cashDirection: payload.cash_direction ?? null,\n            offeringNote: payload.offering_note ?? payload.note ?? null,\n            requestingNote: payload.requesting_note ?? null,\n            offeringNotes: normalized.offeringNotes,\n            requestingNotes: normalized.requestingNotes,\n            senderDisplayName: sender.display_name,\n            sentAt: prev.created_at\n          };\n        });\n        return function queryFn() {\n          return _ref.apply(this, arguments);\n        };\n      }(),\n      enabled: !!conversationId,\n      staleTime: 5 * 60 * 1000\n    });\n  };\n  _s(usePreviousOffer, \"4ZpngI1uv+Uo3WQHEZmTQ5FNM+k=\", false, function () {\n    return [_tanstackReactQuery.useQuery];\n  });\n  var _default = usePreviousOffer;\n});","lineCount":87,"map":[[13,2,83,0,"Object"],[13,8,83,0],[13,9,83,0,"defineProperty"],[13,23,83,0],[13,24,83,0,"exports"],[13,31,83,0],[14,4,83,0,"enumerable"],[14,14,83,0],[15,4,83,0,"get"],[15,7,83,0],[15,18,83,0,"get"],[15,19,83,0],[16,6,83,0],[16,13,83,0,"_default"],[16,21,83,0],[17,4,83,0],[18,2,83,0],[19,2,83,32],[19,6,83,32,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,83,32],[19,45,83,32,"require"],[19,52,83,32],[19,53,83,32,"_dependencyMap"],[19,67,83,32],[20,2,83,32],[20,6,83,32,"_asyncToGenerator"],[20,23,83,32],[20,26,83,32,"_interopDefault"],[20,41,83,32],[20,42,83,32,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,83,32],[21,2,1,0],[21,6,1,0,"_tanstackReactQuery"],[21,25,1,0],[21,28,1,0,"require"],[21,35,1,0],[21,36,1,0,"_dependencyMap"],[21,50,1,0],[22,2,2,0],[22,6,2,0,"_libSupabase"],[22,18,2,0],[22,21,2,0,"require"],[22,28,2,0],[22,29,2,0,"_dependencyMap"],[22,43,2,0],[23,2,3,0],[23,6,3,0,"_queryKeys"],[23,16,3,0],[23,19,3,0,"require"],[23,26,3,0],[23,27,3,0,"_dependencyMap"],[23,41,3,0],[24,2,4,0],[24,6,4,0,"_utilsNormalizeOfferNotesNormalizeOfferNotes"],[24,50,4,0],[24,53,4,0,"require"],[24,60,4,0],[24,61,4,0,"_dependencyMap"],[24,75,4,0],[25,2,4,0],[25,6,4,0,"normalizeOfferNotes"],[25,25,4,0],[25,28,4,0,"_interopDefault"],[25,43,4,0],[25,44,4,0,"_utilsNormalizeOfferNotesNormalizeOfferNotes"],[25,88,4,0],[26,2,20,0],[27,0,21,0],[28,0,22,0],[29,0,23,0],[30,2,24,0],[30,6,24,6,"usePreviousOffer"],[30,22,24,22],[30,25,24,26,"conversationId"],[30,39,24,48],[30,43,24,53],[31,4,24,53,"_s"],[31,6,24,53],[32,4,25,2],[32,11,25,9],[32,15,25,9,"useQuery"],[32,34,25,17],[32,35,25,17,"useQuery"],[32,43,25,17],[32,45,25,18],[33,6,26,4,"queryKey"],[33,14,26,12],[33,16,26,14,"chatKeys"],[33,26,26,22],[33,27,26,22,"chatKeys"],[33,35,26,22],[33,36,26,23,"previousOffer"],[33,49,26,36],[33,50,26,37,"conversationId"],[33,64,26,51],[33,65,26,52],[34,6,27,4,"queryFn"],[34,13,27,11],[35,8,27,11],[35,12,27,11,"_ref"],[35,16,27,11],[35,23,27,11,"_asyncToGenerator"],[35,40,27,11],[35,41,27,11,"default"],[35,48,27,11],[35,50,27,13],[35,63,27,56],[36,10,28,6],[36,14,28,6,"_yield$supabase$from$"],[36,35,28,6],[36,44,28,36,"supabase"],[36,56,28,44],[36,57,28,44,"supabase"],[36,65,28,44],[36,66,29,9,"from"],[36,70,29,13],[36,71,29,14],[36,81,29,24],[36,82,29,25],[36,83,30,9,"select"],[36,89,30,15],[36,90,31,10],[37,0,32,0],[38,0,33,0],[39,0,34,0],[40,0,35,0],[41,0,36,0],[42,0,37,0],[43,0,38,0],[44,0,39,0],[45,0,40,0],[45,9,41,8],[45,10,41,9],[45,11,42,9,"eq"],[45,13,42,11],[45,14,42,12],[45,31,42,29],[45,33,42,31,"conversationId"],[45,47,42,45],[45,48,42,46],[45,49,43,9,"eq"],[45,51,43,11],[45,52,43,12],[45,58,43,18],[45,60,43,20],[45,72,43,32],[45,73,43,33],[45,74,44,9,"order"],[45,79,44,14],[45,80,44,15],[45,92,44,27],[45,94,44,29],[46,14,44,31,"ascending"],[46,23,44,40],[46,25,44,42],[47,12,44,48],[47,13,44,49],[47,14,44,50],[47,15,45,9,"limit"],[47,20,45,14],[47,21,45,15],[47,22,45,16],[47,23,45,17],[48,12,28,14,"data"],[48,16,28,18],[48,19,28,18,"_yield$supabase$from$"],[48,40,28,18],[48,41,28,14,"data"],[48,45,28,18],[49,12,28,20,"error"],[49,17,28,25],[49,20,28,25,"_yield$supabase$from$"],[49,41,28,25],[49,42,28,20,"error"],[49,47,28,25],[50,10,47,6],[50,14,47,10,"error"],[50,19,47,15],[50,21,47,17],[50,27,47,23,"error"],[50,32,47,28],[51,10,48,6],[51,14,48,10],[51,15,48,11,"data"],[51,19,48,15],[51,23,48,19,"data"],[51,27,48,23],[51,28,48,24,"length"],[51,34,48,30],[51,37,48,33],[51,38,48,34],[51,40,48,36],[51,47,48,43],[51,51,48,47],[53,10,50,6],[54,10,51,6],[54,14,51,12,"prev"],[54,18,51,16],[54,21,51,19,"data"],[54,25,51,23],[54,26,51,24],[54,27,51,25],[54,28,51,27],[55,10,52,6],[55,14,52,12,"payload"],[55,21,52,19],[55,24,52,22,"prev"],[55,28,52,26],[55,29,52,27,"payload"],[55,36,52,54],[56,10,53,6],[56,14,53,12,"sender"],[56,20,53,18],[56,23,53,21,"prev"],[56,27,53,25],[56,28,53,26,"sender"],[56,34,57,7],[57,10,59,6],[57,14,59,12,"normalized"],[57,24,59,22],[57,27,59,25],[57,31,59,25,"normalizeOfferNotes"],[57,50,59,44],[57,51,59,44,"default"],[57,58,59,44],[57,60,59,45,"payload"],[57,67,59,52],[57,69,59,54],[58,12,60,8,"id"],[58,14,60,10],[58,16,60,12,"sender"],[58,22,60,18],[58,23,60,19,"id"],[58,25,60,21],[59,12,61,8,"name"],[59,16,61,12],[59,18,61,14,"sender"],[59,24,61,20],[59,25,61,21,"display_name"],[59,37,61,33],[60,12,62,8,"avatarUrl"],[60,21,62,17],[60,23,62,19,"sender"],[60,29,62,25],[60,30,62,26,"avatar_url"],[61,10,63,6],[61,11,63,7],[61,12,63,8],[62,10,65,6],[62,17,65,13],[63,12,66,8,"offering"],[63,20,66,16],[63,22,66,18,"payload"],[63,29,66,25],[63,30,66,26,"offering"],[63,38,66,34],[63,42,66,38],[63,44,66,40],[64,12,67,8,"requesting"],[64,22,67,18],[64,24,67,20,"payload"],[64,31,67,27],[64,32,67,28,"requesting"],[64,42,67,38],[64,46,67,42],[64,48,67,44],[65,12,68,8,"cashAmount"],[65,22,68,18],[65,24,68,20,"payload"],[65,31,68,27],[65,32,68,28,"cash_amount"],[65,43,68,39],[65,47,68,43],[65,48,68,44],[66,12,69,8,"cashDirection"],[66,25,69,21],[66,27,69,23,"payload"],[66,34,69,30],[66,35,69,31,"cash_direction"],[66,49,69,45],[66,53,69,49],[66,57,69,53],[67,12,70,8,"offeringNote"],[67,24,70,20],[67,26,70,22,"payload"],[67,33,70,29],[67,34,70,30,"offering_note"],[67,47,70,43],[67,51,70,47,"payload"],[67,58,70,54],[67,59,70,55,"note"],[67,63,70,59],[67,67,70,63],[67,71,70,67],[68,12,71,8,"requestingNote"],[68,26,71,22],[68,28,71,24,"payload"],[68,35,71,31],[68,36,71,32,"requesting_note"],[68,51,71,47],[68,55,71,51],[68,59,71,55],[69,12,72,8,"offeringNotes"],[69,25,72,21],[69,27,72,23,"normalized"],[69,37,72,33],[69,38,72,34,"offeringNotes"],[69,51,72,47],[70,12,73,8,"requestingNotes"],[70,27,73,23],[70,29,73,25,"normalized"],[70,39,73,35],[70,40,73,36,"requestingNotes"],[70,55,73,51],[71,12,74,8,"senderDisplayName"],[71,29,74,25],[71,31,74,27,"sender"],[71,37,74,33],[71,38,74,34,"display_name"],[71,50,74,46],[72,12,75,8,"sentAt"],[72,18,75,14],[72,20,75,16,"prev"],[72,24,75,20],[72,25,75,21,"created_at"],[73,10,76,6],[73,11,76,7],[74,8,77,4],[74,9,77,5],[75,8,77,5],[75,24,27,4,"queryFn"],[75,31,27,11,"queryFn"],[75,32,27,11],[76,10,27,11],[76,17,27,11,"_ref"],[76,21,27,11],[76,22,27,11,"apply"],[76,27,27,11],[76,34,27,11,"arguments"],[76,43,27,11],[77,8,27,11],[78,6,27,11],[78,9,77,5],[79,6,78,4,"enabled"],[79,13,78,11],[79,15,78,13],[79,16,78,14],[79,17,78,15,"conversationId"],[79,31,78,29],[80,6,79,4,"staleTime"],[80,15,79,13],[80,17,79,15],[80,18,79,16],[80,21,79,19],[80,23,79,21],[80,26,79,24],[81,4,80,2],[81,5,80,3],[81,6,80,4],[82,2,81,0],[82,3,81,1],[83,2,81,2,"_s"],[83,4,81,2],[83,5,24,6,"usePreviousOffer"],[83,21,24,22],[84,4,24,22],[84,12,25,9,"useQuery"],[84,31,25,17],[84,32,25,17,"useQuery"],[84,40,25,17],[85,2,25,17],[86,2,83,0],[86,6,83,0,"_default"],[86,14,83,0],[86,17,83,15,"usePreviousOffer"],[86,33,83,31],[87,0,83,32],[87,3]],"functionMap":{"names":["<global>","usePreviousOffer","useQuery$argument_0.queryFn"],"mappings":"AAA;yBCuB;aCG;KDkD;CDI"},"hasCjsExports":false},"type":"js/module"}]}
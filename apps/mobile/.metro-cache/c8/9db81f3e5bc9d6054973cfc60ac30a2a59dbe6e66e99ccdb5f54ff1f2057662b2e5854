{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":49,"index":49}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":50},"end":{"line":2,"column":42,"index":92}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":93},"end":{"line":3,"column":43,"index":136}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1], \"@tanstack/react-query\");\n  var _libSupabase = require(_dependencyMap[2], \"@/lib/supabase\");\n  var _queryKeys = require(_dependencyMap[3], \"../../queryKeys\");\n  /**\n   * Fetches the previous (second-most-recent) card_offer message for a conversation.\n   * Returns null when there's only one offer (i.e. the current active offer is the first).\n   */\n  var usePreviousOffer = conversationId => {\n    _s();\n    return (0, _tanstackReactQuery.useQuery)({\n      queryKey: _queryKeys.chatKeys.previousOffer(conversationId),\n      queryFn: function () {\n        var _ref = (0, _asyncToGenerator.default)(function* () {\n          var _yield$supabase$from$ = yield _libSupabase.supabase.from('messages').select(`\n          id,\n          payload,\n          created_at,\n          sender:users!messages_sender_id_fkey (\n            id,\n            display_name\n          )\n        `).eq('conversation_id', conversationId).eq('type', 'card_offer').order('created_at', {\n              ascending: false\n            }).limit(2),\n            data = _yield$supabase$from$.data,\n            error = _yield$supabase$from$.error;\n          if (error) throw error;\n          if (!data || data.length < 2) return null;\n\n          // Index 0 = most recent (current active offer), index 1 = previous offer\n          var prev = data[1];\n          var payload = prev.payload;\n          var sender = prev.sender;\n          return {\n            offering: payload.offering ?? [],\n            requesting: payload.requesting ?? [],\n            cashAmount: payload.cash_amount ?? 0,\n            cashDirection: payload.cash_direction ?? null,\n            note: payload.note ?? null,\n            senderDisplayName: sender.display_name,\n            sentAt: prev.created_at\n          };\n        });\n        return function queryFn() {\n          return _ref.apply(this, arguments);\n        };\n      }(),\n      enabled: !!conversationId,\n      staleTime: 5 * 60 * 1000\n    });\n  };\n  _s(usePreviousOffer, \"4ZpngI1uv+Uo3WQHEZmTQ5FNM+k=\", false, function () {\n    return [_tanstackReactQuery.useQuery];\n  });\n  var _default = usePreviousOffer;\n});","lineCount":76,"map":[[13,2,66,0,"Object"],[13,8,66,0],[13,9,66,0,"defineProperty"],[13,23,66,0],[13,24,66,0,"exports"],[13,31,66,0],[14,4,66,0,"enumerable"],[14,14,66,0],[15,4,66,0,"get"],[15,7,66,0],[15,18,66,0,"get"],[15,19,66,0],[16,6,66,0],[16,13,66,0,"_default"],[16,21,66,0],[17,4,66,0],[18,2,66,0],[19,2,66,32],[19,6,66,32,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,66,32],[19,45,66,32,"require"],[19,52,66,32],[19,53,66,32,"_dependencyMap"],[19,67,66,32],[20,2,66,32],[20,6,66,32,"_asyncToGenerator"],[20,23,66,32],[20,26,66,32,"_interopDefault"],[20,41,66,32],[20,42,66,32,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,66,32],[21,2,1,0],[21,6,1,0,"_tanstackReactQuery"],[21,25,1,0],[21,28,1,0,"require"],[21,35,1,0],[21,36,1,0,"_dependencyMap"],[21,50,1,0],[22,2,2,0],[22,6,2,0,"_libSupabase"],[22,18,2,0],[22,21,2,0,"require"],[22,28,2,0],[22,29,2,0,"_dependencyMap"],[22,43,2,0],[23,2,3,0],[23,6,3,0,"_queryKeys"],[23,16,3,0],[23,19,3,0,"require"],[23,26,3,0],[23,27,3,0,"_dependencyMap"],[23,41,3,0],[24,2,17,0],[25,0,18,0],[26,0,19,0],[27,0,20,0],[28,2,21,0],[28,6,21,6,"usePreviousOffer"],[28,22,21,22],[28,25,21,26,"conversationId"],[28,39,21,48],[28,43,21,53],[29,4,21,53,"_s"],[29,6,21,53],[30,4,22,2],[30,11,22,9],[30,15,22,9,"useQuery"],[30,34,22,17],[30,35,22,17,"useQuery"],[30,43,22,17],[30,45,22,18],[31,6,23,4,"queryKey"],[31,14,23,12],[31,16,23,14,"chatKeys"],[31,26,23,22],[31,27,23,22,"chatKeys"],[31,35,23,22],[31,36,23,23,"previousOffer"],[31,49,23,36],[31,50,23,37,"conversationId"],[31,64,23,51],[31,65,23,52],[32,6,24,4,"queryFn"],[32,13,24,11],[33,8,24,11],[33,12,24,11,"_ref"],[33,16,24,11],[33,23,24,11,"_asyncToGenerator"],[33,40,24,11],[33,41,24,11,"default"],[33,48,24,11],[33,50,24,13],[33,63,24,56],[34,10,25,6],[34,14,25,6,"_yield$supabase$from$"],[34,35,25,6],[34,44,25,36,"supabase"],[34,56,25,44],[34,57,25,44,"supabase"],[34,65,25,44],[34,66,26,9,"from"],[34,70,26,13],[34,71,26,14],[34,81,26,24],[34,82,26,25],[34,83,27,9,"select"],[34,89,27,15],[34,90,28,10],[35,0,29,0],[36,0,30,0],[37,0,31,0],[38,0,32,0],[39,0,33,0],[40,0,34,0],[41,0,35,0],[42,0,36,0],[42,9,37,8],[42,10,37,9],[42,11,38,9,"eq"],[42,13,38,11],[42,14,38,12],[42,31,38,29],[42,33,38,31,"conversationId"],[42,47,38,45],[42,48,38,46],[42,49,39,9,"eq"],[42,51,39,11],[42,52,39,12],[42,58,39,18],[42,60,39,20],[42,72,39,32],[42,73,39,33],[42,74,40,9,"order"],[42,79,40,14],[42,80,40,15],[42,92,40,27],[42,94,40,29],[43,14,40,31,"ascending"],[43,23,40,40],[43,25,40,42],[44,12,40,48],[44,13,40,49],[44,14,40,50],[44,15,41,9,"limit"],[44,20,41,14],[44,21,41,15],[44,22,41,16],[44,23,41,17],[45,12,25,14,"data"],[45,16,25,18],[45,19,25,18,"_yield$supabase$from$"],[45,40,25,18],[45,41,25,14,"data"],[45,45,25,18],[46,12,25,20,"error"],[46,17,25,25],[46,20,25,25,"_yield$supabase$from$"],[46,41,25,25],[46,42,25,20,"error"],[46,47,25,25],[47,10,43,6],[47,14,43,10,"error"],[47,19,43,15],[47,21,43,17],[47,27,43,23,"error"],[47,32,43,28],[48,10,44,6],[48,14,44,10],[48,15,44,11,"data"],[48,19,44,15],[48,23,44,19,"data"],[48,27,44,23],[48,28,44,24,"length"],[48,34,44,30],[48,37,44,33],[48,38,44,34],[48,40,44,36],[48,47,44,43],[48,51,44,47],[50,10,46,6],[51,10,47,6],[51,14,47,12,"prev"],[51,18,47,16],[51,21,47,19,"data"],[51,25,47,23],[51,26,47,24],[51,27,47,25],[51,28,47,27],[52,10,48,6],[52,14,48,12,"payload"],[52,21,48,19],[52,24,48,22,"prev"],[52,28,48,26],[52,29,48,27,"payload"],[52,36,48,54],[53,10,49,6],[53,14,49,12,"sender"],[53,20,49,18],[53,23,49,21,"prev"],[53,27,49,25],[53,28,49,26,"sender"],[53,34,49,83],[54,10,51,6],[54,17,51,13],[55,12,52,8,"offering"],[55,20,52,16],[55,22,52,18,"payload"],[55,29,52,25],[55,30,52,26,"offering"],[55,38,52,34],[55,42,52,38],[55,44,52,40],[56,12,53,8,"requesting"],[56,22,53,18],[56,24,53,20,"payload"],[56,31,53,27],[56,32,53,28,"requesting"],[56,42,53,38],[56,46,53,42],[56,48,53,44],[57,12,54,8,"cashAmount"],[57,22,54,18],[57,24,54,20,"payload"],[57,31,54,27],[57,32,54,28,"cash_amount"],[57,43,54,39],[57,47,54,43],[57,48,54,44],[58,12,55,8,"cashDirection"],[58,25,55,21],[58,27,55,23,"payload"],[58,34,55,30],[58,35,55,31,"cash_direction"],[58,49,55,45],[58,53,55,49],[58,57,55,53],[59,12,56,8,"note"],[59,16,56,12],[59,18,56,14,"payload"],[59,25,56,21],[59,26,56,22,"note"],[59,30,56,26],[59,34,56,30],[59,38,56,34],[60,12,57,8,"senderDisplayName"],[60,29,57,25],[60,31,57,27,"sender"],[60,37,57,33],[60,38,57,34,"display_name"],[60,50,57,46],[61,12,58,8,"sentAt"],[61,18,58,14],[61,20,58,16,"prev"],[61,24,58,20],[61,25,58,21,"created_at"],[62,10,59,6],[62,11,59,7],[63,8,60,4],[63,9,60,5],[64,8,60,5],[64,24,24,4,"queryFn"],[64,31,24,11,"queryFn"],[64,32,24,11],[65,10,24,11],[65,17,24,11,"_ref"],[65,21,24,11],[65,22,24,11,"apply"],[65,27,24,11],[65,34,24,11,"arguments"],[65,43,24,11],[66,8,24,11],[67,6,24,11],[67,9,60,5],[68,6,61,4,"enabled"],[68,13,61,11],[68,15,61,13],[68,16,61,14],[68,17,61,15,"conversationId"],[68,31,61,29],[69,6,62,4,"staleTime"],[69,15,62,13],[69,17,62,15],[69,18,62,16],[69,21,62,19],[69,23,62,21],[69,26,62,24],[70,4,63,2],[70,5,63,3],[70,6,63,4],[71,2,64,0],[71,3,64,1],[72,2,64,2,"_s"],[72,4,64,2],[72,5,21,6,"usePreviousOffer"],[72,21,21,22],[73,4,21,22],[73,12,22,9,"useQuery"],[73,31,22,17],[73,32,22,17,"useQuery"],[73,40,22,17],[74,2,22,17],[75,2,66,0],[75,6,66,0,"_default"],[75,14,66,0],[75,17,66,15,"usePreviousOffer"],[75,33,66,31],[76,0,66,32],[76,3]],"functionMap":{"names":["<global>","usePreviousOffer","useQuery$argument_0.queryFn"],"mappings":"AAA;yBCoB;aCG;KDoC;CDI"},"hasCjsExports":false},"type":"js/module"}]}
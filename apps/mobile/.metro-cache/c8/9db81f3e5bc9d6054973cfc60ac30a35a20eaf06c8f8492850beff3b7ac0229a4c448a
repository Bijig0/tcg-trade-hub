{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":49,"index":49}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":50},"end":{"line":2,"column":42,"index":92}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":93},"end":{"line":3,"column":43,"index":136}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1], \"@tanstack/react-query\");\n  var _libSupabase = require(_dependencyMap[2], \"@/lib/supabase\");\n  var _queryKeys = require(_dependencyMap[3], \"../../queryKeys\");\n  /**\n   * Fetches the previous (second-most-recent) card_offer message for a conversation.\n   * Returns null when there's only one offer (i.e. the current active offer is the first).\n   */\n  var usePreviousOffer = conversationId => {\n    _s();\n    return (0, _tanstackReactQuery.useQuery)({\n      queryKey: _queryKeys.chatKeys.previousOffer(conversationId),\n      queryFn: function () {\n        var _ref = (0, _asyncToGenerator.default)(function* () {\n          var _yield$supabase$from$ = yield _libSupabase.supabase.from('messages').select(`\n          id,\n          payload,\n          created_at,\n          sender:users!messages_sender_id_fkey (\n            id,\n            display_name\n          )\n        `).eq('conversation_id', conversationId).eq('type', 'card_offer').order('created_at', {\n              ascending: false\n            }).limit(2),\n            data = _yield$supabase$from$.data,\n            error = _yield$supabase$from$.error;\n          if (error) throw error;\n          if (!data || data.length < 2) return null;\n\n          // Index 0 = most recent (current active offer), index 1 = previous offer\n          var prev = data[1];\n          var payload = prev.payload;\n          var sender = prev.sender;\n          return {\n            offering: payload.offering ?? [],\n            requesting: payload.requesting ?? [],\n            cashAmount: payload.cash_amount ?? 0,\n            cashDirection: payload.cash_direction ?? null,\n            note: payload.note ?? null,\n            senderDisplayName: sender.display_name,\n            sentAt: prev.created_at\n          };\n        });\n        return function queryFn() {\n          return _ref.apply(this, arguments);\n        };\n      }(),\n      enabled: !!conversationId,\n      staleTime: 5 * 60 * 1000\n    });\n  };\n  _s(usePreviousOffer, \"4ZpngI1uv+Uo3WQHEZmTQ5FNM+k=\", false, function () {\n    return [_tanstackReactQuery.useQuery];\n  });\n  var _default = usePreviousOffer;\n});","lineCount":76,"map":[[13,2,65,0,"Object"],[13,8,65,0],[13,9,65,0,"defineProperty"],[13,23,65,0],[13,24,65,0,"exports"],[13,31,65,0],[14,4,65,0,"enumerable"],[14,14,65,0],[15,4,65,0,"get"],[15,7,65,0],[15,18,65,0,"get"],[15,19,65,0],[16,6,65,0],[16,13,65,0,"_default"],[16,21,65,0],[17,4,65,0],[18,2,65,0],[19,2,65,32],[19,6,65,32,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,65,32],[19,45,65,32,"require"],[19,52,65,32],[19,53,65,32,"_dependencyMap"],[19,67,65,32],[20,2,65,32],[20,6,65,32,"_asyncToGenerator"],[20,23,65,32],[20,26,65,32,"_interopDefault"],[20,41,65,32],[20,42,65,32,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,65,32],[21,2,1,0],[21,6,1,0,"_tanstackReactQuery"],[21,25,1,0],[21,28,1,0,"require"],[21,35,1,0],[21,36,1,0,"_dependencyMap"],[21,50,1,0],[22,2,2,0],[22,6,2,0,"_libSupabase"],[22,18,2,0],[22,21,2,0,"require"],[22,28,2,0],[22,29,2,0,"_dependencyMap"],[22,43,2,0],[23,2,3,0],[23,6,3,0,"_queryKeys"],[23,16,3,0],[23,19,3,0,"require"],[23,26,3,0],[23,27,3,0,"_dependencyMap"],[23,41,3,0],[24,2,16,0],[25,0,17,0],[26,0,18,0],[27,0,19,0],[28,2,20,0],[28,6,20,6,"usePreviousOffer"],[28,22,20,22],[28,25,20,26,"conversationId"],[28,39,20,48],[28,43,20,53],[29,4,20,53,"_s"],[29,6,20,53],[30,4,21,2],[30,11,21,9],[30,15,21,9,"useQuery"],[30,34,21,17],[30,35,21,17,"useQuery"],[30,43,21,17],[30,45,21,18],[31,6,22,4,"queryKey"],[31,14,22,12],[31,16,22,14,"chatKeys"],[31,26,22,22],[31,27,22,22,"chatKeys"],[31,35,22,22],[31,36,22,23,"previousOffer"],[31,49,22,36],[31,50,22,37,"conversationId"],[31,64,22,51],[31,65,22,52],[32,6,23,4,"queryFn"],[32,13,23,11],[33,8,23,11],[33,12,23,11,"_ref"],[33,16,23,11],[33,23,23,11,"_asyncToGenerator"],[33,40,23,11],[33,41,23,11,"default"],[33,48,23,11],[33,50,23,13],[33,63,23,56],[34,10,24,6],[34,14,24,6,"_yield$supabase$from$"],[34,35,24,6],[34,44,24,36,"supabase"],[34,56,24,44],[34,57,24,44,"supabase"],[34,65,24,44],[34,66,25,9,"from"],[34,70,25,13],[34,71,25,14],[34,81,25,24],[34,82,25,25],[34,83,26,9,"select"],[34,89,26,15],[34,90,27,10],[35,0,28,0],[36,0,29,0],[37,0,30,0],[38,0,31,0],[39,0,32,0],[40,0,33,0],[41,0,34,0],[42,0,35,0],[42,9,36,8],[42,10,36,9],[42,11,37,9,"eq"],[42,13,37,11],[42,14,37,12],[42,31,37,29],[42,33,37,31,"conversationId"],[42,47,37,45],[42,48,37,46],[42,49,38,9,"eq"],[42,51,38,11],[42,52,38,12],[42,58,38,18],[42,60,38,20],[42,72,38,32],[42,73,38,33],[42,74,39,9,"order"],[42,79,39,14],[42,80,39,15],[42,92,39,27],[42,94,39,29],[43,14,39,31,"ascending"],[43,23,39,40],[43,25,39,42],[44,12,39,48],[44,13,39,49],[44,14,39,50],[44,15,40,9,"limit"],[44,20,40,14],[44,21,40,15],[44,22,40,16],[44,23,40,17],[45,12,24,14,"data"],[45,16,24,18],[45,19,24,18,"_yield$supabase$from$"],[45,40,24,18],[45,41,24,14,"data"],[45,45,24,18],[46,12,24,20,"error"],[46,17,24,25],[46,20,24,25,"_yield$supabase$from$"],[46,41,24,25],[46,42,24,20,"error"],[46,47,24,25],[47,10,42,6],[47,14,42,10,"error"],[47,19,42,15],[47,21,42,17],[47,27,42,23,"error"],[47,32,42,28],[48,10,43,6],[48,14,43,10],[48,15,43,11,"data"],[48,19,43,15],[48,23,43,19,"data"],[48,27,43,23],[48,28,43,24,"length"],[48,34,43,30],[48,37,43,33],[48,38,43,34],[48,40,43,36],[48,47,43,43],[48,51,43,47],[50,10,45,6],[51,10,46,6],[51,14,46,12,"prev"],[51,18,46,16],[51,21,46,19,"data"],[51,25,46,23],[51,26,46,24],[51,27,46,25],[51,28,46,26],[52,10,47,6],[52,14,47,12,"payload"],[52,21,47,19],[52,24,47,22,"prev"],[52,28,47,26],[52,29,47,27,"payload"],[52,36,47,54],[53,10,48,6],[53,14,48,12,"sender"],[53,20,48,18],[53,23,48,21,"prev"],[53,27,48,25],[53,28,48,26,"sender"],[53,34,48,83],[54,10,50,6],[54,17,50,13],[55,12,51,8,"offering"],[55,20,51,16],[55,22,51,18,"payload"],[55,29,51,25],[55,30,51,26,"offering"],[55,38,51,34],[55,42,51,38],[55,44,51,40],[56,12,52,8,"requesting"],[56,22,52,18],[56,24,52,20,"payload"],[56,31,52,27],[56,32,52,28,"requesting"],[56,42,52,38],[56,46,52,42],[56,48,52,44],[57,12,53,8,"cashAmount"],[57,22,53,18],[57,24,53,20,"payload"],[57,31,53,27],[57,32,53,28,"cash_amount"],[57,43,53,39],[57,47,53,43],[57,48,53,44],[58,12,54,8,"cashDirection"],[58,25,54,21],[58,27,54,23,"payload"],[58,34,54,30],[58,35,54,31,"cash_direction"],[58,49,54,45],[58,53,54,49],[58,57,54,53],[59,12,55,8,"note"],[59,16,55,12],[59,18,55,14,"payload"],[59,25,55,21],[59,26,55,22,"note"],[59,30,55,26],[59,34,55,30],[59,38,55,34],[60,12,56,8,"senderDisplayName"],[60,29,56,25],[60,31,56,27,"sender"],[60,37,56,33],[60,38,56,34,"display_name"],[60,50,56,46],[61,12,57,8,"sentAt"],[61,18,57,14],[61,20,57,16,"prev"],[61,24,57,20],[61,25,57,21,"created_at"],[62,10,58,6],[62,11,58,7],[63,8,59,4],[63,9,59,5],[64,8,59,5],[64,24,23,4,"queryFn"],[64,31,23,11,"queryFn"],[64,32,23,11],[65,10,23,11],[65,17,23,11,"_ref"],[65,21,23,11],[65,22,23,11,"apply"],[65,27,23,11],[65,34,23,11,"arguments"],[65,43,23,11],[66,8,23,11],[67,6,23,11],[67,9,59,5],[68,6,60,4,"enabled"],[68,13,60,11],[68,15,60,13],[68,16,60,14],[68,17,60,15,"conversationId"],[68,31,60,29],[69,6,61,4,"staleTime"],[69,15,61,13],[69,17,61,15],[69,18,61,16],[69,21,61,19],[69,23,61,21],[69,26,61,24],[70,4,62,2],[70,5,62,3],[70,6,62,4],[71,2,63,0],[71,3,63,1],[72,2,63,2,"_s"],[72,4,63,2],[72,5,20,6,"usePreviousOffer"],[72,21,20,22],[73,4,20,22],[73,12,21,9,"useQuery"],[73,31,21,17],[73,32,21,17,"useQuery"],[73,40,21,17],[74,2,21,17],[75,2,65,0],[75,6,65,0,"_default"],[75,14,65,0],[75,17,65,15,"usePreviousOffer"],[75,33,65,31],[76,0,65,32],[76,3]],"functionMap":{"names":["<global>","usePreviousOffer","useQuery$argument_0.queryFn"],"mappings":"AAA;yBCmB;aCG;KDoC;CDI"},"hasCjsExports":false},"type":"js/module"}]}
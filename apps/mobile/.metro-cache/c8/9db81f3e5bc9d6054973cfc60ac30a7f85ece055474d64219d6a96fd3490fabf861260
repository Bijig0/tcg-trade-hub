{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":49,"index":49}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":50},"end":{"line":2,"column":42,"index":92}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":93},"end":{"line":3,"column":43,"index":136}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1], \"@tanstack/react-query\");\n  var _libSupabase = require(_dependencyMap[2], \"@/lib/supabase\");\n  var _queryKeys = require(_dependencyMap[3], \"../../queryKeys\");\n  /**\n   * Fetches the previous (second-most-recent) card_offer message for a conversation.\n   * Returns null when there's only one offer (i.e. the current active offer is the first).\n   */\n  var usePreviousOffer = conversationId => {\n    _s();\n    return (0, _tanstackReactQuery.useQuery)({\n      queryKey: _queryKeys.chatKeys.previousOffer(conversationId),\n      queryFn: function () {\n        var _ref = (0, _asyncToGenerator.default)(function* () {\n          var _yield$supabase$from$ = yield _libSupabase.supabase.from('messages').select(`\n          id,\n          payload,\n          created_at,\n          sender:users!messages_sender_id_fkey (\n            id,\n            display_name\n          )\n        `).eq('conversation_id', conversationId).eq('type', 'card_offer').order('created_at', {\n              ascending: false\n            }).limit(2),\n            data = _yield$supabase$from$.data,\n            error = _yield$supabase$from$.error;\n          if (error) throw error;\n          if (!data || data.length < 2) return null;\n\n          // Index 0 = most recent (current active offer), index 1 = previous offer\n          var prev = data[1];\n          var payload = prev.payload;\n          var sender = prev.sender;\n          return {\n            offering: payload.offering ?? [],\n            requesting: payload.requesting ?? [],\n            cashAmount: payload.cash_amount ?? 0,\n            cashDirection: payload.cash_direction ?? null,\n            offeringNote: payload.offering_note ?? payload.note ?? null,\n            requestingNote: payload.requesting_note ?? null,\n            senderDisplayName: sender.display_name,\n            sentAt: prev.created_at\n          };\n        });\n        return function queryFn() {\n          return _ref.apply(this, arguments);\n        };\n      }(),\n      enabled: !!conversationId,\n      staleTime: 5 * 60 * 1000\n    });\n  };\n  _s(usePreviousOffer, \"4ZpngI1uv+Uo3WQHEZmTQ5FNM+k=\", false, function () {\n    return [_tanstackReactQuery.useQuery];\n  });\n  var _default = usePreviousOffer;\n});","lineCount":77,"map":[[13,2,70,0,"Object"],[13,8,70,0],[13,9,70,0,"defineProperty"],[13,23,70,0],[13,24,70,0,"exports"],[13,31,70,0],[14,4,70,0,"enumerable"],[14,14,70,0],[15,4,70,0,"get"],[15,7,70,0],[15,18,70,0,"get"],[15,19,70,0],[16,6,70,0],[16,13,70,0,"_default"],[16,21,70,0],[17,4,70,0],[18,2,70,0],[19,2,70,32],[19,6,70,32,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,70,32],[19,45,70,32,"require"],[19,52,70,32],[19,53,70,32,"_dependencyMap"],[19,67,70,32],[20,2,70,32],[20,6,70,32,"_asyncToGenerator"],[20,23,70,32],[20,26,70,32,"_interopDefault"],[20,41,70,32],[20,42,70,32,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,70,32],[21,2,1,0],[21,6,1,0,"_tanstackReactQuery"],[21,25,1,0],[21,28,1,0,"require"],[21,35,1,0],[21,36,1,0,"_dependencyMap"],[21,50,1,0],[22,2,2,0],[22,6,2,0,"_libSupabase"],[22,18,2,0],[22,21,2,0,"require"],[22,28,2,0],[22,29,2,0,"_dependencyMap"],[22,43,2,0],[23,2,3,0],[23,6,3,0,"_queryKeys"],[23,16,3,0],[23,19,3,0,"require"],[23,26,3,0],[23,27,3,0,"_dependencyMap"],[23,41,3,0],[24,2,20,0],[25,0,21,0],[26,0,22,0],[27,0,23,0],[28,2,24,0],[28,6,24,6,"usePreviousOffer"],[28,22,24,22],[28,25,24,26,"conversationId"],[28,39,24,48],[28,43,24,53],[29,4,24,53,"_s"],[29,6,24,53],[30,4,25,2],[30,11,25,9],[30,15,25,9,"useQuery"],[30,34,25,17],[30,35,25,17,"useQuery"],[30,43,25,17],[30,45,25,18],[31,6,26,4,"queryKey"],[31,14,26,12],[31,16,26,14,"chatKeys"],[31,26,26,22],[31,27,26,22,"chatKeys"],[31,35,26,22],[31,36,26,23,"previousOffer"],[31,49,26,36],[31,50,26,37,"conversationId"],[31,64,26,51],[31,65,26,52],[32,6,27,4,"queryFn"],[32,13,27,11],[33,8,27,11],[33,12,27,11,"_ref"],[33,16,27,11],[33,23,27,11,"_asyncToGenerator"],[33,40,27,11],[33,41,27,11,"default"],[33,48,27,11],[33,50,27,13],[33,63,27,56],[34,10,28,6],[34,14,28,6,"_yield$supabase$from$"],[34,35,28,6],[34,44,28,36,"supabase"],[34,56,28,44],[34,57,28,44,"supabase"],[34,65,28,44],[34,66,29,9,"from"],[34,70,29,13],[34,71,29,14],[34,81,29,24],[34,82,29,25],[34,83,30,9,"select"],[34,89,30,15],[34,90,31,10],[35,0,32,0],[36,0,33,0],[37,0,34,0],[38,0,35,0],[39,0,36,0],[40,0,37,0],[41,0,38,0],[42,0,39,0],[42,9,40,8],[42,10,40,9],[42,11,41,9,"eq"],[42,13,41,11],[42,14,41,12],[42,31,41,29],[42,33,41,31,"conversationId"],[42,47,41,45],[42,48,41,46],[42,49,42,9,"eq"],[42,51,42,11],[42,52,42,12],[42,58,42,18],[42,60,42,20],[42,72,42,32],[42,73,42,33],[42,74,43,9,"order"],[42,79,43,14],[42,80,43,15],[42,92,43,27],[42,94,43,29],[43,14,43,31,"ascending"],[43,23,43,40],[43,25,43,42],[44,12,43,48],[44,13,43,49],[44,14,43,50],[44,15,44,9,"limit"],[44,20,44,14],[44,21,44,15],[44,22,44,16],[44,23,44,17],[45,12,28,14,"data"],[45,16,28,18],[45,19,28,18,"_yield$supabase$from$"],[45,40,28,18],[45,41,28,14,"data"],[45,45,28,18],[46,12,28,20,"error"],[46,17,28,25],[46,20,28,25,"_yield$supabase$from$"],[46,41,28,25],[46,42,28,20,"error"],[46,47,28,25],[47,10,46,6],[47,14,46,10,"error"],[47,19,46,15],[47,21,46,17],[47,27,46,23,"error"],[47,32,46,28],[48,10,47,6],[48,14,47,10],[48,15,47,11,"data"],[48,19,47,15],[48,23,47,19,"data"],[48,27,47,23],[48,28,47,24,"length"],[48,34,47,30],[48,37,47,33],[48,38,47,34],[48,40,47,36],[48,47,47,43],[48,51,47,47],[50,10,49,6],[51,10,50,6],[51,14,50,12,"prev"],[51,18,50,16],[51,21,50,19,"data"],[51,25,50,23],[51,26,50,24],[51,27,50,25],[51,28,50,27],[52,10,51,6],[52,14,51,12,"payload"],[52,21,51,19],[52,24,51,22,"prev"],[52,28,51,26],[52,29,51,27,"payload"],[52,36,51,54],[53,10,52,6],[53,14,52,12,"sender"],[53,20,52,18],[53,23,52,21,"prev"],[53,27,52,25],[53,28,52,26,"sender"],[53,34,52,83],[54,10,54,6],[54,17,54,13],[55,12,55,8,"offering"],[55,20,55,16],[55,22,55,18,"payload"],[55,29,55,25],[55,30,55,26,"offering"],[55,38,55,34],[55,42,55,38],[55,44,55,40],[56,12,56,8,"requesting"],[56,22,56,18],[56,24,56,20,"payload"],[56,31,56,27],[56,32,56,28,"requesting"],[56,42,56,38],[56,46,56,42],[56,48,56,44],[57,12,57,8,"cashAmount"],[57,22,57,18],[57,24,57,20,"payload"],[57,31,57,27],[57,32,57,28,"cash_amount"],[57,43,57,39],[57,47,57,43],[57,48,57,44],[58,12,58,8,"cashDirection"],[58,25,58,21],[58,27,58,23,"payload"],[58,34,58,30],[58,35,58,31,"cash_direction"],[58,49,58,45],[58,53,58,49],[58,57,58,53],[59,12,59,8,"offeringNote"],[59,24,59,20],[59,26,59,22,"payload"],[59,33,59,29],[59,34,59,30,"offering_note"],[59,47,59,43],[59,51,59,47,"payload"],[59,58,59,54],[59,59,59,55,"note"],[59,63,59,59],[59,67,59,63],[59,71,59,67],[60,12,60,8,"requestingNote"],[60,26,60,22],[60,28,60,24,"payload"],[60,35,60,31],[60,36,60,32,"requesting_note"],[60,51,60,47],[60,55,60,51],[60,59,60,55],[61,12,61,8,"senderDisplayName"],[61,29,61,25],[61,31,61,27,"sender"],[61,37,61,33],[61,38,61,34,"display_name"],[61,50,61,46],[62,12,62,8,"sentAt"],[62,18,62,14],[62,20,62,16,"prev"],[62,24,62,20],[62,25,62,21,"created_at"],[63,10,63,6],[63,11,63,7],[64,8,64,4],[64,9,64,5],[65,8,64,5],[65,24,27,4,"queryFn"],[65,31,27,11,"queryFn"],[65,32,27,11],[66,10,27,11],[66,17,27,11,"_ref"],[66,21,27,11],[66,22,27,11,"apply"],[66,27,27,11],[66,34,27,11,"arguments"],[66,43,27,11],[67,8,27,11],[68,6,27,11],[68,9,64,5],[69,6,65,4,"enabled"],[69,13,65,11],[69,15,65,13],[69,16,65,14],[69,17,65,15,"conversationId"],[69,31,65,29],[70,6,66,4,"staleTime"],[70,15,66,13],[70,17,66,15],[70,18,66,16],[70,21,66,19],[70,23,66,21],[70,26,66,24],[71,4,67,2],[71,5,67,3],[71,6,67,4],[72,2,68,0],[72,3,68,1],[73,2,68,2,"_s"],[73,4,68,2],[73,5,24,6,"usePreviousOffer"],[73,21,24,22],[74,4,24,22],[74,12,25,9,"useQuery"],[74,31,25,17],[74,32,25,17,"useQuery"],[74,40,25,17],[75,2,25,17],[76,2,70,0],[76,6,70,0,"_default"],[76,14,70,0],[76,17,70,15,"usePreviousOffer"],[76,33,70,31],[77,0,70,32],[77,3]],"functionMap":{"names":["<global>","usePreviousOffer","useQuery$argument_0.queryFn"],"mappings":"AAA;yBCuB;aCG;KDqC;CDI"},"hasCjsExports":false},"type":"js/module"}]}
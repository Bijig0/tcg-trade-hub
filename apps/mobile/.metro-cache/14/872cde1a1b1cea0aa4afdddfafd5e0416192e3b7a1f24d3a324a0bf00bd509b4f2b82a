{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":57,"index":57}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":58},"end":{"line":2,"column":42,"index":100}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":101},"end":{"line":3,"column":43,"index":144}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1], \"@tanstack/react-query\");\n  var _libSupabase = require(_dependencyMap[2], \"@/lib/supabase\");\n  var _queryKeys = require(_dependencyMap[3], \"../../queryKeys\");\n  var PAGE_SIZE = 30;\n  /** Fetches paginated messages for a conversation in reverse chronological order */\n  var useMessages = conversationId => {\n    _s();\n    return (0, _tanstackReactQuery.useInfiniteQuery)({\n      queryKey: _queryKeys.chatKeys.messages(conversationId),\n      queryFn: function () {\n        var _ref2 = (0, _asyncToGenerator.default)(function* (_ref) {\n          var pageParam = _ref.pageParam;\n          var query = _libSupabase.supabase.from('messages').select(`\n          *,\n          sender:users!messages_sender_id_fkey (\n            id,\n            display_name,\n            avatar_url\n          )\n        `).eq('conversation_id', conversationId).order('created_at', {\n            ascending: false\n          }).limit(PAGE_SIZE);\n          if (pageParam) {\n            query = query.lt('created_at', pageParam);\n          }\n          var _yield$query = yield query,\n            data = _yield$query.data,\n            error = _yield$query.error;\n          if (error) throw error;\n          return (data ?? []).map(msg => ({\n            ...msg,\n            sender: msg.sender\n          }));\n        });\n        return function queryFn(_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }(),\n      initialPageParam: null,\n      getNextPageParam: lastPage => {\n        if (lastPage.length < PAGE_SIZE) return undefined;\n        return lastPage[lastPage.length - 1]?.created_at ?? undefined;\n      },\n      enabled: !!conversationId\n    });\n  };\n  _s(useMessages, \"xMCOiuh9cV5e8gBi6hogZoGnISk=\", false, function () {\n    return [_tanstackReactQuery.useInfiniteQuery];\n  });\n  var _default = useMessages;\n});","lineCount":71,"map":[[13,2,58,0,"Object"],[13,8,58,0],[13,9,58,0,"defineProperty"],[13,23,58,0],[13,24,58,0,"exports"],[13,31,58,0],[14,4,58,0,"enumerable"],[14,14,58,0],[15,4,58,0,"get"],[15,7,58,0],[15,18,58,0,"get"],[15,19,58,0],[16,6,58,0],[16,13,58,0,"_default"],[16,21,58,0],[17,4,58,0],[18,2,58,0],[19,2,58,27],[19,6,58,27,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,58,27],[19,45,58,27,"require"],[19,52,58,27],[19,53,58,27,"_dependencyMap"],[19,67,58,27],[20,2,58,27],[20,6,58,27,"_asyncToGenerator"],[20,23,58,27],[20,26,58,27,"_interopDefault"],[20,41,58,27],[20,42,58,27,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,58,27],[21,2,1,0],[21,6,1,0,"_tanstackReactQuery"],[21,25,1,0],[21,28,1,0,"require"],[21,35,1,0],[21,36,1,0,"_dependencyMap"],[21,50,1,0],[22,2,2,0],[22,6,2,0,"_libSupabase"],[22,18,2,0],[22,21,2,0,"require"],[22,28,2,0],[22,29,2,0,"_dependencyMap"],[22,43,2,0],[23,2,3,0],[23,6,3,0,"_queryKeys"],[23,16,3,0],[23,19,3,0,"require"],[23,26,3,0],[23,27,3,0,"_dependencyMap"],[23,41,3,0],[24,2,6,0],[24,6,6,6,"PAGE_SIZE"],[24,15,6,15],[24,18,6,18],[24,20,6,20],[25,2,12,0],[26,2,13,0],[26,6,13,6,"useMessages"],[26,17,13,17],[26,20,13,21,"conversationId"],[26,34,13,43],[26,38,13,48],[27,4,13,48,"_s"],[27,6,13,48],[28,4,14,2],[28,11,14,9],[28,15,14,9,"useInfiniteQuery"],[28,34,14,25],[28,35,14,25,"useInfiniteQuery"],[28,51,14,25],[28,53,14,26],[29,6,15,4,"queryKey"],[29,14,15,12],[29,16,15,14,"chatKeys"],[29,26,15,22],[29,27,15,22,"chatKeys"],[29,35,15,22],[29,36,15,23,"messages"],[29,44,15,31],[29,45,15,32,"conversationId"],[29,59,15,46],[29,60,15,47],[30,6,16,4,"queryFn"],[30,13,16,11],[31,8,16,11],[31,12,16,11,"_ref2"],[31,17,16,11],[31,24,16,11,"_asyncToGenerator"],[31,41,16,11],[31,42,16,11,"default"],[31,49,16,11],[31,51,16,13],[31,62,16,13,"_ref"],[31,66,16,13],[31,68,16,68],[32,10,16,68],[32,14,16,22,"pageParam"],[32,23,16,31],[32,26,16,31,"_ref"],[32,30,16,31],[32,31,16,22,"pageParam"],[32,40,16,31],[33,10,17,6],[33,14,17,10,"query"],[33,19,17,15],[33,22,17,18,"supabase"],[33,34,17,26],[33,35,17,26,"supabase"],[33,43,17,26],[33,44,18,9,"from"],[33,48,18,13],[33,49,18,14],[33,59,18,24],[33,60,18,25],[33,61,19,9,"select"],[33,67,19,15],[33,68,20,10],[34,0,21,0],[35,0,22,0],[36,0,23,0],[37,0,24,0],[38,0,25,0],[39,0,26,0],[40,0,27,0],[40,9,28,8],[40,10,28,9],[40,11,29,9,"eq"],[40,13,29,11],[40,14,29,12],[40,31,29,29],[40,33,29,31,"conversationId"],[40,47,29,45],[40,48,29,46],[40,49,30,9,"order"],[40,54,30,14],[40,55,30,15],[40,67,30,27],[40,69,30,29],[41,12,30,31,"ascending"],[41,21,30,40],[41,23,30,42],[42,10,30,48],[42,11,30,49],[42,12,30,50],[42,13,31,9,"limit"],[42,18,31,14],[42,19,31,15,"PAGE_SIZE"],[42,28,31,24],[42,29,31,25],[43,10,33,6],[43,14,33,10,"pageParam"],[43,23,33,19],[43,25,33,21],[44,12,34,8,"query"],[44,17,34,13],[44,20,34,16,"query"],[44,25,34,21],[44,26,34,22,"lt"],[44,28,34,24],[44,29,34,25],[44,41,34,37],[44,43,34,39,"pageParam"],[44,52,34,48],[44,53,34,49],[45,10,35,6],[46,10,37,6],[46,14,37,6,"_yield$query"],[46,26,37,6],[46,35,37,36,"query"],[46,40,37,41],[47,12,37,14,"data"],[47,16,37,18],[47,19,37,18,"_yield$query"],[47,31,37,18],[47,32,37,14,"data"],[47,36,37,18],[48,12,37,20,"error"],[48,17,37,25],[48,20,37,25,"_yield$query"],[48,32,37,25],[48,33,37,20,"error"],[48,38,37,25],[49,10,39,6],[49,14,39,10,"error"],[49,19,39,15],[49,21,39,17],[49,27,39,23,"error"],[49,32,39,28],[50,10,41,6],[50,17,41,13],[50,18,41,14,"data"],[50,22,41,18],[50,26,41,22],[50,28,41,24],[50,30,41,26,"map"],[50,33,41,29],[50,34,41,31,"msg"],[50,37,41,34],[50,42,41,40],[51,12,42,8],[51,15,42,11,"msg"],[51,18,42,14],[52,12,43,8,"sender"],[52,18,43,14],[52,20,43,16,"msg"],[52,23,43,19],[52,24,43,20,"sender"],[53,10,47,6],[53,11,47,7],[53,12,47,8],[53,13,47,9],[54,8,48,4],[54,9,48,5],[55,8,48,5],[55,24,16,4,"queryFn"],[55,31,16,11,"queryFn"],[55,32,16,11,"_x"],[55,34,16,11],[56,10,16,11],[56,17,16,11,"_ref2"],[56,22,16,11],[56,23,16,11,"apply"],[56,28,16,11],[56,35,16,11,"arguments"],[56,44,16,11],[57,8,16,11],[58,6,16,11],[58,9,48,5],[59,6,49,4,"initialPageParam"],[59,22,49,20],[59,24,49,22],[59,28,49,43],[60,6,50,4,"getNextPageParam"],[60,22,50,20],[60,24,50,23,"lastPage"],[60,32,50,31],[60,36,50,36],[61,8,51,6],[61,12,51,10,"lastPage"],[61,20,51,18],[61,21,51,19,"length"],[61,27,51,25],[61,30,51,28,"PAGE_SIZE"],[61,39,51,37],[61,41,51,39],[61,48,51,46,"undefined"],[61,57,51,55],[62,8,52,6],[62,15,52,13,"lastPage"],[62,23,52,21],[62,24,52,22,"lastPage"],[62,32,52,30],[62,33,52,31,"length"],[62,39,52,37],[62,42,52,40],[62,43,52,41],[62,44,52,42],[62,46,52,44,"created_at"],[62,56,52,54],[62,60,52,58,"undefined"],[62,69,52,67],[63,6,53,4],[63,7,53,5],[64,6,54,4,"enabled"],[64,13,54,11],[64,15,54,13],[64,16,54,14],[64,17,54,15,"conversationId"],[65,4,55,2],[65,5,55,3],[65,6,55,4],[66,2,56,0],[66,3,56,1],[67,2,56,2,"_s"],[67,4,56,2],[67,5,13,6,"useMessages"],[67,16,13,17],[68,4,13,17],[68,12,14,9,"useInfiniteQuery"],[68,31,14,25],[68,32,14,25,"useInfiniteQuery"],[68,48,14,25],[69,2,14,25],[70,2,58,0],[70,6,58,0,"_default"],[70,14,58,0],[70,17,58,15,"useMessages"],[70,28,58,26],[71,0,58,27],[71,3]],"functionMap":{"names":["<global>","useMessages","useInfiniteQuery$argument_0.queryFn","map$argument_0","useInfiniteQuery$argument_0.getNextPageParam"],"mappings":"AAA;oBCY;aCG;8BCyB;QDM;KDC;sBGE;KHG;CDG"},"hasCjsExports":false},"type":"js/module"}]}
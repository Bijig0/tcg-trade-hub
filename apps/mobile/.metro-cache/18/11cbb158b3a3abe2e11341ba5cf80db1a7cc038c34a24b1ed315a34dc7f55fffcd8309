{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":34,"index":34}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":35},"end":{"line":2,"column":55,"index":90}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":91},"end":{"line":3,"column":42,"index":133}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":134},"end":{"line":4,"column":46,"index":180}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _react = require(_dependencyMap[0]);\n  var _tanstackReactQuery = require(_dependencyMap[1]);\n  var _libSupabase = require(_dependencyMap[2]);\n  var _queryKeys = require(_dependencyMap[3]);\n  /**\n   * Subscribes to Supabase Realtime for offer changes on a specific listing.\n   * - UPDATE on offers: invalidates the offers list, and on acceptance also\n   *   invalidates the listing detail and myListings queries.\n   * - INSERT on offers: new offer arrived, invalidates offers list.\n   */\n  var useRealtimeOfferUpdates = listingId => {\n    var queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    (0, _react.useEffect)(() => {\n      if (!listingId) return;\n      var channel = _libSupabase.supabase.channel(`offers:listing:${listingId}`).on('postgres_changes', {\n        event: 'UPDATE',\n        schema: 'public',\n        table: 'offers',\n        filter: `listing_id=eq.${listingId}`\n      }, payload => {\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.offers(listingId)\n        });\n\n        // If an offer was accepted, the listing status also changed\n        if (payload.new.status === 'accepted') {\n          queryClient.invalidateQueries({\n            queryKey: _queryKeys.listingKeys.detail(listingId)\n          });\n          queryClient.invalidateQueries({\n            queryKey: _queryKeys.listingKeys.myListings()\n          });\n        }\n      }).on('postgres_changes', {\n        event: 'INSERT',\n        schema: 'public',\n        table: 'offers',\n        filter: `listing_id=eq.${listingId}`\n      }, () => {\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.offers(listingId)\n        });\n      }).subscribe();\n      return () => {\n        _libSupabase.supabase.removeChannel(channel);\n      };\n    }, [listingId, queryClient]);\n  };\n  var _default = useRealtimeOfferUpdates;\n});","lineCount":62,"map":[[7,2,67,0,"Object"],[7,8,67,0],[7,9,67,0,"defineProperty"],[7,23,67,0],[7,24,67,0,"exports"],[7,31,67,0],[8,4,67,0,"enumerable"],[8,14,67,0],[9,4,67,0,"get"],[9,7,67,0],[9,18,67,0,"get"],[9,19,67,0],[10,6,67,0],[10,13,67,0,"_default"],[10,21,67,0],[11,4,67,0],[12,2,67,0],[13,2,1,0],[13,6,1,0,"_react"],[13,12,1,0],[13,15,1,0,"require"],[13,22,1,0],[13,23,1,0,"_dependencyMap"],[13,37,1,0],[14,2,2,0],[14,6,2,0,"_tanstackReactQuery"],[14,25,2,0],[14,28,2,0,"require"],[14,35,2,0],[14,36,2,0,"_dependencyMap"],[14,50,2,0],[15,2,3,0],[15,6,3,0,"_libSupabase"],[15,18,3,0],[15,21,3,0,"require"],[15,28,3,0],[15,29,3,0,"_dependencyMap"],[15,43,3,0],[16,2,4,0],[16,6,4,0,"_queryKeys"],[16,16,4,0],[16,19,4,0,"require"],[16,26,4,0],[16,27,4,0,"_dependencyMap"],[16,41,4,0],[17,2,7,0],[18,0,8,0],[19,0,9,0],[20,0,10,0],[21,0,11,0],[22,0,12,0],[23,2,13,0],[23,6,13,6,"useRealtimeOfferUpdates"],[23,29,13,29],[23,32,13,33,"listingId"],[23,41,13,50],[23,45,13,55],[24,4,14,2],[24,8,14,8,"queryClient"],[24,19,14,19],[24,22,14,22],[24,26,14,22,"useQueryClient"],[24,45,14,36],[24,46,14,36,"useQueryClient"],[24,60,14,36],[24,62,14,37],[24,63,14,38],[25,4,16,2],[25,8,16,2,"useEffect"],[25,14,16,11],[25,15,16,11,"useEffect"],[25,24,16,11],[25,26,16,12],[25,32,16,18],[26,6,17,4],[26,10,17,8],[26,11,17,9,"listingId"],[26,20,17,18],[26,22,17,20],[27,6,19,4],[27,10,19,10,"channel"],[27,17,19,17],[27,20,19,20,"supabase"],[27,32,19,28],[27,33,19,28,"supabase"],[27,41,19,28],[27,42,20,7,"channel"],[27,49,20,14],[27,50,20,15],[27,68,20,33,"listingId"],[27,77,20,42],[27,79,20,44],[27,80,20,45],[27,81,21,7,"on"],[27,83,21,9],[27,84,22,8],[27,102,22,26],[27,104,23,8],[28,8,24,10,"event"],[28,13,24,15],[28,15,24,17],[28,23,24,25],[29,8,25,10,"schema"],[29,14,25,16],[29,16,25,18],[29,24,25,26],[30,8,26,10,"table"],[30,13,26,15],[30,15,26,17],[30,23,26,25],[31,8,27,10,"filter"],[31,14,27,16],[31,16,27,18],[31,33,27,35,"listingId"],[31,42,27,44],[32,6,28,8],[32,7,28,9],[32,9,29,9,"payload"],[32,16,29,16],[32,20,29,21],[33,8,30,10,"queryClient"],[33,19,30,21],[33,20,30,22,"invalidateQueries"],[33,37,30,39],[33,38,30,40],[34,10,31,12,"queryKey"],[34,18,31,20],[34,20,31,22,"listingKeys"],[34,30,31,33],[34,31,31,33,"listingKeys"],[34,42,31,33],[34,43,31,34,"offers"],[34,49,31,40],[34,50,31,41,"listingId"],[34,59,31,50],[35,8,32,10],[35,9,32,11],[35,10,32,12],[37,8,34,10],[38,8,35,10],[38,12,35,14,"payload"],[38,19,35,21],[38,20,35,22,"new"],[38,23,35,25],[38,24,35,26,"status"],[38,30,35,32],[38,35,35,37],[38,45,35,47],[38,47,35,49],[39,10,36,12,"queryClient"],[39,21,36,23],[39,22,36,24,"invalidateQueries"],[39,39,36,41],[39,40,36,42],[40,12,37,14,"queryKey"],[40,20,37,22],[40,22,37,24,"listingKeys"],[40,32,37,35],[40,33,37,35,"listingKeys"],[40,44,37,35],[40,45,37,36,"detail"],[40,51,37,42],[40,52,37,43,"listingId"],[40,61,37,52],[41,10,38,12],[41,11,38,13],[41,12,38,14],[42,10,39,12,"queryClient"],[42,21,39,23],[42,22,39,24,"invalidateQueries"],[42,39,39,41],[42,40,39,42],[43,12,40,14,"queryKey"],[43,20,40,22],[43,22,40,24,"listingKeys"],[43,32,40,35],[43,33,40,35,"listingKeys"],[43,44,40,35],[43,45,40,36,"myListings"],[43,55,40,46],[43,56,40,47],[44,10,41,12],[44,11,41,13],[44,12,41,14],[45,8,42,10],[46,6,43,8],[46,7,44,6],[46,8,44,7],[46,9,45,7,"on"],[46,11,45,9],[46,12,46,8],[46,30,46,26],[46,32,47,8],[47,8,48,10,"event"],[47,13,48,15],[47,15,48,17],[47,23,48,25],[48,8,49,10,"schema"],[48,14,49,16],[48,16,49,18],[48,24,49,26],[49,8,50,10,"table"],[49,13,50,15],[49,15,50,17],[49,23,50,25],[50,8,51,10,"filter"],[50,14,51,16],[50,16,51,18],[50,33,51,35,"listingId"],[50,42,51,44],[51,6,52,8],[51,7,52,9],[51,9,53,8],[51,15,53,14],[52,8,54,10,"queryClient"],[52,19,54,21],[52,20,54,22,"invalidateQueries"],[52,37,54,39],[52,38,54,40],[53,10,55,12,"queryKey"],[53,18,55,20],[53,20,55,22,"listingKeys"],[53,30,55,33],[53,31,55,33,"listingKeys"],[53,42,55,33],[53,43,55,34,"offers"],[53,49,55,40],[53,50,55,41,"listingId"],[53,59,55,50],[54,8,56,10],[54,9,56,11],[54,10,56,12],[55,6,57,8],[55,7,58,6],[55,8,58,7],[55,9,59,7,"subscribe"],[55,18,59,16],[55,19,59,17],[55,20,59,18],[56,6,61,4],[56,13,61,11],[56,19,61,17],[57,8,62,6,"supabase"],[57,20,62,14],[57,21,62,14,"supabase"],[57,29,62,14],[57,30,62,15,"removeChannel"],[57,43,62,28],[57,44,62,29,"channel"],[57,51,62,36],[57,52,62,37],[58,6,63,4],[58,7,63,5],[59,4,64,2],[59,5,64,3],[59,7,64,5],[59,8,64,6,"listingId"],[59,17,64,15],[59,19,64,17,"queryClient"],[59,30,64,28],[59,31,64,29],[59,32,64,30],[60,2,65,0],[60,3,65,1],[61,2,67,0],[61,6,67,0,"_default"],[61,14,67,0],[61,17,67,15,"useRealtimeOfferUpdates"],[61,40,67,38],[62,0,67,39],[62,3]],"functionMap":{"names":["<global>","useRealtimeOfferUpdates","useEffect$argument_0","supabase.channel.on$argument_2","supabase.channel.on.on$argument_2","<anonymous>"],"mappings":"AAA;gCCY;YCG;QCa;SDc;QEU;SFI;WGI;KHE;GDC;CDC"},"hasCjsExports":false},"type":"js/module"}]}
{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":49,"index":49}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":50},"end":{"line":2,"column":42,"index":92}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":93},"end":{"line":3,"column":43,"index":136}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}},{"name":"../../utils/normalizeOfferNotes/normalizeOfferNotes","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":137},"end":{"line":4,"column":86,"index":223}}],"key":"i1eXRxjKohYoHxkMvLegV8XaHRc=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0]);\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1]);\n  var _libSupabase = require(_dependencyMap[2]);\n  var _queryKeys = require(_dependencyMap[3]);\n  var _utilsNormalizeOfferNotesNormalizeOfferNotes = require(_dependencyMap[4]);\n  var normalizeOfferNotes = _interopDefault(_utilsNormalizeOfferNotesNormalizeOfferNotes);\n  /**\n   * Fetches notes from the most recent card_offer message in a conversation.\n   * Handles both new multi-author format and legacy single-string format.\n   */\n  var useOfferNotes = conversationId => {\n    return (0, _tanstackReactQuery.useQuery)({\n      queryKey: _queryKeys.chatKeys.offerNotes(conversationId),\n      queryFn: function () {\n        var _ref = (0, _asyncToGenerator.default)(function* () {\n          var _yield$supabase$from$ = yield _libSupabase.supabase.from('messages').select(`\n          id,\n          payload,\n          sender:users!messages_sender_id_fkey (\n            id,\n            display_name,\n            avatar_url\n          )\n        `).eq('conversation_id', conversationId).eq('type', 'card_offer').order('created_at', {\n              ascending: false\n            }).limit(1),\n            data = _yield$supabase$from$.data,\n            error = _yield$supabase$from$.error;\n          if (error) throw error;\n          if (!data || data.length === 0) {\n            return {\n              offeringNotes: [],\n              requestingNotes: []\n            };\n          }\n          var msg = data[0];\n          var payload = msg.payload;\n          var sender = msg.sender;\n          return (0, normalizeOfferNotes.default)(payload, {\n            id: sender.id,\n            name: sender.display_name,\n            avatarUrl: sender.avatar_url\n          });\n        });\n        return function queryFn() {\n          return _ref.apply(this, arguments);\n        };\n      }(),\n      enabled: !!conversationId,\n      staleTime: 300000\n    });\n  };\n  var _default = useOfferNotes;\n});","lineCount":72,"map":[[12,2,62,0,"Object"],[12,8,62,0],[12,9,62,0,"defineProperty"],[12,23,62,0],[12,24,62,0,"exports"],[12,31,62,0],[13,4,62,0,"enumerable"],[13,14,62,0],[14,4,62,0,"get"],[14,7,62,0],[14,18,62,0,"get"],[14,19,62,0],[15,6,62,0],[15,13,62,0,"_default"],[15,21,62,0],[16,4,62,0],[17,2,62,0],[18,2,62,29],[18,6,62,29,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,62,29],[18,45,62,29,"require"],[18,52,62,29],[18,53,62,29,"_dependencyMap"],[18,67,62,29],[19,2,62,29],[19,6,62,29,"_asyncToGenerator"],[19,23,62,29],[19,26,62,29,"_interopDefault"],[19,41,62,29],[19,42,62,29,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,62,29],[20,2,1,0],[20,6,1,0,"_tanstackReactQuery"],[20,25,1,0],[20,28,1,0,"require"],[20,35,1,0],[20,36,1,0,"_dependencyMap"],[20,50,1,0],[21,2,2,0],[21,6,2,0,"_libSupabase"],[21,18,2,0],[21,21,2,0,"require"],[21,28,2,0],[21,29,2,0,"_dependencyMap"],[21,43,2,0],[22,2,3,0],[22,6,3,0,"_queryKeys"],[22,16,3,0],[22,19,3,0,"require"],[22,26,3,0],[22,27,3,0,"_dependencyMap"],[22,41,3,0],[23,2,4,0],[23,6,4,0,"_utilsNormalizeOfferNotesNormalizeOfferNotes"],[23,50,4,0],[23,53,4,0,"require"],[23,60,4,0],[23,61,4,0,"_dependencyMap"],[23,75,4,0],[24,2,4,0],[24,6,4,0,"normalizeOfferNotes"],[24,25,4,0],[24,28,4,0,"_interopDefault"],[24,43,4,0],[24,44,4,0,"_utilsNormalizeOfferNotesNormalizeOfferNotes"],[24,88,4,0],[25,2,12,0],[26,0,13,0],[27,0,14,0],[28,0,15,0],[29,2,16,0],[29,6,16,6,"useOfferNotes"],[29,19,16,19],[29,22,16,23,"conversationId"],[29,36,16,45],[29,40,16,50],[30,4,17,2],[30,11,17,9],[30,15,17,9,"useQuery"],[30,34,17,17],[30,35,17,17,"useQuery"],[30,43,17,17],[30,45,17,18],[31,6,18,4,"queryKey"],[31,14,18,12],[31,16,18,14,"chatKeys"],[31,26,18,22],[31,27,18,22,"chatKeys"],[31,35,18,22],[31,36,18,23,"offerNotes"],[31,46,18,33],[31,47,18,34,"conversationId"],[31,61,18,48],[31,62,18,49],[32,6,19,4,"queryFn"],[32,13,19,11],[33,8,19,11],[33,12,19,11,"_ref"],[33,16,19,11],[33,23,19,11,"_asyncToGenerator"],[33,40,19,11],[33,41,19,11,"default"],[33,48,19,11],[33,50,19,13],[33,63,19,46],[34,10,20,6],[34,14,20,6,"_yield$supabase$from$"],[34,35,20,6],[34,44,20,36,"supabase"],[34,56,20,44],[34,57,20,44,"supabase"],[34,65,20,44],[34,66,21,9,"from"],[34,70,21,13],[34,71,21,14],[34,81,21,24],[34,82,21,25],[34,83,22,9,"select"],[34,89,22,15],[34,90,23,10],[35,0,24,0],[36,0,25,0],[37,0,26,0],[38,0,27,0],[39,0,28,0],[40,0,29,0],[41,0,30,0],[42,0,31,0],[42,9,32,8],[42,10,32,9],[42,11,33,9,"eq"],[42,13,33,11],[42,14,33,12],[42,31,33,29],[42,33,33,31,"conversationId"],[42,47,33,45],[42,48,33,46],[42,49,34,9,"eq"],[42,51,34,11],[42,52,34,12],[42,58,34,18],[42,60,34,20],[42,72,34,32],[42,73,34,33],[42,74,35,9,"order"],[42,79,35,14],[42,80,35,15],[42,92,35,27],[42,94,35,29],[43,14,35,31,"ascending"],[43,23,35,40],[43,25,35,42],[44,12,35,48],[44,13,35,49],[44,14,35,50],[44,15,36,9,"limit"],[44,20,36,14],[44,21,36,15],[44,22,36,16],[44,23,36,17],[45,12,20,14,"data"],[45,16,20,18],[45,19,20,18,"_yield$supabase$from$"],[45,40,20,18],[45,41,20,14,"data"],[45,45,20,18],[46,12,20,20,"error"],[46,17,20,25],[46,20,20,25,"_yield$supabase$from$"],[46,41,20,25],[46,42,20,20,"error"],[46,47,20,25],[47,10,38,6],[47,14,38,10,"error"],[47,19,38,15],[47,21,38,17],[47,27,38,23,"error"],[47,32,38,28],[48,10,39,6],[48,14,39,10],[48,15,39,11,"data"],[48,19,39,15],[48,23,39,19,"data"],[48,27,39,23],[48,28,39,24,"length"],[48,34,39,30],[48,39,39,35],[48,40,39,36],[48,42,39,38],[49,12,40,8],[49,19,40,15],[50,14,40,17,"offeringNotes"],[50,27,40,30],[50,29,40,32],[50,31,40,34],[51,14,40,36,"requestingNotes"],[51,29,40,51],[51,31,40,53],[52,12,40,56],[52,13,40,57],[53,10,41,6],[54,10,43,6],[54,14,43,12,"msg"],[54,17,43,15],[54,20,43,18,"data"],[54,24,43,22],[54,25,43,23],[54,26,43,24],[54,27,43,26],[55,10,44,6],[55,14,44,12,"payload"],[55,21,44,19],[55,24,44,22,"msg"],[55,27,44,25],[55,28,44,26,"payload"],[55,35,44,53],[56,10,45,6],[56,14,45,12,"sender"],[56,20,45,18],[56,23,45,21,"msg"],[56,26,45,24],[56,27,45,25,"sender"],[56,33,49,7],[57,10,51,6],[57,17,51,13],[57,21,51,13,"normalizeOfferNotes"],[57,40,51,32],[57,41,51,32,"default"],[57,48,51,32],[57,50,51,33,"payload"],[57,57,51,40],[57,59,51,42],[58,12,52,8,"id"],[58,14,52,10],[58,16,52,12,"sender"],[58,22,52,18],[58,23,52,19,"id"],[58,25,52,21],[59,12,53,8,"name"],[59,16,53,12],[59,18,53,14,"sender"],[59,24,53,20],[59,25,53,21,"display_name"],[59,37,53,33],[60,12,54,8,"avatarUrl"],[60,21,54,17],[60,23,54,19,"sender"],[60,29,54,25],[60,30,54,26,"avatar_url"],[61,10,55,6],[61,11,55,7],[61,12,55,8],[62,8,56,4],[62,9,56,5],[63,8,56,5],[63,24,19,4,"queryFn"],[63,31,19,11,"queryFn"],[63,32,19,11],[64,10,19,11],[64,17,19,11,"_ref"],[64,21,19,11],[64,22,19,11,"apply"],[64,27,19,11],[64,34,19,11,"arguments"],[64,43,19,11],[65,8,19,11],[66,6,19,11],[66,9,56,5],[67,6,57,4,"enabled"],[67,13,57,11],[67,15,57,13],[67,16,57,14],[67,17,57,15,"conversationId"],[67,31,57,29],[68,6,58,4,"staleTime"],[68,15,58,13],[69,4,59,2],[69,5,59,3],[69,6,59,4],[70,2,60,0],[70,3,60,1],[71,2,62,0],[71,6,62,0,"_default"],[71,14,62,0],[71,17,62,15,"useOfferNotes"],[71,30,62,28],[72,0,62,29],[72,3]],"functionMap":{"names":["<global>","useOfferNotes","useQuery$argument_0.queryFn"],"mappings":"AAA;sBCe;aCG;KDqC;CDI"},"hasCjsExports":false},"type":"js/module"}]}
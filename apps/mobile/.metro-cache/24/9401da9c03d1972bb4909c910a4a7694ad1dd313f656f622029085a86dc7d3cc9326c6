{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":49,"index":49}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":50},"end":{"line":2,"column":42,"index":92}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":93},"end":{"line":3,"column":43,"index":136}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0]);\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1]);\n  var _libSupabase = require(_dependencyMap[2]);\n  var _queryKeys = require(_dependencyMap[3]);\n  /**\n   * Fetches the previous (second-most-recent) card_offer message for a conversation.\n   * Returns null when there's only one offer (i.e. the current active offer is the first).\n   */\n  var usePreviousOffer = conversationId => {\n    return (0, _tanstackReactQuery.useQuery)({\n      queryKey: _queryKeys.chatKeys.previousOffer(conversationId),\n      queryFn: function () {\n        var _ref = (0, _asyncToGenerator.default)(function* () {\n          var _yield$supabase$from$ = yield _libSupabase.supabase.from('messages').select(`\n          id,\n          payload,\n          created_at,\n          sender:users!messages_sender_id_fkey (\n            id,\n            display_name\n          )\n        `).eq('conversation_id', conversationId).eq('type', 'card_offer').order('created_at', {\n              ascending: false\n            }).limit(2),\n            data = _yield$supabase$from$.data,\n            error = _yield$supabase$from$.error;\n          if (error) throw error;\n          if (!data || data.length < 2) return null;\n\n          // Index 0 = most recent (current active offer), index 1 = previous offer\n          var prev = data[1];\n          var payload = prev.payload;\n          var sender = prev.sender;\n          return {\n            offering: payload.offering ?? [],\n            requesting: payload.requesting ?? [],\n            cashAmount: payload.cash_amount ?? 0,\n            cashDirection: payload.cash_direction ?? null,\n            offeringNote: payload.offering_note ?? payload.note ?? null,\n            requestingNote: payload.requesting_note ?? null,\n            senderDisplayName: sender.display_name,\n            sentAt: prev.created_at\n          };\n        });\n        return function queryFn() {\n          return _ref.apply(this, arguments);\n        };\n      }(),\n      enabled: !!conversationId,\n      staleTime: 300000\n    });\n  };\n  var _default = usePreviousOffer;\n});","lineCount":72,"map":[[12,2,67,0,"Object"],[12,8,67,0],[12,9,67,0,"defineProperty"],[12,23,67,0],[12,24,67,0,"exports"],[12,31,67,0],[13,4,67,0,"enumerable"],[13,14,67,0],[14,4,67,0,"get"],[14,7,67,0],[14,18,67,0,"get"],[14,19,67,0],[15,6,67,0],[15,13,67,0,"_default"],[15,21,67,0],[16,4,67,0],[17,2,67,0],[18,2,67,32],[18,6,67,32,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,67,32],[18,45,67,32,"require"],[18,52,67,32],[18,53,67,32,"_dependencyMap"],[18,67,67,32],[19,2,67,32],[19,6,67,32,"_asyncToGenerator"],[19,23,67,32],[19,26,67,32,"_interopDefault"],[19,41,67,32],[19,42,67,32,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,67,32],[20,2,1,0],[20,6,1,0,"_tanstackReactQuery"],[20,25,1,0],[20,28,1,0,"require"],[20,35,1,0],[20,36,1,0,"_dependencyMap"],[20,50,1,0],[21,2,2,0],[21,6,2,0,"_libSupabase"],[21,18,2,0],[21,21,2,0,"require"],[21,28,2,0],[21,29,2,0,"_dependencyMap"],[21,43,2,0],[22,2,3,0],[22,6,3,0,"_queryKeys"],[22,16,3,0],[22,19,3,0,"require"],[22,26,3,0],[22,27,3,0,"_dependencyMap"],[22,41,3,0],[23,2,17,0],[24,0,18,0],[25,0,19,0],[26,0,20,0],[27,2,21,0],[27,6,21,6,"usePreviousOffer"],[27,22,21,22],[27,25,21,26,"conversationId"],[27,39,21,48],[27,43,21,53],[28,4,22,2],[28,11,22,9],[28,15,22,9,"useQuery"],[28,34,22,17],[28,35,22,17,"useQuery"],[28,43,22,17],[28,45,22,18],[29,6,23,4,"queryKey"],[29,14,23,12],[29,16,23,14,"chatKeys"],[29,26,23,22],[29,27,23,22,"chatKeys"],[29,35,23,22],[29,36,23,23,"previousOffer"],[29,49,23,36],[29,50,23,37,"conversationId"],[29,64,23,51],[29,65,23,52],[30,6,24,4,"queryFn"],[30,13,24,11],[31,8,24,11],[31,12,24,11,"_ref"],[31,16,24,11],[31,23,24,11,"_asyncToGenerator"],[31,40,24,11],[31,41,24,11,"default"],[31,48,24,11],[31,50,24,13],[31,63,24,56],[32,10,25,6],[32,14,25,6,"_yield$supabase$from$"],[32,35,25,6],[32,44,25,36,"supabase"],[32,56,25,44],[32,57,25,44,"supabase"],[32,65,25,44],[32,66,26,9,"from"],[32,70,26,13],[32,71,26,14],[32,81,26,24],[32,82,26,25],[32,83,27,9,"select"],[32,89,27,15],[32,90,28,10],[33,0,29,0],[34,0,30,0],[35,0,31,0],[36,0,32,0],[37,0,33,0],[38,0,34,0],[39,0,35,0],[40,0,36,0],[40,9,37,8],[40,10,37,9],[40,11,38,9,"eq"],[40,13,38,11],[40,14,38,12],[40,31,38,29],[40,33,38,31,"conversationId"],[40,47,38,45],[40,48,38,46],[40,49,39,9,"eq"],[40,51,39,11],[40,52,39,12],[40,58,39,18],[40,60,39,20],[40,72,39,32],[40,73,39,33],[40,74,40,9,"order"],[40,79,40,14],[40,80,40,15],[40,92,40,27],[40,94,40,29],[41,14,40,31,"ascending"],[41,23,40,40],[41,25,40,42],[42,12,40,48],[42,13,40,49],[42,14,40,50],[42,15,41,9,"limit"],[42,20,41,14],[42,21,41,15],[42,22,41,16],[42,23,41,17],[43,12,25,14,"data"],[43,16,25,18],[43,19,25,18,"_yield$supabase$from$"],[43,40,25,18],[43,41,25,14,"data"],[43,45,25,18],[44,12,25,20,"error"],[44,17,25,25],[44,20,25,25,"_yield$supabase$from$"],[44,41,25,25],[44,42,25,20,"error"],[44,47,25,25],[45,10,43,6],[45,14,43,10,"error"],[45,19,43,15],[45,21,43,17],[45,27,43,23,"error"],[45,32,43,28],[46,10,44,6],[46,14,44,10],[46,15,44,11,"data"],[46,19,44,15],[46,23,44,19,"data"],[46,27,44,23],[46,28,44,24,"length"],[46,34,44,30],[46,37,44,33],[46,38,44,34],[46,40,44,36],[46,47,44,43],[46,51,44,47],[48,10,46,6],[49,10,47,6],[49,14,47,12,"prev"],[49,18,47,16],[49,21,47,19,"data"],[49,25,47,23],[49,26,47,24],[49,27,47,25],[49,28,47,27],[50,10,48,6],[50,14,48,12,"payload"],[50,21,48,19],[50,24,48,22,"prev"],[50,28,48,26],[50,29,48,27,"payload"],[50,36,48,54],[51,10,49,6],[51,14,49,12,"sender"],[51,20,49,18],[51,23,49,21,"prev"],[51,27,49,25],[51,28,49,26,"sender"],[51,34,49,83],[52,10,51,6],[52,17,51,13],[53,12,52,8,"offering"],[53,20,52,16],[53,22,52,18,"payload"],[53,29,52,25],[53,30,52,26,"offering"],[53,38,52,34],[53,42,52,38],[53,44,52,40],[54,12,53,8,"requesting"],[54,22,53,18],[54,24,53,20,"payload"],[54,31,53,27],[54,32,53,28,"requesting"],[54,42,53,38],[54,46,53,42],[54,48,53,44],[55,12,54,8,"cashAmount"],[55,22,54,18],[55,24,54,20,"payload"],[55,31,54,27],[55,32,54,28,"cash_amount"],[55,43,54,39],[55,47,54,43],[55,48,54,44],[56,12,55,8,"cashDirection"],[56,25,55,21],[56,27,55,23,"payload"],[56,34,55,30],[56,35,55,31,"cash_direction"],[56,49,55,45],[56,53,55,49],[56,57,55,53],[57,12,56,8,"offeringNote"],[57,24,56,20],[57,26,56,22,"payload"],[57,33,56,29],[57,34,56,30,"offering_note"],[57,47,56,43],[57,51,56,47,"payload"],[57,58,56,54],[57,59,56,55,"note"],[57,63,56,59],[57,67,56,63],[57,71,56,67],[58,12,57,8,"requestingNote"],[58,26,57,22],[58,28,57,24,"payload"],[58,35,57,31],[58,36,57,32,"requesting_note"],[58,51,57,47],[58,55,57,51],[58,59,57,55],[59,12,58,8,"senderDisplayName"],[59,29,58,25],[59,31,58,27,"sender"],[59,37,58,33],[59,38,58,34,"display_name"],[59,50,58,46],[60,12,59,8,"sentAt"],[60,18,59,14],[60,20,59,16,"prev"],[60,24,59,20],[60,25,59,21,"created_at"],[61,10,60,6],[61,11,60,7],[62,8,61,4],[62,9,61,5],[63,8,61,5],[63,24,24,4,"queryFn"],[63,31,24,11,"queryFn"],[63,32,24,11],[64,10,24,11],[64,17,24,11,"_ref"],[64,21,24,11],[64,22,24,11,"apply"],[64,27,24,11],[64,34,24,11,"arguments"],[64,43,24,11],[65,8,24,11],[66,6,24,11],[66,9,61,5],[67,6,62,4,"enabled"],[67,13,62,11],[67,15,62,13],[67,16,62,14],[67,17,62,15,"conversationId"],[67,31,62,29],[68,6,63,4,"staleTime"],[68,15,63,13],[69,4,64,2],[69,5,64,3],[69,6,64,4],[70,2,65,0],[70,3,65,1],[71,2,67,0],[71,6,67,0,"_default"],[71,14,67,0],[71,17,67,15,"usePreviousOffer"],[71,33,67,31],[72,0,67,32],[72,3]],"functionMap":{"names":["<global>","usePreviousOffer","useQuery$argument_0.queryFn"],"mappings":"AAA;yBCoB;aCG;KDqC;CDI"},"hasCjsExports":false},"type":"js/module"}]}
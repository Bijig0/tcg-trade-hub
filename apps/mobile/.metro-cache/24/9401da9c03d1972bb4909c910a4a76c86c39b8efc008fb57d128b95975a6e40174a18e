{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":49,"index":49}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":50},"end":{"line":2,"column":42,"index":92}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":93},"end":{"line":3,"column":43,"index":136}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}},{"name":"../../utils/normalizeOfferNotes/normalizeOfferNotes","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":137},"end":{"line":4,"column":86,"index":223}}],"key":"i1eXRxjKohYoHxkMvLegV8XaHRc=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0]);\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1]);\n  var _libSupabase = require(_dependencyMap[2]);\n  var _queryKeys = require(_dependencyMap[3]);\n  var _utilsNormalizeOfferNotesNormalizeOfferNotes = require(_dependencyMap[4]);\n  var normalizeOfferNotes = _interopDefault(_utilsNormalizeOfferNotesNormalizeOfferNotes);\n  /**\n   * Fetches the previous (second-most-recent) card_offer message for a conversation.\n   * Returns null when there's only one offer (i.e. the current active offer is the first).\n   */\n  var usePreviousOffer = conversationId => {\n    return (0, _tanstackReactQuery.useQuery)({\n      queryKey: _queryKeys.chatKeys.previousOffer(conversationId),\n      queryFn: function () {\n        var _ref = (0, _asyncToGenerator.default)(function* () {\n          var _yield$supabase$from$ = yield _libSupabase.supabase.from('messages').select(`\n          id,\n          payload,\n          created_at,\n          sender:users!messages_sender_id_fkey (\n            id,\n            display_name,\n            avatar_url\n          )\n        `).eq('conversation_id', conversationId).eq('type', 'card_offer').order('created_at', {\n              ascending: false\n            }).limit(2),\n            data = _yield$supabase$from$.data,\n            error = _yield$supabase$from$.error;\n          if (error) throw error;\n          if (!data || data.length < 2) return null;\n\n          // Index 0 = most recent (current active offer), index 1 = previous offer\n          var prev = data[1];\n          var payload = prev.payload;\n          var sender = prev.sender;\n          var normalized = (0, normalizeOfferNotes.default)(payload, {\n            id: sender.id,\n            name: sender.display_name,\n            avatarUrl: sender.avatar_url\n          });\n          return {\n            offering: payload.offering ?? [],\n            requesting: payload.requesting ?? [],\n            cashAmount: payload.cash_amount ?? 0,\n            cashDirection: payload.cash_direction ?? null,\n            offeringNote: payload.offering_note ?? payload.note ?? null,\n            requestingNote: payload.requesting_note ?? null,\n            offeringNotes: normalized.offeringNotes,\n            requestingNotes: normalized.requestingNotes,\n            senderDisplayName: sender.display_name,\n            sentAt: prev.created_at\n          };\n        });\n        return function queryFn() {\n          return _ref.apply(this, arguments);\n        };\n      }(),\n      enabled: !!conversationId,\n      staleTime: 300000\n    });\n  };\n  var _default = usePreviousOffer;\n});","lineCount":82,"map":[[12,2,83,0,"Object"],[12,8,83,0],[12,9,83,0,"defineProperty"],[12,23,83,0],[12,24,83,0,"exports"],[12,31,83,0],[13,4,83,0,"enumerable"],[13,14,83,0],[14,4,83,0,"get"],[14,7,83,0],[14,18,83,0,"get"],[14,19,83,0],[15,6,83,0],[15,13,83,0,"_default"],[15,21,83,0],[16,4,83,0],[17,2,83,0],[18,2,83,32],[18,6,83,32,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,83,32],[18,45,83,32,"require"],[18,52,83,32],[18,53,83,32,"_dependencyMap"],[18,67,83,32],[19,2,83,32],[19,6,83,32,"_asyncToGenerator"],[19,23,83,32],[19,26,83,32,"_interopDefault"],[19,41,83,32],[19,42,83,32,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,83,32],[20,2,1,0],[20,6,1,0,"_tanstackReactQuery"],[20,25,1,0],[20,28,1,0,"require"],[20,35,1,0],[20,36,1,0,"_dependencyMap"],[20,50,1,0],[21,2,2,0],[21,6,2,0,"_libSupabase"],[21,18,2,0],[21,21,2,0,"require"],[21,28,2,0],[21,29,2,0,"_dependencyMap"],[21,43,2,0],[22,2,3,0],[22,6,3,0,"_queryKeys"],[22,16,3,0],[22,19,3,0,"require"],[22,26,3,0],[22,27,3,0,"_dependencyMap"],[22,41,3,0],[23,2,4,0],[23,6,4,0,"_utilsNormalizeOfferNotesNormalizeOfferNotes"],[23,50,4,0],[23,53,4,0,"require"],[23,60,4,0],[23,61,4,0,"_dependencyMap"],[23,75,4,0],[24,2,4,0],[24,6,4,0,"normalizeOfferNotes"],[24,25,4,0],[24,28,4,0,"_interopDefault"],[24,43,4,0],[24,44,4,0,"_utilsNormalizeOfferNotesNormalizeOfferNotes"],[24,88,4,0],[25,2,20,0],[26,0,21,0],[27,0,22,0],[28,0,23,0],[29,2,24,0],[29,6,24,6,"usePreviousOffer"],[29,22,24,22],[29,25,24,26,"conversationId"],[29,39,24,48],[29,43,24,53],[30,4,25,2],[30,11,25,9],[30,15,25,9,"useQuery"],[30,34,25,17],[30,35,25,17,"useQuery"],[30,43,25,17],[30,45,25,18],[31,6,26,4,"queryKey"],[31,14,26,12],[31,16,26,14,"chatKeys"],[31,26,26,22],[31,27,26,22,"chatKeys"],[31,35,26,22],[31,36,26,23,"previousOffer"],[31,49,26,36],[31,50,26,37,"conversationId"],[31,64,26,51],[31,65,26,52],[32,6,27,4,"queryFn"],[32,13,27,11],[33,8,27,11],[33,12,27,11,"_ref"],[33,16,27,11],[33,23,27,11,"_asyncToGenerator"],[33,40,27,11],[33,41,27,11,"default"],[33,48,27,11],[33,50,27,13],[33,63,27,56],[34,10,28,6],[34,14,28,6,"_yield$supabase$from$"],[34,35,28,6],[34,44,28,36,"supabase"],[34,56,28,44],[34,57,28,44,"supabase"],[34,65,28,44],[34,66,29,9,"from"],[34,70,29,13],[34,71,29,14],[34,81,29,24],[34,82,29,25],[34,83,30,9,"select"],[34,89,30,15],[34,90,31,10],[35,0,32,0],[36,0,33,0],[37,0,34,0],[38,0,35,0],[39,0,36,0],[40,0,37,0],[41,0,38,0],[42,0,39,0],[43,0,40,0],[43,9,41,8],[43,10,41,9],[43,11,42,9,"eq"],[43,13,42,11],[43,14,42,12],[43,31,42,29],[43,33,42,31,"conversationId"],[43,47,42,45],[43,48,42,46],[43,49,43,9,"eq"],[43,51,43,11],[43,52,43,12],[43,58,43,18],[43,60,43,20],[43,72,43,32],[43,73,43,33],[43,74,44,9,"order"],[43,79,44,14],[43,80,44,15],[43,92,44,27],[43,94,44,29],[44,14,44,31,"ascending"],[44,23,44,40],[44,25,44,42],[45,12,44,48],[45,13,44,49],[45,14,44,50],[45,15,45,9,"limit"],[45,20,45,14],[45,21,45,15],[45,22,45,16],[45,23,45,17],[46,12,28,14,"data"],[46,16,28,18],[46,19,28,18,"_yield$supabase$from$"],[46,40,28,18],[46,41,28,14,"data"],[46,45,28,18],[47,12,28,20,"error"],[47,17,28,25],[47,20,28,25,"_yield$supabase$from$"],[47,41,28,25],[47,42,28,20,"error"],[47,47,28,25],[48,10,47,6],[48,14,47,10,"error"],[48,19,47,15],[48,21,47,17],[48,27,47,23,"error"],[48,32,47,28],[49,10,48,6],[49,14,48,10],[49,15,48,11,"data"],[49,19,48,15],[49,23,48,19,"data"],[49,27,48,23],[49,28,48,24,"length"],[49,34,48,30],[49,37,48,33],[49,38,48,34],[49,40,48,36],[49,47,48,43],[49,51,48,47],[51,10,50,6],[52,10,51,6],[52,14,51,12,"prev"],[52,18,51,16],[52,21,51,19,"data"],[52,25,51,23],[52,26,51,24],[52,27,51,25],[52,28,51,27],[53,10,52,6],[53,14,52,12,"payload"],[53,21,52,19],[53,24,52,22,"prev"],[53,28,52,26],[53,29,52,27,"payload"],[53,36,52,54],[54,10,53,6],[54,14,53,12,"sender"],[54,20,53,18],[54,23,53,21,"prev"],[54,27,53,25],[54,28,53,26,"sender"],[54,34,57,7],[55,10,59,6],[55,14,59,12,"normalized"],[55,24,59,22],[55,27,59,25],[55,31,59,25,"normalizeOfferNotes"],[55,50,59,44],[55,51,59,44,"default"],[55,58,59,44],[55,60,59,45,"payload"],[55,67,59,52],[55,69,59,54],[56,12,60,8,"id"],[56,14,60,10],[56,16,60,12,"sender"],[56,22,60,18],[56,23,60,19,"id"],[56,25,60,21],[57,12,61,8,"name"],[57,16,61,12],[57,18,61,14,"sender"],[57,24,61,20],[57,25,61,21,"display_name"],[57,37,61,33],[58,12,62,8,"avatarUrl"],[58,21,62,17],[58,23,62,19,"sender"],[58,29,62,25],[58,30,62,26,"avatar_url"],[59,10,63,6],[59,11,63,7],[59,12,63,8],[60,10,65,6],[60,17,65,13],[61,12,66,8,"offering"],[61,20,66,16],[61,22,66,18,"payload"],[61,29,66,25],[61,30,66,26,"offering"],[61,38,66,34],[61,42,66,38],[61,44,66,40],[62,12,67,8,"requesting"],[62,22,67,18],[62,24,67,20,"payload"],[62,31,67,27],[62,32,67,28,"requesting"],[62,42,67,38],[62,46,67,42],[62,48,67,44],[63,12,68,8,"cashAmount"],[63,22,68,18],[63,24,68,20,"payload"],[63,31,68,27],[63,32,68,28,"cash_amount"],[63,43,68,39],[63,47,68,43],[63,48,68,44],[64,12,69,8,"cashDirection"],[64,25,69,21],[64,27,69,23,"payload"],[64,34,69,30],[64,35,69,31,"cash_direction"],[64,49,69,45],[64,53,69,49],[64,57,69,53],[65,12,70,8,"offeringNote"],[65,24,70,20],[65,26,70,22,"payload"],[65,33,70,29],[65,34,70,30,"offering_note"],[65,47,70,43],[65,51,70,47,"payload"],[65,58,70,54],[65,59,70,55,"note"],[65,63,70,59],[65,67,70,63],[65,71,70,67],[66,12,71,8,"requestingNote"],[66,26,71,22],[66,28,71,24,"payload"],[66,35,71,31],[66,36,71,32,"requesting_note"],[66,51,71,47],[66,55,71,51],[66,59,71,55],[67,12,72,8,"offeringNotes"],[67,25,72,21],[67,27,72,23,"normalized"],[67,37,72,33],[67,38,72,34,"offeringNotes"],[67,51,72,47],[68,12,73,8,"requestingNotes"],[68,27,73,23],[68,29,73,25,"normalized"],[68,39,73,35],[68,40,73,36,"requestingNotes"],[68,55,73,51],[69,12,74,8,"senderDisplayName"],[69,29,74,25],[69,31,74,27,"sender"],[69,37,74,33],[69,38,74,34,"display_name"],[69,50,74,46],[70,12,75,8,"sentAt"],[70,18,75,14],[70,20,75,16,"prev"],[70,24,75,20],[70,25,75,21,"created_at"],[71,10,76,6],[71,11,76,7],[72,8,77,4],[72,9,77,5],[73,8,77,5],[73,24,27,4,"queryFn"],[73,31,27,11,"queryFn"],[73,32,27,11],[74,10,27,11],[74,17,27,11,"_ref"],[74,21,27,11],[74,22,27,11,"apply"],[74,27,27,11],[74,34,27,11,"arguments"],[74,43,27,11],[75,8,27,11],[76,6,27,11],[76,9,77,5],[77,6,78,4,"enabled"],[77,13,78,11],[77,15,78,13],[77,16,78,14],[77,17,78,15,"conversationId"],[77,31,78,29],[78,6,79,4,"staleTime"],[78,15,79,13],[79,4,80,2],[79,5,80,3],[79,6,80,4],[80,2,81,0],[80,3,81,1],[81,2,83,0],[81,6,83,0,"_default"],[81,14,83,0],[81,17,83,15,"usePreviousOffer"],[81,33,83,31],[82,0,83,32],[82,3]],"functionMap":{"names":["<global>","usePreviousOffer","useQuery$argument_0.queryFn"],"mappings":"AAA;yBCuB;aCG;KDkD;CDI"},"hasCjsExports":false},"type":"js/module"}]}
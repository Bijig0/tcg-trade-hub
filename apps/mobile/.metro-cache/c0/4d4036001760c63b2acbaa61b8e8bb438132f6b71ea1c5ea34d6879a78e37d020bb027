{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":49,"index":49}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":50},"end":{"line":2,"column":42,"index":92}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":93},"end":{"line":3,"column":43,"index":136}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0]);\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1]);\n  var _libSupabase = require(_dependencyMap[2]);\n  var _queryKeys = require(_dependencyMap[3]);\n  /**\n   * Fetches the trade context for a conversation — listing info, offer info,\n   * and negotiation status. Joins through conversations → matches → listings/offers.\n   */\n  var useTradeContext = conversationId => {\n    return (0, _tanstackReactQuery.useQuery)({\n      queryKey: _queryKeys.chatKeys.tradeContext(conversationId),\n      queryFn: function () {\n        var _ref = (0, _asyncToGenerator.default)(function* () {\n          // Get conversation with match, listing, and offer data\n          var _yield$supabase$from$ = yield _libSupabase.supabase.from('conversations').select(`\n          id,\n          negotiation_status,\n          matches!inner (\n            id,\n            user_a_id,\n            user_b_id,\n            listing_id,\n            offer_id,\n            listings!inner (\n              id,\n              user_id,\n              title,\n              type,\n              tcg,\n              total_value\n            ),\n            offers!inner (\n              id,\n              offerer_id,\n              cash_amount\n            )\n          )\n        `).eq('id', conversationId).single(),\n            conv = _yield$supabase$from$.data,\n            convError = _yield$supabase$from$.error;\n          if (convError || !conv) return null;\n          var match = conv.matches;\n\n          // Fetch listing items\n          var _yield$supabase$from$2 = yield _libSupabase.supabase.from('listing_items').select('card_name, card_image_url, card_external_id, tcg, condition, quantity, market_price').eq('listing_id', match.listings.id),\n            listingItems = _yield$supabase$from$2.data;\n\n          // Fetch offer items\n          var _yield$supabase$from$3 = yield _libSupabase.supabase.from('offer_items').select('card_name, card_image_url, card_external_id, tcg, condition, quantity, market_price').eq('offer_id', match.offers.id),\n            offerItems = _yield$supabase$from$3.data;\n\n          // Fetch user profiles for both sides\n          var userIds = [match.listings.user_id, match.offers.offerer_id];\n          var _yield$supabase$from$4 = yield _libSupabase.supabase.from('users').select('id, display_name, avatar_url, rating_score, total_trades').in('id', userIds),\n            profiles = _yield$supabase$from$4.data;\n          var profileMap = new Map((profiles ?? []).map(p => [p.id, {\n            id: p.id,\n            displayName: p.display_name,\n            avatarUrl: p.avatar_url,\n            ratingScore: p.rating_score,\n            totalTrades: p.total_trades\n          }]));\n          return {\n            listingId: match.listings.id,\n            listingTitle: match.listings.title,\n            listingType: match.listings.type,\n            listingTcg: match.listings.tcg,\n            listingOwnerId: match.listings.user_id,\n            listingOwnerProfile: profileMap.get(match.listings.user_id) ?? null,\n            offererProfile: profileMap.get(match.offers.offerer_id) ?? null,\n            listingItems: (listingItems ?? []).map(li => ({\n              cardName: li.card_name,\n              cardImageUrl: li.card_image_url,\n              cardExternalId: li.card_external_id,\n              tcg: li.tcg,\n              condition: li.condition,\n              quantity: li.quantity,\n              marketPrice: li.market_price\n            })),\n            listingTotalValue: match.listings.total_value,\n            offererId: match.offers.offerer_id,\n            offerItems: (offerItems ?? []).map(oi => ({\n              cardName: oi.card_name,\n              cardImageUrl: oi.card_image_url,\n              cardExternalId: oi.card_external_id,\n              tcg: oi.tcg,\n              condition: oi.condition,\n              quantity: oi.quantity,\n              marketPrice: oi.market_price\n            })),\n            offerCashAmount: match.offers.cash_amount,\n            offerCashDirection: match.offers.cash_amount > 0 ? 'offering' : null,\n            negotiationStatus: conv.negotiation_status\n          };\n        });\n        return function queryFn() {\n          return _ref.apply(this, arguments);\n        };\n      }(),\n      enabled: !!conversationId,\n      staleTime: 300000 // 5 minutes\n    });\n  };\n  var _default = useTradeContext;\n});","lineCount":123,"map":[[12,2,174,0,"Object"],[12,8,174,0],[12,9,174,0,"defineProperty"],[12,23,174,0],[12,24,174,0,"exports"],[12,31,174,0],[13,4,174,0,"enumerable"],[13,14,174,0],[14,4,174,0,"get"],[14,7,174,0],[14,18,174,0,"get"],[14,19,174,0],[15,6,174,0],[15,13,174,0,"_default"],[15,21,174,0],[16,4,174,0],[17,2,174,0],[18,2,174,31],[18,6,174,31,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,174,31],[18,45,174,31,"require"],[18,52,174,31],[18,53,174,31,"_dependencyMap"],[18,67,174,31],[19,2,174,31],[19,6,174,31,"_asyncToGenerator"],[19,23,174,31],[19,26,174,31,"_interopDefault"],[19,41,174,31],[19,42,174,31,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,174,31],[20,2,1,0],[20,6,1,0,"_tanstackReactQuery"],[20,25,1,0],[20,28,1,0,"require"],[20,35,1,0],[20,36,1,0,"_dependencyMap"],[20,50,1,0],[21,2,2,0],[21,6,2,0,"_libSupabase"],[21,18,2,0],[21,21,2,0,"require"],[21,28,2,0],[21,29,2,0,"_dependencyMap"],[21,43,2,0],[22,2,3,0],[22,6,3,0,"_queryKeys"],[22,16,3,0],[22,19,3,0,"require"],[22,26,3,0],[22,27,3,0,"_dependencyMap"],[22,41,3,0],[23,2,41,0],[24,0,42,0],[25,0,43,0],[26,0,44,0],[27,2,45,0],[27,6,45,6,"useTradeContext"],[27,21,45,21],[27,24,45,25,"conversationId"],[27,38,45,47],[27,42,45,52],[28,4,46,2],[28,11,46,9],[28,15,46,9,"useQuery"],[28,34,46,17],[28,35,46,17,"useQuery"],[28,43,46,17],[28,45,46,18],[29,6,47,4,"queryKey"],[29,14,47,12],[29,16,47,14,"chatKeys"],[29,26,47,22],[29,27,47,22,"chatKeys"],[29,35,47,22],[29,36,47,23,"tradeContext"],[29,48,47,35],[29,49,47,36,"conversationId"],[29,63,47,50],[29,64,47,51],[30,6,48,4,"queryFn"],[30,13,48,11],[31,8,48,11],[31,12,48,11,"_ref"],[31,16,48,11],[31,23,48,11,"_asyncToGenerator"],[31,40,48,11],[31,41,48,11,"default"],[31,48,48,11],[31,50,48,13],[31,63,48,55],[32,10,49,6],[33,10,50,6],[33,14,50,6,"_yield$supabase$from$"],[33,35,50,6],[33,44,50,53,"supabase"],[33,56,50,61],[33,57,50,61,"supabase"],[33,65,50,61],[33,66,51,9,"from"],[33,70,51,13],[33,71,51,14],[33,86,51,29],[33,87,51,30],[33,88,52,9,"select"],[33,94,52,15],[33,95,53,10],[34,0,54,0],[35,0,55,0],[36,0,56,0],[37,0,57,0],[38,0,58,0],[39,0,59,0],[40,0,60,0],[41,0,61,0],[42,0,62,0],[43,0,63,0],[44,0,64,0],[45,0,65,0],[46,0,66,0],[47,0,67,0],[48,0,68,0],[49,0,69,0],[50,0,70,0],[51,0,71,0],[52,0,72,0],[53,0,73,0],[54,0,74,0],[55,0,75,0],[56,0,76,0],[56,9,77,8],[56,10,77,9],[56,11,78,9,"eq"],[56,13,78,11],[56,14,78,12],[56,18,78,16],[56,20,78,18,"conversationId"],[56,34,78,32],[56,35,78,33],[56,36,79,9,"single"],[56,42,79,15],[56,43,79,16],[56,44,79,17],[57,12,50,20,"conv"],[57,16,50,24],[57,19,50,24,"_yield$supabase$from$"],[57,40,50,24],[57,41,50,14,"data"],[57,45,50,18],[58,12,50,33,"convError"],[58,21,50,42],[58,24,50,42,"_yield$supabase$from$"],[58,45,50,42],[58,46,50,26,"error"],[58,51,50,31],[59,10,81,6],[59,14,81,10,"convError"],[59,23,81,19],[59,27,81,23],[59,28,81,24,"conv"],[59,32,81,28],[59,34,81,30],[59,41,81,37],[59,45,81,41],[60,10,83,6],[60,14,83,12,"match"],[60,19,83,17],[60,22,83,20,"conv"],[60,26,83,24],[60,27,83,25,"matches"],[60,34,102,7],[62,10,104,6],[63,10,105,6],[63,14,105,6,"_yield$supabase$from$2"],[63,36,105,6],[63,45,105,43,"supabase"],[63,57,105,51],[63,58,105,51,"supabase"],[63,66,105,51],[63,67,106,9,"from"],[63,71,106,13],[63,72,106,14],[63,87,106,29],[63,88,106,30],[63,89,107,9,"select"],[63,95,107,15],[63,96,107,16],[63,181,107,101],[63,182,107,102],[63,183,108,9,"eq"],[63,185,108,11],[63,186,108,12],[63,198,108,24],[63,200,108,26,"match"],[63,205,108,31],[63,206,108,32,"listings"],[63,214,108,40],[63,215,108,41,"id"],[63,217,108,43],[63,218,108,44],[64,12,105,20,"listingItems"],[64,24,105,32],[64,27,105,32,"_yield$supabase$from$2"],[64,49,105,32],[64,50,105,14,"data"],[64,54,105,18],[66,10,110,6],[67,10,111,6],[67,14,111,6,"_yield$supabase$from$3"],[67,36,111,6],[67,45,111,41,"supabase"],[67,57,111,49],[67,58,111,49,"supabase"],[67,66,111,49],[67,67,112,9,"from"],[67,71,112,13],[67,72,112,14],[67,85,112,27],[67,86,112,28],[67,87,113,9,"select"],[67,93,113,15],[67,94,113,16],[67,179,113,101],[67,180,113,102],[67,181,114,9,"eq"],[67,183,114,11],[67,184,114,12],[67,194,114,22],[67,196,114,24,"match"],[67,201,114,29],[67,202,114,30,"offers"],[67,208,114,36],[67,209,114,37,"id"],[67,211,114,39],[67,212,114,40],[68,12,111,20,"offerItems"],[68,22,111,30],[68,25,111,30,"_yield$supabase$from$3"],[68,47,111,30],[68,48,111,14,"data"],[68,52,111,18],[70,10,116,6],[71,10,117,6],[71,14,117,12,"userIds"],[71,21,117,19],[71,24,117,22],[71,25,117,23,"match"],[71,30,117,28],[71,31,117,29,"listings"],[71,39,117,37],[71,40,117,38,"user_id"],[71,47,117,45],[71,49,117,47,"match"],[71,54,117,52],[71,55,117,53,"offers"],[71,61,117,59],[71,62,117,60,"offerer_id"],[71,72,117,70],[71,73,117,71],[72,10,118,6],[72,14,118,6,"_yield$supabase$from$4"],[72,36,118,6],[72,45,118,39,"supabase"],[72,57,118,47],[72,58,118,47,"supabase"],[72,66,118,47],[72,67,119,9,"from"],[72,71,119,13],[72,72,119,14],[72,79,119,21],[72,80,119,22],[72,81,120,9,"select"],[72,87,120,15],[72,88,120,16],[72,146,120,74],[72,147,120,75],[72,148,121,9,"in"],[72,150,121,11],[72,151,121,12],[72,155,121,16],[72,157,121,18,"userIds"],[72,164,121,25],[72,165,121,26],[73,12,118,20,"profiles"],[73,20,118,28],[73,23,118,28,"_yield$supabase$from$4"],[73,45,118,28],[73,46,118,14,"data"],[73,50,118,18],[74,10,123,6],[74,14,123,12,"profileMap"],[74,24,123,22],[74,27,123,25],[74,31,123,29,"Map"],[74,34,123,32],[74,35,124,8],[74,36,124,9,"profiles"],[74,44,124,17],[74,48,124,21],[74,50,124,23],[74,52,124,25,"map"],[74,55,124,28],[74,56,124,30,"p"],[74,57,124,31],[74,61,124,36],[74,62,125,10,"p"],[74,63,125,11],[74,64,125,12,"id"],[74,66,125,14],[74,68,126,10],[75,12,127,12,"id"],[75,14,127,14],[75,16,127,16,"p"],[75,17,127,17],[75,18,127,18,"id"],[75,20,127,20],[76,12,128,12,"displayName"],[76,23,128,23],[76,25,128,25,"p"],[76,26,128,26],[76,27,128,27,"display_name"],[76,39,128,39],[77,12,129,12,"avatarUrl"],[77,21,129,21],[77,23,129,23,"p"],[77,24,129,24],[77,25,129,25,"avatar_url"],[77,35,129,35],[78,12,130,12,"ratingScore"],[78,23,130,23],[78,25,130,25,"p"],[78,26,130,26],[78,27,130,27,"rating_score"],[78,39,130,39],[79,12,131,12,"totalTrades"],[79,23,131,23],[79,25,131,25,"p"],[79,26,131,26],[79,27,131,27,"total_trades"],[80,10,132,10],[80,11,132,11],[80,12,133,9],[80,13,134,6],[80,14,134,7],[81,10,136,6],[81,17,136,13],[82,12,137,8,"listingId"],[82,21,137,17],[82,23,137,19,"match"],[82,28,137,24],[82,29,137,25,"listings"],[82,37,137,33],[82,38,137,34,"id"],[82,40,137,36],[83,12,138,8,"listingTitle"],[83,24,138,20],[83,26,138,22,"match"],[83,31,138,27],[83,32,138,28,"listings"],[83,40,138,36],[83,41,138,37,"title"],[83,46,138,42],[84,12,139,8,"listingType"],[84,23,139,19],[84,25,139,21,"match"],[84,30,139,26],[84,31,139,27,"listings"],[84,39,139,35],[84,40,139,36,"type"],[84,44,139,55],[85,12,140,8,"listingTcg"],[85,22,140,18],[85,24,140,20,"match"],[85,29,140,25],[85,30,140,26,"listings"],[85,38,140,34],[85,39,140,35,"tcg"],[85,42,140,49],[86,12,141,8,"listingOwnerId"],[86,26,141,22],[86,28,141,24,"match"],[86,33,141,29],[86,34,141,30,"listings"],[86,42,141,38],[86,43,141,39,"user_id"],[86,50,141,46],[87,12,142,8,"listingOwnerProfile"],[87,31,142,27],[87,33,142,29,"profileMap"],[87,43,142,39],[87,44,142,40,"get"],[87,47,142,43],[87,48,142,44,"match"],[87,53,142,49],[87,54,142,50,"listings"],[87,62,142,58],[87,63,142,59,"user_id"],[87,70,142,66],[87,71,142,67],[87,75,142,71],[87,79,142,75],[88,12,143,8,"offererProfile"],[88,26,143,22],[88,28,143,24,"profileMap"],[88,38,143,34],[88,39,143,35,"get"],[88,42,143,38],[88,43,143,39,"match"],[88,48,143,44],[88,49,143,45,"offers"],[88,55,143,51],[88,56,143,52,"offerer_id"],[88,66,143,62],[88,67,143,63],[88,71,143,67],[88,75,143,71],[89,12,144,8,"listingItems"],[89,24,144,20],[89,26,144,22],[89,27,144,23,"listingItems"],[89,39,144,35],[89,43,144,39],[89,45,144,41],[89,47,144,43,"map"],[89,50,144,46],[89,51,144,48,"li"],[89,53,144,50],[89,58,144,56],[90,14,145,10,"cardName"],[90,22,145,18],[90,24,145,20,"li"],[90,26,145,22],[90,27,145,23,"card_name"],[90,36,145,32],[91,14,146,10,"cardImageUrl"],[91,26,146,22],[91,28,146,24,"li"],[91,30,146,26],[91,31,146,27,"card_image_url"],[91,45,146,41],[92,14,147,10,"cardExternalId"],[92,28,147,24],[92,30,147,26,"li"],[92,32,147,28],[92,33,147,29,"card_external_id"],[92,49,147,45],[93,14,148,10,"tcg"],[93,17,148,13],[93,19,148,15,"li"],[93,21,148,17],[93,22,148,18,"tcg"],[93,25,148,21],[94,14,149,10,"condition"],[94,23,149,19],[94,25,149,21,"li"],[94,27,149,23],[94,28,149,24,"condition"],[94,37,149,33],[95,14,150,10,"quantity"],[95,22,150,18],[95,24,150,20,"li"],[95,26,150,22],[95,27,150,23,"quantity"],[95,35,150,31],[96,14,151,10,"marketPrice"],[96,25,151,21],[96,27,151,23,"li"],[96,29,151,25],[96,30,151,26,"market_price"],[97,12,152,8],[97,13,152,9],[97,14,152,10],[97,15,152,11],[98,12,153,8,"listingTotalValue"],[98,29,153,25],[98,31,153,27,"match"],[98,36,153,32],[98,37,153,33,"listings"],[98,45,153,41],[98,46,153,42,"total_value"],[98,57,153,53],[99,12,154,8,"offererId"],[99,21,154,17],[99,23,154,19,"match"],[99,28,154,24],[99,29,154,25,"offers"],[99,35,154,31],[99,36,154,32,"offerer_id"],[99,46,154,42],[100,12,155,8,"offerItems"],[100,22,155,18],[100,24,155,20],[100,25,155,21,"offerItems"],[100,35,155,31],[100,39,155,35],[100,41,155,37],[100,43,155,39,"map"],[100,46,155,42],[100,47,155,44,"oi"],[100,49,155,46],[100,54,155,52],[101,14,156,10,"cardName"],[101,22,156,18],[101,24,156,20,"oi"],[101,26,156,22],[101,27,156,23,"card_name"],[101,36,156,32],[102,14,157,10,"cardImageUrl"],[102,26,157,22],[102,28,157,24,"oi"],[102,30,157,26],[102,31,157,27,"card_image_url"],[102,45,157,41],[103,14,158,10,"cardExternalId"],[103,28,158,24],[103,30,158,26,"oi"],[103,32,158,28],[103,33,158,29,"card_external_id"],[103,49,158,45],[104,14,159,10,"tcg"],[104,17,159,13],[104,19,159,15,"oi"],[104,21,159,17],[104,22,159,18,"tcg"],[104,25,159,21],[105,14,160,10,"condition"],[105,23,160,19],[105,25,160,21,"oi"],[105,27,160,23],[105,28,160,24,"condition"],[105,37,160,33],[106,14,161,10,"quantity"],[106,22,161,18],[106,24,161,20,"oi"],[106,26,161,22],[106,27,161,23,"quantity"],[106,35,161,31],[107,14,162,10,"marketPrice"],[107,25,162,21],[107,27,162,23,"oi"],[107,29,162,25],[107,30,162,26,"market_price"],[108,12,163,8],[108,13,163,9],[108,14,163,10],[108,15,163,11],[109,12,164,8,"offerCashAmount"],[109,27,164,23],[109,29,164,25,"match"],[109,34,164,30],[109,35,164,31,"offers"],[109,41,164,37],[109,42,164,38,"cash_amount"],[109,53,164,49],[110,12,165,8,"offerCashDirection"],[110,30,165,26],[110,32,165,28,"match"],[110,37,165,33],[110,38,165,34,"offers"],[110,44,165,40],[110,45,165,41,"cash_amount"],[110,56,165,52],[110,59,165,55],[110,60,165,56],[110,63,165,59],[110,73,165,69],[110,76,165,72],[110,80,165,76],[111,12,166,8,"negotiationStatus"],[111,29,166,25],[111,31,166,27,"conv"],[111,35,166,31],[111,36,166,32,"negotiation_status"],[112,10,167,6],[112,11,167,7],[113,8,168,4],[113,9,168,5],[114,8,168,5],[114,24,48,4,"queryFn"],[114,31,48,11,"queryFn"],[114,32,48,11],[115,10,48,11],[115,17,48,11,"_ref"],[115,21,48,11],[115,22,48,11,"apply"],[115,27,48,11],[115,34,48,11,"arguments"],[115,43,48,11],[116,8,48,11],[117,6,48,11],[117,9,168,5],[118,6,169,4,"enabled"],[118,13,169,11],[118,15,169,13],[118,16,169,14],[118,17,169,15,"conversationId"],[118,31,169,29],[119,6,170,4,"staleTime"],[119,15,170,13],[119,23,170,28],[119,24,170,30],[120,4,171,2],[120,5,171,3],[120,6,171,4],[121,2,172,0],[121,3,172,1],[122,2,174,0],[122,6,174,0,"_default"],[122,14,174,0],[122,17,174,15,"useTradeContext"],[122,32,174,30],[123,0,174,31],[123,3]],"functionMap":{"names":["<global>","useTradeContext","useQuery$argument_0.queryFn","map$argument_0"],"mappings":"AAA;wBC4C;aCG;6BC4E;SDS;+CCW;UDQ;2CCG;UDQ;KDK;CDI"},"hasCjsExports":false},"type":"js/module"}]}
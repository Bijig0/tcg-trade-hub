{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/asyncIterator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"iAa+RToycgxigMSWyQzterF69/I=","exportNames":["*"],"imports":1}},{"name":"./utils.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":24},"end":{"line":2,"column":61,"index":85}}],"key":"NIaSEHO1E48gsZc7jH9Ex1xTHgE=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"streamedQuery\", {\n    enumerable: true,\n    get: function () {\n      return streamedQuery;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _babelRuntimeHelpersAsyncIterator = require(_dependencyMap[1], \"@babel/runtime/helpers/asyncIterator\");\n  var _asyncIterator = _interopDefault(_babelRuntimeHelpersAsyncIterator);\n  var _utilsJs = require(_dependencyMap[2], \"./utils.js\");\n  // src/streamedQuery.ts\n\n  function streamedQuery(_ref) {\n    var streamFn = _ref.streamFn,\n      _ref$refetchMode = _ref.refetchMode,\n      refetchMode = _ref$refetchMode === void 0 ? \"reset\" : _ref$refetchMode,\n      _ref$reducer = _ref.reducer,\n      reducer = _ref$reducer === void 0 ? function (items, chunk) {\n        return (0, _utilsJs.addToEnd)(items, chunk);\n      } : _ref$reducer,\n      _ref$initialValue = _ref.initialValue,\n      initialValue = _ref$initialValue === void 0 ? [] : _ref$initialValue;\n    return /*#__PURE__*/function () {\n      var _ref2 = (0, _asyncToGenerator.default)(function* (context) {\n        var _context$client$getQu;\n        var query = context.client.getQueryCache().find({\n          queryKey: context.queryKey,\n          exact: true\n        });\n        var isRefetch = !!query && query.state.data !== void 0;\n        if (isRefetch && refetchMode === \"reset\") {\n          query.setState({\n            status: \"pending\",\n            data: void 0,\n            error: null,\n            fetchStatus: \"fetching\"\n          });\n        }\n        var result = initialValue;\n        var cancelled = false;\n        var streamFnContext = (0, _utilsJs.addConsumeAwareSignal)({\n          client: context.client,\n          meta: context.meta,\n          queryKey: context.queryKey,\n          pageParam: context.pageParam,\n          direction: context.direction\n        }, function () {\n          return context.signal;\n        }, function () {\n          return cancelled = true;\n        });\n        var stream = yield streamFn(streamFnContext);\n        var isReplaceRefetch = isRefetch && refetchMode === \"replace\";\n        var _iteratorAbruptCompletion = false;\n        var _didIteratorError = false;\n        var _iteratorError;\n        try {\n          var _loop = function* _loop() {\n            var chunk = _step.value;\n            {\n              if (cancelled) {\n                return 1; // break\n              }\n              if (isReplaceRefetch) {\n                result = reducer(result, chunk);\n              } else {\n                context.client.setQueryData(context.queryKey, function (prev) {\n                  return reducer(prev === void 0 ? initialValue : prev, chunk);\n                });\n              }\n            }\n          };\n          for (var _iterator = (0, _asyncIterator.default)(stream), _step; _iteratorAbruptCompletion = !(_step = yield _iterator.next()).done; _iteratorAbruptCompletion = false) {\n            if (yield* _loop()) break;\n          }\n        } catch (err) {\n          _didIteratorError = true;\n          _iteratorError = err;\n        } finally {\n          try {\n            if (_iteratorAbruptCompletion && _iterator.return != null) {\n              yield _iterator.return();\n            }\n          } finally {\n            if (_didIteratorError) {\n              throw _iteratorError;\n            }\n          }\n        }\n        if (isReplaceRefetch && !cancelled) {\n          context.client.setQueryData(context.queryKey, result);\n        }\n        return (_context$client$getQu = context.client.getQueryData(context.queryKey)) != null ? _context$client$getQu : initialValue;\n      });\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n  }\n});","lineCount":112,"map":[[12,2,54,0,"Object"],[12,8,54,0],[12,9,54,0,"defineProperty"],[12,23,54,0],[12,24,54,0,"exports"],[12,31,54,0],[13,4,54,0,"enumerable"],[13,14,54,0],[14,4,54,0,"get"],[14,7,54,0],[14,18,54,0,"get"],[14,19,54,0],[15,6,54,0],[15,13,55,2,"streamedQuery"],[15,26,55,15],[16,4,55,15],[17,2,55,15],[18,2,56,2],[18,6,56,2,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,56,2],[18,45,56,2,"require"],[18,52,56,2],[18,53,56,2,"_dependencyMap"],[18,67,56,2],[19,2,56,2],[19,6,56,2,"_asyncToGenerator"],[19,23,56,2],[19,26,56,2,"_interopDefault"],[19,41,56,2],[19,42,56,2,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,56,2],[20,2,56,2],[20,6,56,2,"_babelRuntimeHelpersAsyncIterator"],[20,39,56,2],[20,42,56,2,"require"],[20,49,56,2],[20,50,56,2,"_dependencyMap"],[20,64,56,2],[21,2,56,2],[21,6,56,2,"_asyncIterator"],[21,20,56,2],[21,23,56,2,"_interopDefault"],[21,38,56,2],[21,39,56,2,"_babelRuntimeHelpersAsyncIterator"],[21,72,56,2],[22,2,2,0],[22,6,2,0,"_utilsJs"],[22,14,2,0],[22,17,2,0,"require"],[22,24,2,0],[22,25,2,0,"_dependencyMap"],[22,39,2,0],[23,2,1,0],[25,2,3,0],[25,11,3,9,"streamedQuery"],[25,24,3,22,"streamedQuery"],[25,25,3,22,"_ref"],[25,29,3,22],[25,31,8,3],[26,4,8,3],[26,8,4,2,"streamFn"],[26,16,4,10],[26,19,4,10,"_ref"],[26,23,4,10],[26,24,4,2,"streamFn"],[26,32,4,10],[27,6,4,10,"_ref$refetchMode"],[27,22,4,10],[27,25,4,10,"_ref"],[27,29,4,10],[27,30,5,2,"refetchMode"],[27,41,5,13],[28,6,5,2,"refetchMode"],[28,17,5,13],[28,20,5,13,"_ref$refetchMode"],[28,36,5,13],[28,50,5,16],[28,57,5,23],[28,60,5,23,"_ref$refetchMode"],[28,76,5,23],[29,6,5,23,"_ref$reducer"],[29,18,5,23],[29,21,5,23,"_ref"],[29,25,5,23],[29,26,6,2,"reducer"],[29,33,6,9],[30,6,6,2,"reducer"],[30,13,6,9],[30,16,6,9,"_ref$reducer"],[30,28,6,9],[30,42,6,12],[30,52,6,13,"items"],[30,57,6,18],[30,59,6,20,"chunk"],[30,64,6,25],[31,8,6,25],[31,15,6,30],[31,19,6,30,"addToEnd"],[31,27,6,38],[31,28,6,38,"addToEnd"],[31,36,6,38],[31,38,6,39,"items"],[31,43,6,44],[31,45,6,46,"chunk"],[31,50,6,51],[31,51,6,52],[32,6,6,52],[32,10,6,52,"_ref$reducer"],[32,22,6,52],[33,6,6,52,"_ref$initialValue"],[33,23,6,52],[33,26,6,52,"_ref"],[33,30,6,52],[33,31,7,2,"initialValue"],[33,43,7,14],[34,6,7,2,"initialValue"],[34,18,7,14],[34,21,7,14,"_ref$initialValue"],[34,38,7,14],[34,52,7,17],[34,54,7,19],[34,57,7,19,"_ref$initialValue"],[34,74,7,19],[35,4,9,2],[36,6,9,2],[36,10,9,2,"_ref2"],[36,15,9,2],[36,22,9,2,"_asyncToGenerator"],[36,39,9,2],[36,40,9,2,"default"],[36,47,9,2],[36,49,9,9],[36,60,9,16,"context"],[36,67,9,23],[36,69,9,28],[37,8,9,28],[37,12,9,28,"_context$client$getQu"],[37,33,9,28],[38,8,10,4],[38,12,10,10,"query"],[38,17,10,15],[38,20,10,18,"context"],[38,27,10,25],[38,28,10,26,"client"],[38,34,10,32],[38,35,10,33,"getQueryCache"],[38,48,10,46],[38,49,10,47],[38,50,10,48],[38,51,10,49,"find"],[38,55,10,53],[38,56,10,54],[39,10,10,56,"queryKey"],[39,18,10,64],[39,20,10,66,"context"],[39,27,10,73],[39,28,10,74,"queryKey"],[39,36,10,82],[40,10,10,84,"exact"],[40,15,10,89],[40,17,10,91],[41,8,10,96],[41,9,10,97],[41,10,10,98],[42,8,11,4],[42,12,11,10,"isRefetch"],[42,21,11,19],[42,24,11,22],[42,25,11,23],[42,26,11,24,"query"],[42,31,11,29],[42,35,11,33,"query"],[42,40,11,38],[42,41,11,39,"state"],[42,46,11,44],[42,47,11,45,"data"],[42,51,11,49],[42,56,11,54],[42,61,11,59],[42,62,11,60],[43,8,12,4],[43,12,12,8,"isRefetch"],[43,21,12,17],[43,25,12,21,"refetchMode"],[43,36,12,32],[43,41,12,37],[43,48,12,44],[43,50,12,46],[44,10,13,6,"query"],[44,15,13,11],[44,16,13,12,"setState"],[44,24,13,20],[44,25,13,21],[45,12,14,8,"status"],[45,18,14,14],[45,20,14,16],[45,29,14,25],[46,12,15,8,"data"],[46,16,15,12],[46,18,15,14],[46,23,15,19],[46,24,15,20],[47,12,16,8,"error"],[47,17,16,13],[47,19,16,15],[47,23,16,19],[48,12,17,8,"fetchStatus"],[48,23,17,19],[48,25,17,21],[49,10,18,6],[49,11,18,7],[49,12,18,8],[50,8,19,4],[51,8,20,4],[51,12,20,8,"result"],[51,18,20,14],[51,21,20,17,"initialValue"],[51,33,20,29],[52,8,21,4],[52,12,21,8,"cancelled"],[52,21,21,17],[52,24,21,20],[52,29,21,25],[53,8,22,4],[53,12,22,10,"streamFnContext"],[53,27,22,25],[53,30,22,28],[53,34,22,28,"addConsumeAwareSignal"],[53,42,22,49],[53,43,22,49,"addConsumeAwareSignal"],[53,64,22,49],[53,66,23,6],[54,10,24,8,"client"],[54,16,24,14],[54,18,24,16,"context"],[54,25,24,23],[54,26,24,24,"client"],[54,32,24,30],[55,10,25,8,"meta"],[55,14,25,12],[55,16,25,14,"context"],[55,23,25,21],[55,24,25,22,"meta"],[55,28,25,26],[56,10,26,8,"queryKey"],[56,18,26,16],[56,20,26,18,"context"],[56,27,26,25],[56,28,26,26,"queryKey"],[56,36,26,34],[57,10,27,8,"pageParam"],[57,19,27,17],[57,21,27,19,"context"],[57,28,27,26],[57,29,27,27,"pageParam"],[57,38,27,36],[58,10,28,8,"direction"],[58,19,28,17],[58,21,28,19,"context"],[58,28,28,26],[58,29,28,27,"direction"],[59,8,29,6],[59,9,29,7],[59,11,30,6],[60,10,30,6],[60,17,30,12,"context"],[60,24,30,19],[60,25,30,20,"signal"],[60,31,30,26],[61,8,30,26],[61,11,31,6],[62,10,31,6],[62,17,31,12,"cancelled"],[62,26,31,21],[62,29,31,24],[62,33,31,28],[63,8,31,28],[63,9,32,4],[63,10,32,5],[64,8,33,4],[64,12,33,10,"stream"],[64,18,33,16],[64,27,33,25,"streamFn"],[64,35,33,33],[64,36,33,34,"streamFnContext"],[64,51,33,49],[64,52,33,50],[65,8,34,4],[65,12,34,10,"isReplaceRefetch"],[65,28,34,26],[65,31,34,29,"isRefetch"],[65,40,34,38],[65,44,34,42,"refetchMode"],[65,55,34,53],[65,60,34,58],[65,69,34,67],[66,8,34,68],[66,12,34,68,"_iteratorAbruptCompletion"],[66,37,34,68],[67,8,34,68],[67,12,34,68,"_didIteratorError"],[67,29,34,68],[68,8,34,68],[68,12,34,68,"_iteratorError"],[68,26,34,68],[69,8,34,68],[70,10,34,68],[70,14,34,68,"_loop"],[70,19,34,68],[70,32,34,68,"_loop"],[70,38,34,68],[70,40,35,38],[71,12,35,38],[71,16,35,21,"chunk"],[71,21,35,26],[71,24,35,26,"_step"],[71,29,35,26],[71,30,35,26,"value"],[71,35,35,26],[72,12,35,26],[73,14,36,6],[73,18,36,10,"cancelled"],[73,27,36,19],[73,29,36,21],[74,16,36,21],[75,14,38,6],[76,14,39,6],[76,18,39,10,"isReplaceRefetch"],[76,34,39,26],[76,36,39,28],[77,16,40,8,"result"],[77,22,40,14],[77,25,40,17,"reducer"],[77,32,40,24],[77,33,40,25,"result"],[77,39,40,31],[77,41,40,33,"chunk"],[77,46,40,38],[77,47,40,39],[78,14,41,6],[78,15,41,7],[78,21,41,13],[79,16,42,8,"context"],[79,23,42,15],[79,24,42,16,"client"],[79,30,42,22],[79,31,42,23,"setQueryData"],[79,43,42,35],[79,44,43,10,"context"],[79,51,43,17],[79,52,43,18,"queryKey"],[79,60,43,26],[79,62,44,10],[79,72,44,11,"prev"],[79,76,44,15],[80,18,44,15],[80,25,44,20,"reducer"],[80,32,44,27],[80,33,44,28,"prev"],[80,37,44,32],[80,42,44,37],[80,47,44,42],[80,48,44,43],[80,51,44,46,"initialValue"],[80,63,44,58],[80,66,44,61,"prev"],[80,70,44,65],[80,72,44,67,"chunk"],[80,77,44,72],[80,78,44,73],[81,16,44,73],[81,17,45,8],[81,18,45,9],[82,14,46,6],[83,12,46,7],[84,10,47,4],[84,11,47,5],[85,10,35,4],[85,19,35,4,"_iterator"],[85,28,35,4],[85,35,35,4,"_asyncIterator"],[85,49,35,4],[85,50,35,4,"default"],[85,57,35,4],[85,59,35,30,"stream"],[85,65,35,36],[85,68,35,36,"_step"],[85,73,35,36],[85,75,35,36,"_iteratorAbruptCompletion"],[85,100,35,36],[85,105,35,36,"_step"],[85,110,35,36],[85,119,35,36,"_iterator"],[85,128,35,36],[85,129,35,36,"next"],[85,133,35,36],[85,137,35,36,"done"],[85,141,35,36],[85,143,35,36,"_iteratorAbruptCompletion"],[85,168,35,36],[86,12,35,36],[86,23,35,36,"_loop"],[86,28,35,36],[86,32,37,8],[87,10,37,14],[88,8,47,5],[88,17,47,5,"err"],[88,20,47,5],[89,10,47,5,"_didIteratorError"],[89,27,47,5],[90,10,47,5,"_iteratorError"],[90,24,47,5],[90,27,47,5,"err"],[90,30,47,5],[91,8,47,5],[92,10,47,5],[93,12,47,5],[93,16,47,5,"_iteratorAbruptCompletion"],[93,41,47,5],[93,45,47,5,"_iterator"],[93,54,47,5],[93,55,47,5,"return"],[93,61,47,5],[94,14,47,5],[94,20,47,5,"_iterator"],[94,29,47,5],[94,30,47,5,"return"],[94,36,47,5],[95,12,47,5],[96,10,47,5],[97,12,47,5],[97,16,47,5,"_didIteratorError"],[97,33,47,5],[98,14,47,5],[98,20,47,5,"_iteratorError"],[98,34,47,5],[99,12,47,5],[100,10,47,5],[101,8,47,5],[102,8,48,4],[102,12,48,8,"isReplaceRefetch"],[102,28,48,24],[102,32,48,28],[102,33,48,29,"cancelled"],[102,42,48,38],[102,44,48,40],[103,10,49,6,"context"],[103,17,49,13],[103,18,49,14,"client"],[103,24,49,20],[103,25,49,21,"setQueryData"],[103,37,49,33],[103,38,49,34,"context"],[103,45,49,41],[103,46,49,42,"queryKey"],[103,54,49,50],[103,56,49,52,"result"],[103,62,49,58],[103,63,49,59],[104,8,50,4],[105,8,51,4],[105,16,51,4,"_context$client$getQu"],[105,37,51,4],[105,40,51,11,"context"],[105,47,51,18],[105,48,51,19,"client"],[105,54,51,25],[105,55,51,26,"getQueryData"],[105,67,51,38],[105,68,51,39,"context"],[105,75,51,46],[105,76,51,47,"queryKey"],[105,84,51,55],[105,85,51,56],[105,97,51,56,"_context$client$getQu"],[105,118,51,56],[105,121,51,60,"initialValue"],[105,133,51,72],[106,6,52,2],[106,7,52,3],[107,6,52,3],[107,23,52,3,"_x"],[107,25,52,3],[108,8,52,3],[108,15,52,3,"_ref2"],[108,20,52,3],[108,21,52,3,"apply"],[108,26,52,3],[108,33,52,3,"arguments"],[108,42,52,3],[109,6,52,3],[110,4,52,3],[111,2,53,0],[112,0,53,1],[112,3]],"functionMap":{"names":["<global>","streamedQuery","<anonymous>","addConsumeAwareSignal$argument_1","addConsumeAwareSignal$argument_2","context.client.setQueryData$argument_1"],"mappings":"AAA;ACE;YCG,wCD;SCG;MCqB,oBD;MEC,sBF;UGa,+DH;GDQ;CDC"},"hasCjsExports":false},"type":"js/module"}]}
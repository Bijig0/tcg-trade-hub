{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":49,"index":49}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":50},"end":{"line":2,"column":42,"index":92}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":93},"end":{"line":3,"column":43,"index":136}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}},{"name":"../../algorithm/transformRawListing/transformRawListing","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":137},"end":{"line":4,"column":90,"index":227}}],"key":"r8X/l37NUzIp9LCyUpeWLBMlkwc=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1], \"@tanstack/react-query\");\n  var _libSupabase = require(_dependencyMap[2], \"@/lib/supabase\");\n  var _queryKeys = require(_dependencyMap[3], \"../../queryKeys\");\n  var _algorithmTransformRawListingTransformRawListing = require(_dependencyMap[4], \"../../algorithm/transformRawListing/transformRawListing\");\n  var transformRawListing = _interopDefault(_algorithmTransformRawListingTransformRawListing);\n  /**\n   * Queries all active listings containing a specific card by `card_external_id`.\n   *\n   * Splits results into:\n   * - singles: listings with exactly 1 item (the matched card)\n   * - bundles: listings with >1 items that include the matched card\n   */\n  var useCardListings = externalId => {\n    _s();\n    return (0, _tanstackReactQuery.useQuery)({\n      queryKey: _queryKeys.feedKeys.cardListings(externalId),\n      queryFn: function () {\n        var _ref = (0, _asyncToGenerator.default)(function* () {\n          var _yield$supabase$from$ = yield _libSupabase.supabase.from('listing_items').select(`\n          *,\n          listing:listings!inner (\n            *,\n            listing_items (*),\n            users!inner (\n              id,\n              display_name,\n              avatar_url,\n              location,\n              rating_score,\n              total_trades\n            )\n          )\n        `).eq('card_external_id', externalId).eq('listing.status', 'active'),\n            data = _yield$supabase$from$.data,\n            error = _yield$supabase$from$.error;\n          if (error) {\n            console.error('[useCardListings] Supabase query error:', error);\n            throw error;\n          }\n          var all = (data ?? []).map(row => (0, transformRawListing.default)(row.listing));\n\n          // Deduplicate by listing id (a bundle may have multiple matching items)\n          var seen = new Set();\n          var unique = all.filter(listing => {\n            if (seen.has(listing.id)) return false;\n            seen.add(listing.id);\n            return true;\n          });\n          return {\n            singles: unique.filter(l => l.items.length === 1),\n            bundles: unique.filter(l => l.items.length > 1)\n          };\n        });\n        return function queryFn() {\n          return _ref.apply(this, arguments);\n        };\n      }(),\n      enabled: externalId.length > 0\n    });\n  };\n  _s(useCardListings, \"4ZpngI1uv+Uo3WQHEZmTQ5FNM+k=\", false, function () {\n    return [_tanstackReactQuery.useQuery];\n  });\n  var _default = useCardListings;\n});","lineCount":85,"map":[[13,2,70,0,"Object"],[13,8,70,0],[13,9,70,0,"defineProperty"],[13,23,70,0],[13,24,70,0,"exports"],[13,31,70,0],[14,4,70,0,"enumerable"],[14,14,70,0],[15,4,70,0,"get"],[15,7,70,0],[15,18,70,0,"get"],[15,19,70,0],[16,6,70,0],[16,13,70,0,"_default"],[16,21,70,0],[17,4,70,0],[18,2,70,0],[19,2,70,31],[19,6,70,31,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,70,31],[19,45,70,31,"require"],[19,52,70,31],[19,53,70,31,"_dependencyMap"],[19,67,70,31],[20,2,70,31],[20,6,70,31,"_asyncToGenerator"],[20,23,70,31],[20,26,70,31,"_interopDefault"],[20,41,70,31],[20,42,70,31,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,70,31],[21,2,1,0],[21,6,1,0,"_tanstackReactQuery"],[21,25,1,0],[21,28,1,0,"require"],[21,35,1,0],[21,36,1,0,"_dependencyMap"],[21,50,1,0],[22,2,2,0],[22,6,2,0,"_libSupabase"],[22,18,2,0],[22,21,2,0,"require"],[22,28,2,0],[22,29,2,0,"_dependencyMap"],[22,43,2,0],[23,2,3,0],[23,6,3,0,"_queryKeys"],[23,16,3,0],[23,19,3,0,"require"],[23,26,3,0],[23,27,3,0,"_dependencyMap"],[23,41,3,0],[24,2,4,0],[24,6,4,0,"_algorithmTransformRawListingTransformRawListing"],[24,54,4,0],[24,57,4,0,"require"],[24,64,4,0],[24,65,4,0,"_dependencyMap"],[24,79,4,0],[25,2,4,0],[25,6,4,0,"transformRawListing"],[25,25,4,0],[25,28,4,0,"_interopDefault"],[25,43,4,0],[25,44,4,0,"_algorithmTransformRawListingTransformRawListing"],[25,92,4,0],[26,2,13,0],[27,0,14,0],[28,0,15,0],[29,0,16,0],[30,0,17,0],[31,0,18,0],[32,0,19,0],[33,2,20,0],[33,6,20,6,"useCardListings"],[33,21,20,21],[33,24,20,25,"externalId"],[33,34,20,43],[33,38,20,48],[34,4,20,48,"_s"],[34,6,20,48],[35,4,21,2],[35,11,21,9],[35,15,21,9,"useQuery"],[35,34,21,17],[35,35,21,17,"useQuery"],[35,43,21,17],[35,45,21,45],[36,6,22,4,"queryKey"],[36,14,22,12],[36,16,22,14,"feedKeys"],[36,26,22,22],[36,27,22,22,"feedKeys"],[36,35,22,22],[36,36,22,23,"cardListings"],[36,48,22,35],[36,49,22,36,"externalId"],[36,59,22,46],[36,60,22,47],[37,6,23,4,"queryFn"],[37,13,23,11],[38,8,23,11],[38,12,23,11,"_ref"],[38,16,23,11],[38,23,23,11,"_asyncToGenerator"],[38,40,23,11],[38,41,23,11,"default"],[38,48,23,11],[38,50,23,13],[38,63,23,25],[39,10,24,6],[39,14,24,6,"_yield$supabase$from$"],[39,35,24,6],[39,44,24,36,"supabase"],[39,56,24,44],[39,57,24,44,"supabase"],[39,65,24,44],[39,66,25,9,"from"],[39,70,25,13],[39,71,25,14],[39,86,25,29],[39,87,25,30],[39,88,26,9,"select"],[39,94,26,15],[39,95,26,16],[40,0,27,0],[41,0,28,0],[42,0,29,0],[43,0,30,0],[44,0,31,0],[45,0,32,0],[46,0,33,0],[47,0,34,0],[48,0,35,0],[49,0,36,0],[50,0,37,0],[51,0,38,0],[52,0,39,0],[53,0,40,0],[53,9,40,9],[53,10,40,10],[53,11,41,9,"eq"],[53,13,41,11],[53,14,41,12],[53,32,41,30],[53,34,41,32,"externalId"],[53,44,41,42],[53,45,41,43],[53,46,42,9,"eq"],[53,48,42,11],[53,49,42,12],[53,65,42,28],[53,67,42,30],[53,75,42,38],[53,76,42,39],[54,12,24,14,"data"],[54,16,24,18],[54,19,24,18,"_yield$supabase$from$"],[54,40,24,18],[54,41,24,14,"data"],[54,45,24,18],[55,12,24,20,"error"],[55,17,24,25],[55,20,24,25,"_yield$supabase$from$"],[55,41,24,25],[55,42,24,20,"error"],[55,47,24,25],[56,10,44,6],[56,14,44,10,"error"],[56,19,44,15],[56,21,44,17],[57,12,45,8,"console"],[57,19,45,15],[57,20,45,16,"error"],[57,25,45,21],[57,26,45,22],[57,67,45,63],[57,69,45,65,"error"],[57,74,45,70],[57,75,45,71],[58,12,46,8],[58,18,46,14,"error"],[58,23,46,19],[59,10,47,6],[60,10,49,6],[60,14,49,12,"all"],[60,17,49,15],[60,20,49,18],[60,21,49,19,"data"],[60,25,49,23],[60,29,49,27],[60,31,49,29],[60,33,49,31,"map"],[60,36,49,34],[60,37,49,36,"row"],[60,40,49,39],[60,44,50,8],[60,48,50,8,"transformRawListing"],[60,67,50,27],[60,68,50,27,"default"],[60,75,50,27],[60,77,50,28,"row"],[60,80,50,31],[60,81,50,32,"listing"],[60,88,50,68],[60,89,51,6],[60,90,51,7],[62,10,53,6],[63,10,54,6],[63,14,54,12,"seen"],[63,18,54,16],[63,21,54,19],[63,25,54,23,"Set"],[63,28,54,26],[63,29,54,35],[63,30,54,36],[64,10,55,6],[64,14,55,12,"unique"],[64,20,55,18],[64,23,55,21,"all"],[64,26,55,24],[64,27,55,25,"filter"],[64,33,55,31],[64,34,55,33,"listing"],[64,41,55,40],[64,45,55,45],[65,12,56,8],[65,16,56,12,"seen"],[65,20,56,16],[65,21,56,17,"has"],[65,24,56,20],[65,25,56,21,"listing"],[65,32,56,28],[65,33,56,29,"id"],[65,35,56,31],[65,36,56,32],[65,38,56,34],[65,45,56,41],[65,50,56,46],[66,12,57,8,"seen"],[66,16,57,12],[66,17,57,13,"add"],[66,20,57,16],[66,21,57,17,"listing"],[66,28,57,24],[66,29,57,25,"id"],[66,31,57,27],[66,32,57,28],[67,12,58,8],[67,19,58,15],[67,23,58,19],[68,10,59,6],[68,11,59,7],[68,12,59,8],[69,10,61,6],[69,17,61,13],[70,12,62,8,"singles"],[70,19,62,15],[70,21,62,17,"unique"],[70,27,62,23],[70,28,62,24,"filter"],[70,34,62,30],[70,35,62,32,"l"],[70,36,62,33],[70,40,62,38,"l"],[70,41,62,39],[70,42,62,40,"items"],[70,47,62,45],[70,48,62,46,"length"],[70,54,62,52],[70,59,62,57],[70,60,62,58],[70,61,62,59],[71,12,63,8,"bundles"],[71,19,63,15],[71,21,63,17,"unique"],[71,27,63,23],[71,28,63,24,"filter"],[71,34,63,30],[71,35,63,32,"l"],[71,36,63,33],[71,40,63,38,"l"],[71,41,63,39],[71,42,63,40,"items"],[71,47,63,45],[71,48,63,46,"length"],[71,54,63,52],[71,57,63,55],[71,58,63,56],[72,10,64,6],[72,11,64,7],[73,8,65,4],[73,9,65,5],[74,8,65,5],[74,24,23,4,"queryFn"],[74,31,23,11,"queryFn"],[74,32,23,11],[75,10,23,11],[75,17,23,11,"_ref"],[75,21,23,11],[75,22,23,11,"apply"],[75,27,23,11],[75,34,23,11,"arguments"],[75,43,23,11],[76,8,23,11],[77,6,23,11],[77,9,65,5],[78,6,66,4,"enabled"],[78,13,66,11],[78,15,66,13,"externalId"],[78,25,66,23],[78,26,66,24,"length"],[78,32,66,30],[78,35,66,33],[79,4,67,2],[79,5,67,3],[79,6,67,4],[80,2,68,0],[80,3,68,1],[81,2,68,2,"_s"],[81,4,68,2],[81,5,20,6,"useCardListings"],[81,20,20,21],[82,4,20,21],[82,12,21,9,"useQuery"],[82,31,21,17],[82,32,21,17,"useQuery"],[82,40,21,17],[83,2,21,17],[84,2,70,0],[84,6,70,0,"_default"],[84,14,70,0],[84,17,70,15,"useCardListings"],[84,32,70,30],[85,0,70,31],[85,3]],"functionMap":{"names":["<global>","useCardListings","useQuery$argument_0.queryFn","map$argument_0","all.filter$argument_0","unique.filter$argument_0"],"mappings":"AAA;wBCmB;aCG;mCC0B;qEDC;gCEK;OFI;+BGG,2BH;+BGC,yBH;KDE;CDG"},"hasCjsExports":false},"type":"js/module"}]}
{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":68,"index":68}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":69},"end":{"line":2,"column":42,"index":111}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":112},"end":{"line":3,"column":46,"index":158}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0]);\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1]);\n  var _libSupabase = require(_dependencyMap[2]);\n  var _queryKeys = require(_dependencyMap[3]);\n  /**\n   * Mutation hook that creates an offer on a listing via atomic Postgres RPC.\n   *\n   * Atomically inserts an offer row and all offer_items in a single transaction.\n   *\n   * @see packages/api/src/pipelines/createOffer/createOffer.ts\n   */\n  var useCreateOffer = () => {\n    var queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    return (0, _tanstackReactQuery.useMutation)({\n      mutationFn: function () {\n        var _ref2 = (0, _asyncToGenerator.default)(function* (_ref) {\n          var listingId = _ref.listingId,\n            selectedCards = _ref.selectedCards,\n            cashAmount = _ref.cashAmount,\n            message = _ref.message;\n          var _yield$supabase$auth$ = yield _libSupabase.supabase.auth.getSession(),\n            session = _yield$supabase$auth$.data.session;\n          var user = session?.user ?? null;\n          if (!user) throw new Error('User not authenticated');\n          var items = selectedCards.map(sc => ({\n            card_name: sc.card.name,\n            card_image_url: sc.card.imageUrl,\n            card_external_id: sc.card.externalId,\n            tcg: sc.card.tcg,\n            card_set: sc.card.setName,\n            card_number: sc.card.number,\n            condition: sc.condition,\n            market_price: sc.card.marketPrice ?? null,\n            quantity: 1\n          }));\n          var _yield$supabase$rpc = yield _libSupabase.supabase.rpc('create_offer_v1', {\n              p_listing_id: listingId,\n              p_offerer_id: user.id,\n              p_cash_amount: cashAmount,\n              p_message: message ?? '',\n              p_items: JSON.stringify(items)\n            }),\n            data = _yield$supabase$rpc.data,\n            error = _yield$supabase$rpc.error;\n          if (error) throw error;\n          return data;\n        });\n        return function mutationFn(_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }(),\n      onSuccess: (_, variables) => {\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.offers(variables.listingId)\n        });\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.detail(variables.listingId)\n        });\n      }\n    });\n  };\n  var _default = useCreateOffer;\n});","lineCount":81,"map":[[12,2,67,0,"Object"],[12,8,67,0],[12,9,67,0,"defineProperty"],[12,23,67,0],[12,24,67,0,"exports"],[12,31,67,0],[13,4,67,0,"enumerable"],[13,14,67,0],[14,4,67,0,"get"],[14,7,67,0],[14,18,67,0,"get"],[14,19,67,0],[15,6,67,0],[15,13,67,0,"_default"],[15,21,67,0],[16,4,67,0],[17,2,67,0],[18,2,67,30],[18,6,67,30,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,67,30],[18,45,67,30,"require"],[18,52,67,30],[18,53,67,30,"_dependencyMap"],[18,67,67,30],[19,2,67,30],[19,6,67,30,"_asyncToGenerator"],[19,23,67,30],[19,26,67,30,"_interopDefault"],[19,41,67,30],[19,42,67,30,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,67,30],[20,2,1,0],[20,6,1,0,"_tanstackReactQuery"],[20,25,1,0],[20,28,1,0,"require"],[20,35,1,0],[20,36,1,0,"_dependencyMap"],[20,50,1,0],[21,2,2,0],[21,6,2,0,"_libSupabase"],[21,18,2,0],[21,21,2,0,"require"],[21,28,2,0],[21,29,2,0,"_dependencyMap"],[21,43,2,0],[22,2,3,0],[22,6,3,0,"_queryKeys"],[22,16,3,0],[22,19,3,0,"require"],[22,26,3,0],[22,27,3,0,"_dependencyMap"],[22,41,3,0],[23,2,17,0],[24,0,18,0],[25,0,19,0],[26,0,20,0],[27,0,21,0],[28,0,22,0],[29,0,23,0],[30,2,24,0],[30,6,24,6,"useCreateOffer"],[30,20,24,20],[30,23,24,23,"useCreateOffer"],[30,24,24,23],[30,29,24,29],[31,4,25,2],[31,8,25,8,"queryClient"],[31,19,25,19],[31,22,25,22],[31,26,25,22,"useQueryClient"],[31,45,25,36],[31,46,25,36,"useQueryClient"],[31,60,25,36],[31,62,25,37],[31,63,25,38],[32,4,27,2],[32,11,27,9],[32,15,27,9,"useMutation"],[32,34,27,20],[32,35,27,20,"useMutation"],[32,46,27,20],[32,48,27,65],[33,6,28,4,"mutationFn"],[33,16,28,14],[34,8,28,14],[34,12,28,14,"_ref2"],[34,17,28,14],[34,24,28,14,"_asyncToGenerator"],[34,41,28,14],[34,42,28,14,"default"],[34,49,28,14],[34,51,28,16],[34,62,28,16,"_ref"],[34,66,28,16],[34,68,28,77],[35,10,28,77],[35,14,28,25,"listingId"],[35,23,28,34],[35,26,28,34,"_ref"],[35,30,28,34],[35,31,28,25,"listingId"],[35,40,28,34],[36,12,28,36,"selectedCards"],[36,25,28,49],[36,28,28,49,"_ref"],[36,32,28,49],[36,33,28,36,"selectedCards"],[36,46,28,49],[37,12,28,51,"cashAmount"],[37,22,28,61],[37,25,28,61,"_ref"],[37,29,28,61],[37,30,28,51,"cashAmount"],[37,40,28,61],[38,12,28,63,"message"],[38,19,28,70],[38,22,28,70,"_ref"],[38,26,28,70],[38,27,28,63,"message"],[38,34,28,70],[39,10,29,6],[39,14,29,6,"_yield$supabase$auth$"],[39,35,29,6],[39,44,31,16,"supabase"],[39,56,31,24],[39,57,31,24,"supabase"],[39,65,31,24],[39,66,31,25,"auth"],[39,70,31,29],[39,71,31,30,"getSession"],[39,81,31,40],[39,82,31,41],[39,83,31,42],[40,12,30,16,"session"],[40,19,30,23],[40,22,30,23,"_yield$supabase$auth$"],[40,43,30,23],[40,44,30,8,"data"],[40,48,30,12],[40,49,30,16,"session"],[40,56,30,23],[41,10,32,6],[41,14,32,12,"user"],[41,18,32,16],[41,21,32,19,"session"],[41,28,32,26],[41,30,32,28,"user"],[41,34,32,32],[41,38,32,36],[41,42,32,40],[42,10,34,6],[42,14,34,10],[42,15,34,11,"user"],[42,19,34,15],[42,21,34,17],[42,27,34,23],[42,31,34,27,"Error"],[42,36,34,32],[42,37,34,33],[42,61,34,57],[42,62,34,58],[43,10,36,6],[43,14,36,12,"items"],[43,19,36,17],[43,22,36,20,"selectedCards"],[43,35,36,33],[43,36,36,34,"map"],[43,39,36,37],[43,40,36,39,"sc"],[43,42,36,41],[43,47,36,47],[44,12,37,8,"card_name"],[44,21,37,17],[44,23,37,19,"sc"],[44,25,37,21],[44,26,37,22,"card"],[44,30,37,26],[44,31,37,27,"name"],[44,35,37,31],[45,12,38,8,"card_image_url"],[45,26,38,22],[45,28,38,24,"sc"],[45,30,38,26],[45,31,38,27,"card"],[45,35,38,31],[45,36,38,32,"imageUrl"],[45,44,38,40],[46,12,39,8,"card_external_id"],[46,28,39,24],[46,30,39,26,"sc"],[46,32,39,28],[46,33,39,29,"card"],[46,37,39,33],[46,38,39,34,"externalId"],[46,48,39,44],[47,12,40,8,"tcg"],[47,15,40,11],[47,17,40,13,"sc"],[47,19,40,15],[47,20,40,16,"card"],[47,24,40,20],[47,25,40,21,"tcg"],[47,28,40,24],[48,12,41,8,"card_set"],[48,20,41,16],[48,22,41,18,"sc"],[48,24,41,20],[48,25,41,21,"card"],[48,29,41,25],[48,30,41,26,"setName"],[48,37,41,33],[49,12,42,8,"card_number"],[49,23,42,19],[49,25,42,21,"sc"],[49,27,42,23],[49,28,42,24,"card"],[49,32,42,28],[49,33,42,29,"number"],[49,39,42,35],[50,12,43,8,"condition"],[50,21,43,17],[50,23,43,19,"sc"],[50,25,43,21],[50,26,43,22,"condition"],[50,35,43,31],[51,12,44,8,"market_price"],[51,24,44,20],[51,26,44,22,"sc"],[51,28,44,24],[51,29,44,25,"card"],[51,33,44,29],[51,34,44,30,"marketPrice"],[51,45,44,41],[51,49,44,45],[51,53,44,49],[52,12,45,8,"quantity"],[52,20,45,16],[52,22,45,18],[53,10,46,6],[53,11,46,7],[53,12,46,8],[53,13,46,9],[54,10,48,6],[54,14,48,6,"_yield$supabase$rpc"],[54,33,48,6],[54,42,48,36,"supabase"],[54,54,48,44],[54,55,48,44,"supabase"],[54,63,48,44],[54,64,48,45,"rpc"],[54,67,48,48],[54,68,48,49],[54,85,48,66],[54,87,48,68],[55,14,49,8,"p_listing_id"],[55,26,49,20],[55,28,49,22,"listingId"],[55,37,49,31],[56,14,50,8,"p_offerer_id"],[56,26,50,20],[56,28,50,22,"user"],[56,32,50,26],[56,33,50,27,"id"],[56,35,50,29],[57,14,51,8,"p_cash_amount"],[57,27,51,21],[57,29,51,23,"cashAmount"],[57,39,51,33],[58,14,52,8,"p_message"],[58,23,52,17],[58,25,52,19,"message"],[58,32,52,26],[58,36,52,30],[58,38,52,32],[59,14,53,8,"p_items"],[59,21,53,15],[59,23,53,17,"JSON"],[59,27,53,21],[59,28,53,22,"stringify"],[59,37,53,31],[59,38,53,32,"items"],[59,43,53,37],[60,12,54,6],[60,13,54,7],[60,14,54,8],[61,12,48,14,"data"],[61,16,48,18],[61,19,48,18,"_yield$supabase$rpc"],[61,38,48,18],[61,39,48,14,"data"],[61,43,48,18],[62,12,48,20,"error"],[62,17,48,25],[62,20,48,25,"_yield$supabase$rpc"],[62,39,48,25],[62,40,48,20,"error"],[62,45,48,25],[63,10,56,6],[63,14,56,10,"error"],[63,19,56,15],[63,21,56,17],[63,27,56,23,"error"],[63,32,56,28],[64,10,58,6],[64,17,58,13,"data"],[64,21,58,17],[65,8,59,4],[65,9,59,5],[66,8,59,5],[66,24,28,4,"mutationFn"],[66,34,28,14,"mutationFn"],[66,35,28,14,"_x"],[66,37,28,14],[67,10,28,14],[67,17,28,14,"_ref2"],[67,22,28,14],[67,23,28,14,"apply"],[67,28,28,14],[67,35,28,14,"arguments"],[67,44,28,14],[68,8,28,14],[69,6,28,14],[69,9,59,5],[70,6,60,4,"onSuccess"],[70,15,60,13],[70,17,60,15,"onSuccess"],[70,18,60,16,"_"],[70,19,60,17],[70,21,60,19,"variables"],[70,30,60,28],[70,35,60,33],[71,8,61,6,"queryClient"],[71,19,61,17],[71,20,61,18,"invalidateQueries"],[71,37,61,35],[71,38,61,36],[72,10,61,38,"queryKey"],[72,18,61,46],[72,20,61,48,"listingKeys"],[72,30,61,59],[72,31,61,59,"listingKeys"],[72,42,61,59],[72,43,61,60,"offers"],[72,49,61,66],[72,50,61,67,"variables"],[72,59,61,76],[72,60,61,77,"listingId"],[72,69,61,86],[73,8,61,88],[73,9,61,89],[73,10,61,90],[74,8,62,6,"queryClient"],[74,19,62,17],[74,20,62,18,"invalidateQueries"],[74,37,62,35],[74,38,62,36],[75,10,62,38,"queryKey"],[75,18,62,46],[75,20,62,48,"listingKeys"],[75,30,62,59],[75,31,62,59,"listingKeys"],[75,42,62,59],[75,43,62,60,"detail"],[75,49,62,66],[75,50,62,67,"variables"],[75,59,62,76],[75,60,62,77,"listingId"],[75,69,62,86],[76,8,62,88],[76,9,62,89],[76,10,62,90],[77,6,63,4],[78,4,64,2],[78,5,64,3],[78,6,64,4],[79,2,65,0],[79,3,65,1],[80,2,67,0],[80,6,67,0,"_default"],[80,14,67,0],[80,17,67,15,"useCreateOffer"],[80,31,67,29],[81,0,67,30],[81,3]],"functionMap":{"names":["<global>","useCreateOffer","useMutation$argument_0.mutationFn","selectedCards.map$argument_0","useMutation$argument_0.onSuccess"],"mappings":"AAA;uBCuB;gBCI;sCCQ;QDU;KDa;eGC;KHG;CDE"},"hasCjsExports":false},"type":"js/module"}]}
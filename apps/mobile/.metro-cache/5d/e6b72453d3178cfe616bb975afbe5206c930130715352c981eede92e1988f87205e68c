{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":68,"index":68}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":69},"end":{"line":2,"column":42,"index":111}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":112},"end":{"line":3,"column":46,"index":158}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}},{"name":"@/services/devLiveEmitter/devLiveEmitter","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":210},"end":{"line":5,"column":85,"index":295}}],"key":"+12q/uGkja92D/Tp4S2X61mlsvU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0]);\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1]);\n  var _libSupabase = require(_dependencyMap[2]);\n  var _queryKeys = require(_dependencyMap[3]);\n  var _servicesDevLiveEmitterDevLiveEmitter = require(_dependencyMap[4]);\n  /**\n   * Mutation hook that creates an offer on a listing via atomic Postgres RPC.\n   *\n   * Atomically inserts an offer row and all offer_items in a single transaction.\n   *\n   * @see packages/api/src/pipelines/createOffer/createOffer.ts\n   */\n  var useCreateOffer = () => {\n    var queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    return (0, _tanstackReactQuery.useMutation)({\n      mutationFn: function () {\n        var _ref2 = (0, _asyncToGenerator.default)(function* (_ref) {\n          var listingId = _ref.listingId,\n            selectedCards = _ref.selectedCards,\n            cashAmount = _ref.cashAmount,\n            offeringNote = _ref.offeringNote;\n          var scoped = undefined;\n          scoped?.(0, 'started');\n          var _yield$supabase$auth$ = yield _libSupabase.supabase.auth.getSession(),\n            session = _yield$supabase$auth$.data.session;\n          var user = session?.user ?? null;\n          if (!user) throw new Error('User not authenticated');\n          var items = selectedCards.map(sc => ({\n            card_name: sc.card.name,\n            card_image_url: sc.card.imageUrl,\n            card_external_id: sc.card.externalId,\n            tcg: sc.card.tcg,\n            card_set: sc.card.setName,\n            card_number: sc.card.number,\n            condition: sc.condition,\n            market_price: sc.card.marketPrice ?? null,\n            quantity: 1\n          }));\n          try {\n            var _yield$supabase$rpc = yield _libSupabase.supabase.rpc('create_offer_v1', {\n                p_listing_id: listingId,\n                p_offerer_id: user.id,\n                p_cash_amount: cashAmount,\n                p_offerer_note: offeringNote ?? '',\n                p_items: JSON.stringify(items)\n              }),\n              data = _yield$supabase$rpc.data,\n              error = _yield$supabase$rpc.error;\n            if (error) throw error;\n            scoped?.(0, 'success');\n            return data;\n          } catch (err) {\n            scoped?.(0, 'error', {\n              message: err.message\n            });\n            throw err;\n          }\n        });\n        return function mutationFn(_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }(),\n      onSuccess: (_, variables) => {\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.offers(variables.listingId)\n        });\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.detail(variables.listingId)\n        });\n      }\n    });\n  };\n  var _default = useCreateOffer;\n});","lineCount":92,"map":[[12,2,80,0,"Object"],[12,8,80,0],[12,9,80,0,"defineProperty"],[12,23,80,0],[12,24,80,0,"exports"],[12,31,80,0],[13,4,80,0,"enumerable"],[13,14,80,0],[14,4,80,0,"get"],[14,7,80,0],[14,18,80,0,"get"],[14,19,80,0],[15,6,80,0],[15,13,80,0,"_default"],[15,21,80,0],[16,4,80,0],[17,2,80,0],[18,2,80,30],[18,6,80,30,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,80,30],[18,45,80,30,"require"],[18,52,80,30],[18,53,80,30,"_dependencyMap"],[18,67,80,30],[19,2,80,30],[19,6,80,30,"_asyncToGenerator"],[19,23,80,30],[19,26,80,30,"_interopDefault"],[19,41,80,30],[19,42,80,30,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,80,30],[20,2,1,0],[20,6,1,0,"_tanstackReactQuery"],[20,25,1,0],[20,28,1,0,"require"],[20,35,1,0],[20,36,1,0,"_dependencyMap"],[20,50,1,0],[21,2,2,0],[21,6,2,0,"_libSupabase"],[21,18,2,0],[21,21,2,0,"require"],[21,28,2,0],[21,29,2,0,"_dependencyMap"],[21,43,2,0],[22,2,3,0],[22,6,3,0,"_queryKeys"],[22,16,3,0],[22,19,3,0,"require"],[22,26,3,0],[22,27,3,0,"_dependencyMap"],[22,41,3,0],[23,2,5,0],[23,6,5,0,"_servicesDevLiveEmitterDevLiveEmitter"],[23,43,5,0],[23,46,5,0,"require"],[23,53,5,0],[23,54,5,0,"_dependencyMap"],[23,68,5,0],[24,2,18,0],[25,0,19,0],[26,0,20,0],[27,0,21,0],[28,0,22,0],[29,0,23,0],[30,0,24,0],[31,2,25,0],[31,6,25,6,"useCreateOffer"],[31,20,25,20],[31,23,25,23,"useCreateOffer"],[31,24,25,23],[31,29,25,29],[32,4,26,2],[32,8,26,8,"queryClient"],[32,19,26,19],[32,22,26,22],[32,26,26,22,"useQueryClient"],[32,45,26,36],[32,46,26,36,"useQueryClient"],[32,60,26,36],[32,62,26,37],[32,63,26,38],[33,4,28,2],[33,11,28,9],[33,15,28,9,"useMutation"],[33,34,28,20],[33,35,28,20,"useMutation"],[33,46,28,20],[33,48,28,65],[34,6,29,4,"mutationFn"],[34,16,29,14],[35,8,29,14],[35,12,29,14,"_ref2"],[35,17,29,14],[35,24,29,14,"_asyncToGenerator"],[35,41,29,14],[35,42,29,14,"default"],[35,49,29,14],[35,51,29,16],[35,62,29,16,"_ref"],[35,66,29,16],[35,68,29,82],[36,10,29,82],[36,14,29,25,"listingId"],[36,23,29,34],[36,26,29,34,"_ref"],[36,30,29,34],[36,31,29,25,"listingId"],[36,40,29,34],[37,12,29,36,"selectedCards"],[37,25,29,49],[37,28,29,49,"_ref"],[37,32,29,49],[37,33,29,36,"selectedCards"],[37,46,29,49],[38,12,29,51,"cashAmount"],[38,22,29,61],[38,25,29,61,"_ref"],[38,29,29,61],[38,30,29,51,"cashAmount"],[38,40,29,61],[39,12,29,63,"offeringNote"],[39,24,29,75],[39,27,29,75,"_ref"],[39,31,29,75],[39,32,29,63,"offeringNote"],[39,44,29,75],[40,10,30,6],[40,14,30,12,"scoped"],[40,20,30,18],[40,23,32,10,"undefined"],[40,32,32,19],[41,10,34,6,"scoped"],[41,16,34,12],[41,19,34,15],[41,20,34,16],[41,22,34,18],[41,31,34,27],[41,32,34,28],[42,10,36,6],[42,14,36,6,"_yield$supabase$auth$"],[42,35,36,6],[42,44,38,16,"supabase"],[42,56,38,24],[42,57,38,24,"supabase"],[42,65,38,24],[42,66,38,25,"auth"],[42,70,38,29],[42,71,38,30,"getSession"],[42,81,38,40],[42,82,38,41],[42,83,38,42],[43,12,37,16,"session"],[43,19,37,23],[43,22,37,23,"_yield$supabase$auth$"],[43,43,37,23],[43,44,37,8,"data"],[43,48,37,12],[43,49,37,16,"session"],[43,56,37,23],[44,10,39,6],[44,14,39,12,"user"],[44,18,39,16],[44,21,39,19,"session"],[44,28,39,26],[44,30,39,28,"user"],[44,34,39,32],[44,38,39,36],[44,42,39,40],[45,10,41,6],[45,14,41,10],[45,15,41,11,"user"],[45,19,41,15],[45,21,41,17],[45,27,41,23],[45,31,41,27,"Error"],[45,36,41,32],[45,37,41,33],[45,61,41,57],[45,62,41,58],[46,10,43,6],[46,14,43,12,"items"],[46,19,43,17],[46,22,43,20,"selectedCards"],[46,35,43,33],[46,36,43,34,"map"],[46,39,43,37],[46,40,43,39,"sc"],[46,42,43,41],[46,47,43,47],[47,12,44,8,"card_name"],[47,21,44,17],[47,23,44,19,"sc"],[47,25,44,21],[47,26,44,22,"card"],[47,30,44,26],[47,31,44,27,"name"],[47,35,44,31],[48,12,45,8,"card_image_url"],[48,26,45,22],[48,28,45,24,"sc"],[48,30,45,26],[48,31,45,27,"card"],[48,35,45,31],[48,36,45,32,"imageUrl"],[48,44,45,40],[49,12,46,8,"card_external_id"],[49,28,46,24],[49,30,46,26,"sc"],[49,32,46,28],[49,33,46,29,"card"],[49,37,46,33],[49,38,46,34,"externalId"],[49,48,46,44],[50,12,47,8,"tcg"],[50,15,47,11],[50,17,47,13,"sc"],[50,19,47,15],[50,20,47,16,"card"],[50,24,47,20],[50,25,47,21,"tcg"],[50,28,47,24],[51,12,48,8,"card_set"],[51,20,48,16],[51,22,48,18,"sc"],[51,24,48,20],[51,25,48,21,"card"],[51,29,48,25],[51,30,48,26,"setName"],[51,37,48,33],[52,12,49,8,"card_number"],[52,23,49,19],[52,25,49,21,"sc"],[52,27,49,23],[52,28,49,24,"card"],[52,32,49,28],[52,33,49,29,"number"],[52,39,49,35],[53,12,50,8,"condition"],[53,21,50,17],[53,23,50,19,"sc"],[53,25,50,21],[53,26,50,22,"condition"],[53,35,50,31],[54,12,51,8,"market_price"],[54,24,51,20],[54,26,51,22,"sc"],[54,28,51,24],[54,29,51,25,"card"],[54,33,51,29],[54,34,51,30,"marketPrice"],[54,45,51,41],[54,49,51,45],[54,53,51,49],[55,12,52,8,"quantity"],[55,20,52,16],[55,22,52,18],[56,10,53,6],[56,11,53,7],[56,12,53,8],[56,13,53,9],[57,10,55,6],[57,14,55,10],[58,12,56,8],[58,16,56,8,"_yield$supabase$rpc"],[58,35,56,8],[58,44,56,38,"supabase"],[58,56,56,46],[58,57,56,46,"supabase"],[58,65,56,46],[58,66,56,47,"rpc"],[58,69,56,50],[58,70,56,51],[58,87,56,68],[58,89,56,70],[59,16,57,10,"p_listing_id"],[59,28,57,22],[59,30,57,24,"listingId"],[59,39,57,33],[60,16,58,10,"p_offerer_id"],[60,28,58,22],[60,30,58,24,"user"],[60,34,58,28],[60,35,58,29,"id"],[60,37,58,31],[61,16,59,10,"p_cash_amount"],[61,29,59,23],[61,31,59,25,"cashAmount"],[61,41,59,35],[62,16,60,10,"p_offerer_note"],[62,30,60,24],[62,32,60,26,"offeringNote"],[62,44,60,38],[62,48,60,42],[62,50,60,44],[63,16,61,10,"p_items"],[63,23,61,17],[63,25,61,19,"JSON"],[63,29,61,23],[63,30,61,24,"stringify"],[63,39,61,33],[63,40,61,34,"items"],[63,45,61,39],[64,14,62,8],[64,15,62,9],[64,16,62,10],[65,14,56,16,"data"],[65,18,56,20],[65,21,56,20,"_yield$supabase$rpc"],[65,40,56,20],[65,41,56,16,"data"],[65,45,56,20],[66,14,56,22,"error"],[66,19,56,27],[66,22,56,27,"_yield$supabase$rpc"],[66,41,56,27],[66,42,56,22,"error"],[66,47,56,27],[67,12,64,8],[67,16,64,12,"error"],[67,21,64,17],[67,23,64,19],[67,29,64,25,"error"],[67,34,64,30],[68,12,66,8,"scoped"],[68,18,66,14],[68,21,66,17],[68,22,66,18],[68,24,66,20],[68,33,66,29],[68,34,66,30],[69,12,67,8],[69,19,67,15,"data"],[69,23,67,19],[70,10,68,6],[70,11,68,7],[70,12,68,8],[70,19,68,15,"err"],[70,22,68,18],[70,24,68,20],[71,12,69,8,"scoped"],[71,18,69,14],[71,21,69,17],[71,22,69,18],[71,24,69,20],[71,31,69,27],[71,33,69,29],[72,14,69,31,"message"],[72,21,69,38],[72,23,69,41,"err"],[72,26,69,44],[72,27,69,55,"message"],[73,12,69,63],[73,13,69,64],[73,14,69,65],[74,12,70,8],[74,18,70,14,"err"],[74,21,70,17],[75,10,71,6],[76,8,72,4],[76,9,72,5],[77,8,72,5],[77,24,29,4,"mutationFn"],[77,34,29,14,"mutationFn"],[77,35,29,14,"_x"],[77,37,29,14],[78,10,29,14],[78,17,29,14,"_ref2"],[78,22,29,14],[78,23,29,14,"apply"],[78,28,29,14],[78,35,29,14,"arguments"],[78,44,29,14],[79,8,29,14],[80,6,29,14],[80,9,72,5],[81,6,73,4,"onSuccess"],[81,15,73,13],[81,17,73,15,"onSuccess"],[81,18,73,16,"_"],[81,19,73,17],[81,21,73,19,"variables"],[81,30,73,28],[81,35,73,33],[82,8,74,6,"queryClient"],[82,19,74,17],[82,20,74,18,"invalidateQueries"],[82,37,74,35],[82,38,74,36],[83,10,74,38,"queryKey"],[83,18,74,46],[83,20,74,48,"listingKeys"],[83,30,74,59],[83,31,74,59,"listingKeys"],[83,42,74,59],[83,43,74,60,"offers"],[83,49,74,66],[83,50,74,67,"variables"],[83,59,74,76],[83,60,74,77,"listingId"],[83,69,74,86],[84,8,74,88],[84,9,74,89],[84,10,74,90],[85,8,75,6,"queryClient"],[85,19,75,17],[85,20,75,18,"invalidateQueries"],[85,37,75,35],[85,38,75,36],[86,10,75,38,"queryKey"],[86,18,75,46],[86,20,75,48,"listingKeys"],[86,30,75,59],[86,31,75,59,"listingKeys"],[86,42,75,59],[86,43,75,60,"detail"],[86,49,75,66],[86,50,75,67,"variables"],[86,59,75,76],[86,60,75,77,"listingId"],[86,69,75,86],[87,8,75,88],[87,9,75,89],[87,10,75,90],[88,6,76,4],[89,4,77,2],[89,5,77,3],[89,6,77,4],[90,2,78,0],[90,3,78,1],[91,2,80,0],[91,6,80,0,"_default"],[91,14,80,0],[91,17,80,15,"useCreateOffer"],[91,31,80,29],[92,0,80,30],[92,3]],"functionMap":{"names":["<global>","useCreateOffer","useMutation$argument_0.mutationFn","selectedCards.map$argument_0","useMutation$argument_0.onSuccess"],"mappings":"AAA;uBCwB;gBCI;sCCc;QDU;KDmB;eGC;KHG;CDE"},"hasCjsExports":false},"type":"js/module"}]}
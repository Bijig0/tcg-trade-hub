{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":68,"index":68}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":69},"end":{"line":2,"column":44,"index":113}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":114},"end":{"line":3,"column":42,"index":156}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"@/context/AuthProvider","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":157},"end":{"line":4,"column":49,"index":206}}],"key":"hnDMt1RwOyVwgo481TGNr6ITBm4=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":207},"end":{"line":5,"column":43,"index":250}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0]);\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1]);\n  var _react = require(_dependencyMap[2]);\n  var _libSupabase = require(_dependencyMap[3]);\n  var _contextAuthProvider = require(_dependencyMap[4]);\n  var _queryKeys = require(_dependencyMap[5]);\n  /**\n   * Upserts the user's read position for a conversation.\n   * Call on conversation mount and when new messages arrive while focused.\n   * Invalidates conversation list to update unread badges.\n   */\n  var useMarkAsRead = conversationId => {\n    var queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    var _useAuth = (0, _contextAuthProvider.useAuth)(),\n      user = _useAuth.user;\n    var lastMarkedRef = (0, _react.useRef)(null);\n    var mutation = (0, _tanstackReactQuery.useMutation)({\n      mutationFn: function () {\n        var _ref2 = (0, _asyncToGenerator.default)(function* (_ref) {\n          var conversationId = _ref.conversationId,\n            lastMessageId = _ref.lastMessageId;\n          if (!user) throw new Error('Not authenticated');\n          var _yield$supabase$from$ = yield _libSupabase.supabase.from('conversation_reads').upsert({\n              conversation_id: conversationId,\n              user_id: user.id,\n              last_read_message_id: lastMessageId ?? null,\n              last_read_at: new Date().toISOString()\n            }, {\n              onConflict: 'conversation_id,user_id'\n            }),\n            error = _yield$supabase$from$.error;\n          if (error) throw error;\n        });\n        return function mutationFn(_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }(),\n      onSuccess: () => {\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.chatKeys.conversations()\n        });\n      }\n    });\n    var markAsRead = (0, _react.useCallback)(lastMessageId => {\n      // Deduplicate: don't re-mark the same message\n      if (lastMessageId && lastMessageId === lastMarkedRef.current) return;\n      if (lastMessageId) lastMarkedRef.current = lastMessageId;\n      mutation.mutate({\n        conversationId,\n        lastMessageId\n      });\n    }, [conversationId, mutation]);\n    return {\n      markAsRead,\n      ...mutation\n    };\n  };\n  var _default = useMarkAsRead;\n});","lineCount":77,"map":[[12,2,59,0,"Object"],[12,8,59,0],[12,9,59,0,"defineProperty"],[12,23,59,0],[12,24,59,0,"exports"],[12,31,59,0],[13,4,59,0,"enumerable"],[13,14,59,0],[14,4,59,0,"get"],[14,7,59,0],[14,18,59,0,"get"],[14,19,59,0],[15,6,59,0],[15,13,59,0,"_default"],[15,21,59,0],[16,4,59,0],[17,2,59,0],[18,2,59,29],[18,6,59,29,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,59,29],[18,45,59,29,"require"],[18,52,59,29],[18,53,59,29,"_dependencyMap"],[18,67,59,29],[19,2,59,29],[19,6,59,29,"_asyncToGenerator"],[19,23,59,29],[19,26,59,29,"_interopDefault"],[19,41,59,29],[19,42,59,29,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,59,29],[20,2,1,0],[20,6,1,0,"_tanstackReactQuery"],[20,25,1,0],[20,28,1,0,"require"],[20,35,1,0],[20,36,1,0,"_dependencyMap"],[20,50,1,0],[21,2,2,0],[21,6,2,0,"_react"],[21,12,2,0],[21,15,2,0,"require"],[21,22,2,0],[21,23,2,0,"_dependencyMap"],[21,37,2,0],[22,2,3,0],[22,6,3,0,"_libSupabase"],[22,18,3,0],[22,21,3,0,"require"],[22,28,3,0],[22,29,3,0,"_dependencyMap"],[22,43,3,0],[23,2,4,0],[23,6,4,0,"_contextAuthProvider"],[23,26,4,0],[23,29,4,0,"require"],[23,36,4,0],[23,37,4,0,"_dependencyMap"],[23,51,4,0],[24,2,5,0],[24,6,5,0,"_queryKeys"],[24,16,5,0],[24,19,5,0,"require"],[24,26,5,0],[24,27,5,0,"_dependencyMap"],[24,41,5,0],[25,2,12,0],[26,0,13,0],[27,0,14,0],[28,0,15,0],[29,0,16,0],[30,2,17,0],[30,6,17,6,"useMarkAsRead"],[30,19,17,19],[30,22,17,23,"conversationId"],[30,36,17,45],[30,40,17,50],[31,4,18,2],[31,8,18,8,"queryClient"],[31,19,18,19],[31,22,18,22],[31,26,18,22,"useQueryClient"],[31,45,18,36],[31,46,18,36,"useQueryClient"],[31,60,18,36],[31,62,18,37],[31,63,18,38],[32,4,19,2],[32,8,19,2,"_useAuth"],[32,16,19,2],[32,19,19,19],[32,23,19,19,"useAuth"],[32,43,19,26],[32,44,19,26,"useAuth"],[32,51,19,26],[32,53,19,27],[32,54,19,28],[33,6,19,10,"user"],[33,10,19,14],[33,13,19,14,"_useAuth"],[33,21,19,14],[33,22,19,10,"user"],[33,26,19,14],[34,4,20,2],[34,8,20,8,"lastMarkedRef"],[34,21,20,21],[34,24,20,24],[34,28,20,24,"useRef"],[34,34,20,30],[34,35,20,30,"useRef"],[34,41,20,30],[34,43,20,46],[34,47,20,50],[34,48,20,51],[35,4,22,2],[35,8,22,8,"mutation"],[35,16,22,16],[35,19,22,19],[35,23,22,19,"useMutation"],[35,42,22,30],[35,43,22,30,"useMutation"],[35,54,22,30],[35,56,22,31],[36,6,23,4,"mutationFn"],[36,16,23,14],[37,8,23,14],[37,12,23,14,"_ref2"],[37,17,23,14],[37,24,23,14,"_asyncToGenerator"],[37,41,23,14],[37,42,23,14,"default"],[37,49,23,14],[37,51,23,16],[37,62,23,16,"_ref"],[37,66,23,16],[37,68,23,79],[38,10,23,79],[38,14,23,25,"conversationId"],[38,28,23,39],[38,31,23,39,"_ref"],[38,35,23,39],[38,36,23,25,"conversationId"],[38,50,23,39],[39,12,23,41,"lastMessageId"],[39,25,23,54],[39,28,23,54,"_ref"],[39,32,23,54],[39,33,23,41,"lastMessageId"],[39,46,23,54],[40,10,24,6],[40,14,24,10],[40,15,24,11,"user"],[40,19,24,15],[40,21,24,17],[40,27,24,23],[40,31,24,27,"Error"],[40,36,24,32],[40,37,24,33],[40,56,24,52],[40,57,24,53],[41,10,26,6],[41,14,26,6,"_yield$supabase$from$"],[41,35,26,6],[41,44,26,30,"supabase"],[41,56,26,38],[41,57,26,38,"supabase"],[41,65,26,38],[41,66,27,9,"from"],[41,70,27,13],[41,71,27,14],[41,91,27,34],[41,92,27,35],[41,93,28,9,"upsert"],[41,99,28,15],[41,100,29,10],[42,14,30,12,"conversation_id"],[42,29,30,27],[42,31,30,29,"conversationId"],[42,45,30,43],[43,14,31,12,"user_id"],[43,21,31,19],[43,23,31,21,"user"],[43,27,31,25],[43,28,31,26,"id"],[43,30,31,28],[44,14,32,12,"last_read_message_id"],[44,34,32,32],[44,36,32,34,"lastMessageId"],[44,49,32,47],[44,53,32,51],[44,57,32,55],[45,14,33,12,"last_read_at"],[45,26,33,24],[45,28,33,26],[45,32,33,30,"Date"],[45,36,33,34],[45,37,33,35],[45,38,33,36],[45,39,33,37,"toISOString"],[45,50,33,48],[45,51,33,49],[46,12,34,10],[46,13,34,11],[46,15,35,10],[47,14,35,12,"onConflict"],[47,24,35,22],[47,26,35,24],[48,12,35,50],[48,13,36,8],[48,14,36,9],[49,12,26,14,"error"],[49,17,26,19],[49,20,26,19,"_yield$supabase$from$"],[49,41,26,19],[49,42,26,14,"error"],[49,47,26,19],[50,10,38,6],[50,14,38,10,"error"],[50,19,38,15],[50,21,38,17],[50,27,38,23,"error"],[50,32,38,28],[51,8,39,4],[51,9,39,5],[52,8,39,5],[52,24,23,4,"mutationFn"],[52,34,23,14,"mutationFn"],[52,35,23,14,"_x"],[52,37,23,14],[53,10,23,14],[53,17,23,14,"_ref2"],[53,22,23,14],[53,23,23,14,"apply"],[53,28,23,14],[53,35,23,14,"arguments"],[53,44,23,14],[54,8,23,14],[55,6,23,14],[55,9,39,5],[56,6,40,4,"onSuccess"],[56,15,40,13],[56,17,40,15,"onSuccess"],[56,18,40,15],[56,23,40,21],[57,8,41,6,"queryClient"],[57,19,41,17],[57,20,41,18,"invalidateQueries"],[57,37,41,35],[57,38,41,36],[58,10,41,38,"queryKey"],[58,18,41,46],[58,20,41,48,"chatKeys"],[58,30,41,56],[58,31,41,56,"chatKeys"],[58,39,41,56],[58,40,41,57,"conversations"],[58,53,41,70],[58,54,41,71],[59,8,41,73],[59,9,41,74],[59,10,41,75],[60,6,42,4],[61,4,43,2],[61,5,43,3],[61,6,43,4],[62,4,45,2],[62,8,45,8,"markAsRead"],[62,18,45,18],[62,21,45,21],[62,25,45,21,"useCallback"],[62,31,45,32],[62,32,45,32,"useCallback"],[62,43,45,32],[62,45,46,5,"lastMessageId"],[62,58,46,34],[62,62,46,39],[63,6,47,6],[64,6,48,6],[64,10,48,10,"lastMessageId"],[64,23,48,23],[64,27,48,27,"lastMessageId"],[64,40,48,40],[64,45,48,45,"lastMarkedRef"],[64,58,48,58],[64,59,48,59,"current"],[64,66,48,66],[64,68,48,68],[65,6,49,6],[65,10,49,10,"lastMessageId"],[65,23,49,23],[65,25,49,25,"lastMarkedRef"],[65,38,49,38],[65,39,49,39,"current"],[65,46,49,46],[65,49,49,49,"lastMessageId"],[65,62,49,62],[66,6,51,6,"mutation"],[66,14,51,14],[66,15,51,15,"mutate"],[66,21,51,21],[66,22,51,22],[67,8,51,24,"conversationId"],[67,22,51,38],[68,8,51,40,"lastMessageId"],[69,6,51,54],[69,7,51,55],[69,8,51,56],[70,4,52,4],[70,5,52,5],[70,7,53,4],[70,8,53,5,"conversationId"],[70,22,53,19],[70,24,53,21,"mutation"],[70,32,53,29],[70,33,54,2],[70,34,54,3],[71,4,56,2],[71,11,56,9],[72,6,56,11,"markAsRead"],[72,16,56,21],[73,6,56,23],[73,9,56,26,"mutation"],[74,4,56,35],[74,5,56,36],[75,2,57,0],[75,3,57,1],[76,2,59,0],[76,6,59,0,"_default"],[76,14,59,0],[76,17,59,15,"useMarkAsRead"],[76,30,59,28],[77,0,59,29],[77,3]],"functionMap":{"names":["<global>","useMarkAsRead","useMutation$argument_0.mutationFn","useMutation$argument_0.onSuccess","markAsRead"],"mappings":"AAA;sBCgB;gBCM;KDgB;eEC;KFE;IGI;KHM;CDK"},"hasCjsExports":false},"type":"js/module"}]}
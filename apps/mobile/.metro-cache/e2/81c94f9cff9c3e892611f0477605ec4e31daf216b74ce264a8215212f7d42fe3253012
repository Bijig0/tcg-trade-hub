{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var WEIGHTS = {\n    tcgMatch: 2,\n    proximity: 2,\n    recency: 1\n  };\n  var RECENCY_DECAY_DAYS = 7;\n  var computeTcgMatchScore = (listing, userListings) => {\n    var userTcgs = new Set(userListings.map(ul => ul.tcg));\n    return userTcgs.has(listing.tcg) ? WEIGHTS.tcgMatch : 0;\n  };\n  var computeProximityScore = (distanceKm, maxRadiusKm) => {\n    if (distanceKm >= maxRadiusKm) return 0;\n    return WEIGHTS.proximity * (1 - distanceKm / maxRadiusKm);\n  };\n  var computeRecencyScore = createdAt => {\n    var ageMs = Date.now() - new Date(createdAt).getTime();\n    var ageDays = ageMs / 86400000;\n    if (ageDays >= RECENCY_DECAY_DAYS) return 0;\n    return WEIGHTS.recency * (1 - ageDays / RECENCY_DECAY_DAYS);\n  };\n\n  /**\n   * Ranks listings by weighted score:\n   * - TCG match (2): listing TCG matches user's active listing TCGs\n   * - Proximity (2): inverse distance, closer = higher\n   * - Recency (1): newer listings score higher, decays over 7 days\n   *\n   * Note: complement matching (card-level overlap) has been removed\n   * since listings are now bundles. Real scoring happens in the\n   * get-feed Edge Function.\n   */\n  var rankListings = function (listings, userListings, _userLocation) {\n    var maxRadiusKm = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 25;\n    var ranked = listings.map(listing => {\n      var tcgScore = computeTcgMatchScore(listing, userListings);\n      var distanceKm = maxRadiusKm / 2;\n      var proximityScore = computeProximityScore(distanceKm, maxRadiusKm);\n      var recencyScore = computeRecencyScore(listing.created_at);\n      var score = tcgScore + proximityScore + recencyScore;\n      return {\n        listing,\n        score\n      };\n    });\n    ranked.sort((a, b) => b.score - a.score);\n    return ranked;\n  };\n  var _default = rankListings;\n});","lineCount":61,"map":[[7,2,76,0,"Object"],[7,8,76,0],[7,9,76,0,"defineProperty"],[7,23,76,0],[7,24,76,0,"exports"],[7,31,76,0],[8,4,76,0,"enumerable"],[8,14,76,0],[9,4,76,0,"get"],[9,7,76,0],[9,18,76,0,"get"],[9,19,76,0],[10,6,76,0],[10,13,76,0,"_default"],[10,21,76,0],[11,4,76,0],[12,2,76,0],[13,2,13,0],[13,6,13,6,"WEIGHTS"],[13,13,13,13],[13,16,13,16],[14,4,14,2,"tcgMatch"],[14,12,14,10],[14,14,14,12],[14,15,14,13],[15,4,15,2,"proximity"],[15,13,15,11],[15,15,15,13],[15,16,15,14],[16,4,16,2,"recency"],[16,11,16,9],[16,13,16,11],[17,2,17,0],[17,3,17,10],[18,2,19,0],[18,6,19,6,"RECENCY_DECAY_DAYS"],[18,24,19,24],[18,27,19,27],[18,28,19,28],[19,2,21,0],[19,6,21,6,"computeTcgMatchScore"],[19,26,21,26],[19,29,21,29,"computeTcgMatchScore"],[19,30,22,2,"listing"],[19,37,22,21],[19,39,23,2,"userListings"],[19,51,23,28],[19,56,24,13],[20,4,25,2],[20,8,25,8,"userTcgs"],[20,16,25,16],[20,19,25,19],[20,23,25,23,"Set"],[20,26,25,26],[20,27,25,27,"userListings"],[20,39,25,39],[20,40,25,40,"map"],[20,43,25,43],[20,44,25,45,"ul"],[20,46,25,47],[20,50,25,52,"ul"],[20,52,25,54],[20,53,25,55,"tcg"],[20,56,25,58],[20,57,25,59],[20,58,25,60],[21,4,26,2],[21,11,26,9,"userTcgs"],[21,19,26,17],[21,20,26,18,"has"],[21,23,26,21],[21,24,26,22,"listing"],[21,31,26,29],[21,32,26,30,"tcg"],[21,35,26,33],[21,36,26,34],[21,39,26,37,"WEIGHTS"],[21,46,26,44],[21,47,26,45,"tcgMatch"],[21,55,26,53],[21,58,26,56],[21,59,26,57],[22,2,27,0],[22,3,27,1],[23,2,29,0],[23,6,29,6,"computeProximityScore"],[23,27,29,27],[23,30,29,30,"computeProximityScore"],[23,31,30,2,"distanceKm"],[23,41,30,20],[23,43,31,2,"maxRadiusKm"],[23,54,31,21],[23,59,32,13],[24,4,33,2],[24,8,33,6,"distanceKm"],[24,18,33,16],[24,22,33,20,"maxRadiusKm"],[24,33,33,31],[24,35,33,33],[24,42,33,40],[24,43,33,41],[25,4,34,2],[25,11,34,9,"WEIGHTS"],[25,18,34,16],[25,19,34,17,"proximity"],[25,28,34,26],[25,32,34,30],[25,33,34,31],[25,36,34,34,"distanceKm"],[25,46,34,44],[25,49,34,47,"maxRadiusKm"],[25,60,34,58],[25,61,34,59],[26,2,35,0],[26,3,35,1],[27,2,37,0],[27,6,37,6,"computeRecencyScore"],[27,25,37,25],[27,28,37,29,"createdAt"],[27,37,37,46],[27,41,37,59],[28,4,38,2],[28,8,38,8,"ageMs"],[28,13,38,13],[28,16,38,16,"Date"],[28,20,38,20],[28,21,38,21,"now"],[28,24,38,24],[28,25,38,25],[28,26,38,26],[28,29,38,29],[28,33,38,33,"Date"],[28,37,38,37],[28,38,38,38,"createdAt"],[28,47,38,47],[28,48,38,48],[28,49,38,49,"getTime"],[28,56,38,56],[28,57,38,57],[28,58,38,58],[29,4,39,2],[29,8,39,8,"ageDays"],[29,15,39,15],[29,18,39,18,"ageMs"],[29,23,39,23],[29,34,39,47],[30,4,40,2],[30,8,40,6,"ageDays"],[30,15,40,13],[30,19,40,17,"RECENCY_DECAY_DAYS"],[30,37,40,35],[30,39,40,37],[30,46,40,44],[30,47,40,45],[31,4,41,2],[31,11,41,9,"WEIGHTS"],[31,18,41,16],[31,19,41,17,"recency"],[31,26,41,24],[31,30,41,28],[31,31,41,29],[31,34,41,32,"ageDays"],[31,41,41,39],[31,44,41,42,"RECENCY_DECAY_DAYS"],[31,62,41,60],[31,63,41,61],[32,2,42,0],[32,3,42,1],[34,2,44,0],[35,0,45,0],[36,0,46,0],[37,0,47,0],[38,0,48,0],[39,0,49,0],[40,0,50,0],[41,0,51,0],[42,0,52,0],[43,0,53,0],[44,2,54,0],[44,6,54,6,"rankListings"],[44,18,54,18],[44,21,54,21],[44,30,54,21,"rankListings"],[44,31,55,2,"listings"],[44,39,55,24],[44,41,56,2,"userListings"],[44,53,56,28],[44,55,57,2,"_userLocation"],[44,68,57,22],[44,70,59,22],[45,4,59,22],[45,8,58,2,"maxRadiusKm"],[45,19,58,13],[45,22,58,13,"arguments"],[45,31,58,13],[45,32,58,13,"length"],[45,38,58,13],[45,46,58,13,"arguments"],[45,55,58,13],[45,63,58,13,"undefined"],[45,72,58,13],[45,75,58,13,"arguments"],[45,84,58,13],[45,90,58,16],[45,92,58,18],[46,4,60,2],[46,8,60,8,"ranked"],[46,14,60,14],[46,17,60,17,"listings"],[46,25,60,25],[46,26,60,26,"map"],[46,29,60,29],[46,30,60,31,"listing"],[46,37,60,38],[46,41,60,43],[47,6,61,4],[47,10,61,10,"tcgScore"],[47,18,61,18],[47,21,61,21,"computeTcgMatchScore"],[47,41,61,41],[47,42,61,42,"listing"],[47,49,61,49],[47,51,61,51,"userListings"],[47,63,61,63],[47,64,61,64],[48,6,62,4],[48,10,62,10,"distanceKm"],[48,20,62,20],[48,23,62,23,"maxRadiusKm"],[48,34,62,34],[48,37,62,37],[48,38,62,38],[49,6,63,4],[49,10,63,10,"proximityScore"],[49,24,63,24],[49,27,63,27,"computeProximityScore"],[49,48,63,48],[49,49,63,49,"distanceKm"],[49,59,63,59],[49,61,63,61,"maxRadiusKm"],[49,72,63,72],[49,73,63,73],[50,6,64,4],[50,10,64,10,"recencyScore"],[50,22,64,22],[50,25,64,25,"computeRecencyScore"],[50,44,64,44],[50,45,64,45,"listing"],[50,52,64,52],[50,53,64,53,"created_at"],[50,63,64,63],[50,64,64,64],[51,6,66,4],[51,10,66,10,"score"],[51,15,66,15],[51,18,66,18,"tcgScore"],[51,26,66,26],[51,29,66,29,"proximityScore"],[51,43,66,43],[51,46,66,46,"recencyScore"],[51,58,66,58],[52,6,68,4],[52,13,68,11],[53,8,68,13,"listing"],[53,15,68,20],[54,8,68,22,"score"],[55,6,68,28],[55,7,68,29],[56,4,69,2],[56,5,69,3],[56,6,69,4],[57,4,71,2,"ranked"],[57,10,71,8],[57,11,71,9,"sort"],[57,15,71,13],[57,16,71,14],[57,17,71,15,"a"],[57,18,71,16],[57,20,71,18,"b"],[57,21,71,19],[57,26,71,24,"b"],[57,27,71,25],[57,28,71,26,"score"],[57,33,71,31],[57,36,71,34,"a"],[57,37,71,35],[57,38,71,36,"score"],[57,43,71,41],[57,44,71,42],[58,4,73,2],[58,11,73,9,"ranked"],[58,17,73,15],[59,2,74,0],[59,3,74,1],[60,2,76,0],[60,6,76,0,"_default"],[60,14,76,0],[60,17,76,15,"rankListings"],[60,29,76,27],[61,0,76,28],[61,3]],"functionMap":{"names":["<global>","computeTcgMatchScore","userListings.map$argument_0","computeProximityScore","computeRecencyScore","rankListings","listings.map$argument_0","ranked.sort$argument_0"],"mappings":"AAA;6BCoB;4CCI,cD;CDE;8BGE;CHM;4BIE;CJK;qBKY;8BCM;GDS;cEE,2BF;CLG"},"hasCjsExports":false},"type":"js/module"}]}
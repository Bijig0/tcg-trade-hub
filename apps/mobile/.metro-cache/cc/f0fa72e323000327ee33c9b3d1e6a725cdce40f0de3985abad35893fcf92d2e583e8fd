{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":34,"index":34}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":35},"end":{"line":2,"column":55,"index":90}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":91},"end":{"line":3,"column":42,"index":133}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"@/context/AuthProvider","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":134},"end":{"line":4,"column":49,"index":183}}],"key":"hnDMt1RwOyVwgo481TGNr6ITBm4=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":184},"end":{"line":5,"column":43,"index":227}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _react = require(_dependencyMap[1], \"react\");\n  var _tanstackReactQuery = require(_dependencyMap[2], \"@tanstack/react-query\");\n  var _libSupabase = require(_dependencyMap[3], \"@/lib/supabase\");\n  var _contextAuthProvider = require(_dependencyMap[4], \"@/context/AuthProvider\");\n  var _queryKeys = require(_dependencyMap[5], \"../../queryKeys\");\n  /**\n   * Subscribes to Supabase Realtime for new messages in a conversation.\n   * On INSERT, adds the message to the TanStack Query cache.\n   */\n  var useRealtimeChat = conversationId => {\n    _s();\n    var queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    var _useAuth = (0, _contextAuthProvider.useAuth)(),\n      user = _useAuth.user;\n    (0, _react.useEffect)(() => {\n      if (!conversationId) return;\n      var channel = _libSupabase.supabase.channel(`messages:${conversationId}`).on('postgres_changes', {\n        event: 'INSERT',\n        schema: 'public',\n        table: 'messages',\n        filter: `conversation_id=eq.${conversationId}`\n      }, /*#__PURE__*/function () {\n        var _ref = (0, _asyncToGenerator.default)(function* (payload) {\n          var newMessage = payload.new;\n\n          // Don't duplicate our own optimistically-added messages\n          if (newMessage.sender_id === user?.id) return;\n\n          // Fetch the sender info\n          var _yield$supabase$from$ = yield _libSupabase.supabase.from('users').select('id, display_name, avatar_url').eq('id', newMessage.sender_id).single(),\n            senderData = _yield$supabase$from$.data;\n          var messageWithSender = {\n            ...newMessage,\n            sender: senderData ?? {\n              id: newMessage.sender_id,\n              display_name: 'Unknown',\n              avatar_url: null\n            }\n          };\n          var messagesKey = _queryKeys.chatKeys.messages(conversationId);\n          queryClient.setQueryData(messagesKey, old => {\n            if (!old) {\n              return {\n                pages: [[messageWithSender]],\n                pageParams: [null]\n              };\n            }\n\n            // Prevent duplicates\n            var allIds = old.pages.flatMap(page => page.map(m => m.id));\n            if (allIds.includes(messageWithSender.id)) return old;\n            return {\n              ...old,\n              pages: [[messageWithSender, ...(old.pages[0] ?? [])], ...old.pages.slice(1)]\n            };\n          });\n\n          // Also invalidate conversations list to update last message\n          queryClient.invalidateQueries({\n            queryKey: _queryKeys.chatKeys.conversations()\n          });\n        });\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }()).subscribe();\n      return () => {\n        _libSupabase.supabase.removeChannel(channel);\n      };\n    }, [conversationId, queryClient, user?.id]);\n  };\n  _s(useRealtimeChat, \"TDrJ95GxdHquDBjgVv/lJ4LOc/A=\", false, function () {\n    return [_tanstackReactQuery.useQueryClient, _contextAuthProvider.useAuth];\n  });\n  var _default = useRealtimeChat;\n});","lineCount":96,"map":[[13,2,98,0,"Object"],[13,8,98,0],[13,9,98,0,"defineProperty"],[13,23,98,0],[13,24,98,0,"exports"],[13,31,98,0],[14,4,98,0,"enumerable"],[14,14,98,0],[15,4,98,0,"get"],[15,7,98,0],[15,18,98,0,"get"],[15,19,98,0],[16,6,98,0],[16,13,98,0,"_default"],[16,21,98,0],[17,4,98,0],[18,2,98,0],[19,2,98,31],[19,6,98,31,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,98,31],[19,45,98,31,"require"],[19,52,98,31],[19,53,98,31,"_dependencyMap"],[19,67,98,31],[20,2,98,31],[20,6,98,31,"_asyncToGenerator"],[20,23,98,31],[20,26,98,31,"_interopDefault"],[20,41,98,31],[20,42,98,31,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,98,31],[21,2,1,0],[21,6,1,0,"_react"],[21,12,1,0],[21,15,1,0,"require"],[21,22,1,0],[21,23,1,0,"_dependencyMap"],[21,37,1,0],[22,2,2,0],[22,6,2,0,"_tanstackReactQuery"],[22,25,2,0],[22,28,2,0,"require"],[22,35,2,0],[22,36,2,0,"_dependencyMap"],[22,50,2,0],[23,2,3,0],[23,6,3,0,"_libSupabase"],[23,18,3,0],[23,21,3,0,"require"],[23,28,3,0],[23,29,3,0,"_dependencyMap"],[23,43,3,0],[24,2,4,0],[24,6,4,0,"_contextAuthProvider"],[24,26,4,0],[24,29,4,0,"require"],[24,36,4,0],[24,37,4,0,"_dependencyMap"],[24,51,4,0],[25,2,5,0],[25,6,5,0,"_queryKeys"],[25,16,5,0],[25,19,5,0,"require"],[25,26,5,0],[25,27,5,0,"_dependencyMap"],[25,41,5,0],[26,2,10,0],[27,0,11,0],[28,0,12,0],[29,0,13,0],[30,2,14,0],[30,6,14,6,"useRealtimeChat"],[30,21,14,21],[30,24,14,25,"conversationId"],[30,38,14,47],[30,42,14,52],[31,4,14,52,"_s"],[31,6,14,52],[32,4,15,2],[32,8,15,8,"queryClient"],[32,19,15,19],[32,22,15,22],[32,26,15,22,"useQueryClient"],[32,45,15,36],[32,46,15,36,"useQueryClient"],[32,60,15,36],[32,62,15,37],[32,63,15,38],[33,4,16,2],[33,8,16,2,"_useAuth"],[33,16,16,2],[33,19,16,19],[33,23,16,19,"useAuth"],[33,43,16,26],[33,44,16,26,"useAuth"],[33,51,16,26],[33,53,16,27],[33,54,16,28],[34,6,16,10,"user"],[34,10,16,14],[34,13,16,14,"_useAuth"],[34,21,16,14],[34,22,16,10,"user"],[34,26,16,14],[35,4,18,2],[35,8,18,2,"useEffect"],[35,14,18,11],[35,15,18,11,"useEffect"],[35,24,18,11],[35,26,18,12],[35,32,18,18],[36,6,19,4],[36,10,19,8],[36,11,19,9,"conversationId"],[36,25,19,23],[36,27,19,25],[37,6,21,4],[37,10,21,10,"channel"],[37,17,21,17],[37,20,21,20,"supabase"],[37,32,21,28],[37,33,21,28,"supabase"],[37,41,21,28],[37,42,22,7,"channel"],[37,49,22,14],[37,50,22,15],[37,62,22,27,"conversationId"],[37,76,22,41],[37,78,22,43],[37,79,22,44],[37,80,23,7,"on"],[37,82,23,9],[37,83,24,8],[37,101,24,26],[37,103,25,8],[38,8,26,10,"event"],[38,13,26,15],[38,15,26,17],[38,23,26,25],[39,8,27,10,"schema"],[39,14,27,16],[39,16,27,18],[39,24,27,26],[40,8,28,10,"table"],[40,13,28,15],[40,15,28,17],[40,25,28,27],[41,8,29,10,"filter"],[41,14,29,16],[41,16,29,18],[41,38,29,40,"conversationId"],[41,52,29,54],[42,6,30,8],[42,7,30,9],[43,8,30,9],[43,12,30,9,"_ref"],[43,16,30,9],[43,23,30,9,"_asyncToGenerator"],[43,40,30,9],[43,41,30,9,"default"],[43,48,30,9],[43,50,31,8],[43,61,31,15,"payload"],[43,68,31,22],[43,70,31,27],[44,10,32,10],[44,14,32,16,"newMessage"],[44,24,32,26],[44,27,32,29,"payload"],[44,34,32,36],[44,35,32,37,"new"],[44,38,32,40],[46,10,34,10],[47,10,35,10],[47,14,35,14,"newMessage"],[47,24,35,24],[47,25,35,25,"sender_id"],[47,34,35,34],[47,39,35,39,"user"],[47,43,35,43],[47,45,35,45,"id"],[47,47,35,47],[47,49,35,49],[49,10,37,10],[50,10,38,10],[50,14,38,10,"_yield$supabase$from$"],[50,35,38,10],[50,44,38,45,"supabase"],[50,56,38,53],[50,57,38,53,"supabase"],[50,65,38,53],[50,66,39,13,"from"],[50,70,39,17],[50,71,39,18],[50,78,39,25],[50,79,39,26],[50,80,40,13,"select"],[50,86,40,19],[50,87,40,20],[50,117,40,50],[50,118,40,51],[50,119,41,13,"eq"],[50,121,41,15],[50,122,41,16],[50,126,41,20],[50,128,41,22,"newMessage"],[50,138,41,32],[50,139,41,33,"sender_id"],[50,148,41,42],[50,149,41,43],[50,150,42,13,"single"],[50,156,42,19],[50,157,42,20],[50,158,42,21],[51,12,38,24,"senderData"],[51,22,38,34],[51,25,38,34,"_yield$supabase$from$"],[51,46,38,34],[51,47,38,18,"data"],[51,51,38,22],[52,10,44,10],[52,14,44,16,"messageWithSender"],[52,31,44,52],[52,34,44,55],[53,12,45,12],[53,15,45,15,"newMessage"],[53,25,45,25],[54,12,46,12,"sender"],[54,18,46,18],[54,20,46,21,"senderData"],[54,30,46,31],[54,34,49,18],[55,14,50,14,"id"],[55,16,50,16],[55,18,50,18,"newMessage"],[55,28,50,28],[55,29,50,29,"sender_id"],[55,38,50,38],[56,14,51,14,"display_name"],[56,26,51,26],[56,28,51,28],[56,37,51,37],[57,14,52,14,"avatar_url"],[57,24,52,24],[57,26,52,26],[58,12,53,12],[59,10,54,10],[59,11,54,11],[60,10,56,10],[60,14,56,16,"messagesKey"],[60,25,56,27],[60,28,56,30,"chatKeys"],[60,38,56,38],[60,39,56,38,"chatKeys"],[60,47,56,38],[60,48,56,39,"messages"],[60,56,56,47],[60,57,56,48,"conversationId"],[60,71,56,62],[60,72,56,63],[61,10,58,10,"queryClient"],[61,21,58,21],[61,22,58,22,"setQueryData"],[61,34,58,34],[61,35,59,12,"messagesKey"],[61,46,59,23],[61,48,60,13,"old"],[61,51,60,16],[61,55,60,21],[62,12,61,14],[62,16,61,18],[62,17,61,19,"old"],[62,20,61,22],[62,22,61,24],[63,14,62,16],[63,21,62,23],[64,16,63,18,"pages"],[64,21,63,23],[64,23,63,25],[64,24,63,26],[64,25,63,27,"messageWithSender"],[64,42,63,44],[64,43,63,45],[64,44,63,46],[65,16,64,18,"pageParams"],[65,26,64,28],[65,28,64,30],[65,29,64,31],[65,33,64,35],[66,14,65,16],[66,15,65,17],[67,12,66,14],[69,12,68,14],[70,12,69,14],[70,16,69,20,"allIds"],[70,22,69,26],[70,25,69,29,"old"],[70,28,69,32],[70,29,69,33,"pages"],[70,34,69,38],[70,35,69,39,"flatMap"],[70,42,69,46],[70,43,69,48,"page"],[70,47,69,52],[70,51,70,16,"page"],[70,55,70,20],[70,56,70,21,"map"],[70,59,70,24],[70,60,70,26,"m"],[70,61,70,27],[70,65,70,32,"m"],[70,66,70,33],[70,67,70,34,"id"],[70,69,70,36],[70,70,71,14],[70,71,71,15],[71,12,72,14],[71,16,72,18,"allIds"],[71,22,72,24],[71,23,72,25,"includes"],[71,31,72,33],[71,32,72,34,"messageWithSender"],[71,49,72,51],[71,50,72,52,"id"],[71,52,72,54],[71,53,72,55],[71,55,72,57],[71,62,72,64,"old"],[71,65,72,67],[72,12,74,14],[72,19,74,21],[73,14,75,16],[73,17,75,19,"old"],[73,20,75,22],[74,14,76,16,"pages"],[74,19,76,21],[74,21,76,23],[74,22,77,18],[74,23,77,19,"messageWithSender"],[74,40,77,36],[74,42,77,38],[74,46,77,42,"old"],[74,49,77,45],[74,50,77,46,"pages"],[74,55,77,51],[74,56,77,52],[74,57,77,53],[74,58,77,54],[74,62,77,58],[74,64,77,60],[74,65,77,61],[74,66,77,62],[74,68,78,18],[74,71,78,21,"old"],[74,74,78,24],[74,75,78,25,"pages"],[74,80,78,30],[74,81,78,31,"slice"],[74,86,78,36],[74,87,78,37],[74,88,78,38],[74,89,78,39],[75,12,80,14],[75,13,80,15],[76,10,81,12],[76,11,82,10],[76,12,82,11],[78,10,84,10],[79,10,85,10,"queryClient"],[79,21,85,21],[79,22,85,22,"invalidateQueries"],[79,39,85,39],[79,40,85,40],[80,12,86,12,"queryKey"],[80,20,86,20],[80,22,86,22,"chatKeys"],[80,32,86,30],[80,33,86,30,"chatKeys"],[80,41,86,30],[80,42,86,31,"conversations"],[80,55,86,44],[80,56,86,45],[81,10,87,10],[81,11,87,11],[81,12,87,12],[82,8,88,8],[82,9,88,9],[83,8,88,9],[83,25,88,9,"_x"],[83,27,88,9],[84,10,88,9],[84,17,88,9,"_ref"],[84,21,88,9],[84,22,88,9,"apply"],[84,27,88,9],[84,34,88,9,"arguments"],[84,43,88,9],[85,8,88,9],[86,6,88,9],[86,9,89,6],[86,10,89,7],[86,11,90,7,"subscribe"],[86,20,90,16],[86,21,90,17],[86,22,90,18],[87,6,92,4],[87,13,92,11],[87,19,92,17],[88,8,93,6,"supabase"],[88,20,93,14],[88,21,93,14,"supabase"],[88,29,93,14],[88,30,93,15,"removeChannel"],[88,43,93,28],[88,44,93,29,"channel"],[88,51,93,36],[88,52,93,37],[89,6,94,4],[89,7,94,5],[90,4,95,2],[90,5,95,3],[90,7,95,5],[90,8,95,6,"conversationId"],[90,22,95,20],[90,24,95,22,"queryClient"],[90,35,95,33],[90,37,95,35,"user"],[90,41,95,39],[90,43,95,41,"id"],[90,45,95,43],[90,46,95,44],[90,47,95,45],[91,2,96,0],[91,3,96,1],[92,2,96,2,"_s"],[92,4,96,2],[92,5,14,6,"useRealtimeChat"],[92,20,14,21],[93,4,14,21],[93,12,15,22,"useQueryClient"],[93,31,15,36],[93,32,15,36,"useQueryClient"],[93,46,15,36],[93,48,16,19,"useAuth"],[93,68,16,26],[93,69,16,26,"useAuth"],[93,76,16,26],[94,2,16,26],[95,2,98,0],[95,6,98,0,"_default"],[95,14,98,0],[95,17,98,15,"useRealtimeChat"],[95,32,98,30],[96,0,98,31],[96,3]],"functionMap":{"names":["<global>","useRealtimeChat","useEffect$argument_0","supabase.channel.on$argument_2","queryClient.setQueryData$argument_1","old.pages.flatMap$argument_0","page.map$argument_0","<anonymous>"],"mappings":"AAA;wBCa;YCI;QCa;YC6B;+CCS;yBCC,WD,CD;aDW;SDO;WKI;KLE;GDC;CDC"},"hasCjsExports":false},"type":"js/module"}]}
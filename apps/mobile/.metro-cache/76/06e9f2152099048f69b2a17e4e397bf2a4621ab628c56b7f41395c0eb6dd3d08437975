{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":68,"index":68}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":69},"end":{"line":2,"column":44,"index":113}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":114},"end":{"line":3,"column":42,"index":156}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"@/context/AuthProvider","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":157},"end":{"line":4,"column":49,"index":206}}],"key":"hnDMt1RwOyVwgo481TGNr6ITBm4=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":207},"end":{"line":5,"column":43,"index":250}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1], \"@tanstack/react-query\");\n  var _react = require(_dependencyMap[2], \"react\");\n  var _libSupabase = require(_dependencyMap[3], \"@/lib/supabase\");\n  var _contextAuthProvider = require(_dependencyMap[4], \"@/context/AuthProvider\");\n  var _queryKeys = require(_dependencyMap[5], \"../../queryKeys\");\n  /**\n   * Upserts the user's read position for a conversation.\n   * Call on conversation mount and when new messages arrive while focused.\n   * Invalidates conversation list to update unread badges.\n   */\n  var useMarkAsRead = function useMarkAsRead(conversationId) {\n    _s();\n    var queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    var _useAuth = (0, _contextAuthProvider.useAuth)(),\n      user = _useAuth.user;\n    var lastMarkedRef = (0, _react.useRef)(null);\n    var mutation = (0, _tanstackReactQuery.useMutation)({\n      mutationFn: function () {\n        var _mutationFn = (0, _asyncToGenerator.default)(function* (_ref) {\n          var conversationId = _ref.conversationId,\n            lastMessageId = _ref.lastMessageId;\n          if (!user) throw new Error('Not authenticated');\n          var _yield$supabase$from$ = yield _libSupabase.supabase.from('conversation_reads').upsert({\n              conversation_id: conversationId,\n              user_id: user.id,\n              last_read_message_id: lastMessageId != null ? lastMessageId : null,\n              last_read_at: new Date().toISOString()\n            }, {\n              onConflict: 'conversation_id,user_id'\n            }),\n            error = _yield$supabase$from$.error;\n          if (error) throw error;\n        });\n        function mutationFn(_x) {\n          return _mutationFn.apply(this, arguments);\n        }\n        return mutationFn;\n      }(),\n      onSuccess: function onSuccess() {\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.chatKeys.conversations()\n        });\n      }\n    });\n    var markAsRead = (0, _react.useCallback)(function (lastMessageId) {\n      // Deduplicate: don't re-mark the same message\n      if (lastMessageId && lastMessageId === lastMarkedRef.current) return;\n      if (lastMessageId) lastMarkedRef.current = lastMessageId;\n      mutation.mutate({\n        conversationId: conversationId,\n        lastMessageId: lastMessageId\n      });\n    }, [conversationId, mutation]);\n    return Object.assign({\n      markAsRead: markAsRead\n    }, mutation);\n  };\n  _s(useMarkAsRead, \"S5KlCUq9Srcgb3vT34TftGyoJe4=\", false, function () {\n    return [_tanstackReactQuery.useQueryClient, _contextAuthProvider.useAuth, _tanstackReactQuery.useMutation];\n  });\n  var _default = useMarkAsRead;\n});","lineCount":82,"map":[[13,2,59,0,"Object"],[13,8,59,0],[13,9,59,0,"defineProperty"],[13,23,59,0],[13,24,59,0,"exports"],[13,31,59,0],[14,4,59,0,"enumerable"],[14,14,59,0],[15,4,59,0,"get"],[15,7,59,0],[15,18,59,0,"get"],[15,19,59,0],[16,6,59,0],[16,13,59,0,"_default"],[16,21,59,0],[17,4,59,0],[18,2,59,0],[19,2,59,29],[19,6,59,29,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,59,29],[19,45,59,29,"require"],[19,52,59,29],[19,53,59,29,"_dependencyMap"],[19,67,59,29],[20,2,59,29],[20,6,59,29,"_asyncToGenerator"],[20,23,59,29],[20,26,59,29,"_interopDefault"],[20,41,59,29],[20,42,59,29,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,59,29],[21,2,1,0],[21,6,1,0,"_tanstackReactQuery"],[21,25,1,0],[21,28,1,0,"require"],[21,35,1,0],[21,36,1,0,"_dependencyMap"],[21,50,1,0],[22,2,2,0],[22,6,2,0,"_react"],[22,12,2,0],[22,15,2,0,"require"],[22,22,2,0],[22,23,2,0,"_dependencyMap"],[22,37,2,0],[23,2,3,0],[23,6,3,0,"_libSupabase"],[23,18,3,0],[23,21,3,0,"require"],[23,28,3,0],[23,29,3,0,"_dependencyMap"],[23,43,3,0],[24,2,4,0],[24,6,4,0,"_contextAuthProvider"],[24,26,4,0],[24,29,4,0,"require"],[24,36,4,0],[24,37,4,0,"_dependencyMap"],[24,51,4,0],[25,2,5,0],[25,6,5,0,"_queryKeys"],[25,16,5,0],[25,19,5,0,"require"],[25,26,5,0],[25,27,5,0,"_dependencyMap"],[25,41,5,0],[26,2,12,0],[27,0,13,0],[28,0,14,0],[29,0,15,0],[30,0,16,0],[31,2,17,0],[31,6,17,6,"useMarkAsRead"],[31,19,17,19],[31,22,17,22],[31,31,17,6,"useMarkAsRead"],[31,44,17,19,"useMarkAsRead"],[31,45,17,23,"conversationId"],[31,59,17,45],[31,61,17,50],[32,4,17,50,"_s"],[32,6,17,50],[33,4,18,2],[33,8,18,8,"queryClient"],[33,19,18,19],[33,22,18,22],[33,26,18,22,"useQueryClient"],[33,45,18,36],[33,46,18,36,"useQueryClient"],[33,60,18,36],[33,62,18,37],[33,63,18,38],[34,4,19,2],[34,8,19,2,"_useAuth"],[34,16,19,2],[34,19,19,19],[34,23,19,19,"useAuth"],[34,43,19,26],[34,44,19,26,"useAuth"],[34,51,19,26],[34,53,19,27],[34,54,19,28],[35,6,19,10,"user"],[35,10,19,14],[35,13,19,14,"_useAuth"],[35,21,19,14],[35,22,19,10,"user"],[35,26,19,14],[36,4,20,2],[36,8,20,8,"lastMarkedRef"],[36,21,20,21],[36,24,20,24],[36,28,20,24,"useRef"],[36,34,20,30],[36,35,20,30,"useRef"],[36,41,20,30],[36,43,20,46],[36,47,20,50],[36,48,20,51],[37,4,22,2],[37,8,22,8,"mutation"],[37,16,22,16],[37,19,22,19],[37,23,22,19,"useMutation"],[37,42,22,30],[37,43,22,30,"useMutation"],[37,54,22,30],[37,56,22,31],[38,6,23,4,"mutationFn"],[38,16,23,14],[39,8,23,14],[39,12,23,14,"_mutationFn"],[39,23,23,14],[39,30,23,14,"_asyncToGenerator"],[39,47,23,14],[39,48,23,14,"default"],[39,55,23,14],[39,57,23,16],[39,68,23,16,"_ref"],[39,72,23,16],[39,74,23,79],[40,10,23,79],[40,14,23,25,"conversationId"],[40,28,23,39],[40,31,23,39,"_ref"],[40,35,23,39],[40,36,23,25,"conversationId"],[40,50,23,39],[41,12,23,41,"lastMessageId"],[41,25,23,54],[41,28,23,54,"_ref"],[41,32,23,54],[41,33,23,41,"lastMessageId"],[41,46,23,54],[42,10,24,6],[42,14,24,10],[42,15,24,11,"user"],[42,19,24,15],[42,21,24,17],[42,27,24,23],[42,31,24,27,"Error"],[42,36,24,32],[42,37,24,33],[42,56,24,52],[42,57,24,53],[43,10,26,6],[43,14,26,6,"_yield$supabase$from$"],[43,35,26,6],[43,44,26,30,"supabase"],[43,56,26,38],[43,57,26,38,"supabase"],[43,65,26,38],[43,66,27,9,"from"],[43,70,27,13],[43,71,27,14],[43,91,27,34],[43,92,27,35],[43,93,28,9,"upsert"],[43,99,28,15],[43,100,29,10],[44,14,30,12,"conversation_id"],[44,29,30,27],[44,31,30,29,"conversationId"],[44,45,30,43],[45,14,31,12,"user_id"],[45,21,31,19],[45,23,31,21,"user"],[45,27,31,25],[45,28,31,26,"id"],[45,30,31,28],[46,14,32,12,"last_read_message_id"],[46,34,32,32],[46,36,32,34,"lastMessageId"],[46,49,32,47],[46,60,32,34,"lastMessageId"],[46,73,32,47],[46,76,32,51],[46,80,32,55],[47,14,33,12,"last_read_at"],[47,26,33,24],[47,28,33,26],[47,32,33,30,"Date"],[47,36,33,34],[47,37,33,35],[47,38,33,36],[47,39,33,37,"toISOString"],[47,50,33,48],[47,51,33,49],[48,12,34,10],[48,13,34,11],[48,15,35,10],[49,14,35,12,"onConflict"],[49,24,35,22],[49,26,35,24],[50,12,35,50],[50,13,36,8],[50,14,36,9],[51,12,26,14,"error"],[51,17,26,19],[51,20,26,19,"_yield$supabase$from$"],[51,41,26,19],[51,42,26,14,"error"],[51,47,26,19],[52,10,38,6],[52,14,38,10,"error"],[52,19,38,15],[52,21,38,17],[52,27,38,23,"error"],[52,32,38,28],[53,8,39,4],[53,9,39,5],[54,8,39,5],[54,17,23,4,"mutationFn"],[54,27,23,14,"mutationFn"],[54,28,23,14,"_x"],[54,30,23,14],[55,10,23,14],[55,17,23,14,"_mutationFn"],[55,28,23,14],[55,29,23,14,"apply"],[55,34,23,14],[55,41,23,14,"arguments"],[55,50,23,14],[56,8,23,14],[57,8,23,14],[57,15,23,4,"mutationFn"],[57,25,23,14],[58,6,23,14],[58,9,39,5],[59,6,40,4,"onSuccess"],[59,15,40,13],[59,17,40,15],[59,26,40,4,"onSuccess"],[59,35,40,13,"onSuccess"],[59,36,40,13],[59,38,40,21],[60,8,41,6,"queryClient"],[60,19,41,17],[60,20,41,18,"invalidateQueries"],[60,37,41,35],[60,38,41,36],[61,10,41,38,"queryKey"],[61,18,41,46],[61,20,41,48,"chatKeys"],[61,30,41,56],[61,31,41,56,"chatKeys"],[61,39,41,56],[61,40,41,57,"conversations"],[61,53,41,70],[61,54,41,71],[62,8,41,73],[62,9,41,74],[62,10,41,75],[63,6,42,4],[64,4,43,2],[64,5,43,3],[64,6,43,4],[65,4,45,2],[65,8,45,8,"markAsRead"],[65,18,45,18],[65,21,45,21],[65,25,45,21,"useCallback"],[65,31,45,32],[65,32,45,32,"useCallback"],[65,43,45,32],[65,45,46,4],[65,55,46,5,"lastMessageId"],[65,68,46,34],[65,70,46,39],[66,6,47,6],[67,6,48,6],[67,10,48,10,"lastMessageId"],[67,23,48,23],[67,27,48,27,"lastMessageId"],[67,40,48,40],[67,45,48,45,"lastMarkedRef"],[67,58,48,58],[67,59,48,59,"current"],[67,66,48,66],[67,68,48,68],[68,6,49,6],[68,10,49,10,"lastMessageId"],[68,23,49,23],[68,25,49,25,"lastMarkedRef"],[68,38,49,38],[68,39,49,39,"current"],[68,46,49,46],[68,49,49,49,"lastMessageId"],[68,62,49,62],[69,6,51,6,"mutation"],[69,14,51,14],[69,15,51,15,"mutate"],[69,21,51,21],[69,22,51,22],[70,8,51,24,"conversationId"],[70,22,51,38],[70,24,51,24,"conversationId"],[70,38,51,38],[71,8,51,40,"lastMessageId"],[71,21,51,53],[71,23,51,40,"lastMessageId"],[72,6,51,54],[72,7,51,55],[72,8,51,56],[73,4,52,4],[73,5,52,5],[73,7,53,4],[73,8,53,5,"conversationId"],[73,22,53,19],[73,24,53,21,"mutation"],[73,32,53,29],[73,33,54,2],[73,34,54,3],[74,4,56,2],[74,11,56,2,"Object"],[74,17,56,2],[74,18,56,2,"assign"],[74,24,56,2],[75,6,56,11,"markAsRead"],[75,16,56,21],[75,18,56,11,"markAsRead"],[76,4,56,21],[76,7,56,26,"mutation"],[76,15,56,34],[77,2,57,0],[77,3,57,1],[78,2,57,2,"_s"],[78,4,57,2],[78,5,17,6,"useMarkAsRead"],[78,18,17,19],[79,4,17,19],[79,12,18,22,"useQueryClient"],[79,31,18,36],[79,32,18,36,"useQueryClient"],[79,46,18,36],[79,48,19,19,"useAuth"],[79,68,19,26],[79,69,19,26,"useAuth"],[79,76,19,26],[79,78,22,19,"useMutation"],[79,97,22,30],[79,98,22,30,"useMutation"],[79,109,22,30],[80,2,22,30],[81,2,59,0],[81,6,59,0,"_default"],[81,14,59,0],[81,17,59,15,"useMarkAsRead"],[81,30,59,28],[82,0,59,29],[82,3]],"functionMap":{"names":["<global>","useMarkAsRead","useMutation$argument_0.mutationFn","useMutation$argument_0.onSuccess","markAsRead"],"mappings":"AAA;sBCgB;gBCM;KDgB;eEC;KFE;IGI;KHM;CDK"},"hasCjsExports":false},"type":"js/module"}]}
{"dependencies":[{"name":"@babel/runtime/helpers/slicedToArray","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"5y7e5+zC7teYEEC6niD9f5zII1M=","exportNames":["*"],"imports":1}},{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":65,"index":65}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":66},"end":{"line":2,"column":42,"index":108}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"@/context/AuthProvider","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":109},"end":{"line":3,"column":49,"index":158}}],"key":"hnDMt1RwOyVwgo481TGNr6ITBm4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersSlicedToArray = require(_dependencyMap[0]);\n  var _slicedToArray = _interopDefault(_babelRuntimeHelpersSlicedToArray);\n  var _react = require(_dependencyMap[1]);\n  var _libSupabase = require(_dependencyMap[2]);\n  var _contextAuthProvider = require(_dependencyMap[3]);\n  var THROTTLE_MS = 2_000;\n  var AUTO_CLEAR_MS = 4_000;\n  /**\n   * Broadcast-based typing indicator for a conversation.\n   *\n   * Uses Supabase Realtime Broadcast (no persistence) on channel `typing:{conversationId}`.\n   * - `sendTypingStart()` fires at most once every 2 s.\n   * - `sendTypingStop()` fires immediately.\n   * - `isOtherUserTyping` auto-clears after 4 s without a stop event.\n   */\n  var useTypingIndicator = conversationId => {\n    var _useAuth = (0, _contextAuthProvider.useAuth)(),\n      user = _useAuth.user;\n    var _useState = (0, _react.useState)(false),\n      _useState2 = (0, _slicedToArray.default)(_useState, 2),\n      isOtherUserTyping = _useState2[0],\n      setIsOtherUserTyping = _useState2[1];\n    var lastSentRef = (0, _react.useRef)(0);\n    var clearTimerRef = (0, _react.useRef)(null);\n    var channelRef = (0, _react.useRef)(null);\n\n    // Subscribe to typing events from the other user\n    (0, _react.useEffect)(() => {\n      if (!conversationId || !user) return;\n      var channel = _libSupabase.supabase.channel(`typing:${conversationId}`);\n      channelRef.current = channel;\n      channel.on('broadcast', {\n        event: 'typing'\n      }, _ref => {\n        var payload = _ref.payload;\n        var data = payload;\n        if (data.userId === user.id) return; // Ignore own events\n\n        if (data.event === 'start') {\n          setIsOtherUserTyping(true);\n\n          // Auto-clear after 4 s\n          if (clearTimerRef.current) clearTimeout(clearTimerRef.current);\n          clearTimerRef.current = setTimeout(() => {\n            setIsOtherUserTyping(false);\n          }, AUTO_CLEAR_MS);\n        } else {\n          setIsOtherUserTyping(false);\n          if (clearTimerRef.current) clearTimeout(clearTimerRef.current);\n        }\n      }).subscribe();\n      return () => {\n        if (clearTimerRef.current) clearTimeout(clearTimerRef.current);\n        _libSupabase.supabase.removeChannel(channel);\n        channelRef.current = null;\n      };\n    }, [conversationId, user]);\n    var sendTypingStart = (0, _react.useCallback)(() => {\n      if (!user || !channelRef.current) return;\n      var now = Date.now();\n      if (now - lastSentRef.current < THROTTLE_MS) return;\n      lastSentRef.current = now;\n      channelRef.current.send({\n        type: 'broadcast',\n        event: 'typing',\n        payload: {\n          userId: user.id,\n          event: 'start'\n        }\n      });\n    }, [user]);\n    var sendTypingStop = (0, _react.useCallback)(() => {\n      if (!user || !channelRef.current) return;\n      lastSentRef.current = 0; // Reset throttle so next start fires immediately\n\n      channelRef.current.send({\n        type: 'broadcast',\n        event: 'typing',\n        payload: {\n          userId: user.id,\n          event: 'stop'\n        }\n      });\n    }, [user]);\n    return {\n      isOtherUserTyping,\n      sendTypingStart,\n      sendTypingStop\n    };\n  };\n  var _default = useTypingIndicator;\n});","lineCount":109,"map":[[12,2,91,0,"Object"],[12,8,91,0],[12,9,91,0,"defineProperty"],[12,23,91,0],[12,24,91,0,"exports"],[12,31,91,0],[13,4,91,0,"enumerable"],[13,14,91,0],[14,4,91,0,"get"],[14,7,91,0],[14,18,91,0,"get"],[14,19,91,0],[15,6,91,0],[15,13,91,0,"_default"],[15,21,91,0],[16,4,91,0],[17,2,91,0],[18,2,91,34],[18,6,91,34,"_babelRuntimeHelpersSlicedToArray"],[18,39,91,34],[18,42,91,34,"require"],[18,49,91,34],[18,50,91,34,"_dependencyMap"],[18,64,91,34],[19,2,91,34],[19,6,91,34,"_slicedToArray"],[19,20,91,34],[19,23,91,34,"_interopDefault"],[19,38,91,34],[19,39,91,34,"_babelRuntimeHelpersSlicedToArray"],[19,72,91,34],[20,2,1,0],[20,6,1,0,"_react"],[20,12,1,0],[20,15,1,0,"require"],[20,22,1,0],[20,23,1,0,"_dependencyMap"],[20,37,1,0],[21,2,2,0],[21,6,2,0,"_libSupabase"],[21,18,2,0],[21,21,2,0,"require"],[21,28,2,0],[21,29,2,0,"_dependencyMap"],[21,43,2,0],[22,2,3,0],[22,6,3,0,"_contextAuthProvider"],[22,26,3,0],[22,29,3,0,"require"],[22,36,3,0],[22,37,3,0,"_dependencyMap"],[22,51,3,0],[23,2,5,0],[23,6,5,6,"THROTTLE_MS"],[23,17,5,17],[23,20,5,20],[23,25,5,25],[24,2,6,0],[24,6,6,6,"AUTO_CLEAR_MS"],[24,19,6,19],[24,22,6,22],[24,27,6,27],[25,2,13,0],[26,0,14,0],[27,0,15,0],[28,0,16,0],[29,0,17,0],[30,0,18,0],[31,0,19,0],[32,0,20,0],[33,2,21,0],[33,6,21,6,"useTypingIndicator"],[33,24,21,24],[33,27,21,28,"conversationId"],[33,41,21,50],[33,45,21,55],[34,4,22,2],[34,8,22,2,"_useAuth"],[34,16,22,2],[34,19,22,19],[34,23,22,19,"useAuth"],[34,43,22,26],[34,44,22,26,"useAuth"],[34,51,22,26],[34,53,22,27],[34,54,22,28],[35,6,22,10,"user"],[35,10,22,14],[35,13,22,14,"_useAuth"],[35,21,22,14],[35,22,22,10,"user"],[35,26,22,14],[36,4,23,2],[36,8,23,2,"_useState"],[36,17,23,2],[36,20,23,52],[36,24,23,52,"useState"],[36,30,23,60],[36,31,23,60,"useState"],[36,39,23,60],[36,41,23,61],[36,46,23,66],[36,47,23,67],[37,6,23,67,"_useState2"],[37,16,23,67],[37,23,23,67,"_slicedToArray"],[37,37,23,67],[37,38,23,67,"default"],[37,45,23,67],[37,47,23,67,"_useState"],[37,56,23,67],[38,6,23,9,"isOtherUserTyping"],[38,23,23,26],[38,26,23,26,"_useState2"],[38,36,23,26],[39,6,23,28,"setIsOtherUserTyping"],[39,26,23,48],[39,29,23,48,"_useState2"],[39,39,23,48],[40,4,24,2],[40,8,24,8,"lastSentRef"],[40,19,24,19],[40,22,24,22],[40,26,24,22,"useRef"],[40,32,24,28],[40,33,24,28,"useRef"],[40,39,24,28],[40,41,24,29],[40,42,24,30],[40,43,24,31],[41,4,25,2],[41,8,25,8,"clearTimerRef"],[41,21,25,21],[41,24,25,24],[41,28,25,24,"useRef"],[41,34,25,30],[41,35,25,30,"useRef"],[41,41,25,30],[41,43,25,69],[41,47,25,73],[41,48,25,74],[42,4,26,2],[42,8,26,8,"channelRef"],[42,18,26,18],[42,21,26,21],[42,25,26,21,"useRef"],[42,31,26,27],[42,32,26,27,"useRef"],[42,38,26,27],[42,40,26,72],[42,44,26,76],[42,45,26,77],[44,4,28,2],[45,4,29,2],[45,8,29,2,"useEffect"],[45,14,29,11],[45,15,29,11,"useEffect"],[45,24,29,11],[45,26,29,12],[45,32,29,18],[46,6,30,4],[46,10,30,8],[46,11,30,9,"conversationId"],[46,25,30,23],[46,29,30,27],[46,30,30,28,"user"],[46,34,30,32],[46,36,30,34],[47,6,32,4],[47,10,32,10,"channel"],[47,17,32,17],[47,20,32,20,"supabase"],[47,32,32,28],[47,33,32,28,"supabase"],[47,41,32,28],[47,42,32,29,"channel"],[47,49,32,36],[47,50,32,37],[47,60,32,47,"conversationId"],[47,74,32,61],[47,76,32,63],[47,77,32,64],[48,6,33,4,"channelRef"],[48,16,33,14],[48,17,33,15,"current"],[48,24,33,22],[48,27,33,25,"channel"],[48,34,33,32],[49,6,35,4,"channel"],[49,13,35,11],[49,14,36,7,"on"],[49,16,36,9],[49,17,36,10],[49,28,36,21],[49,30,36,23],[50,8,36,25,"event"],[50,13,36,30],[50,15,36,32],[51,6,36,41],[51,7,36,42],[51,9,36,44,"_ref"],[51,13,36,44],[51,17,36,61],[52,8,36,61],[52,12,36,47,"payload"],[52,19,36,54],[52,22,36,54,"_ref"],[52,26,36,54],[52,27,36,47,"payload"],[52,34,36,54],[53,8,37,8],[53,12,37,14,"data"],[53,16,37,18],[53,19,37,21,"payload"],[53,26,37,43],[54,8,38,8],[54,12,38,12,"data"],[54,16,38,16],[54,17,38,17,"userId"],[54,23,38,23],[54,28,38,28,"user"],[54,32,38,32],[54,33,38,33,"id"],[54,35,38,35],[54,37,38,37],[54,44,38,44],[54,45,38,45],[56,8,40,8],[56,12,40,12,"data"],[56,16,40,16],[56,17,40,17,"event"],[56,22,40,22],[56,27,40,27],[56,34,40,34],[56,36,40,36],[57,10,41,10,"setIsOtherUserTyping"],[57,30,41,30],[57,31,41,31],[57,35,41,35],[57,36,41,36],[59,10,43,10],[60,10,44,10],[60,14,44,14,"clearTimerRef"],[60,27,44,27],[60,28,44,28,"current"],[60,35,44,35],[60,37,44,37,"clearTimeout"],[60,49,44,49],[60,50,44,50,"clearTimerRef"],[60,63,44,63],[60,64,44,64,"current"],[60,71,44,71],[60,72,44,72],[61,10,45,10,"clearTimerRef"],[61,23,45,23],[61,24,45,24,"current"],[61,31,45,31],[61,34,45,34,"setTimeout"],[61,44,45,44],[61,45,45,45],[61,51,45,51],[62,12,46,12,"setIsOtherUserTyping"],[62,32,46,32],[62,33,46,33],[62,38,46,38],[62,39,46,39],[63,10,47,10],[63,11,47,11],[63,13,47,13,"AUTO_CLEAR_MS"],[63,26,47,26],[63,27,47,27],[64,8,48,8],[64,9,48,9],[64,15,48,15],[65,10,49,10,"setIsOtherUserTyping"],[65,30,49,30],[65,31,49,31],[65,36,49,36],[65,37,49,37],[66,10,50,10],[66,14,50,14,"clearTimerRef"],[66,27,50,27],[66,28,50,28,"current"],[66,35,50,35],[66,37,50,37,"clearTimeout"],[66,49,50,49],[66,50,50,50,"clearTimerRef"],[66,63,50,63],[66,64,50,64,"current"],[66,71,50,71],[66,72,50,72],[67,8,51,8],[68,6,52,6],[68,7,52,7],[68,8,52,8],[68,9,53,7,"subscribe"],[68,18,53,16],[68,19,53,17],[68,20,53,18],[69,6,55,4],[69,13,55,11],[69,19,55,17],[70,8,56,6],[70,12,56,10,"clearTimerRef"],[70,25,56,23],[70,26,56,24,"current"],[70,33,56,31],[70,35,56,33,"clearTimeout"],[70,47,56,45],[70,48,56,46,"clearTimerRef"],[70,61,56,59],[70,62,56,60,"current"],[70,69,56,67],[70,70,56,68],[71,8,57,6,"supabase"],[71,20,57,14],[71,21,57,14,"supabase"],[71,29,57,14],[71,30,57,15,"removeChannel"],[71,43,57,28],[71,44,57,29,"channel"],[71,51,57,36],[71,52,57,37],[72,8,58,6,"channelRef"],[72,18,58,16],[72,19,58,17,"current"],[72,26,58,24],[72,29,58,27],[72,33,58,31],[73,6,59,4],[73,7,59,5],[74,4,60,2],[74,5,60,3],[74,7,60,5],[74,8,60,6,"conversationId"],[74,22,60,20],[74,24,60,22,"user"],[74,28,60,26],[74,29,60,27],[74,30,60,28],[75,4,62,2],[75,8,62,8,"sendTypingStart"],[75,23,62,23],[75,26,62,26],[75,30,62,26,"useCallback"],[75,36,62,37],[75,37,62,37,"useCallback"],[75,48,62,37],[75,50,62,38],[75,56,62,44],[76,6,63,4],[76,10,63,8],[76,11,63,9,"user"],[76,15,63,13],[76,19,63,17],[76,20,63,18,"channelRef"],[76,30,63,28],[76,31,63,29,"current"],[76,38,63,36],[76,40,63,38],[77,6,65,4],[77,10,65,10,"now"],[77,13,65,13],[77,16,65,16,"Date"],[77,20,65,20],[77,21,65,21,"now"],[77,24,65,24],[77,25,65,25],[77,26,65,26],[78,6,66,4],[78,10,66,8,"now"],[78,13,66,11],[78,16,66,14,"lastSentRef"],[78,27,66,25],[78,28,66,26,"current"],[78,35,66,33],[78,38,66,36,"THROTTLE_MS"],[78,49,66,47],[78,51,66,49],[79,6,67,4,"lastSentRef"],[79,17,67,15],[79,18,67,16,"current"],[79,25,67,23],[79,28,67,26,"now"],[79,31,67,29],[80,6,69,4,"channelRef"],[80,16,69,14],[80,17,69,15,"current"],[80,24,69,22],[80,25,69,23,"send"],[80,29,69,27],[80,30,69,28],[81,8,70,6,"type"],[81,12,70,10],[81,14,70,12],[81,25,70,23],[82,8,71,6,"event"],[82,13,71,11],[82,15,71,13],[82,23,71,21],[83,8,72,6,"payload"],[83,15,72,13],[83,17,72,15],[84,10,72,17,"userId"],[84,16,72,23],[84,18,72,25,"user"],[84,22,72,29],[84,23,72,30,"id"],[84,25,72,32],[85,10,72,34,"event"],[85,15,72,39],[85,17,72,41],[86,8,72,49],[87,6,73,4],[87,7,73,5],[87,8,73,6],[88,4,74,2],[88,5,74,3],[88,7,74,5],[88,8,74,6,"user"],[88,12,74,10],[88,13,74,11],[88,14,74,12],[89,4,76,2],[89,8,76,8,"sendTypingStop"],[89,22,76,22],[89,25,76,25],[89,29,76,25,"useCallback"],[89,35,76,36],[89,36,76,36,"useCallback"],[89,47,76,36],[89,49,76,37],[89,55,76,43],[90,6,77,4],[90,10,77,8],[90,11,77,9,"user"],[90,15,77,13],[90,19,77,17],[90,20,77,18,"channelRef"],[90,30,77,28],[90,31,77,29,"current"],[90,38,77,36],[90,40,77,38],[91,6,79,4,"lastSentRef"],[91,17,79,15],[91,18,79,16,"current"],[91,25,79,23],[91,28,79,26],[91,29,79,27],[91,30,79,28],[91,31,79,29],[93,6,81,4,"channelRef"],[93,16,81,14],[93,17,81,15,"current"],[93,24,81,22],[93,25,81,23,"send"],[93,29,81,27],[93,30,81,28],[94,8,82,6,"type"],[94,12,82,10],[94,14,82,12],[94,25,82,23],[95,8,83,6,"event"],[95,13,83,11],[95,15,83,13],[95,23,83,21],[96,8,84,6,"payload"],[96,15,84,13],[96,17,84,15],[97,10,84,17,"userId"],[97,16,84,23],[97,18,84,25,"user"],[97,22,84,29],[97,23,84,30,"id"],[97,25,84,32],[98,10,84,34,"event"],[98,15,84,39],[98,17,84,41],[99,8,84,48],[100,6,85,4],[100,7,85,5],[100,8,85,6],[101,4,86,2],[101,5,86,3],[101,7,86,5],[101,8,86,6,"user"],[101,12,86,10],[101,13,86,11],[101,14,86,12],[102,4,88,2],[102,11,88,9],[103,6,88,11,"isOtherUserTyping"],[103,23,88,28],[104,6,88,30,"sendTypingStart"],[104,21,88,45],[105,6,88,47,"sendTypingStop"],[106,4,88,62],[106,5,88,63],[107,2,89,0],[107,3,89,1],[108,2,91,0],[108,6,91,0,"_default"],[108,14,91,0],[108,17,91,15,"useTypingIndicator"],[108,35,91,33],[109,0,91,34],[109,3]],"functionMap":{"names":["<global>","useTypingIndicator","useEffect$argument_0","channel.on$argument_2","setTimeout$argument_0","<anonymous>","sendTypingStart","sendTypingStop"],"mappings":"AAA;2BCoB;YCQ;4CCO;6CCS;WDE;ODK;WGG;KHI;GDC;sCKE;GLY;qCME;GNU;CDG"},"hasCjsExports":false},"type":"js/module"}]}
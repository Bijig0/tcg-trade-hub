{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":68,"index":68}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"expo-router","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":69},"end":{"line":2,"column":40,"index":109}}],"key":"/+ErnBisjrT6aDU+GRp5Qz/lYoY=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":110},"end":{"line":3,"column":42,"index":152}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":153},"end":{"line":4,"column":46,"index":199}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1], \"@tanstack/react-query\");\n  var _expoRouter = require(_dependencyMap[2], \"expo-router\");\n  var _libSupabase = require(_dependencyMap[3], \"@/lib/supabase\");\n  var _queryKeys = require(_dependencyMap[4], \"../../queryKeys\");\n  /**\n   * Mutation that accepts or declines an offer via atomic Postgres RPC.\n   *\n   * On accept: atomically accepts the offer, declines all sibling offers,\n   * creates a match + conversation, and transitions the listing to matched.\n   * Then navigates to the new chat.\n   *\n   * On decline: atomically declines the single offer.\n   *\n   * @see packages/api/src/pipelines/acceptOffer/acceptOffer.ts\n   * @see packages/api/src/pipelines/declineOffer/declineOffer.ts\n   */\n  var useRespondToOffer = function useRespondToOffer() {\n    _s();\n    var queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    var router = (0, _expoRouter.useRouter)();\n    return (0, _tanstackReactQuery.useMutation)({\n      mutationFn: function () {\n        var _mutationFn = (0, _asyncToGenerator.default)(function* (_ref) {\n          var _session$user;\n          var offerId = _ref.offerId,\n            listingId = _ref.listingId,\n            action = _ref.action;\n          var _yield$supabase$auth$ = yield _libSupabase.supabase.auth.getSession(),\n            session = _yield$supabase$auth$.data.session;\n          var userId = session == null || (_session$user = session.user) == null ? void 0 : _session$user.id;\n          if (!userId) throw new Error('Not authenticated');\n          if (action === 'accepted') {\n            var _yield$supabase$rpc = yield _libSupabase.supabase.rpc('accept_offer_v1', {\n                p_offer_id: offerId,\n                p_listing_id: listingId,\n                p_user_id: userId\n              }),\n              data = _yield$supabase$rpc.data,\n              _error = _yield$supabase$rpc.error;\n            if (_error) throw _error;\n            var result = data;\n            return {\n              match_id: result.match_id,\n              conversation_id: result.conversation_id\n            };\n          }\n\n          // Decline\n          var _yield$supabase$rpc2 = yield _libSupabase.supabase.rpc('decline_offer_v1', {\n              p_offer_id: offerId,\n              p_user_id: userId\n            }),\n            error = _yield$supabase$rpc2.error;\n          if (error) throw error;\n          return {\n            match_id: null,\n            conversation_id: null\n          };\n        });\n        function mutationFn(_x) {\n          return _mutationFn.apply(this, arguments);\n        }\n        return mutationFn;\n      }(),\n      onSuccess: function onSuccess(data, variables) {\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.offers(variables.listingId)\n        });\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.myListings()\n        });\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.detail(variables.listingId)\n        });\n        if (data.conversation_id) {\n          router.push(`/(tabs)/(messages)/chat/${data.conversation_id}`);\n        }\n      }\n    });\n  };\n  _s(useRespondToOffer, \"OMPBWmuGqcicNpy0gW6DnCxqRr0=\", false, function () {\n    return [_tanstackReactQuery.useQueryClient, _expoRouter.useRouter, _tanstackReactQuery.useMutation];\n  });\n  var _default = useRespondToOffer;\n});","lineCount":105,"map":[[13,2,80,0,"Object"],[13,8,80,0],[13,9,80,0,"defineProperty"],[13,23,80,0],[13,24,80,0,"exports"],[13,31,80,0],[14,4,80,0,"enumerable"],[14,14,80,0],[15,4,80,0,"get"],[15,7,80,0],[15,18,80,0,"get"],[15,19,80,0],[16,6,80,0],[16,13,80,0,"_default"],[16,21,80,0],[17,4,80,0],[18,2,80,0],[19,2,80,33],[19,6,80,33,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,80,33],[19,45,80,33,"require"],[19,52,80,33],[19,53,80,33,"_dependencyMap"],[19,67,80,33],[20,2,80,33],[20,6,80,33,"_asyncToGenerator"],[20,23,80,33],[20,26,80,33,"_interopDefault"],[20,41,80,33],[20,42,80,33,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,80,33],[21,2,1,0],[21,6,1,0,"_tanstackReactQuery"],[21,25,1,0],[21,28,1,0,"require"],[21,35,1,0],[21,36,1,0,"_dependencyMap"],[21,50,1,0],[22,2,2,0],[22,6,2,0,"_expoRouter"],[22,17,2,0],[22,20,2,0,"require"],[22,27,2,0],[22,28,2,0,"_dependencyMap"],[22,42,2,0],[23,2,3,0],[23,6,3,0,"_libSupabase"],[23,18,3,0],[23,21,3,0,"require"],[23,28,3,0],[23,29,3,0,"_dependencyMap"],[23,43,3,0],[24,2,4,0],[24,6,4,0,"_queryKeys"],[24,16,4,0],[24,19,4,0,"require"],[24,26,4,0],[24,27,4,0,"_dependencyMap"],[24,41,4,0],[25,2,17,0],[26,0,18,0],[27,0,19,0],[28,0,20,0],[29,0,21,0],[30,0,22,0],[31,0,23,0],[32,0,24,0],[33,0,25,0],[34,0,26,0],[35,0,27,0],[36,0,28,0],[37,2,29,0],[37,6,29,6,"useRespondToOffer"],[37,23,29,23],[37,26,29,26],[37,35,29,6,"useRespondToOffer"],[37,52,29,23,"useRespondToOffer"],[37,53,29,23],[37,55,29,32],[38,4,29,32,"_s"],[38,6,29,32],[39,4,30,2],[39,8,30,8,"queryClient"],[39,19,30,19],[39,22,30,22],[39,26,30,22,"useQueryClient"],[39,45,30,36],[39,46,30,36,"useQueryClient"],[39,60,30,36],[39,62,30,37],[39,63,30,38],[40,4,31,2],[40,8,31,8,"router"],[40,14,31,14],[40,17,31,17],[40,21,31,17,"useRouter"],[40,32,31,26],[40,33,31,26,"useRouter"],[40,42,31,26],[40,44,31,27],[40,45,31,28],[41,4,33,2],[41,11,33,9],[41,15,33,9,"useMutation"],[41,34,33,20],[41,35,33,20,"useMutation"],[41,46,33,20],[41,48,33,57],[42,6,34,4,"mutationFn"],[42,16,34,14],[43,8,34,14],[43,12,34,14,"_mutationFn"],[43,23,34,14],[43,30,34,14,"_asyncToGenerator"],[43,47,34,14],[43,48,34,14,"default"],[43,55,34,14],[43,57,34,16],[43,68,34,16,"_ref"],[43,72,34,16],[43,74,34,58],[44,10,34,58],[44,14,34,58,"_session$user"],[44,27,34,58],[45,10,34,58],[45,14,34,25,"offerId"],[45,21,34,32],[45,24,34,32,"_ref"],[45,28,34,32],[45,29,34,25,"offerId"],[45,36,34,32],[46,12,34,34,"listingId"],[46,21,34,43],[46,24,34,43,"_ref"],[46,28,34,43],[46,29,34,34,"listingId"],[46,38,34,43],[47,12,34,45,"action"],[47,18,34,51],[47,21,34,51,"_ref"],[47,25,34,51],[47,26,34,45,"action"],[47,32,34,51],[48,10,35,6],[48,14,35,6,"_yield$supabase$auth$"],[48,35,35,6],[48,44,37,16,"supabase"],[48,56,37,24],[48,57,37,24,"supabase"],[48,65,37,24],[48,66,37,25,"auth"],[48,70,37,29],[48,71,37,30,"getSession"],[48,81,37,40],[48,82,37,41],[48,83,37,42],[49,12,36,16,"session"],[49,19,36,23],[49,22,36,23,"_yield$supabase$auth$"],[49,43,36,23],[49,44,36,8,"data"],[49,48,36,12],[49,49,36,16,"session"],[49,56,36,23],[50,10,38,6],[50,14,38,12,"userId"],[50,20,38,18],[50,23,38,21,"session"],[50,30,38,28],[50,43,38,28,"_session$user"],[50,56,38,28],[50,59,38,21,"session"],[50,66,38,28],[50,67,38,30,"user"],[50,71,38,34],[50,92,38,21,"_session$user"],[50,105,38,21],[50,106,38,36,"id"],[50,108,38,38],[51,10,40,6],[51,14,40,10],[51,15,40,11,"userId"],[51,21,40,17],[51,23,40,19],[51,29,40,25],[51,33,40,29,"Error"],[51,38,40,34],[51,39,40,35],[51,58,40,54],[51,59,40,55],[52,10,42,6],[52,14,42,10,"action"],[52,20,42,16],[52,25,42,21],[52,35,42,31],[52,37,42,33],[53,12,43,8],[53,16,43,8,"_yield$supabase$rpc"],[53,35,43,8],[53,44,43,38,"supabase"],[53,56,43,46],[53,57,43,46,"supabase"],[53,65,43,46],[53,66,43,47,"rpc"],[53,69,43,50],[53,70,43,51],[53,87,43,68],[53,89,43,70],[54,16,44,10,"p_offer_id"],[54,26,44,20],[54,28,44,22,"offerId"],[54,35,44,29],[55,16,45,10,"p_listing_id"],[55,28,45,22],[55,30,45,24,"listingId"],[55,39,45,33],[56,16,46,10,"p_user_id"],[56,25,46,19],[56,27,46,21,"userId"],[57,14,47,8],[57,15,47,9],[57,16,47,10],[58,14,43,16,"data"],[58,18,43,20],[58,21,43,20,"_yield$supabase$rpc"],[58,40,43,20],[58,41,43,16,"data"],[58,45,43,20],[59,14,43,22,"error"],[59,20,43,27],[59,23,43,27,"_yield$supabase$rpc"],[59,42,43,27],[59,43,43,22,"error"],[59,48,43,27],[60,12,49,8],[60,16,49,12,"error"],[60,22,49,17],[60,24,49,19],[60,30,49,25,"error"],[60,36,49,30],[61,12,51,8],[61,16,51,14,"result"],[61,22,51,20],[61,25,51,23,"data"],[61,29,51,76],[62,12,52,8],[62,19,52,15],[63,14,53,10,"match_id"],[63,22,53,18],[63,24,53,20,"result"],[63,30,53,26],[63,31,53,27,"match_id"],[63,39,53,35],[64,14,54,10,"conversation_id"],[64,29,54,25],[64,31,54,27,"result"],[64,37,54,33],[64,38,54,34,"conversation_id"],[65,12,55,8],[65,13,55,9],[66,10,56,6],[68,10,58,6],[69,10,59,6],[69,14,59,6,"_yield$supabase$rpc2"],[69,34,59,6],[69,43,59,30,"supabase"],[69,55,59,38],[69,56,59,38,"supabase"],[69,64,59,38],[69,65,59,39,"rpc"],[69,68,59,42],[69,69,59,43],[69,87,59,61],[69,89,59,63],[70,14,60,8,"p_offer_id"],[70,24,60,18],[70,26,60,20,"offerId"],[70,33,60,27],[71,14,61,8,"p_user_id"],[71,23,61,17],[71,25,61,19,"userId"],[72,12,62,6],[72,13,62,7],[72,14,62,8],[73,12,59,14,"error"],[73,17,59,19],[73,20,59,19,"_yield$supabase$rpc2"],[73,40,59,19],[73,41,59,14,"error"],[73,46,59,19],[74,10,64,6],[74,14,64,10,"error"],[74,19,64,15],[74,21,64,17],[74,27,64,23,"error"],[74,32,64,28],[75,10,66,6],[75,17,66,13],[76,12,66,15,"match_id"],[76,20,66,23],[76,22,66,25],[76,26,66,29],[77,12,66,31,"conversation_id"],[77,27,66,46],[77,29,66,48],[78,10,66,53],[78,11,66,54],[79,8,67,4],[79,9,67,5],[80,8,67,5],[80,17,34,4,"mutationFn"],[80,27,34,14,"mutationFn"],[80,28,34,14,"_x"],[80,30,34,14],[81,10,34,14],[81,17,34,14,"_mutationFn"],[81,28,34,14],[81,29,34,14,"apply"],[81,34,34,14],[81,41,34,14,"arguments"],[81,50,34,14],[82,8,34,14],[83,8,34,14],[83,15,34,4,"mutationFn"],[83,25,34,14],[84,6,34,14],[84,9,67,5],[85,6,68,4,"onSuccess"],[85,15,68,13],[85,17,68,15],[85,26,68,4,"onSuccess"],[85,35,68,13,"onSuccess"],[85,36,68,16,"data"],[85,40,68,20],[85,42,68,22,"variables"],[85,51,68,31],[85,53,68,36],[86,8,69,6,"queryClient"],[86,19,69,17],[86,20,69,18,"invalidateQueries"],[86,37,69,35],[86,38,69,36],[87,10,69,38,"queryKey"],[87,18,69,46],[87,20,69,48,"listingKeys"],[87,30,69,59],[87,31,69,59,"listingKeys"],[87,42,69,59],[87,43,69,60,"offers"],[87,49,69,66],[87,50,69,67,"variables"],[87,59,69,76],[87,60,69,77,"listingId"],[87,69,69,86],[88,8,69,88],[88,9,69,89],[88,10,69,90],[89,8,70,6,"queryClient"],[89,19,70,17],[89,20,70,18,"invalidateQueries"],[89,37,70,35],[89,38,70,36],[90,10,70,38,"queryKey"],[90,18,70,46],[90,20,70,48,"listingKeys"],[90,30,70,59],[90,31,70,59,"listingKeys"],[90,42,70,59],[90,43,70,60,"myListings"],[90,53,70,70],[90,54,70,71],[91,8,70,73],[91,9,70,74],[91,10,70,75],[92,8,71,6,"queryClient"],[92,19,71,17],[92,20,71,18,"invalidateQueries"],[92,37,71,35],[92,38,71,36],[93,10,71,38,"queryKey"],[93,18,71,46],[93,20,71,48,"listingKeys"],[93,30,71,59],[93,31,71,59,"listingKeys"],[93,42,71,59],[93,43,71,60,"detail"],[93,49,71,66],[93,50,71,67,"variables"],[93,59,71,76],[93,60,71,77,"listingId"],[93,69,71,86],[94,8,71,88],[94,9,71,89],[94,10,71,90],[95,8,73,6],[95,12,73,10,"data"],[95,16,73,14],[95,17,73,15,"conversation_id"],[95,32,73,30],[95,34,73,32],[96,10,74,8,"router"],[96,16,74,14],[96,17,74,15,"push"],[96,21,74,19],[96,22,74,20],[96,49,74,47,"data"],[96,53,74,51],[96,54,74,52,"conversation_id"],[96,69,74,67],[96,71,74,69],[96,72,74,70],[97,8,75,6],[98,6,76,4],[99,4,77,2],[99,5,77,3],[99,6,77,4],[100,2,78,0],[100,3,78,1],[101,2,78,2,"_s"],[101,4,78,2],[101,5,29,6,"useRespondToOffer"],[101,22,29,23],[102,4,29,23],[102,12,30,22,"useQueryClient"],[102,31,30,36],[102,32,30,36,"useQueryClient"],[102,46,30,36],[102,48,31,17,"useRouter"],[102,59,31,26],[102,60,31,26,"useRouter"],[102,69,31,26],[102,71,33,9,"useMutation"],[102,90,33,20],[102,91,33,20,"useMutation"],[102,102,33,20],[103,2,33,20],[104,2,80,0],[104,6,80,0,"_default"],[104,14,80,0],[104,17,80,15,"useRespondToOffer"],[104,34,80,32],[105,0,80,33],[105,3]],"functionMap":{"names":["<global>","useRespondToOffer","useMutation$argument_0.mutationFn","useMutation$argument_0.onSuccess"],"mappings":"AAA;0BC4B;gBCK;KDiC;eEC;KFQ;CDE"},"hasCjsExports":false},"type":"js/module"}]}
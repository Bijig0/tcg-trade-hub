{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":68,"index":68}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":69},"end":{"line":2,"column":42,"index":111}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"@/context/AuthProvider","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":112},"end":{"line":3,"column":49,"index":161}}],"key":"hnDMt1RwOyVwgo481TGNr6ITBm4=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":162},"end":{"line":4,"column":43,"index":205}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0]);\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1]);\n  var _libSupabase = require(_dependencyMap[2]);\n  var _contextAuthProvider = require(_dependencyMap[3]);\n  var _queryKeys = require(_dependencyMap[4]);\n  /** Mutation hook that inserts a message with optimistic cache update */\n  var useSendMessage = () => {\n    var _useAuth = (0, _contextAuthProvider.useAuth)(),\n      user = _useAuth.user,\n      profile = _useAuth.profile;\n    var queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    return (0, _tanstackReactQuery.useMutation)({\n      mutationFn: function () {\n        var _ref = (0, _asyncToGenerator.default)(function* (input) {\n          if (!user) throw new Error('Must be signed in to send messages');\n          var _yield$supabase$from$ = yield _libSupabase.supabase.from('messages').insert({\n              conversation_id: input.conversationId,\n              sender_id: user.id,\n              type: input.type,\n              body: input.body ?? null,\n              payload: input.payload ?? null\n            }).select(`\n          *,\n          sender:users!messages_sender_id_fkey (\n            id,\n            display_name,\n            avatar_url\n          )\n        `).single(),\n            data = _yield$supabase$from$.data,\n            error = _yield$supabase$from$.error;\n          if (error) throw error;\n          return data;\n        });\n        return function mutationFn(_x) {\n          return _ref.apply(this, arguments);\n        };\n      }(),\n      onMutate: function () {\n        var _ref2 = (0, _asyncToGenerator.default)(function* (input) {\n          if (!user) return;\n          var messagesKey = _queryKeys.chatKeys.messages(input.conversationId);\n\n          // Cancel any outgoing refetches for this conversation\n          yield queryClient.cancelQueries({\n            queryKey: messagesKey\n          });\n\n          // Snapshot the previous value\n          var previousMessages = queryClient.getQueryData(messagesKey);\n\n          // Optimistically add the message to the first page\n          var optimisticMessage = {\n            id: `optimistic-${Date.now()}`,\n            conversation_id: input.conversationId,\n            sender_id: user.id,\n            type: input.type,\n            body: input.body ?? null,\n            payload: input.payload ?? null,\n            created_at: new Date().toISOString(),\n            sender: {\n              id: user.id,\n              display_name: profile?.display_name ?? 'You',\n              avatar_url: profile?.avatar_url ?? null\n            }\n          };\n          queryClient.setQueryData(messagesKey, old => {\n            if (!old) {\n              return {\n                pages: [[optimisticMessage]],\n                pageParams: [null]\n              };\n            }\n            return {\n              ...old,\n              pages: [[optimisticMessage, ...(old.pages[0] ?? [])], ...old.pages.slice(1)]\n            };\n          });\n          return {\n            previousMessages\n          };\n        });\n        return function onMutate(_x2) {\n          return _ref2.apply(this, arguments);\n        };\n      }(),\n      onError: (_err, input, context) => {\n        // Rollback on error\n        if (context?.previousMessages) {\n          queryClient.setQueryData(_queryKeys.chatKeys.messages(input.conversationId), context.previousMessages);\n        }\n      },\n      onSettled: (_data, _error, input) => {\n        // Refetch messages and conversations list\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.chatKeys.messages(input.conversationId)\n        });\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.chatKeys.conversations()\n        });\n      }\n    });\n  };\n  var _default = useSendMessage;\n});","lineCount":123,"map":[[12,2,121,0,"Object"],[12,8,121,0],[12,9,121,0,"defineProperty"],[12,23,121,0],[12,24,121,0,"exports"],[12,31,121,0],[13,4,121,0,"enumerable"],[13,14,121,0],[14,4,121,0,"get"],[14,7,121,0],[14,18,121,0,"get"],[14,19,121,0],[15,6,121,0],[15,13,121,0,"_default"],[15,21,121,0],[16,4,121,0],[17,2,121,0],[18,2,121,30],[18,6,121,30,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,121,30],[18,45,121,30,"require"],[18,52,121,30],[18,53,121,30,"_dependencyMap"],[18,67,121,30],[19,2,121,30],[19,6,121,30,"_asyncToGenerator"],[19,23,121,30],[19,26,121,30,"_interopDefault"],[19,41,121,30],[19,42,121,30,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,121,30],[20,2,1,0],[20,6,1,0,"_tanstackReactQuery"],[20,25,1,0],[20,28,1,0,"require"],[20,35,1,0],[20,36,1,0,"_dependencyMap"],[20,50,1,0],[21,2,2,0],[21,6,2,0,"_libSupabase"],[21,18,2,0],[21,21,2,0,"require"],[21,28,2,0],[21,29,2,0,"_dependencyMap"],[21,43,2,0],[22,2,3,0],[22,6,3,0,"_contextAuthProvider"],[22,26,3,0],[22,29,3,0,"require"],[22,36,3,0],[22,37,3,0,"_dependencyMap"],[22,51,3,0],[23,2,4,0],[23,6,4,0,"_queryKeys"],[23,16,4,0],[23,19,4,0,"require"],[23,26,4,0],[23,27,4,0,"_dependencyMap"],[23,41,4,0],[24,2,16,0],[25,2,17,0],[25,6,17,6,"useSendMessage"],[25,20,17,20],[25,23,17,23,"useSendMessage"],[25,24,17,23],[25,29,17,29],[26,4,18,2],[26,8,18,2,"_useAuth"],[26,16,18,2],[26,19,18,28],[26,23,18,28,"useAuth"],[26,43,18,35],[26,44,18,35,"useAuth"],[26,51,18,35],[26,53,18,36],[26,54,18,37],[27,6,18,10,"user"],[27,10,18,14],[27,13,18,14,"_useAuth"],[27,21,18,14],[27,22,18,10,"user"],[27,26,18,14],[28,6,18,16,"profile"],[28,13,18,23],[28,16,18,23,"_useAuth"],[28,24,18,23],[28,25,18,16,"profile"],[28,32,18,23],[29,4,19,2],[29,8,19,8,"queryClient"],[29,19,19,19],[29,22,19,22],[29,26,19,22,"useQueryClient"],[29,45,19,36],[29,46,19,36,"useQueryClient"],[29,60,19,36],[29,62,19,37],[29,63,19,38],[30,4,21,2],[30,11,21,9],[30,15,21,9,"useMutation"],[30,34,21,20],[30,35,21,20,"useMutation"],[30,46,21,20],[30,48,21,21],[31,6,22,4,"mutationFn"],[31,16,22,14],[32,8,22,14],[32,12,22,14,"_ref"],[32,16,22,14],[32,23,22,14,"_asyncToGenerator"],[32,40,22,14],[32,41,22,14,"default"],[32,48,22,14],[32,50,22,16],[32,61,22,23,"input"],[32,66,22,46],[32,68,22,51],[33,10,23,6],[33,14,23,10],[33,15,23,11,"user"],[33,19,23,15],[33,21,23,17],[33,27,23,23],[33,31,23,27,"Error"],[33,36,23,32],[33,37,23,33],[33,73,23,69],[33,74,23,70],[34,10,25,6],[34,14,25,6,"_yield$supabase$from$"],[34,35,25,6],[34,44,25,36,"supabase"],[34,56,25,44],[34,57,25,44,"supabase"],[34,65,25,44],[34,66,26,9,"from"],[34,70,26,13],[34,71,26,14],[34,81,26,24],[34,82,26,25],[34,83,27,9,"insert"],[34,89,27,15],[34,90,27,16],[35,14,28,10,"conversation_id"],[35,29,28,25],[35,31,28,27,"input"],[35,36,28,32],[35,37,28,33,"conversationId"],[35,51,28,47],[36,14,29,10,"sender_id"],[36,23,29,19],[36,25,29,21,"user"],[36,29,29,25],[36,30,29,26,"id"],[36,32,29,28],[37,14,30,10,"type"],[37,18,30,14],[37,20,30,16,"input"],[37,25,30,21],[37,26,30,22,"type"],[37,30,30,26],[38,14,31,10,"body"],[38,18,31,14],[38,20,31,16,"input"],[38,25,31,21],[38,26,31,22,"body"],[38,30,31,26],[38,34,31,30],[38,38,31,34],[39,14,32,10,"payload"],[39,21,32,17],[39,23,32,19,"input"],[39,28,32,24],[39,29,32,25,"payload"],[39,36,32,32],[39,40,32,36],[40,12,33,8],[40,13,33,9],[40,14,33,10],[40,15,34,9,"select"],[40,21,34,15],[40,22,35,10],[41,0,36,0],[42,0,37,0],[43,0,38,0],[44,0,39,0],[45,0,40,0],[46,0,41,0],[47,0,42,0],[47,9,43,8],[47,10,43,9],[47,11,44,9,"single"],[47,17,44,15],[47,18,44,16],[47,19,44,17],[48,12,25,14,"data"],[48,16,25,18],[48,19,25,18,"_yield$supabase$from$"],[48,40,25,18],[48,41,25,14,"data"],[48,45,25,18],[49,12,25,20,"error"],[49,17,25,25],[49,20,25,25,"_yield$supabase$from$"],[49,41,25,25],[49,42,25,20,"error"],[49,47,25,25],[50,10,46,6],[50,14,46,10,"error"],[50,19,46,15],[50,21,46,17],[50,27,46,23,"error"],[50,32,46,28],[51,10,47,6],[51,17,47,13,"data"],[51,21,47,17],[52,8,48,4],[52,9,48,5],[53,8,48,5],[53,24,22,4,"mutationFn"],[53,34,22,14,"mutationFn"],[53,35,22,14,"_x"],[53,37,22,14],[54,10,22,14],[54,17,22,14,"_ref"],[54,21,22,14],[54,22,22,14,"apply"],[54,27,22,14],[54,34,22,14,"arguments"],[54,43,22,14],[55,8,22,14],[56,6,22,14],[56,9,48,5],[57,6,49,4,"onMutate"],[57,14,49,12],[58,8,49,12],[58,12,49,12,"_ref2"],[58,17,49,12],[58,24,49,12,"_asyncToGenerator"],[58,41,49,12],[58,42,49,12,"default"],[58,49,49,12],[58,51,49,14],[58,62,49,21,"input"],[58,67,49,26],[58,69,49,31],[59,10,50,6],[59,14,50,10],[59,15,50,11,"user"],[59,19,50,15],[59,21,50,17],[60,10,52,6],[60,14,52,12,"messagesKey"],[60,25,52,23],[60,28,52,26,"chatKeys"],[60,38,52,34],[60,39,52,34,"chatKeys"],[60,47,52,34],[60,48,52,35,"messages"],[60,56,52,43],[60,57,52,44,"input"],[60,62,52,49],[60,63,52,50,"conversationId"],[60,77,52,64],[60,78,52,65],[62,10,54,6],[63,10,55,6],[63,16,55,12,"queryClient"],[63,27,55,23],[63,28,55,24,"cancelQueries"],[63,41,55,37],[63,42,55,38],[64,12,55,40,"queryKey"],[64,20,55,48],[64,22,55,50,"messagesKey"],[65,10,55,62],[65,11,55,63],[65,12,55,64],[67,10,57,6],[68,10,58,6],[68,14,58,12,"previousMessages"],[68,30,58,28],[68,33,59,8,"queryClient"],[68,44,59,19],[68,45,59,20,"getQueryData"],[68,57,59,32],[68,58,60,10,"messagesKey"],[68,69,61,8],[68,70,61,9],[70,10,63,6],[71,10,64,6],[71,14,64,12,"optimisticMessage"],[71,31,64,48],[71,34,64,51],[72,12,65,8,"id"],[72,14,65,10],[72,16,65,12],[72,30,65,26,"Date"],[72,34,65,30],[72,35,65,31,"now"],[72,38,65,34],[72,39,65,35],[72,40,65,36],[72,42,65,38],[73,12,66,8,"conversation_id"],[73,27,66,23],[73,29,66,25,"input"],[73,34,66,30],[73,35,66,31,"conversationId"],[73,49,66,45],[74,12,67,8,"sender_id"],[74,21,67,17],[74,23,67,19,"user"],[74,27,67,23],[74,28,67,24,"id"],[74,30,67,26],[75,12,68,8,"type"],[75,16,68,12],[75,18,68,14,"input"],[75,23,68,19],[75,24,68,20,"type"],[75,28,68,24],[76,12,69,8,"body"],[76,16,69,12],[76,18,69,14,"input"],[76,23,69,19],[76,24,69,20,"body"],[76,28,69,24],[76,32,69,28],[76,36,69,32],[77,12,70,8,"payload"],[77,19,70,15],[77,21,70,17,"input"],[77,26,70,22],[77,27,70,23,"payload"],[77,34,70,30],[77,38,70,34],[77,42,70,38],[78,12,71,8,"created_at"],[78,22,71,18],[78,24,71,20],[78,28,71,24,"Date"],[78,32,71,28],[78,33,71,29],[78,34,71,30],[78,35,71,31,"toISOString"],[78,46,71,42],[78,47,71,43],[78,48,71,44],[79,12,72,8,"sender"],[79,18,72,14],[79,20,72,16],[80,14,73,10,"id"],[80,16,73,12],[80,18,73,14,"user"],[80,22,73,18],[80,23,73,19,"id"],[80,25,73,21],[81,14,74,10,"display_name"],[81,26,74,22],[81,28,74,24,"profile"],[81,35,74,31],[81,37,74,33,"display_name"],[81,49,74,45],[81,53,74,49],[81,58,74,54],[82,14,75,10,"avatar_url"],[82,24,75,20],[82,26,75,22,"profile"],[82,33,75,29],[82,35,75,31,"avatar_url"],[82,45,75,41],[82,49,75,45],[83,12,76,8],[84,10,77,6],[84,11,77,7],[85,10,79,6,"queryClient"],[85,21,79,17],[85,22,79,18,"setQueryData"],[85,34,79,30],[85,35,80,8,"messagesKey"],[85,46,80,19],[85,48,81,9,"old"],[85,51,81,12],[85,55,81,17],[86,12,82,10],[86,16,82,14],[86,17,82,15,"old"],[86,20,82,18],[86,22,82,20],[87,14,83,12],[87,21,83,19],[88,16,84,14,"pages"],[88,21,84,19],[88,23,84,21],[88,24,84,22],[88,25,84,23,"optimisticMessage"],[88,42,84,40],[88,43,84,41],[88,44,84,42],[89,16,85,14,"pageParams"],[89,26,85,24],[89,28,85,26],[89,29,85,27],[89,33,85,31],[90,14,86,12],[90,15,86,13],[91,12,87,10],[92,12,88,10],[92,19,88,17],[93,14,89,12],[93,17,89,15,"old"],[93,20,89,18],[94,14,90,12,"pages"],[94,19,90,17],[94,21,90,19],[94,22,91,14],[94,23,91,15,"optimisticMessage"],[94,40,91,32],[94,42,91,34],[94,46,91,38,"old"],[94,49,91,41],[94,50,91,42,"pages"],[94,55,91,47],[94,56,91,48],[94,57,91,49],[94,58,91,50],[94,62,91,54],[94,64,91,56],[94,65,91,57],[94,66,91,58],[94,68,92,14],[94,71,92,17,"old"],[94,74,92,20],[94,75,92,21,"pages"],[94,80,92,26],[94,81,92,27,"slice"],[94,86,92,32],[94,87,92,33],[94,88,92,34],[94,89,92,35],[95,12,94,10],[95,13,94,11],[96,10,95,8],[96,11,96,6],[96,12,96,7],[97,10,98,6],[97,17,98,13],[98,12,98,15,"previousMessages"],[99,10,98,32],[99,11,98,33],[100,8,99,4],[100,9,99,5],[101,8,99,5],[101,24,49,4,"onMutate"],[101,32,49,12,"onMutate"],[101,33,49,12,"_x2"],[101,36,49,12],[102,10,49,12],[102,17,49,12,"_ref2"],[102,22,49,12],[102,23,49,12,"apply"],[102,28,49,12],[102,35,49,12,"arguments"],[102,44,49,12],[103,8,49,12],[104,6,49,12],[104,9,99,5],[105,6,100,4,"onError"],[105,13,100,11],[105,15,100,13,"onError"],[105,16,100,14,"_err"],[105,20,100,18],[105,22,100,20,"input"],[105,27,100,25],[105,29,100,27,"context"],[105,36,100,34],[105,41,100,39],[106,8,101,6],[107,8,102,6],[107,12,102,10,"context"],[107,19,102,17],[107,21,102,19,"previousMessages"],[107,37,102,35],[107,39,102,37],[108,10,103,8,"queryClient"],[108,21,103,19],[108,22,103,20,"setQueryData"],[108,34,103,32],[108,35,104,10,"chatKeys"],[108,45,104,18],[108,46,104,18,"chatKeys"],[108,54,104,18],[108,55,104,19,"messages"],[108,63,104,27],[108,64,104,28,"input"],[108,69,104,33],[108,70,104,34,"conversationId"],[108,84,104,48],[108,85,104,49],[108,87,105,10,"context"],[108,94,105,17],[108,95,105,18,"previousMessages"],[108,111,106,8],[108,112,106,9],[109,8,107,6],[110,6,108,4],[110,7,108,5],[111,6,109,4,"onSettled"],[111,15,109,13],[111,17,109,15,"onSettled"],[111,18,109,16,"_data"],[111,23,109,21],[111,25,109,23,"_error"],[111,31,109,29],[111,33,109,31,"input"],[111,38,109,36],[111,43,109,41],[112,8,110,6],[113,8,111,6,"queryClient"],[113,19,111,17],[113,20,111,18,"invalidateQueries"],[113,37,111,35],[113,38,111,36],[114,10,112,8,"queryKey"],[114,18,112,16],[114,20,112,18,"chatKeys"],[114,30,112,26],[114,31,112,26,"chatKeys"],[114,39,112,26],[114,40,112,27,"messages"],[114,48,112,35],[114,49,112,36,"input"],[114,54,112,41],[114,55,112,42,"conversationId"],[114,69,112,56],[115,8,113,6],[115,9,113,7],[115,10,113,8],[116,8,114,6,"queryClient"],[116,19,114,17],[116,20,114,18,"invalidateQueries"],[116,37,114,35],[116,38,114,36],[117,10,115,8,"queryKey"],[117,18,115,16],[117,20,115,18,"chatKeys"],[117,30,115,26],[117,31,115,26,"chatKeys"],[117,39,115,26],[117,40,115,27,"conversations"],[117,53,115,40],[117,54,115,41],[118,8,116,6],[118,9,116,7],[118,10,116,8],[119,6,117,4],[120,4,118,2],[120,5,118,3],[120,6,118,4],[121,2,119,0],[121,3,119,1],[122,2,121,0],[122,6,121,0,"_default"],[122,14,121,0],[122,17,121,15,"useSendMessage"],[122,31,121,29],[123,0,121,30],[123,3]],"functionMap":{"names":["<global>","useSendMessage","useMutation$argument_0.mutationFn","useMutation$argument_0.onMutate","queryClient.setQueryData$argument_1","useMutation$argument_0.onError","useMutation$argument_0.onSettled"],"mappings":"AAA;uBCgB;gBCK;KD0B;cEC;QCgC;SDc;KFI;aIC;KJQ;eKC;KLQ;CDE"},"hasCjsExports":false},"type":"js/module"}]}
{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":49,"index":49}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":50},"end":{"line":2,"column":42,"index":92}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":93},"end":{"line":3,"column":43,"index":136}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0]);\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1]);\n  var _libSupabase = require(_dependencyMap[2]);\n  var _queryKeys = require(_dependencyMap[3]);\n  /**\n   * Fetches the trade context for a conversation — listing info, offer info,\n   * and negotiation status. Joins through conversations → matches → listings/offers.\n   */\n  var useTradeContext = conversationId => {\n    return (0, _tanstackReactQuery.useQuery)({\n      queryKey: _queryKeys.chatKeys.tradeContext(conversationId),\n      queryFn: function () {\n        var _ref = (0, _asyncToGenerator.default)(function* () {\n          // Get conversation with match, listing, and offer data\n          var _yield$supabase$from$ = yield _libSupabase.supabase.from('conversations').select(`\n          id,\n          negotiation_status,\n          matches!inner (\n            id,\n            user_a_id,\n            user_b_id,\n            listing_id,\n            offer_id,\n            listings!inner (\n              id,\n              user_id,\n              title,\n              type,\n              tcg,\n              total_value\n            ),\n            offers!inner (\n              id,\n              offerer_id,\n              cash_amount\n            )\n          )\n        `).eq('id', conversationId).single(),\n            conv = _yield$supabase$from$.data,\n            convError = _yield$supabase$from$.error;\n          if (convError || !conv) return null;\n          var match = conv.matches;\n\n          // Fetch listing items\n          var _yield$supabase$from$2 = yield _libSupabase.supabase.from('listing_items').select('card_name, card_image_url, quantity, market_price').eq('listing_id', match.listings.id),\n            listingItems = _yield$supabase$from$2.data;\n\n          // Fetch offer items\n          var _yield$supabase$from$3 = yield _libSupabase.supabase.from('offer_items').select('card_name, card_image_url, quantity, market_price').eq('offer_id', match.offers.id),\n            offerItems = _yield$supabase$from$3.data;\n          return {\n            listingId: match.listings.id,\n            listingTitle: match.listings.title,\n            listingType: match.listings.type,\n            listingTcg: match.listings.tcg,\n            listingOwnerId: match.listings.user_id,\n            listingItems: (listingItems ?? []).map(li => ({\n              cardName: li.card_name,\n              cardImageUrl: li.card_image_url,\n              quantity: li.quantity,\n              marketPrice: li.market_price\n            })),\n            listingTotalValue: match.listings.total_value,\n            offererId: match.offers.offerer_id,\n            offerItems: (offerItems ?? []).map(oi => ({\n              cardName: oi.card_name,\n              cardImageUrl: oi.card_image_url,\n              quantity: oi.quantity,\n              marketPrice: oi.market_price\n            })),\n            offerCashAmount: match.offers.cash_amount,\n            negotiationStatus: conv.negotiation_status\n          };\n        });\n        return function queryFn() {\n          return _ref.apply(this, arguments);\n        };\n      }(),\n      enabled: !!conversationId,\n      staleTime: 300000 // 5 minutes\n    });\n  };\n  var _default = useTradeContext;\n});","lineCount":102,"map":[[12,2,131,0,"Object"],[12,8,131,0],[12,9,131,0,"defineProperty"],[12,23,131,0],[12,24,131,0,"exports"],[12,31,131,0],[13,4,131,0,"enumerable"],[13,14,131,0],[14,4,131,0,"get"],[14,7,131,0],[14,18,131,0,"get"],[14,19,131,0],[15,6,131,0],[15,13,131,0,"_default"],[15,21,131,0],[16,4,131,0],[17,2,131,0],[18,2,131,31],[18,6,131,31,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,131,31],[18,45,131,31,"require"],[18,52,131,31],[18,53,131,31,"_dependencyMap"],[18,67,131,31],[19,2,131,31],[19,6,131,31,"_asyncToGenerator"],[19,23,131,31],[19,26,131,31,"_interopDefault"],[19,41,131,31],[19,42,131,31,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,131,31],[20,2,1,0],[20,6,1,0,"_tanstackReactQuery"],[20,25,1,0],[20,28,1,0,"require"],[20,35,1,0],[20,36,1,0,"_dependencyMap"],[20,50,1,0],[21,2,2,0],[21,6,2,0,"_libSupabase"],[21,18,2,0],[21,21,2,0,"require"],[21,28,2,0],[21,29,2,0,"_dependencyMap"],[21,43,2,0],[22,2,3,0],[22,6,3,0,"_queryKeys"],[22,16,3,0],[22,19,3,0,"require"],[22,26,3,0],[22,27,3,0,"_dependencyMap"],[22,41,3,0],[23,2,27,0],[24,0,28,0],[25,0,29,0],[26,0,30,0],[27,2,31,0],[27,6,31,6,"useTradeContext"],[27,21,31,21],[27,24,31,25,"conversationId"],[27,38,31,47],[27,42,31,52],[28,4,32,2],[28,11,32,9],[28,15,32,9,"useQuery"],[28,34,32,17],[28,35,32,17,"useQuery"],[28,43,32,17],[28,45,32,18],[29,6,33,4,"queryKey"],[29,14,33,12],[29,16,33,14,"chatKeys"],[29,26,33,22],[29,27,33,22,"chatKeys"],[29,35,33,22],[29,36,33,23,"tradeContext"],[29,48,33,35],[29,49,33,36,"conversationId"],[29,63,33,50],[29,64,33,51],[30,6,34,4,"queryFn"],[30,13,34,11],[31,8,34,11],[31,12,34,11,"_ref"],[31,16,34,11],[31,23,34,11,"_asyncToGenerator"],[31,40,34,11],[31,41,34,11,"default"],[31,48,34,11],[31,50,34,13],[31,63,34,55],[32,10,35,6],[33,10,36,6],[33,14,36,6,"_yield$supabase$from$"],[33,35,36,6],[33,44,36,53,"supabase"],[33,56,36,61],[33,57,36,61,"supabase"],[33,65,36,61],[33,66,37,9,"from"],[33,70,37,13],[33,71,37,14],[33,86,37,29],[33,87,37,30],[33,88,38,9,"select"],[33,94,38,15],[33,95,39,10],[34,0,40,0],[35,0,41,0],[36,0,42,0],[37,0,43,0],[38,0,44,0],[39,0,45,0],[40,0,46,0],[41,0,47,0],[42,0,48,0],[43,0,49,0],[44,0,50,0],[45,0,51,0],[46,0,52,0],[47,0,53,0],[48,0,54,0],[49,0,55,0],[50,0,56,0],[51,0,57,0],[52,0,58,0],[53,0,59,0],[54,0,60,0],[55,0,61,0],[56,0,62,0],[56,9,63,8],[56,10,63,9],[56,11,64,9,"eq"],[56,13,64,11],[56,14,64,12],[56,18,64,16],[56,20,64,18,"conversationId"],[56,34,64,32],[56,35,64,33],[56,36,65,9,"single"],[56,42,65,15],[56,43,65,16],[56,44,65,17],[57,12,36,20,"conv"],[57,16,36,24],[57,19,36,24,"_yield$supabase$from$"],[57,40,36,24],[57,41,36,14,"data"],[57,45,36,18],[58,12,36,33,"convError"],[58,21,36,42],[58,24,36,42,"_yield$supabase$from$"],[58,45,36,42],[58,46,36,26,"error"],[58,51,36,31],[59,10,67,6],[59,14,67,10,"convError"],[59,23,67,19],[59,27,67,23],[59,28,67,24,"conv"],[59,32,67,28],[59,34,67,30],[59,41,67,37],[59,45,67,41],[60,10,69,6],[60,14,69,12,"match"],[60,19,69,17],[60,22,69,20,"conv"],[60,26,69,24],[60,27,69,25,"matches"],[60,34,88,7],[62,10,90,6],[63,10,91,6],[63,14,91,6,"_yield$supabase$from$2"],[63,36,91,6],[63,45,91,43,"supabase"],[63,57,91,51],[63,58,91,51,"supabase"],[63,66,91,51],[63,67,92,9,"from"],[63,71,92,13],[63,72,92,14],[63,87,92,29],[63,88,92,30],[63,89,93,9,"select"],[63,95,93,15],[63,96,93,16],[63,147,93,67],[63,148,93,68],[63,149,94,9,"eq"],[63,151,94,11],[63,152,94,12],[63,164,94,24],[63,166,94,26,"match"],[63,171,94,31],[63,172,94,32,"listings"],[63,180,94,40],[63,181,94,41,"id"],[63,183,94,43],[63,184,94,44],[64,12,91,20,"listingItems"],[64,24,91,32],[64,27,91,32,"_yield$supabase$from$2"],[64,49,91,32],[64,50,91,14,"data"],[64,54,91,18],[66,10,96,6],[67,10,97,6],[67,14,97,6,"_yield$supabase$from$3"],[67,36,97,6],[67,45,97,41,"supabase"],[67,57,97,49],[67,58,97,49,"supabase"],[67,66,97,49],[67,67,98,9,"from"],[67,71,98,13],[67,72,98,14],[67,85,98,27],[67,86,98,28],[67,87,99,9,"select"],[67,93,99,15],[67,94,99,16],[67,145,99,67],[67,146,99,68],[67,147,100,9,"eq"],[67,149,100,11],[67,150,100,12],[67,160,100,22],[67,162,100,24,"match"],[67,167,100,29],[67,168,100,30,"offers"],[67,174,100,36],[67,175,100,37,"id"],[67,177,100,39],[67,178,100,40],[68,12,97,20,"offerItems"],[68,22,97,30],[68,25,97,30,"_yield$supabase$from$3"],[68,47,97,30],[68,48,97,14,"data"],[68,52,97,18],[69,10,102,6],[69,17,102,13],[70,12,103,8,"listingId"],[70,21,103,17],[70,23,103,19,"match"],[70,28,103,24],[70,29,103,25,"listings"],[70,37,103,33],[70,38,103,34,"id"],[70,40,103,36],[71,12,104,8,"listingTitle"],[71,24,104,20],[71,26,104,22,"match"],[71,31,104,27],[71,32,104,28,"listings"],[71,40,104,36],[71,41,104,37,"title"],[71,46,104,42],[72,12,105,8,"listingType"],[72,23,105,19],[72,25,105,21,"match"],[72,30,105,26],[72,31,105,27,"listings"],[72,39,105,35],[72,40,105,36,"type"],[72,44,105,55],[73,12,106,8,"listingTcg"],[73,22,106,18],[73,24,106,20,"match"],[73,29,106,25],[73,30,106,26,"listings"],[73,38,106,34],[73,39,106,35,"tcg"],[73,42,106,49],[74,12,107,8,"listingOwnerId"],[74,26,107,22],[74,28,107,24,"match"],[74,33,107,29],[74,34,107,30,"listings"],[74,42,107,38],[74,43,107,39,"user_id"],[74,50,107,46],[75,12,108,8,"listingItems"],[75,24,108,20],[75,26,108,22],[75,27,108,23,"listingItems"],[75,39,108,35],[75,43,108,39],[75,45,108,41],[75,47,108,43,"map"],[75,50,108,46],[75,51,108,48,"li"],[75,53,108,50],[75,58,108,56],[76,14,109,10,"cardName"],[76,22,109,18],[76,24,109,20,"li"],[76,26,109,22],[76,27,109,23,"card_name"],[76,36,109,32],[77,14,110,10,"cardImageUrl"],[77,26,110,22],[77,28,110,24,"li"],[77,30,110,26],[77,31,110,27,"card_image_url"],[77,45,110,41],[78,14,111,10,"quantity"],[78,22,111,18],[78,24,111,20,"li"],[78,26,111,22],[78,27,111,23,"quantity"],[78,35,111,31],[79,14,112,10,"marketPrice"],[79,25,112,21],[79,27,112,23,"li"],[79,29,112,25],[79,30,112,26,"market_price"],[80,12,113,8],[80,13,113,9],[80,14,113,10],[80,15,113,11],[81,12,114,8,"listingTotalValue"],[81,29,114,25],[81,31,114,27,"match"],[81,36,114,32],[81,37,114,33,"listings"],[81,45,114,41],[81,46,114,42,"total_value"],[81,57,114,53],[82,12,115,8,"offererId"],[82,21,115,17],[82,23,115,19,"match"],[82,28,115,24],[82,29,115,25,"offers"],[82,35,115,31],[82,36,115,32,"offerer_id"],[82,46,115,42],[83,12,116,8,"offerItems"],[83,22,116,18],[83,24,116,20],[83,25,116,21,"offerItems"],[83,35,116,31],[83,39,116,35],[83,41,116,37],[83,43,116,39,"map"],[83,46,116,42],[83,47,116,44,"oi"],[83,49,116,46],[83,54,116,52],[84,14,117,10,"cardName"],[84,22,117,18],[84,24,117,20,"oi"],[84,26,117,22],[84,27,117,23,"card_name"],[84,36,117,32],[85,14,118,10,"cardImageUrl"],[85,26,118,22],[85,28,118,24,"oi"],[85,30,118,26],[85,31,118,27,"card_image_url"],[85,45,118,41],[86,14,119,10,"quantity"],[86,22,119,18],[86,24,119,20,"oi"],[86,26,119,22],[86,27,119,23,"quantity"],[86,35,119,31],[87,14,120,10,"marketPrice"],[87,25,120,21],[87,27,120,23,"oi"],[87,29,120,25],[87,30,120,26,"market_price"],[88,12,121,8],[88,13,121,9],[88,14,121,10],[88,15,121,11],[89,12,122,8,"offerCashAmount"],[89,27,122,23],[89,29,122,25,"match"],[89,34,122,30],[89,35,122,31,"offers"],[89,41,122,37],[89,42,122,38,"cash_amount"],[89,53,122,49],[90,12,123,8,"negotiationStatus"],[90,29,123,25],[90,31,123,27,"conv"],[90,35,123,31],[90,36,123,32,"negotiation_status"],[91,10,124,6],[91,11,124,7],[92,8,125,4],[92,9,125,5],[93,8,125,5],[93,24,34,4,"queryFn"],[93,31,34,11,"queryFn"],[93,32,34,11],[94,10,34,11],[94,17,34,11,"_ref"],[94,21,34,11],[94,22,34,11,"apply"],[94,27,34,11],[94,34,34,11,"arguments"],[94,43,34,11],[95,8,34,11],[96,6,34,11],[96,9,125,5],[97,6,126,4,"enabled"],[97,13,126,11],[97,15,126,13],[97,16,126,14],[97,17,126,15,"conversationId"],[97,31,126,29],[98,6,127,4,"staleTime"],[98,15,127,13],[98,23,127,28],[98,24,127,30],[99,4,128,2],[99,5,128,3],[99,6,128,4],[100,2,129,0],[100,3,129,1],[101,2,131,0],[101,6,131,0,"_default"],[101,14,131,0],[101,17,131,15,"useTradeContext"],[101,32,131,30],[102,0,131,31],[102,3]],"functionMap":{"names":["<global>","useTradeContext","useQuery$argument_0.queryFn","map$argument_0"],"mappings":"AAA;wBC8B;aCG;+CC0E;UDK;2CCG;UDK;KDI;CDI"},"hasCjsExports":false},"type":"js/module"}]}
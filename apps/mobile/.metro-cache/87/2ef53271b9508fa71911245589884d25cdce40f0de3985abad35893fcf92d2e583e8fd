{"dependencies":[{"name":"@babel/runtime/helpers/toConsumableArray","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"kiCFfIx1MWoD4noR0gEoyrFAUKE=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":34,"index":34}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":35},"end":{"line":2,"column":55,"index":90}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":91},"end":{"line":3,"column":42,"index":133}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"@/context/AuthProvider","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":134},"end":{"line":4,"column":49,"index":183}}],"key":"hnDMt1RwOyVwgo481TGNr6ITBm4=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":184},"end":{"line":5,"column":43,"index":227}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersToConsumableArray = require(_dependencyMap[0], \"@babel/runtime/helpers/toConsumableArray\");\n  var _toConsumableArray = _interopDefault(_babelRuntimeHelpersToConsumableArray);\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[1], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _react = require(_dependencyMap[2], \"react\");\n  var _tanstackReactQuery = require(_dependencyMap[3], \"@tanstack/react-query\");\n  var _libSupabase = require(_dependencyMap[4], \"@/lib/supabase\");\n  var _contextAuthProvider = require(_dependencyMap[5], \"@/context/AuthProvider\");\n  var _queryKeys = require(_dependencyMap[6], \"../../queryKeys\");\n  /**\n   * Subscribes to Supabase Realtime for new messages in a conversation.\n   * On INSERT, adds the message to the TanStack Query cache.\n   */\n  var useRealtimeChat = function useRealtimeChat(conversationId) {\n    _s();\n    var queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    var _useAuth = (0, _contextAuthProvider.useAuth)(),\n      user = _useAuth.user;\n    (0, _react.useEffect)(function () {\n      if (!conversationId) return;\n      var channel = _libSupabase.supabase.channel(`messages:${conversationId}`).on('postgres_changes', {\n        event: 'INSERT',\n        schema: 'public',\n        table: 'messages',\n        filter: `conversation_id=eq.${conversationId}`\n      }, /*#__PURE__*/function () {\n        var _ref = (0, _asyncToGenerator.default)(function* (payload) {\n          var _ref2;\n          var newMessage = payload.new;\n\n          // Don't duplicate our own optimistically-added messages\n          if (newMessage.sender_id === (user == null ? void 0 : user.id)) return;\n\n          // Fetch the sender info\n          var _yield$supabase$from$ = yield _libSupabase.supabase.from('users').select('id, display_name, avatar_url').eq('id', newMessage.sender_id).single(),\n            senderData = _yield$supabase$from$.data;\n          var messageWithSender = Object.assign({}, newMessage, {\n            sender: (_ref2 = senderData) != null ? _ref2 : {\n              id: newMessage.sender_id,\n              display_name: 'Unknown',\n              avatar_url: null\n            }\n          });\n          var messagesKey = _queryKeys.chatKeys.messages(conversationId);\n          queryClient.setQueryData(messagesKey, function (old) {\n            var _old$pages$;\n            if (!old) {\n              return {\n                pages: [[messageWithSender]],\n                pageParams: [null]\n              };\n            }\n\n            // Prevent duplicates\n            var allIds = old.pages.flatMap(function (page) {\n              return page.map(function (m) {\n                return m.id;\n              });\n            });\n            if (allIds.includes(messageWithSender.id)) return old;\n            return Object.assign({}, old, {\n              pages: [[messageWithSender].concat((0, _toConsumableArray.default)((_old$pages$ = old.pages[0]) != null ? _old$pages$ : []))].concat((0, _toConsumableArray.default)(old.pages.slice(1)))\n            });\n          });\n\n          // Also invalidate conversations list to update last message\n          queryClient.invalidateQueries({\n            queryKey: _queryKeys.chatKeys.conversations()\n          });\n        });\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }()).subscribe();\n      return function () {\n        _libSupabase.supabase.removeChannel(channel);\n      };\n    }, [conversationId, queryClient, user == null ? void 0 : user.id]);\n  };\n  _s(useRealtimeChat, \"TDrJ95GxdHquDBjgVv/lJ4LOc/A=\", false, function () {\n    return [_tanstackReactQuery.useQueryClient, _contextAuthProvider.useAuth];\n  });\n  var _default = useRealtimeChat;\n});","lineCount":102,"map":[[13,2,98,0,"Object"],[13,8,98,0],[13,9,98,0,"defineProperty"],[13,23,98,0],[13,24,98,0,"exports"],[13,31,98,0],[14,4,98,0,"enumerable"],[14,14,98,0],[15,4,98,0,"get"],[15,7,98,0],[15,18,98,0,"get"],[15,19,98,0],[16,6,98,0],[16,13,98,0,"_default"],[16,21,98,0],[17,4,98,0],[18,2,98,0],[19,2,98,31],[19,6,98,31,"_babelRuntimeHelpersToConsumableArray"],[19,43,98,31],[19,46,98,31,"require"],[19,53,98,31],[19,54,98,31,"_dependencyMap"],[19,68,98,31],[20,2,98,31],[20,6,98,31,"_toConsumableArray"],[20,24,98,31],[20,27,98,31,"_interopDefault"],[20,42,98,31],[20,43,98,31,"_babelRuntimeHelpersToConsumableArray"],[20,80,98,31],[21,2,98,31],[21,6,98,31,"_babelRuntimeHelpersAsyncToGenerator"],[21,42,98,31],[21,45,98,31,"require"],[21,52,98,31],[21,53,98,31,"_dependencyMap"],[21,67,98,31],[22,2,98,31],[22,6,98,31,"_asyncToGenerator"],[22,23,98,31],[22,26,98,31,"_interopDefault"],[22,41,98,31],[22,42,98,31,"_babelRuntimeHelpersAsyncToGenerator"],[22,78,98,31],[23,2,1,0],[23,6,1,0,"_react"],[23,12,1,0],[23,15,1,0,"require"],[23,22,1,0],[23,23,1,0,"_dependencyMap"],[23,37,1,0],[24,2,2,0],[24,6,2,0,"_tanstackReactQuery"],[24,25,2,0],[24,28,2,0,"require"],[24,35,2,0],[24,36,2,0,"_dependencyMap"],[24,50,2,0],[25,2,3,0],[25,6,3,0,"_libSupabase"],[25,18,3,0],[25,21,3,0,"require"],[25,28,3,0],[25,29,3,0,"_dependencyMap"],[25,43,3,0],[26,2,4,0],[26,6,4,0,"_contextAuthProvider"],[26,26,4,0],[26,29,4,0,"require"],[26,36,4,0],[26,37,4,0,"_dependencyMap"],[26,51,4,0],[27,2,5,0],[27,6,5,0,"_queryKeys"],[27,16,5,0],[27,19,5,0,"require"],[27,26,5,0],[27,27,5,0,"_dependencyMap"],[27,41,5,0],[28,2,10,0],[29,0,11,0],[30,0,12,0],[31,0,13,0],[32,2,14,0],[32,6,14,6,"useRealtimeChat"],[32,21,14,21],[32,24,14,24],[32,33,14,6,"useRealtimeChat"],[32,48,14,21,"useRealtimeChat"],[32,49,14,25,"conversationId"],[32,63,14,47],[32,65,14,52],[33,4,14,52,"_s"],[33,6,14,52],[34,4,15,2],[34,8,15,8,"queryClient"],[34,19,15,19],[34,22,15,22],[34,26,15,22,"useQueryClient"],[34,45,15,36],[34,46,15,36,"useQueryClient"],[34,60,15,36],[34,62,15,37],[34,63,15,38],[35,4,16,2],[35,8,16,2,"_useAuth"],[35,16,16,2],[35,19,16,19],[35,23,16,19,"useAuth"],[35,43,16,26],[35,44,16,26,"useAuth"],[35,51,16,26],[35,53,16,27],[35,54,16,28],[36,6,16,10,"user"],[36,10,16,14],[36,13,16,14,"_useAuth"],[36,21,16,14],[36,22,16,10,"user"],[36,26,16,14],[37,4,18,2],[37,8,18,2,"useEffect"],[37,14,18,11],[37,15,18,11,"useEffect"],[37,24,18,11],[37,26,18,12],[37,38,18,18],[38,6,19,4],[38,10,19,8],[38,11,19,9,"conversationId"],[38,25,19,23],[38,27,19,25],[39,6,21,4],[39,10,21,10,"channel"],[39,17,21,17],[39,20,21,20,"supabase"],[39,32,21,28],[39,33,21,28,"supabase"],[39,41,21,28],[39,42,22,7,"channel"],[39,49,22,14],[39,50,22,15],[39,62,22,27,"conversationId"],[39,76,22,41],[39,78,22,43],[39,79,22,44],[39,80,23,7,"on"],[39,82,23,9],[39,83,24,8],[39,101,24,26],[39,103,25,8],[40,8,26,10,"event"],[40,13,26,15],[40,15,26,17],[40,23,26,25],[41,8,27,10,"schema"],[41,14,27,16],[41,16,27,18],[41,24,27,26],[42,8,28,10,"table"],[42,13,28,15],[42,15,28,17],[42,25,28,27],[43,8,29,10,"filter"],[43,14,29,16],[43,16,29,18],[43,38,29,40,"conversationId"],[43,52,29,54],[44,6,30,8],[44,7,30,9],[45,8,30,9],[45,12,30,9,"_ref"],[45,16,30,9],[45,23,30,9,"_asyncToGenerator"],[45,40,30,9],[45,41,30,9,"default"],[45,48,30,9],[45,50,31,8],[45,61,31,15,"payload"],[45,68,31,22],[45,70,31,27],[46,10,31,27],[46,14,31,27,"_ref2"],[46,19,31,27],[47,10,32,10],[47,14,32,16,"newMessage"],[47,24,32,26],[47,27,32,29,"payload"],[47,34,32,36],[47,35,32,37,"new"],[47,38,32,40],[49,10,34,10],[50,10,35,10],[50,14,35,14,"newMessage"],[50,24,35,24],[50,25,35,25,"sender_id"],[50,34,35,34],[50,40,35,39,"user"],[50,44,35,43],[50,64,35,39,"user"],[50,68,35,43],[50,69,35,45,"id"],[50,71,35,47],[50,74,35,49],[52,10,37,10],[53,10,38,10],[53,14,38,10,"_yield$supabase$from$"],[53,35,38,10],[53,44,38,45,"supabase"],[53,56,38,53],[53,57,38,53,"supabase"],[53,65,38,53],[53,66,39,13,"from"],[53,70,39,17],[53,71,39,18],[53,78,39,25],[53,79,39,26],[53,80,40,13,"select"],[53,86,40,19],[53,87,40,20],[53,117,40,50],[53,118,40,51],[53,119,41,13,"eq"],[53,121,41,15],[53,122,41,16],[53,126,41,20],[53,128,41,22,"newMessage"],[53,138,41,32],[53,139,41,33,"sender_id"],[53,148,41,42],[53,149,41,43],[53,150,42,13,"single"],[53,156,42,19],[53,157,42,20],[53,158,42,21],[54,12,38,24,"senderData"],[54,22,38,34],[54,25,38,34,"_yield$supabase$from$"],[54,46,38,34],[54,47,38,18,"data"],[54,51,38,22],[55,10,44,10],[55,14,44,16,"messageWithSender"],[55,31,44,52],[55,34,44,52,"Object"],[55,40,44,52],[55,41,44,52,"assign"],[55,47,44,52],[55,52,45,15,"newMessage"],[55,62,45,25],[56,12,46,12,"sender"],[56,18,46,18],[56,21,46,18,"_ref2"],[56,26,46,18],[56,29,46,21,"senderData"],[56,39,46,31],[56,51,46,31,"_ref2"],[56,56,46,31],[56,59,49,18],[57,14,50,14,"id"],[57,16,50,16],[57,18,50,18,"newMessage"],[57,28,50,28],[57,29,50,29,"sender_id"],[57,38,50,38],[58,14,51,14,"display_name"],[58,26,51,26],[58,28,51,28],[58,37,51,37],[59,14,52,14,"avatar_url"],[59,24,52,24],[59,26,52,26],[60,12,53,12],[61,10,53,13],[61,12,54,11],[62,10,56,10],[62,14,56,16,"messagesKey"],[62,25,56,27],[62,28,56,30,"chatKeys"],[62,38,56,38],[62,39,56,38,"chatKeys"],[62,47,56,38],[62,48,56,39,"messages"],[62,56,56,47],[62,57,56,48,"conversationId"],[62,71,56,62],[62,72,56,63],[63,10,58,10,"queryClient"],[63,21,58,21],[63,22,58,22,"setQueryData"],[63,34,58,34],[63,35,59,12,"messagesKey"],[63,46,59,23],[63,48,60,12],[63,58,60,13,"old"],[63,61,60,16],[63,63,60,21],[64,12,60,21],[64,16,60,21,"_old$pages$"],[64,27,60,21],[65,12,61,14],[65,16,61,18],[65,17,61,19,"old"],[65,20,61,22],[65,22,61,24],[66,14,62,16],[66,21,62,23],[67,16,63,18,"pages"],[67,21,63,23],[67,23,63,25],[67,24,63,26],[67,25,63,27,"messageWithSender"],[67,42,63,44],[67,43,63,45],[67,44,63,46],[68,16,64,18,"pageParams"],[68,26,64,28],[68,28,64,30],[68,29,64,31],[68,33,64,35],[69,14,65,16],[69,15,65,17],[70,12,66,14],[72,12,68,14],[73,12,69,14],[73,16,69,20,"allIds"],[73,22,69,26],[73,25,69,29,"old"],[73,28,69,32],[73,29,69,33,"pages"],[73,34,69,38],[73,35,69,39,"flatMap"],[73,42,69,46],[73,43,69,47],[73,53,69,48,"page"],[73,57,69,52],[74,14,69,52],[74,21,70,16,"page"],[74,25,70,20],[74,26,70,21,"map"],[74,29,70,24],[74,30,70,25],[74,40,70,26,"m"],[74,41,70,27],[75,16,70,27],[75,23,70,32,"m"],[75,24,70,33],[75,25,70,34,"id"],[75,27,70,36],[76,14,70,36],[76,16,70,37],[77,12,70,37],[77,13,71,14],[77,14,71,15],[78,12,72,14],[78,16,72,18,"allIds"],[78,22,72,24],[78,23,72,25,"includes"],[78,31,72,33],[78,32,72,34,"messageWithSender"],[78,49,72,51],[78,50,72,52,"id"],[78,52,72,54],[78,53,72,55],[78,55,72,57],[78,62,72,64,"old"],[78,65,72,67],[79,12,74,14],[79,19,74,14,"Object"],[79,25,74,14],[79,26,74,14,"assign"],[79,32,74,14],[79,37,75,19,"old"],[79,40,75,22],[80,14,76,16,"pages"],[80,19,76,21],[80,23,77,19,"messageWithSender"],[80,40,77,36],[80,42,77,36,"concat"],[80,48,77,36],[80,53,77,36,"_toConsumableArray"],[80,71,77,36],[80,72,77,36,"default"],[80,79,77,36],[80,82,77,36,"_old$pages$"],[80,93,77,36],[80,96,77,42,"old"],[80,99,77,45],[80,100,77,46,"pages"],[80,105,77,51],[80,106,77,52],[80,107,77,53],[80,108,77,54],[80,120,77,54,"_old$pages$"],[80,131,77,54],[80,134,77,58],[80,136,77,60],[80,140,77,60,"concat"],[80,146,77,60],[80,151,77,60,"_toConsumableArray"],[80,169,77,60],[80,170,77,60,"default"],[80,177,77,60],[80,179,78,21,"old"],[80,182,78,24],[80,183,78,25,"pages"],[80,188,78,30],[80,189,78,31,"slice"],[80,194,78,36],[80,195,78,37],[80,196,78,38],[80,197,78,39],[81,12,79,17],[82,10,81,12],[82,11,82,10],[82,12,82,11],[84,10,84,10],[85,10,85,10,"queryClient"],[85,21,85,21],[85,22,85,22,"invalidateQueries"],[85,39,85,39],[85,40,85,40],[86,12,86,12,"queryKey"],[86,20,86,20],[86,22,86,22,"chatKeys"],[86,32,86,30],[86,33,86,30,"chatKeys"],[86,41,86,30],[86,42,86,31,"conversations"],[86,55,86,44],[86,56,86,45],[87,10,87,10],[87,11,87,11],[87,12,87,12],[88,8,88,8],[88,9,88,9],[89,8,88,9],[89,25,88,9,"_x"],[89,27,88,9],[90,10,88,9],[90,17,88,9,"_ref"],[90,21,88,9],[90,22,88,9,"apply"],[90,27,88,9],[90,34,88,9,"arguments"],[90,43,88,9],[91,8,88,9],[92,6,88,9],[92,9,89,6],[92,10,89,7],[92,11,90,7,"subscribe"],[92,20,90,16],[92,21,90,17],[92,22,90,18],[93,6,92,4],[93,13,92,11],[93,25,92,17],[94,8,93,6,"supabase"],[94,20,93,14],[94,21,93,14,"supabase"],[94,29,93,14],[94,30,93,15,"removeChannel"],[94,43,93,28],[94,44,93,29,"channel"],[94,51,93,36],[94,52,93,37],[95,6,94,4],[95,7,94,5],[96,4,95,2],[96,5,95,3],[96,7,95,5],[96,8,95,6,"conversationId"],[96,22,95,20],[96,24,95,22,"queryClient"],[96,35,95,33],[96,37,95,35,"user"],[96,41,95,39],[96,61,95,35,"user"],[96,65,95,39],[96,66,95,41,"id"],[96,68,95,43],[96,69,95,44],[96,70,95,45],[97,2,96,0],[97,3,96,1],[98,2,96,2,"_s"],[98,4,96,2],[98,5,14,6,"useRealtimeChat"],[98,20,14,21],[99,4,14,21],[99,12,15,22,"useQueryClient"],[99,31,15,36],[99,32,15,36,"useQueryClient"],[99,46,15,36],[99,48,16,19,"useAuth"],[99,68,16,26],[99,69,16,26,"useAuth"],[99,76,16,26],[100,2,16,26],[101,2,98,0],[101,6,98,0,"_default"],[101,14,98,0],[101,17,98,15,"useRealtimeChat"],[101,32,98,30],[102,0,98,31],[102,3]],"functionMap":{"names":["<global>","useRealtimeChat","useEffect$argument_0","supabase.channel.on$argument_2","queryClient.setQueryData$argument_1","old.pages.flatMap$argument_0","page.map$argument_0","<anonymous>"],"mappings":"AAA;wBCa;YCI;QCa;YC6B;+CCS;yBCC,WD,CD;aDW;SDO;WKI;KLE;GDC;CDC"},"hasCjsExports":false},"type":"js/module"}]}
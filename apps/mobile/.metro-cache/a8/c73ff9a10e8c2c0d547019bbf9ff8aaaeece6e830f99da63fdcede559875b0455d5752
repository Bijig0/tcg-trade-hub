{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":49,"index":49}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":50},"end":{"line":2,"column":42,"index":92}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":93},"end":{"line":3,"column":43,"index":136}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}},{"name":"../../algorithm/transformRawListing/transformRawListing","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":137},"end":{"line":4,"column":90,"index":227}}],"key":"r8X/l37NUzIp9LCyUpeWLBMlkwc=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0]);\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1]);\n  var _libSupabase = require(_dependencyMap[2]);\n  var _queryKeys = require(_dependencyMap[3]);\n  var _algorithmTransformRawListingTransformRawListing = require(_dependencyMap[4]);\n  var transformRawListing = _interopDefault(_algorithmTransformRawListingTransformRawListing);\n  /**\n   * Queries all active listings containing a specific card by `card_external_id`.\n   *\n   * Splits results into:\n   * - singles: listings with exactly 1 item (the matched card)\n   * - bundles: listings with >1 items that include the matched card\n   */\n  var useCardListings = externalId => {\n    return (0, _tanstackReactQuery.useQuery)({\n      queryKey: _queryKeys.feedKeys.cardListings(externalId),\n      queryFn: function () {\n        var _ref = (0, _asyncToGenerator.default)(function* () {\n          var _yield$supabase$from$ = yield _libSupabase.supabase.from('listing_items').select(`\n          *,\n          listing:listings!inner (\n            *,\n            listing_items (*),\n            users!inner (\n              id,\n              display_name,\n              avatar_url,\n              location,\n              rating_score,\n              total_trades\n            )\n          )\n        `).eq('card_external_id', externalId).eq('listing.status', 'active'),\n            data = _yield$supabase$from$.data,\n            error = _yield$supabase$from$.error;\n          if (error) {\n            console.error('[useCardListings] Supabase query error:', error);\n            throw error;\n          }\n          var all = (data ?? []).map(row => (0, transformRawListing.default)(row.listing));\n\n          // Deduplicate by listing id (a bundle may have multiple matching items)\n          var seen = new Set();\n          var unique = all.filter(listing => {\n            if (seen.has(listing.id)) return false;\n            seen.add(listing.id);\n            return true;\n          });\n          return {\n            singles: unique.filter(l => l.items.length === 1),\n            bundles: unique.filter(l => l.items.length > 1)\n          };\n        });\n        return function queryFn() {\n          return _ref.apply(this, arguments);\n        };\n      }(),\n      enabled: externalId.length > 0\n    });\n  };\n  var _default = useCardListings;\n});","lineCount":80,"map":[[12,2,70,0,"Object"],[12,8,70,0],[12,9,70,0,"defineProperty"],[12,23,70,0],[12,24,70,0,"exports"],[12,31,70,0],[13,4,70,0,"enumerable"],[13,14,70,0],[14,4,70,0,"get"],[14,7,70,0],[14,18,70,0,"get"],[14,19,70,0],[15,6,70,0],[15,13,70,0,"_default"],[15,21,70,0],[16,4,70,0],[17,2,70,0],[18,2,70,31],[18,6,70,31,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,70,31],[18,45,70,31,"require"],[18,52,70,31],[18,53,70,31,"_dependencyMap"],[18,67,70,31],[19,2,70,31],[19,6,70,31,"_asyncToGenerator"],[19,23,70,31],[19,26,70,31,"_interopDefault"],[19,41,70,31],[19,42,70,31,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,70,31],[20,2,1,0],[20,6,1,0,"_tanstackReactQuery"],[20,25,1,0],[20,28,1,0,"require"],[20,35,1,0],[20,36,1,0,"_dependencyMap"],[20,50,1,0],[21,2,2,0],[21,6,2,0,"_libSupabase"],[21,18,2,0],[21,21,2,0,"require"],[21,28,2,0],[21,29,2,0,"_dependencyMap"],[21,43,2,0],[22,2,3,0],[22,6,3,0,"_queryKeys"],[22,16,3,0],[22,19,3,0,"require"],[22,26,3,0],[22,27,3,0,"_dependencyMap"],[22,41,3,0],[23,2,4,0],[23,6,4,0,"_algorithmTransformRawListingTransformRawListing"],[23,54,4,0],[23,57,4,0,"require"],[23,64,4,0],[23,65,4,0,"_dependencyMap"],[23,79,4,0],[24,2,4,0],[24,6,4,0,"transformRawListing"],[24,25,4,0],[24,28,4,0,"_interopDefault"],[24,43,4,0],[24,44,4,0,"_algorithmTransformRawListingTransformRawListing"],[24,92,4,0],[25,2,13,0],[26,0,14,0],[27,0,15,0],[28,0,16,0],[29,0,17,0],[30,0,18,0],[31,0,19,0],[32,2,20,0],[32,6,20,6,"useCardListings"],[32,21,20,21],[32,24,20,25,"externalId"],[32,34,20,43],[32,38,20,48],[33,4,21,2],[33,11,21,9],[33,15,21,9,"useQuery"],[33,34,21,17],[33,35,21,17,"useQuery"],[33,43,21,17],[33,45,21,45],[34,6,22,4,"queryKey"],[34,14,22,12],[34,16,22,14,"feedKeys"],[34,26,22,22],[34,27,22,22,"feedKeys"],[34,35,22,22],[34,36,22,23,"cardListings"],[34,48,22,35],[34,49,22,36,"externalId"],[34,59,22,46],[34,60,22,47],[35,6,23,4,"queryFn"],[35,13,23,11],[36,8,23,11],[36,12,23,11,"_ref"],[36,16,23,11],[36,23,23,11,"_asyncToGenerator"],[36,40,23,11],[36,41,23,11,"default"],[36,48,23,11],[36,50,23,13],[36,63,23,25],[37,10,24,6],[37,14,24,6,"_yield$supabase$from$"],[37,35,24,6],[37,44,24,36,"supabase"],[37,56,24,44],[37,57,24,44,"supabase"],[37,65,24,44],[37,66,25,9,"from"],[37,70,25,13],[37,71,25,14],[37,86,25,29],[37,87,25,30],[37,88,26,9,"select"],[37,94,26,15],[37,95,26,16],[38,0,27,0],[39,0,28,0],[40,0,29,0],[41,0,30,0],[42,0,31,0],[43,0,32,0],[44,0,33,0],[45,0,34,0],[46,0,35,0],[47,0,36,0],[48,0,37,0],[49,0,38,0],[50,0,39,0],[51,0,40,0],[51,9,40,9],[51,10,40,10],[51,11,41,9,"eq"],[51,13,41,11],[51,14,41,12],[51,32,41,30],[51,34,41,32,"externalId"],[51,44,41,42],[51,45,41,43],[51,46,42,9,"eq"],[51,48,42,11],[51,49,42,12],[51,65,42,28],[51,67,42,30],[51,75,42,38],[51,76,42,39],[52,12,24,14,"data"],[52,16,24,18],[52,19,24,18,"_yield$supabase$from$"],[52,40,24,18],[52,41,24,14,"data"],[52,45,24,18],[53,12,24,20,"error"],[53,17,24,25],[53,20,24,25,"_yield$supabase$from$"],[53,41,24,25],[53,42,24,20,"error"],[53,47,24,25],[54,10,44,6],[54,14,44,10,"error"],[54,19,44,15],[54,21,44,17],[55,12,45,8,"console"],[55,19,45,15],[55,20,45,16,"error"],[55,25,45,21],[55,26,45,22],[55,67,45,63],[55,69,45,65,"error"],[55,74,45,70],[55,75,45,71],[56,12,46,8],[56,18,46,14,"error"],[56,23,46,19],[57,10,47,6],[58,10,49,6],[58,14,49,12,"all"],[58,17,49,15],[58,20,49,18],[58,21,49,19,"data"],[58,25,49,23],[58,29,49,27],[58,31,49,29],[58,33,49,31,"map"],[58,36,49,34],[58,37,49,36,"row"],[58,40,49,39],[58,44,50,8],[58,48,50,8,"transformRawListing"],[58,67,50,27],[58,68,50,27,"default"],[58,75,50,27],[58,77,50,28,"row"],[58,80,50,31],[58,81,50,32,"listing"],[58,88,50,68],[58,89,51,6],[58,90,51,7],[60,10,53,6],[61,10,54,6],[61,14,54,12,"seen"],[61,18,54,16],[61,21,54,19],[61,25,54,23,"Set"],[61,28,54,26],[61,29,54,35],[61,30,54,36],[62,10,55,6],[62,14,55,12,"unique"],[62,20,55,18],[62,23,55,21,"all"],[62,26,55,24],[62,27,55,25,"filter"],[62,33,55,31],[62,34,55,33,"listing"],[62,41,55,40],[62,45,55,45],[63,12,56,8],[63,16,56,12,"seen"],[63,20,56,16],[63,21,56,17,"has"],[63,24,56,20],[63,25,56,21,"listing"],[63,32,56,28],[63,33,56,29,"id"],[63,35,56,31],[63,36,56,32],[63,38,56,34],[63,45,56,41],[63,50,56,46],[64,12,57,8,"seen"],[64,16,57,12],[64,17,57,13,"add"],[64,20,57,16],[64,21,57,17,"listing"],[64,28,57,24],[64,29,57,25,"id"],[64,31,57,27],[64,32,57,28],[65,12,58,8],[65,19,58,15],[65,23,58,19],[66,10,59,6],[66,11,59,7],[66,12,59,8],[67,10,61,6],[67,17,61,13],[68,12,62,8,"singles"],[68,19,62,15],[68,21,62,17,"unique"],[68,27,62,23],[68,28,62,24,"filter"],[68,34,62,30],[68,35,62,32,"l"],[68,36,62,33],[68,40,62,38,"l"],[68,41,62,39],[68,42,62,40,"items"],[68,47,62,45],[68,48,62,46,"length"],[68,54,62,52],[68,59,62,57],[68,60,62,58],[68,61,62,59],[69,12,63,8,"bundles"],[69,19,63,15],[69,21,63,17,"unique"],[69,27,63,23],[69,28,63,24,"filter"],[69,34,63,30],[69,35,63,32,"l"],[69,36,63,33],[69,40,63,38,"l"],[69,41,63,39],[69,42,63,40,"items"],[69,47,63,45],[69,48,63,46,"length"],[69,54,63,52],[69,57,63,55],[69,58,63,56],[70,10,64,6],[70,11,64,7],[71,8,65,4],[71,9,65,5],[72,8,65,5],[72,24,23,4,"queryFn"],[72,31,23,11,"queryFn"],[72,32,23,11],[73,10,23,11],[73,17,23,11,"_ref"],[73,21,23,11],[73,22,23,11,"apply"],[73,27,23,11],[73,34,23,11,"arguments"],[73,43,23,11],[74,8,23,11],[75,6,23,11],[75,9,65,5],[76,6,66,4,"enabled"],[76,13,66,11],[76,15,66,13,"externalId"],[76,25,66,23],[76,26,66,24,"length"],[76,32,66,30],[76,35,66,33],[77,4,67,2],[77,5,67,3],[77,6,67,4],[78,2,68,0],[78,3,68,1],[79,2,70,0],[79,6,70,0,"_default"],[79,14,70,0],[79,17,70,15,"useCardListings"],[79,32,70,30],[80,0,70,31],[80,3]],"functionMap":{"names":["<global>","useCardListings","useQuery$argument_0.queryFn","map$argument_0","all.filter$argument_0","unique.filter$argument_0"],"mappings":"AAA;wBCmB;aCG;mCC0B;qEDC;gCEK;OFI;+BGG,2BH;+BGC,yBH;KDE;CDG"},"hasCjsExports":false},"type":"js/module"}]}
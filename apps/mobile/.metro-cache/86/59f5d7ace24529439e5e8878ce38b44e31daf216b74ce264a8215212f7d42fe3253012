{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var WEIGHTS = {\n    tcgMatch: 2,\n    proximity: 2,\n    recency: 1\n  };\n  var RECENCY_DECAY_DAYS = 7;\n  var computeTcgMatchScore = function computeTcgMatchScore(listing, userListings) {\n    var userTcgs = new Set(userListings.map(function (ul) {\n      return ul.tcg;\n    }));\n    return userTcgs.has(listing.tcg) ? WEIGHTS.tcgMatch : 0;\n  };\n  var computeProximityScore = function computeProximityScore(distanceKm, maxRadiusKm) {\n    if (distanceKm >= maxRadiusKm) return 0;\n    return WEIGHTS.proximity * (1 - distanceKm / maxRadiusKm);\n  };\n  var computeRecencyScore = function computeRecencyScore(createdAt) {\n    var ageMs = Date.now() - new Date(createdAt).getTime();\n    var ageDays = ageMs / (1000 * 60 * 60 * 24);\n    if (ageDays >= RECENCY_DECAY_DAYS) return 0;\n    return WEIGHTS.recency * (1 - ageDays / RECENCY_DECAY_DAYS);\n  };\n\n  /**\n   * Ranks listings by weighted score:\n   * - TCG match (2): listing TCG matches user's active listing TCGs\n   * - Proximity (2): inverse distance, closer = higher\n   * - Recency (1): newer listings score higher, decays over 7 days\n   *\n   * Note: complement matching (card-level overlap) has been removed\n   * since listings are now bundles. Real scoring happens in the\n   * get-feed Edge Function.\n   */\n  var rankListings = function rankListings(listings, userListings, _userLocation) {\n    var maxRadiusKm = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 25;\n    var ranked = listings.map(function (listing) {\n      var tcgScore = computeTcgMatchScore(listing, userListings);\n      var distanceKm = maxRadiusKm / 2;\n      var proximityScore = computeProximityScore(distanceKm, maxRadiusKm);\n      var recencyScore = computeRecencyScore(listing.created_at);\n      var score = tcgScore + proximityScore + recencyScore;\n      return {\n        listing: listing,\n        score: score\n      };\n    });\n    ranked.sort(function (a, b) {\n      return b.score - a.score;\n    });\n    return ranked;\n  };\n  var _default = rankListings;\n});","lineCount":65,"map":[[7,2,76,0,"Object"],[7,8,76,0],[7,9,76,0,"defineProperty"],[7,23,76,0],[7,24,76,0,"exports"],[7,31,76,0],[8,4,76,0,"enumerable"],[8,14,76,0],[9,4,76,0,"get"],[9,7,76,0],[9,18,76,0,"get"],[9,19,76,0],[10,6,76,0],[10,13,76,0,"_default"],[10,21,76,0],[11,4,76,0],[12,2,76,0],[13,2,13,0],[13,6,13,6,"WEIGHTS"],[13,13,13,13],[13,16,13,16],[14,4,14,2,"tcgMatch"],[14,12,14,10],[14,14,14,12],[14,15,14,13],[15,4,15,2,"proximity"],[15,13,15,11],[15,15,15,13],[15,16,15,14],[16,4,16,2,"recency"],[16,11,16,9],[16,13,16,11],[17,2,17,0],[17,3,17,10],[18,2,19,0],[18,6,19,6,"RECENCY_DECAY_DAYS"],[18,24,19,24],[18,27,19,27],[18,28,19,28],[19,2,21,0],[19,6,21,6,"computeTcgMatchScore"],[19,26,21,26],[19,29,21,29],[19,38,21,6,"computeTcgMatchScore"],[19,58,21,26,"computeTcgMatchScore"],[19,59,22,2,"listing"],[19,66,22,21],[19,68,23,2,"userListings"],[19,80,23,28],[19,82,24,13],[20,4,25,2],[20,8,25,8,"userTcgs"],[20,16,25,16],[20,19,25,19],[20,23,25,23,"Set"],[20,26,25,26],[20,27,25,27,"userListings"],[20,39,25,39],[20,40,25,40,"map"],[20,43,25,43],[20,44,25,44],[20,54,25,45,"ul"],[20,56,25,47],[21,6,25,47],[21,13,25,52,"ul"],[21,15,25,54],[21,16,25,55,"tcg"],[21,19,25,58],[22,4,25,58],[22,6,25,59],[22,7,25,60],[23,4,26,2],[23,11,26,9,"userTcgs"],[23,19,26,17],[23,20,26,18,"has"],[23,23,26,21],[23,24,26,22,"listing"],[23,31,26,29],[23,32,26,30,"tcg"],[23,35,26,33],[23,36,26,34],[23,39,26,37,"WEIGHTS"],[23,46,26,44],[23,47,26,45,"tcgMatch"],[23,55,26,53],[23,58,26,56],[23,59,26,57],[24,2,27,0],[24,3,27,1],[25,2,29,0],[25,6,29,6,"computeProximityScore"],[25,27,29,27],[25,30,29,30],[25,39,29,6,"computeProximityScore"],[25,60,29,27,"computeProximityScore"],[25,61,30,2,"distanceKm"],[25,71,30,20],[25,73,31,2,"maxRadiusKm"],[25,84,31,21],[25,86,32,13],[26,4,33,2],[26,8,33,6,"distanceKm"],[26,18,33,16],[26,22,33,20,"maxRadiusKm"],[26,33,33,31],[26,35,33,33],[26,42,33,40],[26,43,33,41],[27,4,34,2],[27,11,34,9,"WEIGHTS"],[27,18,34,16],[27,19,34,17,"proximity"],[27,28,34,26],[27,32,34,30],[27,33,34,31],[27,36,34,34,"distanceKm"],[27,46,34,44],[27,49,34,47,"maxRadiusKm"],[27,60,34,58],[27,61,34,59],[28,2,35,0],[28,3,35,1],[29,2,37,0],[29,6,37,6,"computeRecencyScore"],[29,25,37,25],[29,28,37,28],[29,37,37,6,"computeRecencyScore"],[29,56,37,25,"computeRecencyScore"],[29,57,37,29,"createdAt"],[29,66,37,46],[29,68,37,59],[30,4,38,2],[30,8,38,8,"ageMs"],[30,13,38,13],[30,16,38,16,"Date"],[30,20,38,20],[30,21,38,21,"now"],[30,24,38,24],[30,25,38,25],[30,26,38,26],[30,29,38,29],[30,33,38,33,"Date"],[30,37,38,37],[30,38,38,38,"createdAt"],[30,47,38,47],[30,48,38,48],[30,49,38,49,"getTime"],[30,56,38,56],[30,57,38,57],[30,58,38,58],[31,4,39,2],[31,8,39,8,"ageDays"],[31,15,39,15],[31,18,39,18,"ageMs"],[31,23,39,23],[31,27,39,27],[31,31,39,31],[31,34,39,34],[31,36,39,36],[31,39,39,39],[31,41,39,41],[31,44,39,44],[31,46,39,46],[31,47,39,47],[32,4,40,2],[32,8,40,6,"ageDays"],[32,15,40,13],[32,19,40,17,"RECENCY_DECAY_DAYS"],[32,37,40,35],[32,39,40,37],[32,46,40,44],[32,47,40,45],[33,4,41,2],[33,11,41,9,"WEIGHTS"],[33,18,41,16],[33,19,41,17,"recency"],[33,26,41,24],[33,30,41,28],[33,31,41,29],[33,34,41,32,"ageDays"],[33,41,41,39],[33,44,41,42,"RECENCY_DECAY_DAYS"],[33,62,41,60],[33,63,41,61],[34,2,42,0],[34,3,42,1],[36,2,44,0],[37,0,45,0],[38,0,46,0],[39,0,47,0],[40,0,48,0],[41,0,49,0],[42,0,50,0],[43,0,51,0],[44,0,52,0],[45,0,53,0],[46,2,54,0],[46,6,54,6,"rankListings"],[46,18,54,18],[46,21,54,21],[46,30,54,6,"rankListings"],[46,42,54,18,"rankListings"],[46,43,55,2,"listings"],[46,51,55,24],[46,53,56,2,"userListings"],[46,65,56,28],[46,67,57,2,"_userLocation"],[46,80,57,22],[46,82,59,22],[47,4,59,22],[47,8,58,2,"maxRadiusKm"],[47,19,58,13],[47,22,58,13,"arguments"],[47,31,58,13],[47,32,58,13,"length"],[47,38,58,13],[47,46,58,13,"arguments"],[47,55,58,13],[47,63,58,13,"undefined"],[47,72,58,13],[47,75,58,13,"arguments"],[47,84,58,13],[47,90,58,16],[47,92,58,18],[48,4,60,2],[48,8,60,8,"ranked"],[48,14,60,14],[48,17,60,17,"listings"],[48,25,60,25],[48,26,60,26,"map"],[48,29,60,29],[48,30,60,30],[48,40,60,31,"listing"],[48,47,60,38],[48,49,60,43],[49,6,61,4],[49,10,61,10,"tcgScore"],[49,18,61,18],[49,21,61,21,"computeTcgMatchScore"],[49,41,61,41],[49,42,61,42,"listing"],[49,49,61,49],[49,51,61,51,"userListings"],[49,63,61,63],[49,64,61,64],[50,6,62,4],[50,10,62,10,"distanceKm"],[50,20,62,20],[50,23,62,23,"maxRadiusKm"],[50,34,62,34],[50,37,62,37],[50,38,62,38],[51,6,63,4],[51,10,63,10,"proximityScore"],[51,24,63,24],[51,27,63,27,"computeProximityScore"],[51,48,63,48],[51,49,63,49,"distanceKm"],[51,59,63,59],[51,61,63,61,"maxRadiusKm"],[51,72,63,72],[51,73,63,73],[52,6,64,4],[52,10,64,10,"recencyScore"],[52,22,64,22],[52,25,64,25,"computeRecencyScore"],[52,44,64,44],[52,45,64,45,"listing"],[52,52,64,52],[52,53,64,53,"created_at"],[52,63,64,63],[52,64,64,64],[53,6,66,4],[53,10,66,10,"score"],[53,15,66,15],[53,18,66,18,"tcgScore"],[53,26,66,26],[53,29,66,29,"proximityScore"],[53,43,66,43],[53,46,66,46,"recencyScore"],[53,58,66,58],[54,6,68,4],[54,13,68,11],[55,8,68,13,"listing"],[55,15,68,20],[55,17,68,13,"listing"],[55,24,68,20],[56,8,68,22,"score"],[56,13,68,27],[56,15,68,22,"score"],[57,6,68,28],[57,7,68,29],[58,4,69,2],[58,5,69,3],[58,6,69,4],[59,4,71,2,"ranked"],[59,10,71,8],[59,11,71,9,"sort"],[59,15,71,13],[59,16,71,14],[59,26,71,15,"a"],[59,27,71,16],[59,29,71,18,"b"],[59,30,71,19],[60,6,71,19],[60,13,71,24,"b"],[60,14,71,25],[60,15,71,26,"score"],[60,20,71,31],[60,23,71,34,"a"],[60,24,71,35],[60,25,71,36,"score"],[60,30,71,41],[61,4,71,41],[61,6,71,42],[62,4,73,2],[62,11,73,9,"ranked"],[62,17,73,15],[63,2,74,0],[63,3,74,1],[64,2,76,0],[64,6,76,0,"_default"],[64,14,76,0],[64,17,76,15,"rankListings"],[64,29,76,27],[65,0,76,28],[65,3]],"functionMap":{"names":["<global>","computeTcgMatchScore","userListings.map$argument_0","computeProximityScore","computeRecencyScore","rankListings","listings.map$argument_0","ranked.sort$argument_0"],"mappings":"AAA;6BCoB;4CCI,cD;CDE;8BGE;CHM;4BIE;CJK;qBKY;8BCM;GDS;cEE,2BF;CLG"},"hasCjsExports":false},"type":"js/module"}]}
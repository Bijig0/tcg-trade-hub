{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":49,"index":49}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":50},"end":{"line":2,"column":42,"index":92}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":93},"end":{"line":3,"column":43,"index":136}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1], \"@tanstack/react-query\");\n  var _libSupabase = require(_dependencyMap[2], \"@/lib/supabase\");\n  var _queryKeys = require(_dependencyMap[3], \"../../queryKeys\");\n  /**\n   * Fetches the trade context for a conversation — listing info, offer info,\n   * and negotiation status. Joins through conversations → matches → listings/offers.\n   */\n  var useTradeContext = conversationId => {\n    _s();\n    return (0, _tanstackReactQuery.useQuery)({\n      queryKey: _queryKeys.chatKeys.tradeContext(conversationId),\n      queryFn: function () {\n        var _ref = (0, _asyncToGenerator.default)(function* () {\n          // Get conversation with match, listing, and offer data\n          var _yield$supabase$from$ = yield _libSupabase.supabase.from('conversations').select(`\n          id,\n          negotiation_status,\n          matches!inner (\n            id,\n            user_a_id,\n            user_b_id,\n            listing_id,\n            offer_id,\n            listings!inner (\n              id,\n              user_id,\n              title,\n              type,\n              tcg,\n              total_value\n            ),\n            offers!inner (\n              id,\n              offerer_id,\n              cash_amount\n            )\n          )\n        `).eq('id', conversationId).single(),\n            conv = _yield$supabase$from$.data,\n            convError = _yield$supabase$from$.error;\n          if (convError || !conv) return null;\n          var match = conv.matches;\n\n          // Fetch listing items\n          var _yield$supabase$from$2 = yield _libSupabase.supabase.from('listing_items').select('card_name, card_image_url, card_external_id, tcg, condition, quantity, market_price').eq('listing_id', match.listings.id),\n            listingItems = _yield$supabase$from$2.data;\n\n          // Fetch offer items\n          var _yield$supabase$from$3 = yield _libSupabase.supabase.from('offer_items').select('card_name, card_image_url, card_external_id, tcg, condition, quantity, market_price').eq('offer_id', match.offers.id),\n            offerItems = _yield$supabase$from$3.data;\n          return {\n            listingId: match.listings.id,\n            listingTitle: match.listings.title,\n            listingType: match.listings.type,\n            listingTcg: match.listings.tcg,\n            listingOwnerId: match.listings.user_id,\n            listingItems: (listingItems ?? []).map(li => ({\n              cardName: li.card_name,\n              cardImageUrl: li.card_image_url,\n              cardExternalId: li.card_external_id,\n              tcg: li.tcg,\n              condition: li.condition,\n              quantity: li.quantity,\n              marketPrice: li.market_price\n            })),\n            listingTotalValue: match.listings.total_value,\n            offererId: match.offers.offerer_id,\n            offerItems: (offerItems ?? []).map(oi => ({\n              cardName: oi.card_name,\n              cardImageUrl: oi.card_image_url,\n              cardExternalId: oi.card_external_id,\n              tcg: oi.tcg,\n              condition: oi.condition,\n              quantity: oi.quantity,\n              marketPrice: oi.market_price\n            })),\n            offerCashAmount: match.offers.cash_amount,\n            negotiationStatus: conv.negotiation_status\n          };\n        });\n        return function queryFn() {\n          return _ref.apply(this, arguments);\n        };\n      }(),\n      enabled: !!conversationId,\n      staleTime: 5 * 60 * 1000 // 5 minutes\n    });\n  };\n  _s(useTradeContext, \"4ZpngI1uv+Uo3WQHEZmTQ5FNM+k=\", false, function () {\n    return [_tanstackReactQuery.useQuery];\n  });\n  var _default = useTradeContext;\n});","lineCount":113,"map":[[13,2,151,0,"Object"],[13,8,151,0],[13,9,151,0,"defineProperty"],[13,23,151,0],[13,24,151,0,"exports"],[13,31,151,0],[14,4,151,0,"enumerable"],[14,14,151,0],[15,4,151,0,"get"],[15,7,151,0],[15,18,151,0,"get"],[15,19,151,0],[16,6,151,0],[16,13,151,0,"_default"],[16,21,151,0],[17,4,151,0],[18,2,151,0],[19,2,151,31],[19,6,151,31,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,151,31],[19,45,151,31,"require"],[19,52,151,31],[19,53,151,31,"_dependencyMap"],[19,67,151,31],[20,2,151,31],[20,6,151,31,"_asyncToGenerator"],[20,23,151,31],[20,26,151,31,"_interopDefault"],[20,41,151,31],[20,42,151,31,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,151,31],[21,2,1,0],[21,6,1,0,"_tanstackReactQuery"],[21,25,1,0],[21,28,1,0,"require"],[21,35,1,0],[21,36,1,0,"_dependencyMap"],[21,50,1,0],[22,2,2,0],[22,6,2,0,"_libSupabase"],[22,18,2,0],[22,21,2,0,"require"],[22,28,2,0],[22,29,2,0,"_dependencyMap"],[22,43,2,0],[23,2,3,0],[23,6,3,0,"_queryKeys"],[23,16,3,0],[23,19,3,0,"require"],[23,26,3,0],[23,27,3,0,"_dependencyMap"],[23,41,3,0],[24,2,41,0],[25,0,42,0],[26,0,43,0],[27,0,44,0],[28,2,45,0],[28,6,45,6,"useTradeContext"],[28,21,45,21],[28,24,45,25,"conversationId"],[28,38,45,47],[28,42,45,52],[29,4,45,52,"_s"],[29,6,45,52],[30,4,46,2],[30,11,46,9],[30,15,46,9,"useQuery"],[30,34,46,17],[30,35,46,17,"useQuery"],[30,43,46,17],[30,45,46,18],[31,6,47,4,"queryKey"],[31,14,47,12],[31,16,47,14,"chatKeys"],[31,26,47,22],[31,27,47,22,"chatKeys"],[31,35,47,22],[31,36,47,23,"tradeContext"],[31,48,47,35],[31,49,47,36,"conversationId"],[31,63,47,50],[31,64,47,51],[32,6,48,4,"queryFn"],[32,13,48,11],[33,8,48,11],[33,12,48,11,"_ref"],[33,16,48,11],[33,23,48,11,"_asyncToGenerator"],[33,40,48,11],[33,41,48,11,"default"],[33,48,48,11],[33,50,48,13],[33,63,48,55],[34,10,49,6],[35,10,50,6],[35,14,50,6,"_yield$supabase$from$"],[35,35,50,6],[35,44,50,53,"supabase"],[35,56,50,61],[35,57,50,61,"supabase"],[35,65,50,61],[35,66,51,9,"from"],[35,70,51,13],[35,71,51,14],[35,86,51,29],[35,87,51,30],[35,88,52,9,"select"],[35,94,52,15],[35,95,53,10],[36,0,54,0],[37,0,55,0],[38,0,56,0],[39,0,57,0],[40,0,58,0],[41,0,59,0],[42,0,60,0],[43,0,61,0],[44,0,62,0],[45,0,63,0],[46,0,64,0],[47,0,65,0],[48,0,66,0],[49,0,67,0],[50,0,68,0],[51,0,69,0],[52,0,70,0],[53,0,71,0],[54,0,72,0],[55,0,73,0],[56,0,74,0],[57,0,75,0],[58,0,76,0],[58,9,77,8],[58,10,77,9],[58,11,78,9,"eq"],[58,13,78,11],[58,14,78,12],[58,18,78,16],[58,20,78,18,"conversationId"],[58,34,78,32],[58,35,78,33],[58,36,79,9,"single"],[58,42,79,15],[58,43,79,16],[58,44,79,17],[59,12,50,20,"conv"],[59,16,50,24],[59,19,50,24,"_yield$supabase$from$"],[59,40,50,24],[59,41,50,14,"data"],[59,45,50,18],[60,12,50,33,"convError"],[60,21,50,42],[60,24,50,42,"_yield$supabase$from$"],[60,45,50,42],[60,46,50,26,"error"],[60,51,50,31],[61,10,81,6],[61,14,81,10,"convError"],[61,23,81,19],[61,27,81,23],[61,28,81,24,"conv"],[61,32,81,28],[61,34,81,30],[61,41,81,37],[61,45,81,41],[62,10,83,6],[62,14,83,12,"match"],[62,19,83,17],[62,22,83,20,"conv"],[62,26,83,24],[62,27,83,25,"matches"],[62,34,102,7],[64,10,104,6],[65,10,105,6],[65,14,105,6,"_yield$supabase$from$2"],[65,36,105,6],[65,45,105,43,"supabase"],[65,57,105,51],[65,58,105,51,"supabase"],[65,66,105,51],[65,67,106,9,"from"],[65,71,106,13],[65,72,106,14],[65,87,106,29],[65,88,106,30],[65,89,107,9,"select"],[65,95,107,15],[65,96,107,16],[65,181,107,101],[65,182,107,102],[65,183,108,9,"eq"],[65,185,108,11],[65,186,108,12],[65,198,108,24],[65,200,108,26,"match"],[65,205,108,31],[65,206,108,32,"listings"],[65,214,108,40],[65,215,108,41,"id"],[65,217,108,43],[65,218,108,44],[66,12,105,20,"listingItems"],[66,24,105,32],[66,27,105,32,"_yield$supabase$from$2"],[66,49,105,32],[66,50,105,14,"data"],[66,54,105,18],[68,10,110,6],[69,10,111,6],[69,14,111,6,"_yield$supabase$from$3"],[69,36,111,6],[69,45,111,41,"supabase"],[69,57,111,49],[69,58,111,49,"supabase"],[69,66,111,49],[69,67,112,9,"from"],[69,71,112,13],[69,72,112,14],[69,85,112,27],[69,86,112,28],[69,87,113,9,"select"],[69,93,113,15],[69,94,113,16],[69,179,113,101],[69,180,113,102],[69,181,114,9,"eq"],[69,183,114,11],[69,184,114,12],[69,194,114,22],[69,196,114,24,"match"],[69,201,114,29],[69,202,114,30,"offers"],[69,208,114,36],[69,209,114,37,"id"],[69,211,114,39],[69,212,114,40],[70,12,111,20,"offerItems"],[70,22,111,30],[70,25,111,30,"_yield$supabase$from$3"],[70,47,111,30],[70,48,111,14,"data"],[70,52,111,18],[71,10,116,6],[71,17,116,13],[72,12,117,8,"listingId"],[72,21,117,17],[72,23,117,19,"match"],[72,28,117,24],[72,29,117,25,"listings"],[72,37,117,33],[72,38,117,34,"id"],[72,40,117,36],[73,12,118,8,"listingTitle"],[73,24,118,20],[73,26,118,22,"match"],[73,31,118,27],[73,32,118,28,"listings"],[73,40,118,36],[73,41,118,37,"title"],[73,46,118,42],[74,12,119,8,"listingType"],[74,23,119,19],[74,25,119,21,"match"],[74,30,119,26],[74,31,119,27,"listings"],[74,39,119,35],[74,40,119,36,"type"],[74,44,119,55],[75,12,120,8,"listingTcg"],[75,22,120,18],[75,24,120,20,"match"],[75,29,120,25],[75,30,120,26,"listings"],[75,38,120,34],[75,39,120,35,"tcg"],[75,42,120,49],[76,12,121,8,"listingOwnerId"],[76,26,121,22],[76,28,121,24,"match"],[76,33,121,29],[76,34,121,30,"listings"],[76,42,121,38],[76,43,121,39,"user_id"],[76,50,121,46],[77,12,122,8,"listingItems"],[77,24,122,20],[77,26,122,22],[77,27,122,23,"listingItems"],[77,39,122,35],[77,43,122,39],[77,45,122,41],[77,47,122,43,"map"],[77,50,122,46],[77,51,122,48,"li"],[77,53,122,50],[77,58,122,56],[78,14,123,10,"cardName"],[78,22,123,18],[78,24,123,20,"li"],[78,26,123,22],[78,27,123,23,"card_name"],[78,36,123,32],[79,14,124,10,"cardImageUrl"],[79,26,124,22],[79,28,124,24,"li"],[79,30,124,26],[79,31,124,27,"card_image_url"],[79,45,124,41],[80,14,125,10,"cardExternalId"],[80,28,125,24],[80,30,125,26,"li"],[80,32,125,28],[80,33,125,29,"card_external_id"],[80,49,125,45],[81,14,126,10,"tcg"],[81,17,126,13],[81,19,126,15,"li"],[81,21,126,17],[81,22,126,18,"tcg"],[81,25,126,21],[82,14,127,10,"condition"],[82,23,127,19],[82,25,127,21,"li"],[82,27,127,23],[82,28,127,24,"condition"],[82,37,127,33],[83,14,128,10,"quantity"],[83,22,128,18],[83,24,128,20,"li"],[83,26,128,22],[83,27,128,23,"quantity"],[83,35,128,31],[84,14,129,10,"marketPrice"],[84,25,129,21],[84,27,129,23,"li"],[84,29,129,25],[84,30,129,26,"market_price"],[85,12,130,8],[85,13,130,9],[85,14,130,10],[85,15,130,11],[86,12,131,8,"listingTotalValue"],[86,29,131,25],[86,31,131,27,"match"],[86,36,131,32],[86,37,131,33,"listings"],[86,45,131,41],[86,46,131,42,"total_value"],[86,57,131,53],[87,12,132,8,"offererId"],[87,21,132,17],[87,23,132,19,"match"],[87,28,132,24],[87,29,132,25,"offers"],[87,35,132,31],[87,36,132,32,"offerer_id"],[87,46,132,42],[88,12,133,8,"offerItems"],[88,22,133,18],[88,24,133,20],[88,25,133,21,"offerItems"],[88,35,133,31],[88,39,133,35],[88,41,133,37],[88,43,133,39,"map"],[88,46,133,42],[88,47,133,44,"oi"],[88,49,133,46],[88,54,133,52],[89,14,134,10,"cardName"],[89,22,134,18],[89,24,134,20,"oi"],[89,26,134,22],[89,27,134,23,"card_name"],[89,36,134,32],[90,14,135,10,"cardImageUrl"],[90,26,135,22],[90,28,135,24,"oi"],[90,30,135,26],[90,31,135,27,"card_image_url"],[90,45,135,41],[91,14,136,10,"cardExternalId"],[91,28,136,24],[91,30,136,26,"oi"],[91,32,136,28],[91,33,136,29,"card_external_id"],[91,49,136,45],[92,14,137,10,"tcg"],[92,17,137,13],[92,19,137,15,"oi"],[92,21,137,17],[92,22,137,18,"tcg"],[92,25,137,21],[93,14,138,10,"condition"],[93,23,138,19],[93,25,138,21,"oi"],[93,27,138,23],[93,28,138,24,"condition"],[93,37,138,33],[94,14,139,10,"quantity"],[94,22,139,18],[94,24,139,20,"oi"],[94,26,139,22],[94,27,139,23,"quantity"],[94,35,139,31],[95,14,140,10,"marketPrice"],[95,25,140,21],[95,27,140,23,"oi"],[95,29,140,25],[95,30,140,26,"market_price"],[96,12,141,8],[96,13,141,9],[96,14,141,10],[96,15,141,11],[97,12,142,8,"offerCashAmount"],[97,27,142,23],[97,29,142,25,"match"],[97,34,142,30],[97,35,142,31,"offers"],[97,41,142,37],[97,42,142,38,"cash_amount"],[97,53,142,49],[98,12,143,8,"negotiationStatus"],[98,29,143,25],[98,31,143,27,"conv"],[98,35,143,31],[98,36,143,32,"negotiation_status"],[99,10,144,6],[99,11,144,7],[100,8,145,4],[100,9,145,5],[101,8,145,5],[101,24,48,4,"queryFn"],[101,31,48,11,"queryFn"],[101,32,48,11],[102,10,48,11],[102,17,48,11,"_ref"],[102,21,48,11],[102,22,48,11,"apply"],[102,27,48,11],[102,34,48,11,"arguments"],[102,43,48,11],[103,8,48,11],[104,6,48,11],[104,9,145,5],[105,6,146,4,"enabled"],[105,13,146,11],[105,15,146,13],[105,16,146,14],[105,17,146,15,"conversationId"],[105,31,146,29],[106,6,147,4,"staleTime"],[106,15,147,13],[106,17,147,15],[106,18,147,16],[106,21,147,19],[106,23,147,21],[106,26,147,24],[106,30,147,28],[106,31,147,30],[107,4,148,2],[107,5,148,3],[107,6,148,4],[108,2,149,0],[108,3,149,1],[109,2,149,2,"_s"],[109,4,149,2],[109,5,45,6,"useTradeContext"],[109,20,45,21],[110,4,45,21],[110,12,46,9,"useQuery"],[110,31,46,17],[110,32,46,17,"useQuery"],[110,40,46,17],[111,2,46,17],[112,2,151,0],[112,6,151,0,"_default"],[112,14,151,0],[112,17,151,15,"useTradeContext"],[112,32,151,30],[113,0,151,31],[113,3]],"functionMap":{"names":["<global>","useTradeContext","useQuery$argument_0.queryFn","map$argument_0"],"mappings":"AAA;wBC4C;aCG;+CC0E;UDQ;2CCG;UDQ;KDI;CDI"},"hasCjsExports":false},"type":"js/module"}]}
{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":49,"index":49}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":50},"end":{"line":2,"column":42,"index":92}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":93},"end":{"line":3,"column":43,"index":136}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1], \"@tanstack/react-query\");\n  var _libSupabase = require(_dependencyMap[2], \"@/lib/supabase\");\n  var _queryKeys = require(_dependencyMap[3], \"../../queryKeys\");\n  /**\n   * Fetches the trade context for a conversation — listing info, offer info,\n   * and negotiation status. Joins through conversations → matches → listings/offers.\n   */\n  var useTradeContext = conversationId => {\n    _s();\n    return (0, _tanstackReactQuery.useQuery)({\n      queryKey: _queryKeys.chatKeys.tradeContext(conversationId),\n      queryFn: function () {\n        var _ref = (0, _asyncToGenerator.default)(function* () {\n          // Get conversation with match, listing, and offer data\n          var _yield$supabase$from$ = yield _libSupabase.supabase.from('conversations').select(`\n          id,\n          negotiation_status,\n          matches!inner (\n            id,\n            user_a_id,\n            user_b_id,\n            listing_id,\n            offer_id,\n            listings!inner (\n              id,\n              user_id,\n              title,\n              type,\n              tcg,\n              total_value\n            ),\n            offers!inner (\n              id,\n              offerer_id,\n              cash_amount\n            )\n          )\n        `).eq('id', conversationId).single(),\n            conv = _yield$supabase$from$.data,\n            convError = _yield$supabase$from$.error;\n          if (convError || !conv) return null;\n          var match = conv.matches;\n\n          // Fetch listing items\n          var _yield$supabase$from$2 = yield _libSupabase.supabase.from('listing_items').select('card_name, card_image_url, quantity, market_price').eq('listing_id', match.listings.id),\n            listingItems = _yield$supabase$from$2.data;\n\n          // Fetch offer items\n          var _yield$supabase$from$3 = yield _libSupabase.supabase.from('offer_items').select('card_name, card_image_url, quantity, market_price').eq('offer_id', match.offers.id),\n            offerItems = _yield$supabase$from$3.data;\n          return {\n            listingId: match.listings.id,\n            listingTitle: match.listings.title,\n            listingType: match.listings.type,\n            listingTcg: match.listings.tcg,\n            listingOwnerId: match.listings.user_id,\n            listingItems: (listingItems ?? []).map(li => ({\n              cardName: li.card_name,\n              cardImageUrl: li.card_image_url,\n              quantity: li.quantity,\n              marketPrice: li.market_price\n            })),\n            listingTotalValue: match.listings.total_value,\n            offererId: match.offers.offerer_id,\n            offerItems: (offerItems ?? []).map(oi => ({\n              cardName: oi.card_name,\n              cardImageUrl: oi.card_image_url,\n              quantity: oi.quantity,\n              marketPrice: oi.market_price\n            })),\n            offerCashAmount: match.offers.cash_amount,\n            negotiationStatus: conv.negotiation_status\n          };\n        });\n        return function queryFn() {\n          return _ref.apply(this, arguments);\n        };\n      }(),\n      enabled: !!conversationId,\n      staleTime: 5 * 60 * 1000 // 5 minutes\n    });\n  };\n  _s(useTradeContext, \"4ZpngI1uv+Uo3WQHEZmTQ5FNM+k=\", false, function () {\n    return [_tanstackReactQuery.useQuery];\n  });\n  var _default = useTradeContext;\n});","lineCount":107,"map":[[13,2,131,0,"Object"],[13,8,131,0],[13,9,131,0,"defineProperty"],[13,23,131,0],[13,24,131,0,"exports"],[13,31,131,0],[14,4,131,0,"enumerable"],[14,14,131,0],[15,4,131,0,"get"],[15,7,131,0],[15,18,131,0,"get"],[15,19,131,0],[16,6,131,0],[16,13,131,0,"_default"],[16,21,131,0],[17,4,131,0],[18,2,131,0],[19,2,131,31],[19,6,131,31,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,131,31],[19,45,131,31,"require"],[19,52,131,31],[19,53,131,31,"_dependencyMap"],[19,67,131,31],[20,2,131,31],[20,6,131,31,"_asyncToGenerator"],[20,23,131,31],[20,26,131,31,"_interopDefault"],[20,41,131,31],[20,42,131,31,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,131,31],[21,2,1,0],[21,6,1,0,"_tanstackReactQuery"],[21,25,1,0],[21,28,1,0,"require"],[21,35,1,0],[21,36,1,0,"_dependencyMap"],[21,50,1,0],[22,2,2,0],[22,6,2,0,"_libSupabase"],[22,18,2,0],[22,21,2,0,"require"],[22,28,2,0],[22,29,2,0,"_dependencyMap"],[22,43,2,0],[23,2,3,0],[23,6,3,0,"_queryKeys"],[23,16,3,0],[23,19,3,0,"require"],[23,26,3,0],[23,27,3,0,"_dependencyMap"],[23,41,3,0],[24,2,27,0],[25,0,28,0],[26,0,29,0],[27,0,30,0],[28,2,31,0],[28,6,31,6,"useTradeContext"],[28,21,31,21],[28,24,31,25,"conversationId"],[28,38,31,47],[28,42,31,52],[29,4,31,52,"_s"],[29,6,31,52],[30,4,32,2],[30,11,32,9],[30,15,32,9,"useQuery"],[30,34,32,17],[30,35,32,17,"useQuery"],[30,43,32,17],[30,45,32,18],[31,6,33,4,"queryKey"],[31,14,33,12],[31,16,33,14,"chatKeys"],[31,26,33,22],[31,27,33,22,"chatKeys"],[31,35,33,22],[31,36,33,23,"tradeContext"],[31,48,33,35],[31,49,33,36,"conversationId"],[31,63,33,50],[31,64,33,51],[32,6,34,4,"queryFn"],[32,13,34,11],[33,8,34,11],[33,12,34,11,"_ref"],[33,16,34,11],[33,23,34,11,"_asyncToGenerator"],[33,40,34,11],[33,41,34,11,"default"],[33,48,34,11],[33,50,34,13],[33,63,34,55],[34,10,35,6],[35,10,36,6],[35,14,36,6,"_yield$supabase$from$"],[35,35,36,6],[35,44,36,53,"supabase"],[35,56,36,61],[35,57,36,61,"supabase"],[35,65,36,61],[35,66,37,9,"from"],[35,70,37,13],[35,71,37,14],[35,86,37,29],[35,87,37,30],[35,88,38,9,"select"],[35,94,38,15],[35,95,39,10],[36,0,40,0],[37,0,41,0],[38,0,42,0],[39,0,43,0],[40,0,44,0],[41,0,45,0],[42,0,46,0],[43,0,47,0],[44,0,48,0],[45,0,49,0],[46,0,50,0],[47,0,51,0],[48,0,52,0],[49,0,53,0],[50,0,54,0],[51,0,55,0],[52,0,56,0],[53,0,57,0],[54,0,58,0],[55,0,59,0],[56,0,60,0],[57,0,61,0],[58,0,62,0],[58,9,63,8],[58,10,63,9],[58,11,64,9,"eq"],[58,13,64,11],[58,14,64,12],[58,18,64,16],[58,20,64,18,"conversationId"],[58,34,64,32],[58,35,64,33],[58,36,65,9,"single"],[58,42,65,15],[58,43,65,16],[58,44,65,17],[59,12,36,20,"conv"],[59,16,36,24],[59,19,36,24,"_yield$supabase$from$"],[59,40,36,24],[59,41,36,14,"data"],[59,45,36,18],[60,12,36,33,"convError"],[60,21,36,42],[60,24,36,42,"_yield$supabase$from$"],[60,45,36,42],[60,46,36,26,"error"],[60,51,36,31],[61,10,67,6],[61,14,67,10,"convError"],[61,23,67,19],[61,27,67,23],[61,28,67,24,"conv"],[61,32,67,28],[61,34,67,30],[61,41,67,37],[61,45,67,41],[62,10,69,6],[62,14,69,12,"match"],[62,19,69,17],[62,22,69,20,"conv"],[62,26,69,24],[62,27,69,25,"matches"],[62,34,88,7],[64,10,90,6],[65,10,91,6],[65,14,91,6,"_yield$supabase$from$2"],[65,36,91,6],[65,45,91,43,"supabase"],[65,57,91,51],[65,58,91,51,"supabase"],[65,66,91,51],[65,67,92,9,"from"],[65,71,92,13],[65,72,92,14],[65,87,92,29],[65,88,92,30],[65,89,93,9,"select"],[65,95,93,15],[65,96,93,16],[65,147,93,67],[65,148,93,68],[65,149,94,9,"eq"],[65,151,94,11],[65,152,94,12],[65,164,94,24],[65,166,94,26,"match"],[65,171,94,31],[65,172,94,32,"listings"],[65,180,94,40],[65,181,94,41,"id"],[65,183,94,43],[65,184,94,44],[66,12,91,20,"listingItems"],[66,24,91,32],[66,27,91,32,"_yield$supabase$from$2"],[66,49,91,32],[66,50,91,14,"data"],[66,54,91,18],[68,10,96,6],[69,10,97,6],[69,14,97,6,"_yield$supabase$from$3"],[69,36,97,6],[69,45,97,41,"supabase"],[69,57,97,49],[69,58,97,49,"supabase"],[69,66,97,49],[69,67,98,9,"from"],[69,71,98,13],[69,72,98,14],[69,85,98,27],[69,86,98,28],[69,87,99,9,"select"],[69,93,99,15],[69,94,99,16],[69,145,99,67],[69,146,99,68],[69,147,100,9,"eq"],[69,149,100,11],[69,150,100,12],[69,160,100,22],[69,162,100,24,"match"],[69,167,100,29],[69,168,100,30,"offers"],[69,174,100,36],[69,175,100,37,"id"],[69,177,100,39],[69,178,100,40],[70,12,97,20,"offerItems"],[70,22,97,30],[70,25,97,30,"_yield$supabase$from$3"],[70,47,97,30],[70,48,97,14,"data"],[70,52,97,18],[71,10,102,6],[71,17,102,13],[72,12,103,8,"listingId"],[72,21,103,17],[72,23,103,19,"match"],[72,28,103,24],[72,29,103,25,"listings"],[72,37,103,33],[72,38,103,34,"id"],[72,40,103,36],[73,12,104,8,"listingTitle"],[73,24,104,20],[73,26,104,22,"match"],[73,31,104,27],[73,32,104,28,"listings"],[73,40,104,36],[73,41,104,37,"title"],[73,46,104,42],[74,12,105,8,"listingType"],[74,23,105,19],[74,25,105,21,"match"],[74,30,105,26],[74,31,105,27,"listings"],[74,39,105,35],[74,40,105,36,"type"],[74,44,105,55],[75,12,106,8,"listingTcg"],[75,22,106,18],[75,24,106,20,"match"],[75,29,106,25],[75,30,106,26,"listings"],[75,38,106,34],[75,39,106,35,"tcg"],[75,42,106,49],[76,12,107,8,"listingOwnerId"],[76,26,107,22],[76,28,107,24,"match"],[76,33,107,29],[76,34,107,30,"listings"],[76,42,107,38],[76,43,107,39,"user_id"],[76,50,107,46],[77,12,108,8,"listingItems"],[77,24,108,20],[77,26,108,22],[77,27,108,23,"listingItems"],[77,39,108,35],[77,43,108,39],[77,45,108,41],[77,47,108,43,"map"],[77,50,108,46],[77,51,108,48,"li"],[77,53,108,50],[77,58,108,56],[78,14,109,10,"cardName"],[78,22,109,18],[78,24,109,20,"li"],[78,26,109,22],[78,27,109,23,"card_name"],[78,36,109,32],[79,14,110,10,"cardImageUrl"],[79,26,110,22],[79,28,110,24,"li"],[79,30,110,26],[79,31,110,27,"card_image_url"],[79,45,110,41],[80,14,111,10,"quantity"],[80,22,111,18],[80,24,111,20,"li"],[80,26,111,22],[80,27,111,23,"quantity"],[80,35,111,31],[81,14,112,10,"marketPrice"],[81,25,112,21],[81,27,112,23,"li"],[81,29,112,25],[81,30,112,26,"market_price"],[82,12,113,8],[82,13,113,9],[82,14,113,10],[82,15,113,11],[83,12,114,8,"listingTotalValue"],[83,29,114,25],[83,31,114,27,"match"],[83,36,114,32],[83,37,114,33,"listings"],[83,45,114,41],[83,46,114,42,"total_value"],[83,57,114,53],[84,12,115,8,"offererId"],[84,21,115,17],[84,23,115,19,"match"],[84,28,115,24],[84,29,115,25,"offers"],[84,35,115,31],[84,36,115,32,"offerer_id"],[84,46,115,42],[85,12,116,8,"offerItems"],[85,22,116,18],[85,24,116,20],[85,25,116,21,"offerItems"],[85,35,116,31],[85,39,116,35],[85,41,116,37],[85,43,116,39,"map"],[85,46,116,42],[85,47,116,44,"oi"],[85,49,116,46],[85,54,116,52],[86,14,117,10,"cardName"],[86,22,117,18],[86,24,117,20,"oi"],[86,26,117,22],[86,27,117,23,"card_name"],[86,36,117,32],[87,14,118,10,"cardImageUrl"],[87,26,118,22],[87,28,118,24,"oi"],[87,30,118,26],[87,31,118,27,"card_image_url"],[87,45,118,41],[88,14,119,10,"quantity"],[88,22,119,18],[88,24,119,20,"oi"],[88,26,119,22],[88,27,119,23,"quantity"],[88,35,119,31],[89,14,120,10,"marketPrice"],[89,25,120,21],[89,27,120,23,"oi"],[89,29,120,25],[89,30,120,26,"market_price"],[90,12,121,8],[90,13,121,9],[90,14,121,10],[90,15,121,11],[91,12,122,8,"offerCashAmount"],[91,27,122,23],[91,29,122,25,"match"],[91,34,122,30],[91,35,122,31,"offers"],[91,41,122,37],[91,42,122,38,"cash_amount"],[91,53,122,49],[92,12,123,8,"negotiationStatus"],[92,29,123,25],[92,31,123,27,"conv"],[92,35,123,31],[92,36,123,32,"negotiation_status"],[93,10,124,6],[93,11,124,7],[94,8,125,4],[94,9,125,5],[95,8,125,5],[95,24,34,4,"queryFn"],[95,31,34,11,"queryFn"],[95,32,34,11],[96,10,34,11],[96,17,34,11,"_ref"],[96,21,34,11],[96,22,34,11,"apply"],[96,27,34,11],[96,34,34,11,"arguments"],[96,43,34,11],[97,8,34,11],[98,6,34,11],[98,9,125,5],[99,6,126,4,"enabled"],[99,13,126,11],[99,15,126,13],[99,16,126,14],[99,17,126,15,"conversationId"],[99,31,126,29],[100,6,127,4,"staleTime"],[100,15,127,13],[100,17,127,15],[100,18,127,16],[100,21,127,19],[100,23,127,21],[100,26,127,24],[100,30,127,28],[100,31,127,30],[101,4,128,2],[101,5,128,3],[101,6,128,4],[102,2,129,0],[102,3,129,1],[103,2,129,2,"_s"],[103,4,129,2],[103,5,31,6,"useTradeContext"],[103,20,31,21],[104,4,31,21],[104,12,32,9,"useQuery"],[104,31,32,17],[104,32,32,17,"useQuery"],[104,40,32,17],[105,2,32,17],[106,2,131,0],[106,6,131,0,"_default"],[106,14,131,0],[106,17,131,15,"useTradeContext"],[106,32,131,30],[107,0,131,31],[107,3]],"functionMap":{"names":["<global>","useTradeContext","useQuery$argument_0.queryFn","map$argument_0"],"mappings":"AAA;wBC8B;aCG;+CC0E;UDK;2CCG;UDK;KDI;CDI"},"hasCjsExports":false},"type":"js/module"}]}
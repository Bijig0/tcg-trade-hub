{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":49,"index":49}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":50},"end":{"line":2,"column":42,"index":92}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":93},"end":{"line":3,"column":43,"index":136}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1], \"@tanstack/react-query\");\n  var _libSupabase = require(_dependencyMap[2], \"@/lib/supabase\");\n  var _queryKeys = require(_dependencyMap[3], \"../../queryKeys\");\n  /**\n   * Fetches the trade context for a conversation — listing info, offer info,\n   * and negotiation status. Joins through conversations → matches → listings/offers.\n   */\n  var useTradeContext = conversationId => {\n    _s();\n    return (0, _tanstackReactQuery.useQuery)({\n      queryKey: _queryKeys.chatKeys.tradeContext(conversationId),\n      queryFn: function () {\n        var _ref = (0, _asyncToGenerator.default)(function* () {\n          // Get conversation with match, listing, and offer data\n          var _yield$supabase$from$ = yield _libSupabase.supabase.from('conversations').select(`\n          id,\n          negotiation_status,\n          matches!inner (\n            id,\n            user_a_id,\n            user_b_id,\n            listing_id,\n            offer_id,\n            listings!inner (\n              id,\n              user_id,\n              title,\n              type,\n              tcg,\n              total_value\n            ),\n            offers!inner (\n              id,\n              offerer_id,\n              cash_amount\n            )\n          )\n        `).eq('id', conversationId).single(),\n            conv = _yield$supabase$from$.data,\n            convError = _yield$supabase$from$.error;\n          if (convError || !conv) return null;\n          var match = conv.matches;\n\n          // Fetch listing items\n          var _yield$supabase$from$2 = yield _libSupabase.supabase.from('listing_items').select('card_name, card_image_url, card_external_id, tcg, condition, quantity, market_price').eq('listing_id', match.listings.id),\n            listingItems = _yield$supabase$from$2.data;\n\n          // Fetch offer items\n          var _yield$supabase$from$3 = yield _libSupabase.supabase.from('offer_items').select('card_name, card_image_url, card_external_id, tcg, condition, quantity, market_price').eq('offer_id', match.offers.id),\n            offerItems = _yield$supabase$from$3.data;\n\n          // Fetch user profiles for both sides\n          var userIds = [match.listings.user_id, match.offers.offerer_id];\n          var _yield$supabase$from$4 = yield _libSupabase.supabase.from('users').select('id, display_name, avatar_url, rating_score, total_trades').in('id', userIds),\n            profiles = _yield$supabase$from$4.data;\n          var profileMap = new Map((profiles ?? []).map(p => [p.id, {\n            id: p.id,\n            displayName: p.display_name,\n            avatarUrl: p.avatar_url,\n            ratingScore: p.rating_score,\n            totalTrades: p.total_trades\n          }]));\n          return {\n            listingId: match.listings.id,\n            listingTitle: match.listings.title,\n            listingType: match.listings.type,\n            listingTcg: match.listings.tcg,\n            listingOwnerId: match.listings.user_id,\n            listingItems: (listingItems ?? []).map(li => ({\n              cardName: li.card_name,\n              cardImageUrl: li.card_image_url,\n              cardExternalId: li.card_external_id,\n              tcg: li.tcg,\n              condition: li.condition,\n              quantity: li.quantity,\n              marketPrice: li.market_price\n            })),\n            listingTotalValue: match.listings.total_value,\n            offererId: match.offers.offerer_id,\n            offerItems: (offerItems ?? []).map(oi => ({\n              cardName: oi.card_name,\n              cardImageUrl: oi.card_image_url,\n              cardExternalId: oi.card_external_id,\n              tcg: oi.tcg,\n              condition: oi.condition,\n              quantity: oi.quantity,\n              marketPrice: oi.market_price\n            })),\n            offerCashAmount: match.offers.cash_amount,\n            negotiationStatus: conv.negotiation_status\n          };\n        });\n        return function queryFn() {\n          return _ref.apply(this, arguments);\n        };\n      }(),\n      enabled: !!conversationId,\n      staleTime: 5 * 60 * 1000 // 5 minutes\n    });\n  };\n  _s(useTradeContext, \"4ZpngI1uv+Uo3WQHEZmTQ5FNM+k=\", false, function () {\n    return [_tanstackReactQuery.useQuery];\n  });\n  var _default = useTradeContext;\n});","lineCount":125,"map":[[13,2,171,0,"Object"],[13,8,171,0],[13,9,171,0,"defineProperty"],[13,23,171,0],[13,24,171,0,"exports"],[13,31,171,0],[14,4,171,0,"enumerable"],[14,14,171,0],[15,4,171,0,"get"],[15,7,171,0],[15,18,171,0,"get"],[15,19,171,0],[16,6,171,0],[16,13,171,0,"_default"],[16,21,171,0],[17,4,171,0],[18,2,171,0],[19,2,171,31],[19,6,171,31,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,171,31],[19,45,171,31,"require"],[19,52,171,31],[19,53,171,31,"_dependencyMap"],[19,67,171,31],[20,2,171,31],[20,6,171,31,"_asyncToGenerator"],[20,23,171,31],[20,26,171,31,"_interopDefault"],[20,41,171,31],[20,42,171,31,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,171,31],[21,2,1,0],[21,6,1,0,"_tanstackReactQuery"],[21,25,1,0],[21,28,1,0,"require"],[21,35,1,0],[21,36,1,0,"_dependencyMap"],[21,50,1,0],[22,2,2,0],[22,6,2,0,"_libSupabase"],[22,18,2,0],[22,21,2,0,"require"],[22,28,2,0],[22,29,2,0,"_dependencyMap"],[22,43,2,0],[23,2,3,0],[23,6,3,0,"_queryKeys"],[23,16,3,0],[23,19,3,0,"require"],[23,26,3,0],[23,27,3,0,"_dependencyMap"],[23,41,3,0],[24,2,41,0],[25,0,42,0],[26,0,43,0],[27,0,44,0],[28,2,45,0],[28,6,45,6,"useTradeContext"],[28,21,45,21],[28,24,45,25,"conversationId"],[28,38,45,47],[28,42,45,52],[29,4,45,52,"_s"],[29,6,45,52],[30,4,46,2],[30,11,46,9],[30,15,46,9,"useQuery"],[30,34,46,17],[30,35,46,17,"useQuery"],[30,43,46,17],[30,45,46,18],[31,6,47,4,"queryKey"],[31,14,47,12],[31,16,47,14,"chatKeys"],[31,26,47,22],[31,27,47,22,"chatKeys"],[31,35,47,22],[31,36,47,23,"tradeContext"],[31,48,47,35],[31,49,47,36,"conversationId"],[31,63,47,50],[31,64,47,51],[32,6,48,4,"queryFn"],[32,13,48,11],[33,8,48,11],[33,12,48,11,"_ref"],[33,16,48,11],[33,23,48,11,"_asyncToGenerator"],[33,40,48,11],[33,41,48,11,"default"],[33,48,48,11],[33,50,48,13],[33,63,48,55],[34,10,49,6],[35,10,50,6],[35,14,50,6,"_yield$supabase$from$"],[35,35,50,6],[35,44,50,53,"supabase"],[35,56,50,61],[35,57,50,61,"supabase"],[35,65,50,61],[35,66,51,9,"from"],[35,70,51,13],[35,71,51,14],[35,86,51,29],[35,87,51,30],[35,88,52,9,"select"],[35,94,52,15],[35,95,53,10],[36,0,54,0],[37,0,55,0],[38,0,56,0],[39,0,57,0],[40,0,58,0],[41,0,59,0],[42,0,60,0],[43,0,61,0],[44,0,62,0],[45,0,63,0],[46,0,64,0],[47,0,65,0],[48,0,66,0],[49,0,67,0],[50,0,68,0],[51,0,69,0],[52,0,70,0],[53,0,71,0],[54,0,72,0],[55,0,73,0],[56,0,74,0],[57,0,75,0],[58,0,76,0],[58,9,77,8],[58,10,77,9],[58,11,78,9,"eq"],[58,13,78,11],[58,14,78,12],[58,18,78,16],[58,20,78,18,"conversationId"],[58,34,78,32],[58,35,78,33],[58,36,79,9,"single"],[58,42,79,15],[58,43,79,16],[58,44,79,17],[59,12,50,20,"conv"],[59,16,50,24],[59,19,50,24,"_yield$supabase$from$"],[59,40,50,24],[59,41,50,14,"data"],[59,45,50,18],[60,12,50,33,"convError"],[60,21,50,42],[60,24,50,42,"_yield$supabase$from$"],[60,45,50,42],[60,46,50,26,"error"],[60,51,50,31],[61,10,81,6],[61,14,81,10,"convError"],[61,23,81,19],[61,27,81,23],[61,28,81,24,"conv"],[61,32,81,28],[61,34,81,30],[61,41,81,37],[61,45,81,41],[62,10,83,6],[62,14,83,12,"match"],[62,19,83,17],[62,22,83,20,"conv"],[62,26,83,24],[62,27,83,25,"matches"],[62,34,102,7],[64,10,104,6],[65,10,105,6],[65,14,105,6,"_yield$supabase$from$2"],[65,36,105,6],[65,45,105,43,"supabase"],[65,57,105,51],[65,58,105,51,"supabase"],[65,66,105,51],[65,67,106,9,"from"],[65,71,106,13],[65,72,106,14],[65,87,106,29],[65,88,106,30],[65,89,107,9,"select"],[65,95,107,15],[65,96,107,16],[65,181,107,101],[65,182,107,102],[65,183,108,9,"eq"],[65,185,108,11],[65,186,108,12],[65,198,108,24],[65,200,108,26,"match"],[65,205,108,31],[65,206,108,32,"listings"],[65,214,108,40],[65,215,108,41,"id"],[65,217,108,43],[65,218,108,44],[66,12,105,20,"listingItems"],[66,24,105,32],[66,27,105,32,"_yield$supabase$from$2"],[66,49,105,32],[66,50,105,14,"data"],[66,54,105,18],[68,10,110,6],[69,10,111,6],[69,14,111,6,"_yield$supabase$from$3"],[69,36,111,6],[69,45,111,41,"supabase"],[69,57,111,49],[69,58,111,49,"supabase"],[69,66,111,49],[69,67,112,9,"from"],[69,71,112,13],[69,72,112,14],[69,85,112,27],[69,86,112,28],[69,87,113,9,"select"],[69,93,113,15],[69,94,113,16],[69,179,113,101],[69,180,113,102],[69,181,114,9,"eq"],[69,183,114,11],[69,184,114,12],[69,194,114,22],[69,196,114,24,"match"],[69,201,114,29],[69,202,114,30,"offers"],[69,208,114,36],[69,209,114,37,"id"],[69,211,114,39],[69,212,114,40],[70,12,111,20,"offerItems"],[70,22,111,30],[70,25,111,30,"_yield$supabase$from$3"],[70,47,111,30],[70,48,111,14,"data"],[70,52,111,18],[72,10,116,6],[73,10,117,6],[73,14,117,12,"userIds"],[73,21,117,19],[73,24,117,22],[73,25,117,23,"match"],[73,30,117,28],[73,31,117,29,"listings"],[73,39,117,37],[73,40,117,38,"user_id"],[73,47,117,45],[73,49,117,47,"match"],[73,54,117,52],[73,55,117,53,"offers"],[73,61,117,59],[73,62,117,60,"offerer_id"],[73,72,117,70],[73,73,117,71],[74,10,118,6],[74,14,118,6,"_yield$supabase$from$4"],[74,36,118,6],[74,45,118,39,"supabase"],[74,57,118,47],[74,58,118,47,"supabase"],[74,66,118,47],[74,67,119,9,"from"],[74,71,119,13],[74,72,119,14],[74,79,119,21],[74,80,119,22],[74,81,120,9,"select"],[74,87,120,15],[74,88,120,16],[74,146,120,74],[74,147,120,75],[74,148,121,9,"in"],[74,150,121,11],[74,151,121,12],[74,155,121,16],[74,157,121,18,"userIds"],[74,164,121,25],[74,165,121,26],[75,12,118,20,"profiles"],[75,20,118,28],[75,23,118,28,"_yield$supabase$from$4"],[75,45,118,28],[75,46,118,14,"data"],[75,50,118,18],[76,10,123,6],[76,14,123,12,"profileMap"],[76,24,123,22],[76,27,123,25],[76,31,123,29,"Map"],[76,34,123,32],[76,35,124,8],[76,36,124,9,"profiles"],[76,44,124,17],[76,48,124,21],[76,50,124,23],[76,52,124,25,"map"],[76,55,124,28],[76,56,124,30,"p"],[76,57,124,31],[76,61,124,36],[76,62,125,10,"p"],[76,63,125,11],[76,64,125,12,"id"],[76,66,125,14],[76,68,126,10],[77,12,127,12,"id"],[77,14,127,14],[77,16,127,16,"p"],[77,17,127,17],[77,18,127,18,"id"],[77,20,127,20],[78,12,128,12,"displayName"],[78,23,128,23],[78,25,128,25,"p"],[78,26,128,26],[78,27,128,27,"display_name"],[78,39,128,39],[79,12,129,12,"avatarUrl"],[79,21,129,21],[79,23,129,23,"p"],[79,24,129,24],[79,25,129,25,"avatar_url"],[79,35,129,35],[80,12,130,12,"ratingScore"],[80,23,130,23],[80,25,130,25,"p"],[80,26,130,26],[80,27,130,27,"rating_score"],[80,39,130,39],[81,12,131,12,"totalTrades"],[81,23,131,23],[81,25,131,25,"p"],[81,26,131,26],[81,27,131,27,"total_trades"],[82,10,132,10],[82,11,132,11],[82,12,133,9],[82,13,134,6],[82,14,134,7],[83,10,136,6],[83,17,136,13],[84,12,137,8,"listingId"],[84,21,137,17],[84,23,137,19,"match"],[84,28,137,24],[84,29,137,25,"listings"],[84,37,137,33],[84,38,137,34,"id"],[84,40,137,36],[85,12,138,8,"listingTitle"],[85,24,138,20],[85,26,138,22,"match"],[85,31,138,27],[85,32,138,28,"listings"],[85,40,138,36],[85,41,138,37,"title"],[85,46,138,42],[86,12,139,8,"listingType"],[86,23,139,19],[86,25,139,21,"match"],[86,30,139,26],[86,31,139,27,"listings"],[86,39,139,35],[86,40,139,36,"type"],[86,44,139,55],[87,12,140,8,"listingTcg"],[87,22,140,18],[87,24,140,20,"match"],[87,29,140,25],[87,30,140,26,"listings"],[87,38,140,34],[87,39,140,35,"tcg"],[87,42,140,49],[88,12,141,8,"listingOwnerId"],[88,26,141,22],[88,28,141,24,"match"],[88,33,141,29],[88,34,141,30,"listings"],[88,42,141,38],[88,43,141,39,"user_id"],[88,50,141,46],[89,12,142,8,"listingItems"],[89,24,142,20],[89,26,142,22],[89,27,142,23,"listingItems"],[89,39,142,35],[89,43,142,39],[89,45,142,41],[89,47,142,43,"map"],[89,50,142,46],[89,51,142,48,"li"],[89,53,142,50],[89,58,142,56],[90,14,143,10,"cardName"],[90,22,143,18],[90,24,143,20,"li"],[90,26,143,22],[90,27,143,23,"card_name"],[90,36,143,32],[91,14,144,10,"cardImageUrl"],[91,26,144,22],[91,28,144,24,"li"],[91,30,144,26],[91,31,144,27,"card_image_url"],[91,45,144,41],[92,14,145,10,"cardExternalId"],[92,28,145,24],[92,30,145,26,"li"],[92,32,145,28],[92,33,145,29,"card_external_id"],[92,49,145,45],[93,14,146,10,"tcg"],[93,17,146,13],[93,19,146,15,"li"],[93,21,146,17],[93,22,146,18,"tcg"],[93,25,146,21],[94,14,147,10,"condition"],[94,23,147,19],[94,25,147,21,"li"],[94,27,147,23],[94,28,147,24,"condition"],[94,37,147,33],[95,14,148,10,"quantity"],[95,22,148,18],[95,24,148,20,"li"],[95,26,148,22],[95,27,148,23,"quantity"],[95,35,148,31],[96,14,149,10,"marketPrice"],[96,25,149,21],[96,27,149,23,"li"],[96,29,149,25],[96,30,149,26,"market_price"],[97,12,150,8],[97,13,150,9],[97,14,150,10],[97,15,150,11],[98,12,151,8,"listingTotalValue"],[98,29,151,25],[98,31,151,27,"match"],[98,36,151,32],[98,37,151,33,"listings"],[98,45,151,41],[98,46,151,42,"total_value"],[98,57,151,53],[99,12,152,8,"offererId"],[99,21,152,17],[99,23,152,19,"match"],[99,28,152,24],[99,29,152,25,"offers"],[99,35,152,31],[99,36,152,32,"offerer_id"],[99,46,152,42],[100,12,153,8,"offerItems"],[100,22,153,18],[100,24,153,20],[100,25,153,21,"offerItems"],[100,35,153,31],[100,39,153,35],[100,41,153,37],[100,43,153,39,"map"],[100,46,153,42],[100,47,153,44,"oi"],[100,49,153,46],[100,54,153,52],[101,14,154,10,"cardName"],[101,22,154,18],[101,24,154,20,"oi"],[101,26,154,22],[101,27,154,23,"card_name"],[101,36,154,32],[102,14,155,10,"cardImageUrl"],[102,26,155,22],[102,28,155,24,"oi"],[102,30,155,26],[102,31,155,27,"card_image_url"],[102,45,155,41],[103,14,156,10,"cardExternalId"],[103,28,156,24],[103,30,156,26,"oi"],[103,32,156,28],[103,33,156,29,"card_external_id"],[103,49,156,45],[104,14,157,10,"tcg"],[104,17,157,13],[104,19,157,15,"oi"],[104,21,157,17],[104,22,157,18,"tcg"],[104,25,157,21],[105,14,158,10,"condition"],[105,23,158,19],[105,25,158,21,"oi"],[105,27,158,23],[105,28,158,24,"condition"],[105,37,158,33],[106,14,159,10,"quantity"],[106,22,159,18],[106,24,159,20,"oi"],[106,26,159,22],[106,27,159,23,"quantity"],[106,35,159,31],[107,14,160,10,"marketPrice"],[107,25,160,21],[107,27,160,23,"oi"],[107,29,160,25],[107,30,160,26,"market_price"],[108,12,161,8],[108,13,161,9],[108,14,161,10],[108,15,161,11],[109,12,162,8,"offerCashAmount"],[109,27,162,23],[109,29,162,25,"match"],[109,34,162,30],[109,35,162,31,"offers"],[109,41,162,37],[109,42,162,38,"cash_amount"],[109,53,162,49],[110,12,163,8,"negotiationStatus"],[110,29,163,25],[110,31,163,27,"conv"],[110,35,163,31],[110,36,163,32,"negotiation_status"],[111,10,164,6],[111,11,164,7],[112,8,165,4],[112,9,165,5],[113,8,165,5],[113,24,48,4,"queryFn"],[113,31,48,11,"queryFn"],[113,32,48,11],[114,10,48,11],[114,17,48,11,"_ref"],[114,21,48,11],[114,22,48,11,"apply"],[114,27,48,11],[114,34,48,11,"arguments"],[114,43,48,11],[115,8,48,11],[116,6,48,11],[116,9,165,5],[117,6,166,4,"enabled"],[117,13,166,11],[117,15,166,13],[117,16,166,14],[117,17,166,15,"conversationId"],[117,31,166,29],[118,6,167,4,"staleTime"],[118,15,167,13],[118,17,167,15],[118,18,167,16],[118,21,167,19],[118,23,167,21],[118,26,167,24],[118,30,167,28],[118,31,167,30],[119,4,168,2],[119,5,168,3],[119,6,168,4],[120,2,169,0],[120,3,169,1],[121,2,169,2,"_s"],[121,4,169,2],[121,5,45,6,"useTradeContext"],[121,20,45,21],[122,4,45,21],[122,12,46,9,"useQuery"],[122,31,46,17],[122,32,46,17,"useQuery"],[122,40,46,17],[123,2,46,17],[124,2,171,0],[124,6,171,0,"_default"],[124,14,171,0],[124,17,171,15,"useTradeContext"],[124,32,171,30],[125,0,171,31],[125,3]],"functionMap":{"names":["<global>","useTradeContext","useQuery$argument_0.queryFn","map$argument_0"],"mappings":"AAA;wBC4C;aCG;6BC4E;SDS;+CCS;UDQ;2CCG;UDQ;KDI;CDI"},"hasCjsExports":false},"type":"js/module"}]}
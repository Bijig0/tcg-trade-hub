{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var CONDITION_RANK = {\n    nm: 5,\n    lp: 4,\n    mp: 3,\n    hp: 2,\n    dmg: 1\n  };\n  var SEVEN_DAYS_MS = 604800000;\n\n  /**\n   * Checks if an item satisfies a single trade want.\n   * Returns true if the item matches the want criteria.\n   */\n  var itemMatchesWant = (item, want) => {\n    switch (want.type) {\n      case 'specific_card':\n        return item.card_external_id === want.card_external_id;\n      case 'sealed':\n        // Sealed items would have a product_type indicator — checking card_rarity as proxy\n        // In practice, listing_items don't have is_sealed; this matches on naming convention\n        return false;\n      // Sealed matching requires listing-level metadata not in listing_items\n\n      case 'slab':\n        // Graded items would have grading info — not stored in listing_items\n        return false;\n      // Slab matching requires collection-level metadata\n\n      case 'raw_cards':\n        {\n          if (want.min_condition == null) return true;\n          var itemRank = CONDITION_RANK[item.condition] ?? 0;\n          var minRank = CONDITION_RANK[want.min_condition] ?? 0;\n          return itemRank >= minRank;\n        }\n      case 'cash':\n        return false;\n      // Cash is informational, not item-matchable\n\n      case 'open_to_offers':\n        return true;\n      // Matches everything\n\n      case 'custom':\n        return false;\n      // Custom tags are not system-matchable\n    }\n  };\n\n  /**\n   * Finds trade opportunities for a user's listing by comparing against other active listings.\n   *\n   * Matching logic:\n   * - Forward match: other listing's items satisfy my trade_wants → \"has what you want\"\n   * - Reverse match: my listing's items satisfy their trade_wants → \"wants what you have\"\n   * - Mutual: both directions match\n   *\n   * Scoring:\n   * - Forward card match: +5 per matched item\n   * - Reverse match: +5 per matched item\n   * - Mutual bonus: +3\n   * - Same TCG: +2\n   * - Recency (7-day decay): +1 max\n   */\n  var findTradeOpportunities = (myListing, otherListings) => {\n    var opportunities = [];\n    for (var other of otherListings) {\n      // Skip same user\n      if (other.user_id === myListing.user_id) continue;\n      var forwardScore = 0;\n      var reverseScore = 0;\n      var matchedCardIds = [];\n\n      // Forward: do their items match my wants?\n      for (var want of myListing.trade_wants) {\n        for (var item of other.items) {\n          if (itemMatchesWant(item, want)) {\n            forwardScore += 5;\n            if (!matchedCardIds.includes(item.card_external_id)) {\n              matchedCardIds.push(item.card_external_id);\n            }\n          }\n        }\n      }\n\n      // Reverse: do my items match their wants?\n      for (var _want of other.trade_wants) {\n        for (var _item of myListing.items) {\n          if (itemMatchesWant(_item, _want)) {\n            reverseScore += 5;\n            if (!matchedCardIds.includes(_item.card_external_id)) {\n              matchedCardIds.push(_item.card_external_id);\n            }\n          }\n        }\n      }\n\n      // If no matches at all, skip\n      if (forwardScore === 0 && reverseScore === 0) continue;\n\n      // Determine match type\n      var matchType = undefined;\n      if (forwardScore > 0 && reverseScore > 0) {\n        matchType = 'mutual';\n      } else if (forwardScore > 0) {\n        matchType = 'has_what_you_want';\n      } else {\n        matchType = 'wants_what_you_have';\n      }\n\n      // Calculate total score\n      var score = forwardScore + reverseScore;\n\n      // Mutual bonus\n      if (matchType === 'mutual') {\n        score += 3;\n      }\n\n      // Same TCG bonus\n      if (other.tcg === myListing.tcg) {\n        score += 2;\n      }\n\n      // Recency bonus (7-day decay)\n      var ageMs = Date.now() - new Date(other.created_at).getTime();\n      if (ageMs < SEVEN_DAYS_MS) {\n        score += 1 - ageMs / SEVEN_DAYS_MS;\n      }\n      opportunities.push({\n        listing: other,\n        owner: other.owner,\n        matchType,\n        matchedCardIds,\n        score\n      });\n    }\n\n    // Sort by score descending\n    opportunities.sort((a, b) => b.score - a.score);\n    return opportunities;\n  };\n  var _default = findTradeOpportunities;\n});","lineCount":155,"map":[[7,2,164,0,"Object"],[7,8,164,0],[7,9,164,0,"defineProperty"],[7,23,164,0],[7,24,164,0,"exports"],[7,31,164,0],[8,4,164,0,"enumerable"],[8,14,164,0],[9,4,164,0,"get"],[9,7,164,0],[9,18,164,0,"get"],[9,19,164,0],[10,6,164,0],[10,13,164,0,"_default"],[10,21,164,0],[11,4,164,0],[12,2,164,0],[13,2,18,0],[13,6,18,6,"CONDITION_RANK"],[13,20,18,44],[13,23,18,47],[14,4,19,2,"nm"],[14,6,19,4],[14,8,19,6],[14,9,19,7],[15,4,20,2,"lp"],[15,6,20,4],[15,8,20,6],[15,9,20,7],[16,4,21,2,"mp"],[16,6,21,4],[16,8,21,6],[16,9,21,7],[17,4,22,2,"hp"],[17,6,22,4],[17,8,22,6],[17,9,22,7],[18,4,23,2,"dmg"],[18,7,23,5],[18,9,23,7],[19,2,24,0],[19,3,24,1],[20,2,26,0],[20,6,26,6,"SEVEN_DAYS_MS"],[20,19,26,19],[20,31,26,45],[22,2,28,0],[23,0,29,0],[24,0,30,0],[25,0,31,0],[26,2,32,0],[26,6,32,6,"itemMatchesWant"],[26,21,32,21],[26,24,32,24,"itemMatchesWant"],[26,25,32,25,"item"],[26,29,32,45],[26,31,32,47,"want"],[26,35,32,62],[26,40,32,76],[27,4,33,2],[27,12,33,10,"want"],[27,16,33,14],[27,17,33,15,"type"],[27,21,33,19],[28,6,34,4],[28,11,34,9],[28,26,34,24],[29,8,35,6],[29,15,35,13,"item"],[29,19,35,17],[29,20,35,18,"card_external_id"],[29,36,35,34],[29,41,35,39,"want"],[29,45,35,43],[29,46,35,44,"card_external_id"],[29,62,35,60],[30,6,37,4],[30,11,37,9],[30,19,37,17],[31,8,38,6],[32,8,39,6],[33,8,40,6],[33,15,40,13],[33,20,40,18],[34,6,40,20],[36,6,42,4],[36,11,42,9],[36,17,42,15],[37,8,43,6],[38,8,44,6],[38,15,44,13],[38,20,44,18],[39,6,44,20],[41,6,46,4],[41,11,46,9],[41,22,46,20],[42,8,46,22],[43,10,47,6],[43,14,47,10,"want"],[43,18,47,14],[43,19,47,15,"min_condition"],[43,32,47,28],[43,36,47,32],[43,40,47,36],[43,42,47,38],[43,49,47,45],[43,53,47,49],[44,10,48,6],[44,14,48,12,"itemRank"],[44,22,48,20],[44,25,48,23,"CONDITION_RANK"],[44,39,48,37],[44,40,48,38,"item"],[44,44,48,42],[44,45,48,43,"condition"],[44,54,48,52],[44,55,48,53],[44,59,48,57],[44,60,48,58],[45,10,49,6],[45,14,49,12,"minRank"],[45,21,49,19],[45,24,49,22,"CONDITION_RANK"],[45,38,49,36],[45,39,49,37,"want"],[45,43,49,41],[45,44,49,42,"min_condition"],[45,57,49,55],[45,58,49,56],[45,62,49,60],[45,63,49,61],[46,10,50,6],[46,17,50,13,"itemRank"],[46,25,50,21],[46,29,50,25,"minRank"],[46,36,50,32],[47,8,51,4],[48,6,53,4],[48,11,53,9],[48,17,53,15],[49,8,54,6],[49,15,54,13],[49,20,54,18],[50,6,54,20],[52,6,56,4],[52,11,56,9],[52,27,56,25],[53,8,57,6],[53,15,57,13],[53,19,57,17],[54,6,57,19],[56,6,59,4],[56,11,59,9],[56,19,59,17],[57,8,60,6],[57,15,60,13],[57,20,60,18],[58,6,60,20],[59,4,61,2],[60,2,62,0],[60,3,62,1],[62,2,64,0],[63,0,65,0],[64,0,66,0],[65,0,67,0],[66,0,68,0],[67,0,69,0],[68,0,70,0],[69,0,71,0],[70,0,72,0],[71,0,73,0],[72,0,74,0],[73,0,75,0],[74,0,76,0],[75,0,77,0],[76,0,78,0],[77,2,79,0],[77,6,79,6,"findTradeOpportunities"],[77,28,79,28],[77,31,79,31,"findTradeOpportunities"],[77,32,80,2,"myListing"],[77,41,80,27],[77,43,81,2,"otherListings"],[77,56,81,36],[77,61,82,25],[78,4,83,2],[78,8,83,8,"opportunities"],[78,21,83,41],[78,24,83,44],[78,26,83,46],[79,4,85,2],[79,9,85,7],[79,13,85,13,"other"],[79,18,85,18],[79,22,85,22,"otherListings"],[79,35,85,35],[79,37,85,37],[80,6,86,4],[81,6,87,4],[81,10,87,8,"other"],[81,15,87,13],[81,16,87,14,"user_id"],[81,23,87,21],[81,28,87,26,"myListing"],[81,37,87,35],[81,38,87,36,"user_id"],[81,45,87,43],[81,47,87,45],[82,6,89,4],[82,10,89,8,"forwardScore"],[82,22,89,20],[82,25,89,23],[82,26,89,24],[83,6,90,4],[83,10,90,8,"reverseScore"],[83,22,90,20],[83,25,90,23],[83,26,90,24],[84,6,91,4],[84,10,91,10,"matchedCardIds"],[84,24,91,34],[84,27,91,37],[84,29,91,39],[86,6,93,4],[87,6,94,4],[87,11,94,9],[87,15,94,15,"want"],[87,19,94,19],[87,23,94,23,"myListing"],[87,32,94,32],[87,33,94,33,"trade_wants"],[87,44,94,44],[87,46,94,46],[88,8,95,6],[88,13,95,11],[88,17,95,17,"item"],[88,21,95,21],[88,25,95,25,"other"],[88,30,95,30],[88,31,95,31,"items"],[88,36,95,36],[88,38,95,38],[89,10,96,8],[89,14,96,12,"itemMatchesWant"],[89,29,96,27],[89,30,96,28,"item"],[89,34,96,32],[89,36,96,34,"want"],[89,40,96,38],[89,41,96,39],[89,43,96,41],[90,12,97,10,"forwardScore"],[90,24,97,22],[90,28,97,26],[90,29,97,27],[91,12,98,10],[91,16,98,14],[91,17,98,15,"matchedCardIds"],[91,31,98,29],[91,32,98,30,"includes"],[91,40,98,38],[91,41,98,39,"item"],[91,45,98,43],[91,46,98,44,"card_external_id"],[91,62,98,60],[91,63,98,61],[91,65,98,63],[92,14,99,12,"matchedCardIds"],[92,28,99,26],[92,29,99,27,"push"],[92,33,99,31],[92,34,99,32,"item"],[92,38,99,36],[92,39,99,37,"card_external_id"],[92,55,99,53],[92,56,99,54],[93,12,100,10],[94,10,101,8],[95,8,102,6],[96,6,103,4],[98,6,105,4],[99,6,106,4],[99,11,106,9],[99,15,106,15,"want"],[99,20,106,19],[99,24,106,23,"other"],[99,29,106,28],[99,30,106,29,"trade_wants"],[99,41,106,40],[99,43,106,42],[100,8,107,6],[100,13,107,11],[100,17,107,17,"item"],[100,22,107,21],[100,26,107,25,"myListing"],[100,35,107,34],[100,36,107,35,"items"],[100,41,107,40],[100,43,107,42],[101,10,108,8],[101,14,108,12,"itemMatchesWant"],[101,29,108,27],[101,30,108,28,"item"],[101,35,108,32],[101,37,108,34,"want"],[101,42,108,38],[101,43,108,39],[101,45,108,41],[102,12,109,10,"reverseScore"],[102,24,109,22],[102,28,109,26],[102,29,109,27],[103,12,110,10],[103,16,110,14],[103,17,110,15,"matchedCardIds"],[103,31,110,29],[103,32,110,30,"includes"],[103,40,110,38],[103,41,110,39,"item"],[103,46,110,43],[103,47,110,44,"card_external_id"],[103,63,110,60],[103,64,110,61],[103,66,110,63],[104,14,111,12,"matchedCardIds"],[104,28,111,26],[104,29,111,27,"push"],[104,33,111,31],[104,34,111,32,"item"],[104,39,111,36],[104,40,111,37,"card_external_id"],[104,56,111,53],[104,57,111,54],[105,12,112,10],[106,10,113,8],[107,8,114,6],[108,6,115,4],[110,6,117,4],[111,6,118,4],[111,10,118,8,"forwardScore"],[111,22,118,20],[111,27,118,25],[111,28,118,26],[111,32,118,30,"reverseScore"],[111,44,118,42],[111,49,118,47],[111,50,118,48],[111,52,118,50],[113,6,120,4],[114,6,121,4],[114,10,121,8,"matchType"],[114,19,121,44],[114,22,121,44,"undefined"],[114,31,121,44],[115,6,122,4],[115,10,122,8,"forwardScore"],[115,22,122,20],[115,25,122,23],[115,26,122,24],[115,30,122,28,"reverseScore"],[115,42,122,40],[115,45,122,43],[115,46,122,44],[115,48,122,46],[116,8,123,6,"matchType"],[116,17,123,15],[116,20,123,18],[116,28,123,26],[117,6,124,4],[117,7,124,5],[117,13,124,11],[117,17,124,15,"forwardScore"],[117,29,124,27],[117,32,124,30],[117,33,124,31],[117,35,124,33],[118,8,125,6,"matchType"],[118,17,125,15],[118,20,125,18],[118,39,125,37],[119,6,126,4],[119,7,126,5],[119,13,126,11],[120,8,127,6,"matchType"],[120,17,127,15],[120,20,127,18],[120,41,127,39],[121,6,128,4],[123,6,130,4],[124,6,131,4],[124,10,131,8,"score"],[124,15,131,13],[124,18,131,16,"forwardScore"],[124,30,131,28],[124,33,131,31,"reverseScore"],[124,45,131,43],[126,6,133,4],[127,6,134,4],[127,10,134,8,"matchType"],[127,19,134,17],[127,24,134,22],[127,32,134,30],[127,34,134,32],[128,8,135,6,"score"],[128,13,135,11],[128,17,135,15],[128,18,135,16],[129,6,136,4],[131,6,138,4],[132,6,139,4],[132,10,139,8,"other"],[132,15,139,13],[132,16,139,14,"tcg"],[132,19,139,17],[132,24,139,22,"myListing"],[132,33,139,31],[132,34,139,32,"tcg"],[132,37,139,35],[132,39,139,37],[133,8,140,6,"score"],[133,13,140,11],[133,17,140,15],[133,18,140,16],[134,6,141,4],[136,6,143,4],[137,6,144,4],[137,10,144,10,"ageMs"],[137,15,144,15],[137,18,144,18,"Date"],[137,22,144,22],[137,23,144,23,"now"],[137,26,144,26],[137,27,144,27],[137,28,144,28],[137,31,144,31],[137,35,144,35,"Date"],[137,39,144,39],[137,40,144,40,"other"],[137,45,144,45],[137,46,144,46,"created_at"],[137,56,144,56],[137,57,144,57],[137,58,144,58,"getTime"],[137,65,144,65],[137,66,144,66],[137,67,144,67],[138,6,145,4],[138,10,145,8,"ageMs"],[138,15,145,13],[138,18,145,16,"SEVEN_DAYS_MS"],[138,31,145,29],[138,33,145,31],[139,8,146,6,"score"],[139,13,146,11],[139,17,146,15],[139,18,146,16],[139,21,146,19,"ageMs"],[139,26,146,24],[139,29,146,27,"SEVEN_DAYS_MS"],[139,42,146,40],[140,6,147,4],[141,6,149,4,"opportunities"],[141,19,149,17],[141,20,149,18,"push"],[141,24,149,22],[141,25,149,23],[142,8,150,6,"listing"],[142,15,150,13],[142,17,150,15,"other"],[142,22,150,20],[143,8,151,6,"owner"],[143,13,151,11],[143,15,151,13,"other"],[143,20,151,18],[143,21,151,19,"owner"],[143,26,151,24],[144,8,152,6,"matchType"],[144,17,152,15],[145,8,153,6,"matchedCardIds"],[145,22,153,20],[146,8,154,6,"score"],[147,6,155,4],[147,7,155,5],[147,8,155,6],[148,4,156,2],[150,4,158,2],[151,4,159,2,"opportunities"],[151,17,159,15],[151,18,159,16,"sort"],[151,22,159,20],[151,23,159,21],[151,24,159,22,"a"],[151,25,159,23],[151,27,159,25,"b"],[151,28,159,26],[151,33,159,31,"b"],[151,34,159,32],[151,35,159,33,"score"],[151,40,159,38],[151,43,159,41,"a"],[151,44,159,42],[151,45,159,43,"score"],[151,50,159,48],[151,51,159,49],[152,4,161,2],[152,11,161,9,"opportunities"],[152,24,161,22],[153,2,162,0],[153,3,162,1],[154,2,164,0],[154,6,164,0,"_default"],[154,14,164,0],[154,17,164,15,"findTradeOpportunities"],[154,39,164,37],[155,0,164,38],[155,3]],"functionMap":{"names":["<global>","itemMatchesWant","findTradeOpportunities","opportunities.sort$argument_0"],"mappings":"AAA;wBC+B;CD8B;+BEiB;qBCgF,2BD;CFG"},"hasCjsExports":false},"type":"js/module"}]}
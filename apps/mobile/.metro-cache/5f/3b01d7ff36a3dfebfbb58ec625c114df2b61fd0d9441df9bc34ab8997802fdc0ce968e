{"dependencies":[{"name":"@babel/runtime/helpers/slicedToArray","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"5y7e5+zC7teYEEC6niD9f5zII1M=","exportNames":["*"],"imports":1}},{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":65,"index":65}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":66},"end":{"line":2,"column":42,"index":108}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"@/context/AuthProvider","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":109},"end":{"line":3,"column":49,"index":158}}],"key":"hnDMt1RwOyVwgo481TGNr6ITBm4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersSlicedToArray = require(_dependencyMap[0], \"@babel/runtime/helpers/slicedToArray\");\n  var _slicedToArray = _interopDefault(_babelRuntimeHelpersSlicedToArray);\n  var _react = require(_dependencyMap[1], \"react\");\n  var _libSupabase = require(_dependencyMap[2], \"@/lib/supabase\");\n  var _contextAuthProvider = require(_dependencyMap[3], \"@/context/AuthProvider\");\n  var THROTTLE_MS = 2_000;\n  var AUTO_CLEAR_MS = 4_000;\n  /**\n   * Broadcast-based typing indicator for a conversation.\n   *\n   * Uses Supabase Realtime Broadcast (no persistence) on channel `typing:{conversationId}`.\n   * - `sendTypingStart()` fires at most once every 2 s.\n   * - `sendTypingStop()` fires immediately.\n   * - `isOtherUserTyping` auto-clears after 4 s without a stop event.\n   */\n  var useTypingIndicator = conversationId => {\n    _s();\n    var _useAuth = (0, _contextAuthProvider.useAuth)(),\n      user = _useAuth.user;\n    var _useState = (0, _react.useState)(false),\n      _useState2 = (0, _slicedToArray.default)(_useState, 2),\n      isOtherUserTyping = _useState2[0],\n      setIsOtherUserTyping = _useState2[1];\n    var lastSentRef = (0, _react.useRef)(0);\n    var clearTimerRef = (0, _react.useRef)(null);\n    var channelRef = (0, _react.useRef)(null);\n\n    // Subscribe to typing events from the other user\n    (0, _react.useEffect)(() => {\n      if (!conversationId || !user) return;\n      var channel = _libSupabase.supabase.channel(`typing:${conversationId}`);\n      channelRef.current = channel;\n      channel.on('broadcast', {\n        event: 'typing'\n      }, _ref => {\n        var payload = _ref.payload;\n        var data = payload;\n        if (data.userId === user.id) return; // Ignore own events\n\n        if (data.event === 'start') {\n          setIsOtherUserTyping(true);\n\n          // Auto-clear after 4 s\n          if (clearTimerRef.current) clearTimeout(clearTimerRef.current);\n          clearTimerRef.current = setTimeout(() => {\n            setIsOtherUserTyping(false);\n          }, AUTO_CLEAR_MS);\n        } else {\n          setIsOtherUserTyping(false);\n          if (clearTimerRef.current) clearTimeout(clearTimerRef.current);\n        }\n      }).subscribe();\n      return () => {\n        if (clearTimerRef.current) clearTimeout(clearTimerRef.current);\n        _libSupabase.supabase.removeChannel(channel);\n        channelRef.current = null;\n      };\n    }, [conversationId, user]);\n    var sendTypingStart = (0, _react.useCallback)(() => {\n      if (!user || !channelRef.current) return;\n      var now = Date.now();\n      if (now - lastSentRef.current < THROTTLE_MS) return;\n      lastSentRef.current = now;\n      channelRef.current.send({\n        type: 'broadcast',\n        event: 'typing',\n        payload: {\n          userId: user.id,\n          event: 'start'\n        }\n      });\n    }, [user]);\n    var sendTypingStop = (0, _react.useCallback)(() => {\n      if (!user || !channelRef.current) return;\n      lastSentRef.current = 0; // Reset throttle so next start fires immediately\n\n      channelRef.current.send({\n        type: 'broadcast',\n        event: 'typing',\n        payload: {\n          userId: user.id,\n          event: 'stop'\n        }\n      });\n    }, [user]);\n    return {\n      isOtherUserTyping,\n      sendTypingStart,\n      sendTypingStop\n    };\n  };\n  _s(useTypingIndicator, \"Bbbgu2ahwv4rt4mCA+2yt+fAlYM=\", false, function () {\n    return [_contextAuthProvider.useAuth];\n  });\n  var _default = useTypingIndicator;\n});","lineCount":114,"map":[[13,2,91,0,"Object"],[13,8,91,0],[13,9,91,0,"defineProperty"],[13,23,91,0],[13,24,91,0,"exports"],[13,31,91,0],[14,4,91,0,"enumerable"],[14,14,91,0],[15,4,91,0,"get"],[15,7,91,0],[15,18,91,0,"get"],[15,19,91,0],[16,6,91,0],[16,13,91,0,"_default"],[16,21,91,0],[17,4,91,0],[18,2,91,0],[19,2,91,34],[19,6,91,34,"_babelRuntimeHelpersSlicedToArray"],[19,39,91,34],[19,42,91,34,"require"],[19,49,91,34],[19,50,91,34,"_dependencyMap"],[19,64,91,34],[20,2,91,34],[20,6,91,34,"_slicedToArray"],[20,20,91,34],[20,23,91,34,"_interopDefault"],[20,38,91,34],[20,39,91,34,"_babelRuntimeHelpersSlicedToArray"],[20,72,91,34],[21,2,1,0],[21,6,1,0,"_react"],[21,12,1,0],[21,15,1,0,"require"],[21,22,1,0],[21,23,1,0,"_dependencyMap"],[21,37,1,0],[22,2,2,0],[22,6,2,0,"_libSupabase"],[22,18,2,0],[22,21,2,0,"require"],[22,28,2,0],[22,29,2,0,"_dependencyMap"],[22,43,2,0],[23,2,3,0],[23,6,3,0,"_contextAuthProvider"],[23,26,3,0],[23,29,3,0,"require"],[23,36,3,0],[23,37,3,0,"_dependencyMap"],[23,51,3,0],[24,2,5,0],[24,6,5,6,"THROTTLE_MS"],[24,17,5,17],[24,20,5,20],[24,25,5,25],[25,2,6,0],[25,6,6,6,"AUTO_CLEAR_MS"],[25,19,6,19],[25,22,6,22],[25,27,6,27],[26,2,13,0],[27,0,14,0],[28,0,15,0],[29,0,16,0],[30,0,17,0],[31,0,18,0],[32,0,19,0],[33,0,20,0],[34,2,21,0],[34,6,21,6,"useTypingIndicator"],[34,24,21,24],[34,27,21,28,"conversationId"],[34,41,21,50],[34,45,21,55],[35,4,21,55,"_s"],[35,6,21,55],[36,4,22,2],[36,8,22,2,"_useAuth"],[36,16,22,2],[36,19,22,19],[36,23,22,19,"useAuth"],[36,43,22,26],[36,44,22,26,"useAuth"],[36,51,22,26],[36,53,22,27],[36,54,22,28],[37,6,22,10,"user"],[37,10,22,14],[37,13,22,14,"_useAuth"],[37,21,22,14],[37,22,22,10,"user"],[37,26,22,14],[38,4,23,2],[38,8,23,2,"_useState"],[38,17,23,2],[38,20,23,52],[38,24,23,52,"useState"],[38,30,23,60],[38,31,23,60,"useState"],[38,39,23,60],[38,41,23,61],[38,46,23,66],[38,47,23,67],[39,6,23,67,"_useState2"],[39,16,23,67],[39,23,23,67,"_slicedToArray"],[39,37,23,67],[39,38,23,67,"default"],[39,45,23,67],[39,47,23,67,"_useState"],[39,56,23,67],[40,6,23,9,"isOtherUserTyping"],[40,23,23,26],[40,26,23,26,"_useState2"],[40,36,23,26],[41,6,23,28,"setIsOtherUserTyping"],[41,26,23,48],[41,29,23,48,"_useState2"],[41,39,23,48],[42,4,24,2],[42,8,24,8,"lastSentRef"],[42,19,24,19],[42,22,24,22],[42,26,24,22,"useRef"],[42,32,24,28],[42,33,24,28,"useRef"],[42,39,24,28],[42,41,24,29],[42,42,24,30],[42,43,24,31],[43,4,25,2],[43,8,25,8,"clearTimerRef"],[43,21,25,21],[43,24,25,24],[43,28,25,24,"useRef"],[43,34,25,30],[43,35,25,30,"useRef"],[43,41,25,30],[43,43,25,69],[43,47,25,73],[43,48,25,74],[44,4,26,2],[44,8,26,8,"channelRef"],[44,18,26,18],[44,21,26,21],[44,25,26,21,"useRef"],[44,31,26,27],[44,32,26,27,"useRef"],[44,38,26,27],[44,40,26,72],[44,44,26,76],[44,45,26,77],[46,4,28,2],[47,4,29,2],[47,8,29,2,"useEffect"],[47,14,29,11],[47,15,29,11,"useEffect"],[47,24,29,11],[47,26,29,12],[47,32,29,18],[48,6,30,4],[48,10,30,8],[48,11,30,9,"conversationId"],[48,25,30,23],[48,29,30,27],[48,30,30,28,"user"],[48,34,30,32],[48,36,30,34],[49,6,32,4],[49,10,32,10,"channel"],[49,17,32,17],[49,20,32,20,"supabase"],[49,32,32,28],[49,33,32,28,"supabase"],[49,41,32,28],[49,42,32,29,"channel"],[49,49,32,36],[49,50,32,37],[49,60,32,47,"conversationId"],[49,74,32,61],[49,76,32,63],[49,77,32,64],[50,6,33,4,"channelRef"],[50,16,33,14],[50,17,33,15,"current"],[50,24,33,22],[50,27,33,25,"channel"],[50,34,33,32],[51,6,35,4,"channel"],[51,13,35,11],[51,14,36,7,"on"],[51,16,36,9],[51,17,36,10],[51,28,36,21],[51,30,36,23],[52,8,36,25,"event"],[52,13,36,30],[52,15,36,32],[53,6,36,41],[53,7,36,42],[53,9,36,44,"_ref"],[53,13,36,44],[53,17,36,61],[54,8,36,61],[54,12,36,47,"payload"],[54,19,36,54],[54,22,36,54,"_ref"],[54,26,36,54],[54,27,36,47,"payload"],[54,34,36,54],[55,8,37,8],[55,12,37,14,"data"],[55,16,37,18],[55,19,37,21,"payload"],[55,26,37,43],[56,8,38,8],[56,12,38,12,"data"],[56,16,38,16],[56,17,38,17,"userId"],[56,23,38,23],[56,28,38,28,"user"],[56,32,38,32],[56,33,38,33,"id"],[56,35,38,35],[56,37,38,37],[56,44,38,44],[56,45,38,45],[58,8,40,8],[58,12,40,12,"data"],[58,16,40,16],[58,17,40,17,"event"],[58,22,40,22],[58,27,40,27],[58,34,40,34],[58,36,40,36],[59,10,41,10,"setIsOtherUserTyping"],[59,30,41,30],[59,31,41,31],[59,35,41,35],[59,36,41,36],[61,10,43,10],[62,10,44,10],[62,14,44,14,"clearTimerRef"],[62,27,44,27],[62,28,44,28,"current"],[62,35,44,35],[62,37,44,37,"clearTimeout"],[62,49,44,49],[62,50,44,50,"clearTimerRef"],[62,63,44,63],[62,64,44,64,"current"],[62,71,44,71],[62,72,44,72],[63,10,45,10,"clearTimerRef"],[63,23,45,23],[63,24,45,24,"current"],[63,31,45,31],[63,34,45,34,"setTimeout"],[63,44,45,44],[63,45,45,45],[63,51,45,51],[64,12,46,12,"setIsOtherUserTyping"],[64,32,46,32],[64,33,46,33],[64,38,46,38],[64,39,46,39],[65,10,47,10],[65,11,47,11],[65,13,47,13,"AUTO_CLEAR_MS"],[65,26,47,26],[65,27,47,27],[66,8,48,8],[66,9,48,9],[66,15,48,15],[67,10,49,10,"setIsOtherUserTyping"],[67,30,49,30],[67,31,49,31],[67,36,49,36],[67,37,49,37],[68,10,50,10],[68,14,50,14,"clearTimerRef"],[68,27,50,27],[68,28,50,28,"current"],[68,35,50,35],[68,37,50,37,"clearTimeout"],[68,49,50,49],[68,50,50,50,"clearTimerRef"],[68,63,50,63],[68,64,50,64,"current"],[68,71,50,71],[68,72,50,72],[69,8,51,8],[70,6,52,6],[70,7,52,7],[70,8,52,8],[70,9,53,7,"subscribe"],[70,18,53,16],[70,19,53,17],[70,20,53,18],[71,6,55,4],[71,13,55,11],[71,19,55,17],[72,8,56,6],[72,12,56,10,"clearTimerRef"],[72,25,56,23],[72,26,56,24,"current"],[72,33,56,31],[72,35,56,33,"clearTimeout"],[72,47,56,45],[72,48,56,46,"clearTimerRef"],[72,61,56,59],[72,62,56,60,"current"],[72,69,56,67],[72,70,56,68],[73,8,57,6,"supabase"],[73,20,57,14],[73,21,57,14,"supabase"],[73,29,57,14],[73,30,57,15,"removeChannel"],[73,43,57,28],[73,44,57,29,"channel"],[73,51,57,36],[73,52,57,37],[74,8,58,6,"channelRef"],[74,18,58,16],[74,19,58,17,"current"],[74,26,58,24],[74,29,58,27],[74,33,58,31],[75,6,59,4],[75,7,59,5],[76,4,60,2],[76,5,60,3],[76,7,60,5],[76,8,60,6,"conversationId"],[76,22,60,20],[76,24,60,22,"user"],[76,28,60,26],[76,29,60,27],[76,30,60,28],[77,4,62,2],[77,8,62,8,"sendTypingStart"],[77,23,62,23],[77,26,62,26],[77,30,62,26,"useCallback"],[77,36,62,37],[77,37,62,37,"useCallback"],[77,48,62,37],[77,50,62,38],[77,56,62,44],[78,6,63,4],[78,10,63,8],[78,11,63,9,"user"],[78,15,63,13],[78,19,63,17],[78,20,63,18,"channelRef"],[78,30,63,28],[78,31,63,29,"current"],[78,38,63,36],[78,40,63,38],[79,6,65,4],[79,10,65,10,"now"],[79,13,65,13],[79,16,65,16,"Date"],[79,20,65,20],[79,21,65,21,"now"],[79,24,65,24],[79,25,65,25],[79,26,65,26],[80,6,66,4],[80,10,66,8,"now"],[80,13,66,11],[80,16,66,14,"lastSentRef"],[80,27,66,25],[80,28,66,26,"current"],[80,35,66,33],[80,38,66,36,"THROTTLE_MS"],[80,49,66,47],[80,51,66,49],[81,6,67,4,"lastSentRef"],[81,17,67,15],[81,18,67,16,"current"],[81,25,67,23],[81,28,67,26,"now"],[81,31,67,29],[82,6,69,4,"channelRef"],[82,16,69,14],[82,17,69,15,"current"],[82,24,69,22],[82,25,69,23,"send"],[82,29,69,27],[82,30,69,28],[83,8,70,6,"type"],[83,12,70,10],[83,14,70,12],[83,25,70,23],[84,8,71,6,"event"],[84,13,71,11],[84,15,71,13],[84,23,71,21],[85,8,72,6,"payload"],[85,15,72,13],[85,17,72,15],[86,10,72,17,"userId"],[86,16,72,23],[86,18,72,25,"user"],[86,22,72,29],[86,23,72,30,"id"],[86,25,72,32],[87,10,72,34,"event"],[87,15,72,39],[87,17,72,41],[88,8,72,49],[89,6,73,4],[89,7,73,5],[89,8,73,6],[90,4,74,2],[90,5,74,3],[90,7,74,5],[90,8,74,6,"user"],[90,12,74,10],[90,13,74,11],[90,14,74,12],[91,4,76,2],[91,8,76,8,"sendTypingStop"],[91,22,76,22],[91,25,76,25],[91,29,76,25,"useCallback"],[91,35,76,36],[91,36,76,36,"useCallback"],[91,47,76,36],[91,49,76,37],[91,55,76,43],[92,6,77,4],[92,10,77,8],[92,11,77,9,"user"],[92,15,77,13],[92,19,77,17],[92,20,77,18,"channelRef"],[92,30,77,28],[92,31,77,29,"current"],[92,38,77,36],[92,40,77,38],[93,6,79,4,"lastSentRef"],[93,17,79,15],[93,18,79,16,"current"],[93,25,79,23],[93,28,79,26],[93,29,79,27],[93,30,79,28],[93,31,79,29],[95,6,81,4,"channelRef"],[95,16,81,14],[95,17,81,15,"current"],[95,24,81,22],[95,25,81,23,"send"],[95,29,81,27],[95,30,81,28],[96,8,82,6,"type"],[96,12,82,10],[96,14,82,12],[96,25,82,23],[97,8,83,6,"event"],[97,13,83,11],[97,15,83,13],[97,23,83,21],[98,8,84,6,"payload"],[98,15,84,13],[98,17,84,15],[99,10,84,17,"userId"],[99,16,84,23],[99,18,84,25,"user"],[99,22,84,29],[99,23,84,30,"id"],[99,25,84,32],[100,10,84,34,"event"],[100,15,84,39],[100,17,84,41],[101,8,84,48],[102,6,85,4],[102,7,85,5],[102,8,85,6],[103,4,86,2],[103,5,86,3],[103,7,86,5],[103,8,86,6,"user"],[103,12,86,10],[103,13,86,11],[103,14,86,12],[104,4,88,2],[104,11,88,9],[105,6,88,11,"isOtherUserTyping"],[105,23,88,28],[106,6,88,30,"sendTypingStart"],[106,21,88,45],[107,6,88,47,"sendTypingStop"],[108,4,88,62],[108,5,88,63],[109,2,89,0],[109,3,89,1],[110,2,89,2,"_s"],[110,4,89,2],[110,5,21,6,"useTypingIndicator"],[110,23,21,24],[111,4,21,24],[111,12,22,19,"useAuth"],[111,32,22,26],[111,33,22,26,"useAuth"],[111,40,22,26],[112,2,22,26],[113,2,91,0],[113,6,91,0,"_default"],[113,14,91,0],[113,17,91,15,"useTypingIndicator"],[113,35,91,33],[114,0,91,34],[114,3]],"functionMap":{"names":["<global>","useTypingIndicator","useEffect$argument_0","channel.on$argument_2","setTimeout$argument_0","<anonymous>","sendTypingStart","sendTypingStop"],"mappings":"AAA;2BCoB;YCQ;4CCO;6CCS;WDE;ODK;WGG;KHI;GDC;sCKE;GLY;qCME;GNU;CDG"},"hasCjsExports":false},"type":"js/module"}]}
{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":68,"index":68}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"expo-router","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":69},"end":{"line":2,"column":40,"index":109}}],"key":"/+ErnBisjrT6aDU+GRp5Qz/lYoY=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":110},"end":{"line":3,"column":42,"index":152}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":153},"end":{"line":4,"column":46,"index":199}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}},{"name":"@/services/devLiveEmitter/devLiveEmitter","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":200},"end":{"line":5,"column":85,"index":285}}],"key":"+12q/uGkja92D/Tp4S2X61mlsvU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0]);\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1]);\n  var _expoRouter = require(_dependencyMap[2]);\n  var _libSupabase = require(_dependencyMap[3]);\n  var _queryKeys = require(_dependencyMap[4]);\n  var _servicesDevLiveEmitterDevLiveEmitter = require(_dependencyMap[5]);\n  /**\n   * Mutation that accepts or declines an offer via atomic Postgres RPC.\n   *\n   * On accept: atomically accepts the offer, declines all sibling offers,\n   * creates a match + conversation, and transitions the listing to matched.\n   * Then navigates to the new chat.\n   *\n   * On decline: atomically declines the single offer.\n   *\n   * @see packages/api/src/pipelines/acceptOffer/acceptOffer.ts\n   * @see packages/api/src/pipelines/declineOffer/declineOffer.ts\n   */\n  var useRespondToOffer = () => {\n    var queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    var router = (0, _expoRouter.useRouter)();\n    return (0, _tanstackReactQuery.useMutation)({\n      mutationFn: function () {\n        var _ref2 = (0, _asyncToGenerator.default)(function* (_ref) {\n          var offerId = _ref.offerId,\n            listingId = _ref.listingId,\n            action = _ref.action;\n          var pipelineId = action === 'accepted' ? 'pipeline:acceptOffer' : 'pipeline:declineOffer';\n          var scoped = undefined;\n          scoped?.(0, 'started');\n          var _yield$supabase$auth$ = yield _libSupabase.supabase.auth.getSession(),\n            session = _yield$supabase$auth$.data.session;\n          var userId = session?.user?.id;\n          if (!userId) throw new Error('Not authenticated');\n          try {\n            if (action === 'accepted') {\n              var _yield$supabase$rpc = yield _libSupabase.supabase.rpc('accept_offer_v1', {\n                  p_offer_id: offerId,\n                  p_listing_id: listingId,\n                  p_user_id: userId\n                }),\n                data = _yield$supabase$rpc.data,\n                _error = _yield$supabase$rpc.error;\n              if (_error) throw _error;\n              var result = data;\n              scoped?.(0, 'success');\n              return {\n                match_id: result.match_id,\n                conversation_id: result.conversation_id\n              };\n            }\n\n            // Decline\n            var _yield$supabase$rpc2 = yield _libSupabase.supabase.rpc('decline_offer_v1', {\n                p_offer_id: offerId,\n                p_user_id: userId\n              }),\n              error = _yield$supabase$rpc2.error;\n            if (error) throw error;\n            scoped?.(0, 'success');\n            return {\n              match_id: null,\n              conversation_id: null\n            };\n          } catch (err) {\n            scoped?.(0, 'error', {\n              message: err.message\n            });\n            throw err;\n          }\n        });\n        return function mutationFn(_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }(),\n      onSuccess: (data, variables) => {\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.offers(variables.listingId)\n        });\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.myListings()\n        });\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.detail(variables.listingId)\n        });\n        if (data.conversation_id) {\n          router.push(`/(tabs)/(messages)/chat/${data.conversation_id}`);\n        }\n      }\n    });\n  };\n  var _default = useRespondToOffer;\n});","lineCount":111,"map":[[12,2,95,0,"Object"],[12,8,95,0],[12,9,95,0,"defineProperty"],[12,23,95,0],[12,24,95,0,"exports"],[12,31,95,0],[13,4,95,0,"enumerable"],[13,14,95,0],[14,4,95,0,"get"],[14,7,95,0],[14,18,95,0,"get"],[14,19,95,0],[15,6,95,0],[15,13,95,0,"_default"],[15,21,95,0],[16,4,95,0],[17,2,95,0],[18,2,95,33],[18,6,95,33,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,95,33],[18,45,95,33,"require"],[18,52,95,33],[18,53,95,33,"_dependencyMap"],[18,67,95,33],[19,2,95,33],[19,6,95,33,"_asyncToGenerator"],[19,23,95,33],[19,26,95,33,"_interopDefault"],[19,41,95,33],[19,42,95,33,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,95,33],[20,2,1,0],[20,6,1,0,"_tanstackReactQuery"],[20,25,1,0],[20,28,1,0,"require"],[20,35,1,0],[20,36,1,0,"_dependencyMap"],[20,50,1,0],[21,2,2,0],[21,6,2,0,"_expoRouter"],[21,17,2,0],[21,20,2,0,"require"],[21,27,2,0],[21,28,2,0,"_dependencyMap"],[21,42,2,0],[22,2,3,0],[22,6,3,0,"_libSupabase"],[22,18,3,0],[22,21,3,0,"require"],[22,28,3,0],[22,29,3,0,"_dependencyMap"],[22,43,3,0],[23,2,4,0],[23,6,4,0,"_queryKeys"],[23,16,4,0],[23,19,4,0,"require"],[23,26,4,0],[23,27,4,0,"_dependencyMap"],[23,41,4,0],[24,2,5,0],[24,6,5,0,"_servicesDevLiveEmitterDevLiveEmitter"],[24,43,5,0],[24,46,5,0,"require"],[24,53,5,0],[24,54,5,0,"_dependencyMap"],[24,68,5,0],[25,2,18,0],[26,0,19,0],[27,0,20,0],[28,0,21,0],[29,0,22,0],[30,0,23,0],[31,0,24,0],[32,0,25,0],[33,0,26,0],[34,0,27,0],[35,0,28,0],[36,0,29,0],[37,2,30,0],[37,6,30,6,"useRespondToOffer"],[37,23,30,23],[37,26,30,26,"useRespondToOffer"],[37,27,30,26],[37,32,30,32],[38,4,31,2],[38,8,31,8,"queryClient"],[38,19,31,19],[38,22,31,22],[38,26,31,22,"useQueryClient"],[38,45,31,36],[38,46,31,36,"useQueryClient"],[38,60,31,36],[38,62,31,37],[38,63,31,38],[39,4,32,2],[39,8,32,8,"router"],[39,14,32,14],[39,17,32,17],[39,21,32,17,"useRouter"],[39,32,32,26],[39,33,32,26,"useRouter"],[39,42,32,26],[39,44,32,27],[39,45,32,28],[40,4,34,2],[40,11,34,9],[40,15,34,9,"useMutation"],[40,34,34,20],[40,35,34,20,"useMutation"],[40,46,34,20],[40,48,34,57],[41,6,35,4,"mutationFn"],[41,16,35,14],[42,8,35,14],[42,12,35,14,"_ref2"],[42,17,35,14],[42,24,35,14,"_asyncToGenerator"],[42,41,35,14],[42,42,35,14,"default"],[42,49,35,14],[42,51,35,16],[42,62,35,16,"_ref"],[42,66,35,16],[42,68,35,58],[43,10,35,58],[43,14,35,25,"offerId"],[43,21,35,32],[43,24,35,32,"_ref"],[43,28,35,32],[43,29,35,25,"offerId"],[43,36,35,32],[44,12,35,34,"listingId"],[44,21,35,43],[44,24,35,43,"_ref"],[44,28,35,43],[44,29,35,34,"listingId"],[44,38,35,43],[45,12,35,45,"action"],[45,18,35,51],[45,21,35,51,"_ref"],[45,25,35,51],[45,26,35,45,"action"],[45,32,35,51],[46,10,36,6],[46,14,36,12,"pipelineId"],[46,24,36,22],[46,27,36,25,"action"],[46,33,36,31],[46,38,36,36],[46,48,36,46],[46,51,36,49],[46,73,36,71],[46,76,36,74],[46,99,36,97],[47,10,37,6],[47,14,37,12,"scoped"],[47,20,37,18],[47,23,39,10,"undefined"],[47,32,39,19],[48,10,41,6,"scoped"],[48,16,41,12],[48,19,41,15],[48,20,41,16],[48,22,41,18],[48,31,41,27],[48,32,41,28],[49,10,43,6],[49,14,43,6,"_yield$supabase$auth$"],[49,35,43,6],[49,44,45,16,"supabase"],[49,56,45,24],[49,57,45,24,"supabase"],[49,65,45,24],[49,66,45,25,"auth"],[49,70,45,29],[49,71,45,30,"getSession"],[49,81,45,40],[49,82,45,41],[49,83,45,42],[50,12,44,16,"session"],[50,19,44,23],[50,22,44,23,"_yield$supabase$auth$"],[50,43,44,23],[50,44,44,8,"data"],[50,48,44,12],[50,49,44,16,"session"],[50,56,44,23],[51,10,46,6],[51,14,46,12,"userId"],[51,20,46,18],[51,23,46,21,"session"],[51,30,46,28],[51,32,46,30,"user"],[51,36,46,34],[51,38,46,36,"id"],[51,40,46,38],[52,10,48,6],[52,14,48,10],[52,15,48,11,"userId"],[52,21,48,17],[52,23,48,19],[52,29,48,25],[52,33,48,29,"Error"],[52,38,48,34],[52,39,48,35],[52,58,48,54],[52,59,48,55],[53,10,50,6],[53,14,50,10],[54,12,51,8],[54,16,51,12,"action"],[54,22,51,18],[54,27,51,23],[54,37,51,33],[54,39,51,35],[55,14,52,10],[55,18,52,10,"_yield$supabase$rpc"],[55,37,52,10],[55,46,52,40,"supabase"],[55,58,52,48],[55,59,52,48,"supabase"],[55,67,52,48],[55,68,52,49,"rpc"],[55,71,52,52],[55,72,52,53],[55,89,52,70],[55,91,52,72],[56,18,53,12,"p_offer_id"],[56,28,53,22],[56,30,53,24,"offerId"],[56,37,53,31],[57,18,54,12,"p_listing_id"],[57,30,54,24],[57,32,54,26,"listingId"],[57,41,54,35],[58,18,55,12,"p_user_id"],[58,27,55,21],[58,29,55,23,"userId"],[59,16,56,10],[59,17,56,11],[59,18,56,12],[60,16,52,18,"data"],[60,20,52,22],[60,23,52,22,"_yield$supabase$rpc"],[60,42,52,22],[60,43,52,18,"data"],[60,47,52,22],[61,16,52,24,"error"],[61,22,52,29],[61,25,52,29,"_yield$supabase$rpc"],[61,44,52,29],[61,45,52,24,"error"],[61,50,52,29],[62,14,58,10],[62,18,58,14,"error"],[62,24,58,19],[62,26,58,21],[62,32,58,27,"error"],[62,38,58,32],[63,14,60,10],[63,18,60,16,"result"],[63,24,60,22],[63,27,60,25,"data"],[63,31,60,78],[64,14,61,10,"scoped"],[64,20,61,16],[64,23,61,19],[64,24,61,20],[64,26,61,22],[64,35,61,31],[64,36,61,32],[65,14,62,10],[65,21,62,17],[66,16,63,12,"match_id"],[66,24,63,20],[66,26,63,22,"result"],[66,32,63,28],[66,33,63,29,"match_id"],[66,41,63,37],[67,16,64,12,"conversation_id"],[67,31,64,27],[67,33,64,29,"result"],[67,39,64,35],[67,40,64,36,"conversation_id"],[68,14,65,10],[68,15,65,11],[69,12,66,8],[71,12,68,8],[72,12,69,8],[72,16,69,8,"_yield$supabase$rpc2"],[72,36,69,8],[72,45,69,32,"supabase"],[72,57,69,40],[72,58,69,40,"supabase"],[72,66,69,40],[72,67,69,41,"rpc"],[72,70,69,44],[72,71,69,45],[72,89,69,63],[72,91,69,65],[73,16,70,10,"p_offer_id"],[73,26,70,20],[73,28,70,22,"offerId"],[73,35,70,29],[74,16,71,10,"p_user_id"],[74,25,71,19],[74,27,71,21,"userId"],[75,14,72,8],[75,15,72,9],[75,16,72,10],[76,14,69,16,"error"],[76,19,69,21],[76,22,69,21,"_yield$supabase$rpc2"],[76,42,69,21],[76,43,69,16,"error"],[76,48,69,21],[77,12,74,8],[77,16,74,12,"error"],[77,21,74,17],[77,23,74,19],[77,29,74,25,"error"],[77,34,74,30],[78,12,76,8,"scoped"],[78,18,76,14],[78,21,76,17],[78,22,76,18],[78,24,76,20],[78,33,76,29],[78,34,76,30],[79,12,77,8],[79,19,77,15],[80,14,77,17,"match_id"],[80,22,77,25],[80,24,77,27],[80,28,77,31],[81,14,77,33,"conversation_id"],[81,29,77,48],[81,31,77,50],[82,12,77,55],[82,13,77,56],[83,10,78,6],[83,11,78,7],[83,12,78,8],[83,19,78,15,"err"],[83,22,78,18],[83,24,78,20],[84,12,79,8,"scoped"],[84,18,79,14],[84,21,79,17],[84,22,79,18],[84,24,79,20],[84,31,79,27],[84,33,79,29],[85,14,79,31,"message"],[85,21,79,38],[85,23,79,41,"err"],[85,26,79,44],[85,27,79,55,"message"],[86,12,79,63],[86,13,79,64],[86,14,79,65],[87,12,80,8],[87,18,80,14,"err"],[87,21,80,17],[88,10,81,6],[89,8,82,4],[89,9,82,5],[90,8,82,5],[90,24,35,4,"mutationFn"],[90,34,35,14,"mutationFn"],[90,35,35,14,"_x"],[90,37,35,14],[91,10,35,14],[91,17,35,14,"_ref2"],[91,22,35,14],[91,23,35,14,"apply"],[91,28,35,14],[91,35,35,14,"arguments"],[91,44,35,14],[92,8,35,14],[93,6,35,14],[93,9,82,5],[94,6,83,4,"onSuccess"],[94,15,83,13],[94,17,83,15,"onSuccess"],[94,18,83,16,"data"],[94,22,83,20],[94,24,83,22,"variables"],[94,33,83,31],[94,38,83,36],[95,8,84,6,"queryClient"],[95,19,84,17],[95,20,84,18,"invalidateQueries"],[95,37,84,35],[95,38,84,36],[96,10,84,38,"queryKey"],[96,18,84,46],[96,20,84,48,"listingKeys"],[96,30,84,59],[96,31,84,59,"listingKeys"],[96,42,84,59],[96,43,84,60,"offers"],[96,49,84,66],[96,50,84,67,"variables"],[96,59,84,76],[96,60,84,77,"listingId"],[96,69,84,86],[97,8,84,88],[97,9,84,89],[97,10,84,90],[98,8,85,6,"queryClient"],[98,19,85,17],[98,20,85,18,"invalidateQueries"],[98,37,85,35],[98,38,85,36],[99,10,85,38,"queryKey"],[99,18,85,46],[99,20,85,48,"listingKeys"],[99,30,85,59],[99,31,85,59,"listingKeys"],[99,42,85,59],[99,43,85,60,"myListings"],[99,53,85,70],[99,54,85,71],[100,8,85,73],[100,9,85,74],[100,10,85,75],[101,8,86,6,"queryClient"],[101,19,86,17],[101,20,86,18,"invalidateQueries"],[101,37,86,35],[101,38,86,36],[102,10,86,38,"queryKey"],[102,18,86,46],[102,20,86,48,"listingKeys"],[102,30,86,59],[102,31,86,59,"listingKeys"],[102,42,86,59],[102,43,86,60,"detail"],[102,49,86,66],[102,50,86,67,"variables"],[102,59,86,76],[102,60,86,77,"listingId"],[102,69,86,86],[103,8,86,88],[103,9,86,89],[103,10,86,90],[104,8,88,6],[104,12,88,10,"data"],[104,16,88,14],[104,17,88,15,"conversation_id"],[104,32,88,30],[104,34,88,32],[105,10,89,8,"router"],[105,16,89,14],[105,17,89,15,"push"],[105,21,89,19],[105,22,89,20],[105,49,89,47,"data"],[105,53,89,51],[105,54,89,52,"conversation_id"],[105,69,89,67],[105,71,89,69],[105,72,89,70],[106,8,90,6],[107,6,91,4],[108,4,92,2],[108,5,92,3],[108,6,92,4],[109,2,93,0],[109,3,93,1],[110,2,95,0],[110,6,95,0,"_default"],[110,14,95,0],[110,17,95,15,"useRespondToOffer"],[110,34,95,32],[111,0,95,33],[111,3]],"functionMap":{"names":["<global>","useRespondToOffer","useMutation$argument_0.mutationFn","useMutation$argument_0.onSuccess"],"mappings":"AAA;0BC6B;gBCK;KD+C;eEC;KFQ;CDE"},"hasCjsExports":false},"type":"js/module"}]}
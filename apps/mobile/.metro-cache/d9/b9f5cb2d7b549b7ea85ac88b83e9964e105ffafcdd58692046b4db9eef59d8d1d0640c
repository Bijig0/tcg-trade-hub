{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":68,"index":68}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"expo-router","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":69},"end":{"line":2,"column":40,"index":109}}],"key":"/+ErnBisjrT6aDU+GRp5Qz/lYoY=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":110},"end":{"line":3,"column":42,"index":152}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"../../queryKeys","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":153},"end":{"line":4,"column":46,"index":199}}],"key":"9dB6801Llb9DiWHOk43CNQJdoj8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0]);\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _tanstackReactQuery = require(_dependencyMap[1]);\n  var _expoRouter = require(_dependencyMap[2]);\n  var _libSupabase = require(_dependencyMap[3]);\n  var _queryKeys = require(_dependencyMap[4]);\n  /**\n   * Mutation that accepts or declines an offer via atomic Postgres RPC.\n   *\n   * On accept: atomically accepts the offer, declines all sibling offers,\n   * creates a match + conversation, and transitions the listing to matched.\n   * Then navigates to the new chat.\n   *\n   * On decline: atomically declines the single offer.\n   *\n   * @see packages/api/src/pipelines/acceptOffer/acceptOffer.ts\n   * @see packages/api/src/pipelines/declineOffer/declineOffer.ts\n   */\n  var useRespondToOffer = () => {\n    var queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    var router = (0, _expoRouter.useRouter)();\n    return (0, _tanstackReactQuery.useMutation)({\n      mutationFn: function () {\n        var _ref2 = (0, _asyncToGenerator.default)(function* (_ref) {\n          var offerId = _ref.offerId,\n            listingId = _ref.listingId,\n            action = _ref.action;\n          var _yield$supabase$auth$ = yield _libSupabase.supabase.auth.getSession(),\n            session = _yield$supabase$auth$.data.session;\n          var userId = session?.user?.id;\n          if (!userId) throw new Error('Not authenticated');\n          if (action === 'accepted') {\n            var _yield$supabase$rpc = yield _libSupabase.supabase.rpc('accept_offer_v1', {\n                p_offer_id: offerId,\n                p_listing_id: listingId,\n                p_user_id: userId\n              }),\n              data = _yield$supabase$rpc.data,\n              _error = _yield$supabase$rpc.error;\n            if (_error) throw _error;\n            var result = data;\n            return {\n              match_id: result.match_id,\n              conversation_id: result.conversation_id\n            };\n          }\n\n          // Decline\n          var _yield$supabase$rpc2 = yield _libSupabase.supabase.rpc('decline_offer_v1', {\n              p_offer_id: offerId,\n              p_user_id: userId\n            }),\n            error = _yield$supabase$rpc2.error;\n          if (error) throw error;\n          return {\n            match_id: null,\n            conversation_id: null\n          };\n        });\n        return function mutationFn(_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }(),\n      onSuccess: (data, variables) => {\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.offers(variables.listingId)\n        });\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.myListings()\n        });\n        queryClient.invalidateQueries({\n          queryKey: _queryKeys.listingKeys.detail(variables.listingId)\n        });\n        if (data.conversation_id) {\n          router.push(`/(tabs)/(messages)/chat/${data.conversation_id}`);\n        }\n      }\n    });\n  };\n  var _default = useRespondToOffer;\n});","lineCount":98,"map":[[12,2,80,0,"Object"],[12,8,80,0],[12,9,80,0,"defineProperty"],[12,23,80,0],[12,24,80,0,"exports"],[12,31,80,0],[13,4,80,0,"enumerable"],[13,14,80,0],[14,4,80,0,"get"],[14,7,80,0],[14,18,80,0,"get"],[14,19,80,0],[15,6,80,0],[15,13,80,0,"_default"],[15,21,80,0],[16,4,80,0],[17,2,80,0],[18,2,80,33],[18,6,80,33,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,80,33],[18,45,80,33,"require"],[18,52,80,33],[18,53,80,33,"_dependencyMap"],[18,67,80,33],[19,2,80,33],[19,6,80,33,"_asyncToGenerator"],[19,23,80,33],[19,26,80,33,"_interopDefault"],[19,41,80,33],[19,42,80,33,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,80,33],[20,2,1,0],[20,6,1,0,"_tanstackReactQuery"],[20,25,1,0],[20,28,1,0,"require"],[20,35,1,0],[20,36,1,0,"_dependencyMap"],[20,50,1,0],[21,2,2,0],[21,6,2,0,"_expoRouter"],[21,17,2,0],[21,20,2,0,"require"],[21,27,2,0],[21,28,2,0,"_dependencyMap"],[21,42,2,0],[22,2,3,0],[22,6,3,0,"_libSupabase"],[22,18,3,0],[22,21,3,0,"require"],[22,28,3,0],[22,29,3,0,"_dependencyMap"],[22,43,3,0],[23,2,4,0],[23,6,4,0,"_queryKeys"],[23,16,4,0],[23,19,4,0,"require"],[23,26,4,0],[23,27,4,0,"_dependencyMap"],[23,41,4,0],[24,2,17,0],[25,0,18,0],[26,0,19,0],[27,0,20,0],[28,0,21,0],[29,0,22,0],[30,0,23,0],[31,0,24,0],[32,0,25,0],[33,0,26,0],[34,0,27,0],[35,0,28,0],[36,2,29,0],[36,6,29,6,"useRespondToOffer"],[36,23,29,23],[36,26,29,26,"useRespondToOffer"],[36,27,29,26],[36,32,29,32],[37,4,30,2],[37,8,30,8,"queryClient"],[37,19,30,19],[37,22,30,22],[37,26,30,22,"useQueryClient"],[37,45,30,36],[37,46,30,36,"useQueryClient"],[37,60,30,36],[37,62,30,37],[37,63,30,38],[38,4,31,2],[38,8,31,8,"router"],[38,14,31,14],[38,17,31,17],[38,21,31,17,"useRouter"],[38,32,31,26],[38,33,31,26,"useRouter"],[38,42,31,26],[38,44,31,27],[38,45,31,28],[39,4,33,2],[39,11,33,9],[39,15,33,9,"useMutation"],[39,34,33,20],[39,35,33,20,"useMutation"],[39,46,33,20],[39,48,33,57],[40,6,34,4,"mutationFn"],[40,16,34,14],[41,8,34,14],[41,12,34,14,"_ref2"],[41,17,34,14],[41,24,34,14,"_asyncToGenerator"],[41,41,34,14],[41,42,34,14,"default"],[41,49,34,14],[41,51,34,16],[41,62,34,16,"_ref"],[41,66,34,16],[41,68,34,58],[42,10,34,58],[42,14,34,25,"offerId"],[42,21,34,32],[42,24,34,32,"_ref"],[42,28,34,32],[42,29,34,25,"offerId"],[42,36,34,32],[43,12,34,34,"listingId"],[43,21,34,43],[43,24,34,43,"_ref"],[43,28,34,43],[43,29,34,34,"listingId"],[43,38,34,43],[44,12,34,45,"action"],[44,18,34,51],[44,21,34,51,"_ref"],[44,25,34,51],[44,26,34,45,"action"],[44,32,34,51],[45,10,35,6],[45,14,35,6,"_yield$supabase$auth$"],[45,35,35,6],[45,44,37,16,"supabase"],[45,56,37,24],[45,57,37,24,"supabase"],[45,65,37,24],[45,66,37,25,"auth"],[45,70,37,29],[45,71,37,30,"getSession"],[45,81,37,40],[45,82,37,41],[45,83,37,42],[46,12,36,16,"session"],[46,19,36,23],[46,22,36,23,"_yield$supabase$auth$"],[46,43,36,23],[46,44,36,8,"data"],[46,48,36,12],[46,49,36,16,"session"],[46,56,36,23],[47,10,38,6],[47,14,38,12,"userId"],[47,20,38,18],[47,23,38,21,"session"],[47,30,38,28],[47,32,38,30,"user"],[47,36,38,34],[47,38,38,36,"id"],[47,40,38,38],[48,10,40,6],[48,14,40,10],[48,15,40,11,"userId"],[48,21,40,17],[48,23,40,19],[48,29,40,25],[48,33,40,29,"Error"],[48,38,40,34],[48,39,40,35],[48,58,40,54],[48,59,40,55],[49,10,42,6],[49,14,42,10,"action"],[49,20,42,16],[49,25,42,21],[49,35,42,31],[49,37,42,33],[50,12,43,8],[50,16,43,8,"_yield$supabase$rpc"],[50,35,43,8],[50,44,43,38,"supabase"],[50,56,43,46],[50,57,43,46,"supabase"],[50,65,43,46],[50,66,43,47,"rpc"],[50,69,43,50],[50,70,43,51],[50,87,43,68],[50,89,43,70],[51,16,44,10,"p_offer_id"],[51,26,44,20],[51,28,44,22,"offerId"],[51,35,44,29],[52,16,45,10,"p_listing_id"],[52,28,45,22],[52,30,45,24,"listingId"],[52,39,45,33],[53,16,46,10,"p_user_id"],[53,25,46,19],[53,27,46,21,"userId"],[54,14,47,8],[54,15,47,9],[54,16,47,10],[55,14,43,16,"data"],[55,18,43,20],[55,21,43,20,"_yield$supabase$rpc"],[55,40,43,20],[55,41,43,16,"data"],[55,45,43,20],[56,14,43,22,"error"],[56,20,43,27],[56,23,43,27,"_yield$supabase$rpc"],[56,42,43,27],[56,43,43,22,"error"],[56,48,43,27],[57,12,49,8],[57,16,49,12,"error"],[57,22,49,17],[57,24,49,19],[57,30,49,25,"error"],[57,36,49,30],[58,12,51,8],[58,16,51,14,"result"],[58,22,51,20],[58,25,51,23,"data"],[58,29,51,76],[59,12,52,8],[59,19,52,15],[60,14,53,10,"match_id"],[60,22,53,18],[60,24,53,20,"result"],[60,30,53,26],[60,31,53,27,"match_id"],[60,39,53,35],[61,14,54,10,"conversation_id"],[61,29,54,25],[61,31,54,27,"result"],[61,37,54,33],[61,38,54,34,"conversation_id"],[62,12,55,8],[62,13,55,9],[63,10,56,6],[65,10,58,6],[66,10,59,6],[66,14,59,6,"_yield$supabase$rpc2"],[66,34,59,6],[66,43,59,30,"supabase"],[66,55,59,38],[66,56,59,38,"supabase"],[66,64,59,38],[66,65,59,39,"rpc"],[66,68,59,42],[66,69,59,43],[66,87,59,61],[66,89,59,63],[67,14,60,8,"p_offer_id"],[67,24,60,18],[67,26,60,20,"offerId"],[67,33,60,27],[68,14,61,8,"p_user_id"],[68,23,61,17],[68,25,61,19,"userId"],[69,12,62,6],[69,13,62,7],[69,14,62,8],[70,12,59,14,"error"],[70,17,59,19],[70,20,59,19,"_yield$supabase$rpc2"],[70,40,59,19],[70,41,59,14,"error"],[70,46,59,19],[71,10,64,6],[71,14,64,10,"error"],[71,19,64,15],[71,21,64,17],[71,27,64,23,"error"],[71,32,64,28],[72,10,66,6],[72,17,66,13],[73,12,66,15,"match_id"],[73,20,66,23],[73,22,66,25],[73,26,66,29],[74,12,66,31,"conversation_id"],[74,27,66,46],[74,29,66,48],[75,10,66,53],[75,11,66,54],[76,8,67,4],[76,9,67,5],[77,8,67,5],[77,24,34,4,"mutationFn"],[77,34,34,14,"mutationFn"],[77,35,34,14,"_x"],[77,37,34,14],[78,10,34,14],[78,17,34,14,"_ref2"],[78,22,34,14],[78,23,34,14,"apply"],[78,28,34,14],[78,35,34,14,"arguments"],[78,44,34,14],[79,8,34,14],[80,6,34,14],[80,9,67,5],[81,6,68,4,"onSuccess"],[81,15,68,13],[81,17,68,15,"onSuccess"],[81,18,68,16,"data"],[81,22,68,20],[81,24,68,22,"variables"],[81,33,68,31],[81,38,68,36],[82,8,69,6,"queryClient"],[82,19,69,17],[82,20,69,18,"invalidateQueries"],[82,37,69,35],[82,38,69,36],[83,10,69,38,"queryKey"],[83,18,69,46],[83,20,69,48,"listingKeys"],[83,30,69,59],[83,31,69,59,"listingKeys"],[83,42,69,59],[83,43,69,60,"offers"],[83,49,69,66],[83,50,69,67,"variables"],[83,59,69,76],[83,60,69,77,"listingId"],[83,69,69,86],[84,8,69,88],[84,9,69,89],[84,10,69,90],[85,8,70,6,"queryClient"],[85,19,70,17],[85,20,70,18,"invalidateQueries"],[85,37,70,35],[85,38,70,36],[86,10,70,38,"queryKey"],[86,18,70,46],[86,20,70,48,"listingKeys"],[86,30,70,59],[86,31,70,59,"listingKeys"],[86,42,70,59],[86,43,70,60,"myListings"],[86,53,70,70],[86,54,70,71],[87,8,70,73],[87,9,70,74],[87,10,70,75],[88,8,71,6,"queryClient"],[88,19,71,17],[88,20,71,18,"invalidateQueries"],[88,37,71,35],[88,38,71,36],[89,10,71,38,"queryKey"],[89,18,71,46],[89,20,71,48,"listingKeys"],[89,30,71,59],[89,31,71,59,"listingKeys"],[89,42,71,59],[89,43,71,60,"detail"],[89,49,71,66],[89,50,71,67,"variables"],[89,59,71,76],[89,60,71,77,"listingId"],[89,69,71,86],[90,8,71,88],[90,9,71,89],[90,10,71,90],[91,8,73,6],[91,12,73,10,"data"],[91,16,73,14],[91,17,73,15,"conversation_id"],[91,32,73,30],[91,34,73,32],[92,10,74,8,"router"],[92,16,74,14],[92,17,74,15,"push"],[92,21,74,19],[92,22,74,20],[92,49,74,47,"data"],[92,53,74,51],[92,54,74,52,"conversation_id"],[92,69,74,67],[92,71,74,69],[92,72,74,70],[93,8,75,6],[94,6,76,4],[95,4,77,2],[95,5,77,3],[95,6,77,4],[96,2,78,0],[96,3,78,1],[97,2,80,0],[97,6,80,0,"_default"],[97,14,80,0],[97,17,80,15,"useRespondToOffer"],[97,34,80,32],[98,0,80,33],[98,3]],"functionMap":{"names":["<global>","useRespondToOffer","useMutation$argument_0.mutationFn","useMutation$argument_0.onSuccess"],"mappings":"AAA;0BC4B;gBCK;KDiC;eEC;KFQ;CDE"},"hasCjsExports":false},"type":"js/module"}]}